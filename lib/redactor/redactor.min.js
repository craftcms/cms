!function(a){"use strict";function b(a,c){return new b.prototype.init(a,c)}Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;return function(){return b.apply(a)}});var c=0;a.fn.redactor=function(c){var d=[],e=Array.prototype.slice.call(arguments,1);return"string"==typeof c?this.each(function(){var b,f=a.data(this,"redactor");if("-1"!==c.search(/\./)?(b=c.split("."),"undefined"!=typeof f[b[0]]&&(b=f[b[0]][b[1]])):b=f[c],"undefined"!=typeof f&&a.isFunction(b)){var g=b.apply(f,e);void 0!==g&&g!==f&&d.push(g)}else a.error('No such method "'+c+'" for Redactor')}):this.each(function(){a.data(this,"redactor",{}),a.data(this,"redactor",b(this,c))}),0===d.length?this:1===d.length?d[0]:d},a.Redactor=b,a.Redactor.VERSION="2.7",a.Redactor.modules=["air","autosave","block","buffer","build","button","caret","clean","code","core","detect","dropdown","events","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","marker","modal","observe","offset","paragraphize","paste","placeholder","progress","selection","shortcuts","storage","toolbar","upload","uploads3","utils","browser"],a.Redactor.settings={},a.Redactor.opts={animation:!1,lang:"en",direction:"ltr",spellcheck:!0,overrideStyles:!0,scrollTarget:document,focus:!1,focusEnd:!1,clickToEdit:!1,structure:!1,tabindex:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:!1,callbacks:{},placeholder:!1,linkify:!0,enterKey:!0,pastePlainText:!1,pasteImages:!0,pasteLinks:!0,pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i"],preClass:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveFields:!1,imageUpload:null,imageUploadParam:"file",imageUploadFields:!1,imageUploadForms:!1,imageTag:"figure",imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",dragImageUpload:!0,multipleImageUpload:!0,clipboardImageUpload:!0,fileUpload:null,fileUploadParam:"file",fileUploadFields:!1,fileUploadForms:!1,dragFileUpload:!0,s3:!1,linkNewTab:!1,linkTooltip:!0,linkNofollow:!1,linkSize:30,pasteLinkTarget:!1,videoContainerClass:"video-container",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,air:!1,airWidth:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,buttons:["format","bold","italic","deleted","lists","image","file","link","horizontalrule"],buttonsTextLabeled:!1,buttonsHide:[],buttonsHideOnMobile:[],script:!0,removeNewlines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},keepStyleAttr:[],shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,activeButtons:["deleted","italic","bold"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted"},langs:{en:{format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U",lists:"Lists","link-insert":"Insert link","link-edit":"Edit link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line","upload-label":"Drop file here or ",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center","accessibility-help-label":"Rich text editor"}},type:"textarea",inline:!1,buffer:[],rebuffer:[],inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],paragraphize:!0,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",emptyHtmlRendered:a("").html("​").html(),imageTypes:["image/png","image/jpeg","image/gif"],userAgent:navigator.userAgent.toLowerCase(),observe:{dropdowns:[]},regexps:{linkyoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,linkvimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,linkimage:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},b.fn=a.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(b,d){return this.$element=a(b),this.uuid=c++,this.loadOptions(d),this.loadModules(),this.opts.clickToEdit&&!this.$element.hasClass("redactor-click-to-edit")?this.loadToEdit(d):(this.$element.hasClass("redactor-click-to-edit")&&this.$element.removeClass("redactor-click-to-edit"),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|").toUpperCase()+")$","i"),this.opts.dragImageUpload=null!==this.opts.imageUpload&&this.opts.dragImageUpload,this.opts.dragFileUpload=null!==this.opts.fileUpload&&this.opts.dragFileUpload,this.formatting={},this.lang.load(),a.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.$editor=this.$element,this.detectType(),this.core.callback("start"),this.core.callback("startToEdit"),this.start=!0,void this.build.start())},detectType:function(){this.build.isInline()||this.opts.inline?this.opts.type="inline":this.build.isTag("DIV")?this.opts.type="div":this.build.isTag("PRE")&&(this.opts.type="pre")},loadToEdit:function(b){this.$element.on("click.redactor-click-to-edit",a.proxy(function(){this.initToEdit(b)},this)),this.$element.addClass("redactor-click-to-edit")},initToEdit:function(b){a.extend(b.callbacks,{startToEdit:function(){this.insert.node(this.marker.get(),!1)},initToEdit:function(){this.selection.restore(),this.clickToCancelStorage=this.code.get(),a(this.opts.clickToCancel).off(".redactor-click-to-edit"),a(this.opts.clickToCancel).show().on("click.redactor-click-to-edit",a.proxy(function(c){c.preventDefault(),this.core.destroy(),this.events.syncFire=!1,this.$element.html(this.clickToCancelStorage),this.core.callback("cancel",this.clickToCancelStorage),this.events.syncFire=!0,this.clickToCancelStorage="",a(this.opts.clickToCancel).hide(),a(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",a.proxy(function(){this.initToEdit(b)},this)),this.$element.addClass("redactor-click-to-edit")},this)),a(this.opts.clickToSave).off(".redactor-click-to-edit"),a(this.opts.clickToSave).show().on("click.redactor-click-to-edit",a.proxy(function(c){c.preventDefault(),this.core.destroy(),this.core.callback("save",this.code.get()),a(this.opts.clickToCancel).hide(),a(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",a.proxy(function(){this.initToEdit(b)},this)),this.$element.addClass("redactor-click-to-edit")},this))}}),this.$element.redactor(b),this.$element.off(".redactor-click-to-edit")},loadOptions:function(b){var c={};"undefined"!=typeof a.Redactor.settings.namespace?this.$element.hasClass(a.Redactor.settings.namespace)&&(c=a.Redactor.settings):c=a.Redactor.settings,this.opts=a.extend({},a.Redactor.opts,this.$element.data(),b),this.opts=a.extend(!0,this.opts,c)},getModuleMethods:function(a){return Object.getOwnPropertyNames(a).filter(function(b){return"function"==typeof a[b]})},loadModules:function(){for(var b=a.Redactor.modules.length,c=0;c<b;c++)this.bindModuleMethods(a.Redactor.modules[c])},bindModuleMethods:function(a){if("undefined"!=typeof this[a]){this[a]=this[a]();for(var b=this.getModuleMethods(this[a]),c=b.length,d=0;d<c;d++)this[a][b[d]]=this[a][b[d]].bind(this)}},air:function(){return{enabled:!1,collapsed:function(){this.opts.air&&this.selection.get().collapseToStart()},collapsedEnd:function(){this.opts.air&&this.selection.get().collapseToEnd()},build:function(){this.detect.isMobile()||(this.button.hideButtons(),this.button.hideButtonsOnMobile(),0!==this.opts.buttons.length&&(this.$air=this.air.createContainer(),this.opts.airWidth!==!1&&this.$air.css("width",this.opts.airWidth),this.air.append(),this.button.$toolbar=this.$air,this.button.setFormatting(),this.button.load(this.$air),this.core.editor().on("mouseup.redactor",this,a.proxy(function(a){""!==this.selection.text()&&this.air.show(a)},this))))},append:function(){this.$air.appendTo("body")},createContainer:function(){return a("<ul>").addClass("redactor-air").attr({id:"redactor-air-"+this.uuid,role:"toolbar"}).hide()},show:function(b){this.selection.saveInstant(),a(".redactor-air").hide();var c=0,d=this.$air.innerWidth();a(window).width()<b.clientX+d&&(c=200),this.$air.css({left:b.clientX-c+"px",top:b.clientY+10+a(document).scrollTop()+"px"}).show(),this.air.enabled=!0,this.air.bindHide()},bindHide:function(){a(document).on("mousedown.redactor-air."+this.uuid,a.proxy(function(b){var c=a(b.target).closest(".redactor-dropdown").length;if(0===a(b.target).closest(this.$air).length&&0===c){var d=this.air.hide(b);d!==!1&&this.marker.remove()}},this)).on("keydown.redactor-air."+this.uuid,a.proxy(function(b){var c=b.which;if((this.utils.isRedactorParent(b.target)||a(b.target).hasClass("redactor-in"))&&0===a(b.target).closest("#redactor-modal").length){if(c===this.keyCode.ESC)this.selection.get().collapseToStart();else if(c===this.keyCode.BACKSPACE||c===this.keyCode.DELETE){var d=this.selection.get(),e=this.selection.range(d);e.deleteContents()}else c===this.keyCode.ENTER&&this.selection.get().collapseToEnd();this.air.enabled?this.air.hide(b):this.selection.get().collapseToStart()}},this))},hide:function(b){var c=b.ctrlKey||b.metaKey||b.shiftKey&&b.altKey;return!c&&(this.button.setInactiveAll(),this.$air.fadeOut(100),this.air.enabled=!1,a(document).off("mousedown.redactor-air."+this.uuid),void a(document).off("keydown.redactor-air."+this.uuid))}}},autosave:function(){return{enabled:!1,html:!1,init:function(){this.opts.autosave&&(this.autosave.enabled=!0,this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"))},is:function(){return this.autosave.enabled},send:function(){if(this.opts.autosave&&(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source)){var b={};b.name=this.autosave.name,b[this.autosave.name]=this.autosave.source,b=this.autosave.getHiddenFields(b);var c=a.ajax({url:this.opts.autosave,type:"post",data:b});c.done(this.autosave.success)}},getHiddenFields:function(b){return this.opts.autosaveFields===!1||"object"!=typeof this.opts.autosaveFields?b:(a.each(this.opts.autosaveFields,a.proxy(function(c,d){null!==d&&0===d.toString().indexOf("#")&&(d=a(d).val()),b[c]=d},this)),b)},success:function(a){var b;try{b=JSON.parse(a)}catch(c){b=a}var c="undefined"==typeof b.error?"autosave":"autosaveError";this.core.callback(c,this.autosave.name,b),this.autosave.html=this.autosave.source},disable:function(){this.autosave.enabled=!1,clearInterval(this.autosaveTimeout)}}},block:function(){return{format:function(b,c,d,e){if(b="quote"===b?"blockquote":b,this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],a.inArray(b,this.block.tags)!==-1)return"p"===b&&"undefined"==typeof c&&(c="class"),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(b,c,d,e):this.block.formatUncollapsed(b,c,d,e)},formatCollapsed:function(b,c,d,e){this.selection.save();var f=this.selection.block(),g=f.tagName.toLowerCase();if(a.inArray(g,this.block.tags)===-1)return void this.selection.restore();var h=!1;g===b&&void 0===c&&(b="p",h=!0),h&&(this.block.removeAllClass(),this.block.removeAllAttr());var i;if("blockquote"===g&&this.utils.isEndOfElement(f)){this.marker.remove(),i=document.createElement("p"),i.innerHTML=this.opts.invisibleSpace,a(f).after(i),this.caret.start(i);var j=a(f).children().last();0!==j.length&&"BR"===j[0].tagName&&j.remove()}else i=this.utils.replaceToTag(f,b);if("object"==typeof c){e=d;for(var k in c)i=this.block.setAttr(i,k,c[k],e)}else i=this.block.setAttr(i,c,d,e);return"pre"===b&&1===i.length&&a(i).html(a.trim(a(i).html())),this.selection.restore(),this.block.removeInlineTags(i),i},formatUncollapsed:function(b,c,d,e){this.selection.save();var f=[],g=this.selection.blocks();g[0]&&(a(g[0]).hasClass("redactor-in")||a(g[0]).hasClass("redactor-box"))&&(g=this.core.editor().find(this.opts.blockTags.join(", ")));for(var h=g.length,i=0;i<h;i++){var j=g[i].tagName.toLowerCase();if(a.inArray(j,this.block.tags)!==-1&&"figure"!==j){var k=this.utils.replaceToTag(g[i],b);if("object"==typeof c){e=d;for(var l in c)k=this.block.setAttr(k,l,c[l],e)}else k=this.block.setAttr(k,c,d,e);f.push(k),this.block.removeInlineTags(k)}}if(this.selection.restore(),"pre"===b&&0!==f.length){var m=f[0];a.each(f,function(b,c){0!==b&&(a(m).append("\n"+a.trim(c.html())),a(c).remove())}),f=[],f.push(m)}return f},removeInlineTags:function(b){b=b[0]||b;var c=this.opts.inlineTags,d=["PRE","H1","H2","H3","H4","H5","H6"];if(a.inArray(b.tagName,d)!==-1){if("PRE"!==b.tagName){var e=c.indexOf("a");c.splice(e,1)}a(b).find(c.join(",")).not(".redactor-selection-marker").contents().unwrap()}},setAttr:function(a,b,c,d){if("undefined"==typeof b)return a;var e="undefined"==typeof d?"replace":d;return a="class"===b?this.block[e+"Class"](c,a):"remove"===e?this.block[e+"Attr"](b,a):"removeAll"===e?this.block[e+"Attr"](b,a):this.block[e+"Attr"](b,c,a)},getBlocks:function(a){return"undefined"==typeof a?this.selection.blocks():a},replaceClass:function(b,c){return a(this.block.getBlocks(c)).removeAttr("class").addClass(b)[0]},toggleClass:function(b,c){return a(this.block.getBlocks(c)).toggleClass(b)[0]},addClass:function(b,c){return a(this.block.getBlocks(c)).addClass(b)[0]},removeClass:function(b,c){return a(this.block.getBlocks(c)).removeClass(b)[0]},removeAllClass:function(b){return a(this.block.getBlocks(b)).removeAttr("class")[0]},replaceAttr:function(b,c,d){return d=this.block.removeAttr(b,d),a(d).attr(b,c)[0]},toggleAttr:function(b,c,d){d=this.block.getBlocks(d);var e=this,f=[];return a.each(d,function(d,g){var h=a(g);h.attr(b)?f.push(e.block.removeAttr(b,g)):f.push(e.block.addAttr(b,c,g))}),f},addAttr:function(b,c,d){return a(this.block.getBlocks(d)).attr(b,c)[0]},removeAttr:function(b,c){return a(this.block.getBlocks(c)).removeAttr(b)[0]},removeAllAttr:function(b){b=this.block.getBlocks(b);var c=[];return a.each(b,function(b,d){"undefined"==typeof d.attributes&&c.push(d);for(var e=a(d),f=d.attributes.length,g=0;g<f;g++)e.removeAttr(d.attributes[g].name);c.push(e[0])}),c}}},buffer:function(){return{set:function(a){"undefined"==typeof a&&this.buffer.clear(),"undefined"==typeof a||"undo"===a?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){var a=this.selection.saveInstant(),b=this.opts.buffer[this.opts.buffer.length-1],c=this.core.editor().html(),d="undefined"==typeof b||b[0]!==c;d&&this.opts.buffer.push([c,a])},setRedo:function(){var a=this.selection.saveInstant();this.opts.rebuffer.push([this.core.editor().html(),a])},add:function(){this.opts.buffer.push([this.core.editor().html(),0])},undo:function(){if(0!==this.opts.buffer.length){var a=this.opts.buffer.pop();this.buffer.set("redo"),this.core.editor().html(a[0]),this.selection.restoreInstant(a[1]),this.observe.load()}},redo:function(){if(0!==this.opts.rebuffer.length){var a=this.opts.rebuffer.pop();this.buffer.set("undo"),this.core.editor().html(a[0]),this.selection.restoreInstant(a[1]),this.observe.load()}},clear:function(){this.opts.rebuffer=[]}}},build:function(){return{start:function(){if("inline"===this.opts.type)this.opts.type="inline";else if("div"===this.opts.type){var b=a.trim(this.$editor.html());""===b&&this.$editor.html(this.opts.emptyHtml)}else"textarea"===this.opts.type&&this.build.startTextarea();this.build.setIn(),this.build.setId(),this.build.enableEditor(),this.build.setOptions(),this.build.callEditor()},createContainerBox:function(){this.$box=a('<div class="redactor-box" role="application" />')},setIn:function(){this.core.editor().addClass("redactor-in")},setId:function(){var a="textarea"===this.opts.type?"redactor-uuid-"+this.uuid:this.$element.attr("id");this.core.editor().attr("id","undefined"==typeof a?"redactor-uuid-"+this.uuid:a)},getName:function(){var a=this.$element.attr("name");return"undefined"==typeof a?"content-"+this.uuid:a},loadFromTextarea:function(){this.$editor=a("<div />"),this.$textarea=this.$element,this.$element.attr("name",this.build.getName()),this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-layer"),this.opts.overrideStyles&&this.$editor.addClass("redactor-styles"),this.$element.hide(),this.$box.prepend('<span class="redactor-voice-label" id="redactor-voice-'+this.uuid+'" aria-hidden="false">'+this.lang.get("accessibility-help-label")+"</span>"),this.$editor.attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},startTextarea:function(){this.build.createContainerBox(),this.build.loadFromTextarea(),this.code.start(this.core.textarea().val()),this.core.textarea().val(this.clean.onSync(this.$editor.html()))},isTag:function(a){return this.$element[0].tagName===a},isInline:function(){return!this.build.isTag("TEXTAREA")&&!this.build.isTag("DIV")&&!this.build.isTag("PRE")},enableEditor:function(){this.core.editor().attr({contenteditable:!0})},setOptions:function(){"inline"===this.opts.type&&(this.opts.enterKey=!1),"inline"!==this.opts.type&&"pre"!==this.opts.type||(this.opts.toolbarMobile=!1,this.opts.toolbar=!1,this.opts.air=!1,this.opts.linkify=!1),this.core.editor().attr("spellcheck",this.opts.spellcheck),this.opts.structure&&this.core.editor().addClass("redactor-structure"),"textarea"===this.opts.type&&(this.core.box().attr("dir",this.opts.direction),this.core.editor().attr("dir",this.opts.direction),this.opts.tabindex&&this.core.editor().attr("tabindex",this.opts.tabindex),this.opts.minHeight?this.core.editor().css("min-height",this.opts.minHeight):this.core.editor().css("min-height","40px"),this.opts.maxHeight&&this.core.editor().css("max-height",this.opts.maxHeight),this.opts.maxWidth&&this.core.editor().css({"max-width":this.opts.maxWidth,margin:"auto"}))},callEditor:function(){this.build.disableBrowsersEditing(),this.events.init(),this.build.setHelpers(),(this.opts.toolbar||this.opts.air)&&(this.toolbarsButtons=this.button.init()),this.opts.air?this.air.build():this.opts.toolbar&&this.toolbar.build(),this.detect.isMobile()&&this.opts.toolbarMobile&&this.opts.air&&(this.opts.toolbar=!0,this.toolbar.build()),(this.opts.air||this.opts.toolbar)&&(this.core.editor().on("mouseup.redactor-observe."+this.uuid+" keyup.redactor-observe."+this.uuid+" focus.redactor-observe."+this.uuid+" touchstart.redactor-observe."+this.uuid,a.proxy(this.observe.toolbar,this)),this.core.element().on("blur.callback.redactor",a.proxy(function(){this.button.setInactiveAll()},this))),this.modal.templates(),this.build.plugins(),this.autosave.init(),this.code.html=this.code.cleaned(this.core.editor().html()),this.core.callback("init"),this.core.callback("initToEdit"),this.storage.observe(),this.start=!1},setHelpers:function(){this.opts.linkify&&this.linkify.format(),this.placeholder.init(),this.opts.focus?setTimeout(this.focus.start,100):this.opts.focusEnd&&setTimeout(this.focus.end,100)},disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1)}catch(a){}},plugins:function(){this.opts.plugins&&a.each(this.opts.plugins,a.proxy(function(c,d){var e="undefined"!=typeof RedactorPlugins&&"undefined"!=typeof RedactorPlugins[d]?RedactorPlugins:b.fn;if(a.isFunction(e[d])){this[d]=e[d]();for(var f=this.getModuleMethods(this[d]),g=f.length,h=0;h<g;h++)this[d][f[h]]=this[d][f[h]].bind(this);if("undefined"!=typeof this[d].langs){var i={};"undefined"!=typeof this[d].langs[this.opts.lang]?i=this[d].langs[this.opts.lang]:"undefined"==typeof this[d].langs[this.opts.lang]&&"undefined"!=typeof this[d].langs.en&&(i=this[d].langs.en);var j=this;a.each(i,function(a,b){"undefined"==typeof j.opts.curLang[a]&&(j.opts.curLang[a]=b)})}a.isFunction(this[d].init)&&this[d].init()}},this))}}},button:function(){return{toolbar:function(){return"undefined"!=typeof this.button.$toolbar&&this.button.$toolbar?this.button.$toolbar:this.$toolbar},init:function(){return{format:{title:this.lang.get("format"),icon:!0,dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("heading1"),func:"block.format"},h2:{title:this.lang.get("heading2"),func:"block.format"},h3:{title:this.lang.get("heading3"),func:"block.format"},h4:{title:this.lang.get("heading4"),func:"block.format"},h5:{title:this.lang.get("heading5"),func:"block.format"},h6:{title:this.lang.get("heading6"),func:"block.format"}}},bold:{title:this.lang.get("bold-abbr"),icon:!0,label:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic-abbr"),icon:!0,label:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted-abbr"),icon:!0,label:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline-abbr"),icon:!0,label:this.lang.get("underline"),func:"inline.format"},lists:{title:this.lang.get("lists"),icon:!0,dropdown:{unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},ul:{title:"&bull; "+this.lang.get("bulletslist"),icon:!0,func:"list.toggle"},ol:{title:"1. "+this.lang.get("numberslist"),icon:!0,func:"list.toggle"},outdent:{title:this.lang.get("outdent"),icon:!0,func:"indent.decrease"},indent:{title:this.lang.get("indent"),icon:!0,func:"indent.increase"},image:{title:this.lang.get("image"),icon:!0,func:"image.show"},file:{title:this.lang.get("file"),icon:!0,func:"file.show"},link:{title:this.lang.get("link"),icon:!0,dropdown:{link:{title:this.lang.get("link-insert"),func:"link.show",observe:{element:"a",in:{title:this.lang.get("link-edit")},out:{title:this.lang.get("link-insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},horizontalrule:{title:this.lang.get("horizontalrule"),icon:!0,func:"line.insert"}}},setFormatting:function(){a.each(this.toolbarsButtons.format.dropdown,a.proxy(function(b,c){a.inArray(b,this.opts.formatting)===-1&&delete this.toolbarsButtons.format.dropdown[b]},this))},hideButtons:function(){0!==this.opts.buttonsHide.length&&this.button.hideButtonsSlicer(this.opts.buttonsHide)},hideButtonsOnMobile:function(){this.detect.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&this.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile)},hideButtonsSlicer:function(b){a.each(b,a.proxy(function(a,b){var c=this.opts.buttons.indexOf(b);c!==-1&&this.opts.buttons.splice(c,1)},this))},load:function(b){this.button.buttons=[],a.each(this.opts.buttons,a.proxy(function(c,d){!this.toolbarsButtons[d]||"file"===d&&!this.file.is()||"image"===d&&!this.image.is()||b.append(a("<li>").append(this.button.build(d,this.toolbarsButtons[d])))},this))},buildButtonTooltip:function(b,c){if(!this.opts.air&&!this.detect.isMobile()){var d=a("<span>");d.addClass("re-button-tooltip"),d.html(c),b.append(d),b.on("mouseover",function(){a(this).hasClass("redactor-button-disabled")||(d.show(),d.css("margin-left",-(d.innerWidth()/2)))}).on("mouseout",function(){d.hide()})}},build:function(b,c){if(this.opts.toolbar!==!1){var d="undefined"!=typeof c.label?c.label:c.title,e=a('<a href="javascript:void(null);" alt="'+d+'" rel="'+b+'" />');if(e.addClass("re-button re-"+b),e.attr({role:"button","aria-label":d,tabindex:"-1"}),"undefined"==typeof c.icon||this.opts.buttonsTextLabeled)e.html(c.title);else{var f=a("<i>");f.addClass("re-icon-"+b),e.append(f),e.addClass("re-button-icon"),this.button.buildButtonTooltip(e,d)}if((c.func||c.command||c.dropdown)&&this.button.setEvent(e,b,c),c.dropdown){e.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var g=a('<ul class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+b+'" style="display: none;">');e.data("dropdown",g),this.dropdown.build(b,g,c.dropdown)}return this.button.buttons.push(e),e}},getButtons:function(){return this.button.toolbar().find("a.re-button")},getButtonsKeys:function(){return this.button.buttons},setEvent:function(b,c,d){b.on("mousedown",a.proxy(function(a){if(a.preventDefault(),b.hasClass("redactor-button-disabled"))return!1;var e="func",f=d.func;return d.command?(e="command",f=d.command):d.dropdown&&(e="dropdown",f=!1),this.button.toggle(a,c,e,f),!1},this))},toggle:function(a,b,c,d,e){!this.detect.isIe()&&this.detect.isDesktop()||(this.utils.freezeScroll(),a.returnValue=!1),"command"===c?this.inline.format(d):"dropdown"===c?this.dropdown.show(a,b):this.button.clickCallback(a,d,b,e),"dropdown"!==c&&this.dropdown.hideAll(!1),this.opts.air&&"dropdown"!==c&&this.air.hide(a),!this.detect.isIe()&&this.detect.isDesktop()||this.utils.unfreezeScroll()},clickCallback:function(b,c,d,e){var f;if(e="undefined"==typeof e?d:e,a.isFunction(c))c.call(this,d);else if("-1"!==c.search(/\./)){if(f=c.split("."),"undefined"==typeof this[f[0]])return;"object"==typeof e?this[f[0]][f[1]].apply(this,e):this[f[0]][f[1]].call(this,e)}else"object"==typeof e?this[c].apply(this,e):this[c].call(this,e);this.observe.buttons(b,d)},all:function(){return this.button.buttons},get:function(a){if(this.opts.toolbar!==!1)return this.button.toolbar().find("a.re-"+a)},set:function(a,b){if(this.opts.toolbar!==!1){var c=this.button.toolbar().find("a.re-"+a);return c.html(b).attr("aria-label",b),c}},add:function(b,c){if(this.button.isAdded(b)!==!0)return a();var d=this.button.build(b,{title:c});return this.button.toolbar().append(a("<li>").append(d)),d},addFirst:function(b,c){if(this.button.isAdded(b)!==!0)return a();var d=this.button.build(b,{title:c});return this.button.toolbar().prepend(a("<li>").append(d)),d},addAfter:function(b,c,d){if(this.button.isAdded(c)!==!0)return a();var e=this.button.build(c,{title:d}),f=this.button.get(b);return 0!==f.length?f.parent().after(a("<li>").append(e)):this.button.toolbar().append(a("<li>").append(e)),e},addBefore:function(b,c,d){if(this.button.isAdded(c)!==!0)return a();var e=this.button.build(c,{title:d}),f=this.button.get(b);return 0!==f.length?f.parent().before(a("<li>").append(e)):this.button.toolbar().append(a("<li>").append(e)),e},isAdded:function(a){var b=this.opts.buttonsHideOnMobile.indexOf(a);return!(this.opts.toolbar===!1||b!==-1&&this.detect.isMobile())},setIcon:function(a,b){this.opts.buttonsTextLabeled||(a.html(b).addClass("re-button-icon"),this.button.buildButtonTooltip(a,a.attr("alt")))},changeIcon:function(a,b){var c=this.button.get(a);0!==c.length&&c.find("i").removeAttr("class").addClass("re-icon-"+b)},addCallback:function(b,c){if("undefined"!=typeof b&&this.opts.toolbar!==!1){var d="dropdown"===c?"dropdown":"func",e=b.attr("rel");b.on("mousedown",a.proxy(function(a){return!b.hasClass("redactor-button-disabled")&&void this.button.toggle(a,e,d,c)},this))}},addDropdown:function(b,c){if(this.opts.toolbar!==!1){b.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var d=b.attr("rel");this.button.addCallback(b,"dropdown");var e=a('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+d+'" style="display: none;">');return b.data("dropdown",e),c&&this.dropdown.build(d,e,c),e}},setActive:function(a){this.button.get(a).addClass("redactor-act")},setInactive:function(a){this.button.get(a).removeClass("redactor-act")},setInactiveAll:function(a){var b=this.button.toolbar().find("a.re-button");"undefined"!=typeof a&&(b=b.not(".re-"+a)),b.removeClass("redactor-act")},disable:function(a){this.button.get(a).addClass("redactor-button-disabled")},enable:function(a){this.button.get(a).removeClass("redactor-button-disabled")},disableAll:function(a){var b=this.button.toolbar().find("a.re-button");"undefined"!=typeof a&&(b=b.not(".re-"+a)),b.addClass("redactor-button-disabled")},enableAll:function(){this.button.toolbar().find("a.re-button").removeClass("redactor-button-disabled")},remove:function(a){this.button.get(a).remove()}}},caret:function(){return{set:function(a,b,c){var d=this.core.editor().scrollTop();this.core.editor().focus(),this.core.editor().scrollTop(d),c="undefined"==typeof c?0:1,a=a[0]||a,b=b[0]||b;var e=this.selection.get(),f=this.selection.range(e);try{f.setStart(a,0),f.setEnd(b,c)}catch(a){}this.selection.update(e,f)},prepare:function(a){return this.detect.isFirefox()&&"undefined"!=typeof this.start&&this.core.editor().focus(),a[0]||a},start:function(b){var c,d;if(b=this.caret.prepare(b)){if("BR"===b.tagName)return this.caret.before(b);var e=a(b).children().first(),f=this.utils.isInlineTag(b.tagName);""===b.innerHTML||f?this.caret.setStartEmptyOrInline(b,f):e&&0!==e.length&&this.utils.isInlineTag(e[0].tagName)&&""===e.text()?this.caret.setStartEmptyOrInline(e[0],!0):(c=window.getSelection(),c.removeAllRanges(),d=document.createRange(),d.selectNodeContents(b),d.collapse(!0),c.addRange(d))}},setStartEmptyOrInline:function(b,c){var d=window.getSelection(),e=document.createRange(),f=document.createTextNode("​");e.setStart(b,0),e.insertNode(f),e.setStartAfter(f),e.collapse(!0),d.removeAllRanges(),d.addRange(e),c||this.core.editor().on("keydown.redactor-remove-textnode",function(){a(f).remove(),a(this).off("keydown.redactor-remove-textnode")})},end:function(b){var c,d;if(b=this.caret.prepare(b)){if("BR"!==b.tagName&&""===b.innerHTML)return this.caret.start(b);if("BR"===b.tagName){var e=document.createElement("span");return e.className="redactor-invisible-space",e.innerHTML="&#x200b;",a(b).after(e),c=window.getSelection(),c.removeAllRanges(),d=document.createRange(),d.setStartBefore(e),d.setEndBefore(e),c.addRange(d),void a(e).replaceWith(function(){return a(this).contents()})}if(b.lastChild&&1===b.lastChild.nodeType)return this.caret.after(b.lastChild);var c=window.getSelection();
if(c.getRangeAt||c.rangeCount)try{var d=c.getRangeAt(0);d.selectNodeContents(b),d.collapse(!1),c.removeAllRanges(),c.addRange(d)}catch(a){}}},after:function(b){var c,d;if(b=this.caret.prepare(b)){if("BR"===b.tagName)return this.caret.end(b);if(this.utils.isBlockTag(b.tagName)){var e=this.caret.next(b);return void("undefined"==typeof e?this.caret.end(b):("TABLE"===e.tagName?e=a(e).find("th, td").first()[0]:"UL"!==e.tagName&&"OL"!==e.tagName||(e=a(e).find("li").first()[0]),this.caret.start(e)))}var f=document.createTextNode("​");c=window.getSelection(),c.removeAllRanges(),d=document.createRange(),d.setStartAfter(b),d.insertNode(f),d.setStartAfter(f),d.collapse(!0),c.addRange(d)}},before:function(b){var c,d;if(b=this.caret.prepare(b)){if(this.utils.isBlockTag(b.tagName)){var e=this.caret.prev(b);return void("undefined"==typeof e?this.caret.start(b):("TABLE"===e.tagName?e=a(e).find("th, td").last()[0]:"UL"!==e.tagName&&"OL"!==e.tagName||(e=a(e).find("li").last()[0]),this.caret.end(e)))}c=window.getSelection(),c.removeAllRanges(),d=document.createRange(),d.setStartBefore(b),d.collapse(!0),c.addRange(d)}},next:function(b){var c=a(b).next();return c.hasClass("redactor-script-tag, redactor-selection-marker")?c.next()[0]:c[0]},prev:function(b){var c=a(b).prev();return c.hasClass("redactor-script-tag, redactor-selection-marker")?c.prev()[0]:c[0]},offset:function(a){return this.offset.get(a)}}},clean:function(){return{onSet:function(b){b=this.clean.savePreCode(b),b=this.clean.saveFormTags(b),this.opts.script&&(b=b.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" $1>$2</pre>')),b=b.replace(/\$/g,"&#36;"),b=b.replace(/&amp;/g,"&"),b=b.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),b=b.replace(/<span id="selection-marker-1"(.*?[^>]?)>​<\/span>/gi,"###marker1###"),b=b.replace(/<span id="selection-marker-2"(.*?[^>]?)>​<\/span>/gi,"###marker2###");var c=this,d=a("<div/>").html(a.parseHTML(b,document,!0)),e=this.opts.replaceTags;if(e){var f=Object.keys(this.opts.replaceTags);d.find(f.join(",")).each(function(a,b){c.utils.replaceToTag(b,e[b.tagName.toLowerCase()])})}d.find("span, a").attr("data-redactor-span",!0),d.find(this.opts.inlineTags.join(",")).each(function(){var b=a(this);b.attr("style")&&b.attr("data-redactor-style-cache",b.attr("style"))}),b=d.html();var g=["font","html","head","link","body","meta","applet"];return this.opts.script||g.push("script"),b=this.clean.stripTags(b,g),this.opts.removeComments&&(b=b.replace(/<!--[\s\S]*?-->/gi,"")),b=this.paragraphize.load(b),b=b.replace("###marker1###",'<span id="selection-marker-1" class="redactor-selection-marker">​</span>'),b=b.replace("###marker2###",'<span id="selection-marker-2" class="redactor-selection-marker">​</span>'),b.search(/^(||\s||<br\s?\/?>||&nbsp;)$/i)!==-1?this.opts.emptyHtml:b},onGet:function(a){return this.clean.onSync(a)},onSync:function(b){if(b=b.replace(/\u200B/g,""),b=b.replace(/&#x200b;/gi,""),b.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)!==-1)return"";b=b.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),b=b.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),b=b.replace(/<img(.*?)style="(.*?)opacity: 0\.5;(.*?)"(.*?)>/gi,'<img$1style="$2$3"$4>');var c=a("<div/>").html(a.parseHTML(b,document,!0));c.find('*[style=""]').removeAttr("style"),c.find('*[class=""]').removeAttr("class"),c.find('*[rel=""]').removeAttr("rel"),c.find('*[data-image=""]').removeAttr("data-image"),c.find('*[alt=""]').removeAttr("alt"),c.find('*[title=""]').removeAttr("title"),c.find("*[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),c.find(".redactor-invisible-space, .redactor-unlink").each(function(){a(this).contents().unwrap()}),c.find("span, a").removeAttr("data-redactor-span data-redactor-style-cache").each(function(){0===this.attributes.length&&a(this).contents().unwrap()}),c.find("img").removeAttr("rel"),c.find(".redactor-selection-marker, #redactor-insert-marker").remove(),b=c.html(),this.opts.script&&(b=b.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>")),b=this.clean.restoreFormTags(b),b=b.replace(new RegExp("<br\\s?/?></h","gi"),"</h"),b=b.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),b=b.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),b=b.replace(/<pre>/gi,"<pre>\n"),this.opts.preClass&&(b=b.replace(/<pre>/gi,'<pre class="'+this.opts.preClass+'">')),this.opts.linkNofollow&&(b=b.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),b=b.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'));var d={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};return a.each(d,function(a,c){b=b.replace(new RegExp(a,"g"),c)}),b=b.replace(/&amp;/g,"&"),b=b.replace(/\n{2,}/g,"\n"),this.opts.removeNewlines&&(b=b.replace(/\r?\n/g,"")),b},onPaste:function(b,c,d){if(d!==!0){b=b.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),b=b.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),b=b.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>"),b=b.replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>"),b=b.replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>"),b=b.replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>"),b=b.replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>"),b=b.replace(/<o:p[^>]*>/gi,""),b=b.replace(/<\/o:p>/gi,"");var e=this.clean.isHtmlMsWord(b);e&&(b=this.clean.cleanMsWord(b))}return b=a.trim(b),c.pre?this.opts.preSpaces&&(b=b.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))):(b=this.clean.replaceBrToNl(b),b=this.clean.removeTagsInsidePre(b)),d!==!0&&(b=this.clean.removeEmptyInlineTags(b),c.encode===!1&&(b=b.replace(/&/g,"&amp;"),b=this.clean.convertTags(b,c),b=this.clean.getPlainText(b),b=this.clean.reconvertTags(b,c))),c.text&&(b=this.clean.replaceNbspToSpaces(b),b=this.clean.getPlainText(b)),c.lists&&(b=b.replace("\n","<br>")),c.encode&&(b=this.clean.encodeHtml(b)),c.paragraphize&&(b=b.replace(/ \n/g," "),b=b.replace(/\n /g," "),b=this.paragraphize.load(b),b=b.replace(/<p><\/p>/g,"")),b},getCurrentType:function(a,b){var c=this.selection.blocks(),d={text:!1,encode:!1,paragraphize:!0,line:this.clean.isHtmlLine(a),blocks:this.clean.isHtmlBlocked(a),pre:!1,lists:!1,block:!0,inline:!0,links:!0,images:!0};return 1===c.length&&this.utils.isCurrentOrParent(["h1","h2","h3","h4","h5","h6","a","figcaption"])?(d.text=!0,d.paragraphize=!1,d.inline=!1,d.images=!1,d.links=!1,d.line=!0):"inline"===this.opts.type||this.opts.enterKey===!1?(d.paragraphize=!1,d.block=!1,d.line=!0):1===c.length&&this.utils.isCurrentOrParent(["li"])?(d.lists=!0,d.block=!1,d.paragraphize=!1,d.images=!1):1===c.length&&this.utils.isCurrentOrParent(["th","td","blockquote"])?(d.block=!1,d.paragraphize=!1):("pre"===this.opts.type||1===c.length&&this.utils.isCurrentOrParent("pre"))&&(d.inline=!1,d.block=!1,d.encode=!0,d.pre=!0,d.paragraphize=!1,d.images=!1,d.links=!1),d.line===!0&&(d.paragraphize=!1),b===!0&&(d.text=!1),d},isHtmlBlocked:function(a){var b=a.match(new RegExp("</("+this.opts.blockTags.join("|").toUpperCase()+")>","gi")),c=a.match(new RegExp("<hr(.*?[^>])>","gi"));return null!==b||null!==c},isHtmlLine:function(a){if(this.clean.isHtmlBlocked(a))return!1;var b=a.match(/<br\s?\/?>/gi),c=a.match(/\n/gi);return!b&&!c},isHtmlMsWord:function(a){return a.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},removeEmptyInlineTags:function(b){var c=this.opts.inlineTags,d=a("<div/>").html(a.parseHTML(b,document,!0)),e=this,f=d.find("span"),g=d.find(c.join(","));return g.removeAttr("style"),g.each(function(){var b=a(this).html();0===this.attributes.length&&e.utils.isEmpty(b)&&a(this).replaceWith(function(){return a(this).contents()})}),f.each(function(){a(this).html();0===this.attributes.length&&a(this).replaceWith(function(){return a(this).contents()})}),b=d.html(),b=b.replace("<!--?php","<?php"),b=b.replace("<!--?","<?"),b=b.replace("?-->","?>"),d.remove(),b},cleanMsWord:function(b){b=b.replace(/<!--[\s\S]*?-->/g,""),b=b.replace(/<o:p>[\s\S]*?<\/o:p>/gi,""),b=b.replace(/\n/g," "),b=b.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n\n");var c=a("<div/>").html(b),d=!1,e=1,f=[];return c.find("p[style]").each(function(){var b=a(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(b){var g=parseInt(b[1]),h=parseInt(b[2]),i=a(this).html().match(/^[\w]+\./)?"ol":"ul",j=a("<li/>").html(a(this).html());if(j.html(j.html().replace(/^([\w\.]+)</,"<")),j.find("span:first").remove(),1==h&&a.inArray(g,f)==-1){var k=a("<"+i+"/>").attr({"data-level":h,"data-list":g}).html(j);a(this).replaceWith(k),d=g,f.push(g)}else{if(h>e){for(var l=c.find('[data-level="'+e+'"][data-list="'+d+'"]'),m=l,n=e;n<h;n++)k=a("<"+i+"/>"),k.appendTo(m.find("li").last()),m=k;m.attr({"data-level":h,"data-list":g}).html(j)}else{var l=c.find('[data-level="'+h+'"][data-list="'+g+'"]').last();l.append(j)}e=h,d=g,a(this).remove()}}}),c.find("[data-level][data-list]").removeAttr("data-level data-list"),b=c.html()},replaceNbspToSpaces:function(a){return a.replace("&nbsp;"," ")},replaceBrToNl:function(a){return a.replace(/<br\s?\/?>/gi,"\n")},replaceNlToBr:function(a){return a.replace(/\n/g,"<br />")},convertTags:function(b,c){var d=a("<div>").html(b);d.find("iframe").remove();var e=d.find("a");if(e.removeAttr("style"),this.opts.pasteLinkTarget!==!1&&e.attr("target",this.opts.pasteLinkTarget),c.links&&this.opts.pasteLinks&&d.find("a").each(function(a,b){if(b.href){for(var c,d='##%a href="'+b.href+'"',e=0,f=b.attributes.length;e<f;e++)c=b.attributes.item(e),"href"!==c.name&&(d+=" "+c.name+'="'+c.value+'"');b.outerHTML=d+"%##"+b.innerHTML+"##%/a%##"}}),b=d.html(),c.images&&this.opts.pasteImages&&(b=b.replace(/<img(.*?)src="(.*?)"(.*?[^>])>/gi,'##%img$1src="$2"$3%##')),this.opts.pastePlainText)return b;var f,g=c.lists?["ul","ol","li"]:this.opts.pasteBlockTags;f=c.block||c.lists?c.inline?g.concat(this.opts.pasteInlineTags):g:c.inline?this.opts.pasteInlineTags:[];for(var h=f.length,i=0;i<h;i++)b=b.replace(new RegExp("</"+f[i]+">","gi"),"###/"+f[i]+"###"),"td"===f[i]||"th"===f[i]?b=b.replace(new RegExp("<"+f[i]+'(.*?[^>])((colspan|rowspan)="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+f[i]+" $2###"):this.utils.isInlineTag(f[i])?(b=b.replace(new RegExp("<"+f[i]+'([^>]*)class="([^>]*)"[^>]*>',"gi"),"###"+f[i]+' class="$2"###'),b=b.replace(new RegExp("<"+f[i]+'([^>]*)data-redactor-style-cache="([^>]*)"[^>]*>',"gi"),"###"+f[i]+' cache="$2"###'),b=b.replace(new RegExp("<"+f[i]+"[^>]*>","gi"),"###"+f[i]+"###")):b=b.replace(new RegExp("<"+f[i]+"[^>]*>","gi"),"###"+f[i]+"###");return b},reconvertTags:function(a,b){if((b.links&&this.opts.pasteLinks||b.images&&this.opts.pasteImages)&&(a=a.replace(new RegExp("##%","gi"),"<"),a=a.replace(new RegExp("%##","gi"),">")),this.opts.pastePlainText)return a;var c,d=b.lists?["ul","ol","li"]:this.opts.pasteBlockTags;c=b.block||b.lists?b.inline?d.concat(this.opts.pasteInlineTags):d:b.inline?this.opts.pasteInlineTags:[];for(var e=c.length,f=0;f<e;f++)a=a.replace(new RegExp("###/"+c[f]+"###","gi"),"</"+c[f]+">");for(var f=0;f<e;f++)a=a.replace(new RegExp("###"+c[f]+"###","gi"),"<"+c[f]+">");for(var f=0;f<e;f++)if("td"===c[f]||"th"===c[f])a=a.replace(new RegExp("###"+c[f]+"s?(.*?[^#])###","gi"),"<"+c[f]+"$1>");else if(this.utils.isInlineTag(c[f])){var g="span"===c[f]?' data-redactor-span="true"':"";a=a.replace(new RegExp("###"+c[f]+' cache="(.*?[^#])"###',"gi"),"<"+c[f]+' style="$1"'+g+' data-redactor-style-cache="$1">'),a=a.replace(new RegExp("###"+c[f]+"s?(.*?[^#])###","gi"),"<"+c[f]+"$1>")}return a},cleanPre:function(b){b="undefined"==typeof b?a(this.selection.block()).closest("pre",this.core.editor()[0]):b,a(b).find("br").replaceWith(function(){return document.createTextNode("\n")}),a(b).find("p").replaceWith(function(){return a(this).contents()})},removeTagsInsidePre:function(b){var c=a("<div />").append(b);return c.find("pre").replaceWith(function(){var b=a(this).html();return b=b.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n"),b=b.replace(/(<([^>]+)>)/gi,""),a("<pre />").append(b)}),b=c.html(),c.remove(),b},getPlainText:function(b){b=b.replace(/<!--[\s\S]*?-->/gi,""),b=b.replace(/<style[\s\S]*?style>/gi,""),b=b.replace(/<p><\/p>/g,""),b=b.replace(/<\/div>|<\/li>|<\/td>/gi,"\n"),b=b.replace(/<\/p>/gi,"\n\n"),b=b.replace(/<\/H[1-6]>/gi,"\n\n");var c=document.createElement("div");return c.innerHTML=b,b=c.textContent||c.innerText,a.trim(b)},savePreCode:function(a){return a=this.clean.savePreFormatting(a),a=this.clean.saveCodeFormatting(a),a=this.clean.restoreSelectionMarkers(a)},savePreFormatting:function(b){var c=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null===c?b:(a.each(c,a.proxy(function(a,c){var d,e,f,g=[],h=!1;c.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>/i)?(g=c.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>([\w\W]*?)<\/code>(([\n\r\s]+)?)<\/pre>/i),h=!0,d=g[5],e=g[1],f=g[4]):(g=c.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i),d=g[2],e=g[1]),d=d.replace(/<br\s?\/?>/g,"\n"),d=d.replace(/&nbsp;/g," "),this.opts.preSpaces&&(d=d.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),d=this.clean.encodeEntities(d),d=d.replace(/\$/g,"&#36;"),b=h?b.replace(c,"<pre"+e+"><code"+f+">"+d+"</code></pre>"):b.replace(c,"<pre"+e+">"+d+"</pre>")},this)),b)},saveCodeFormatting:function(b){var c=b.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null===c?b:(a.each(c,a.proxy(function(a,c){var d=c.match(/<code(.*?)>([\w\W]*?)<\/code>/i);d[2]=d[2].replace(/&nbsp;/g," "),d[2]=this.clean.encodeEntities(d[2]),d[2]=d[2].replace(/\$/g,"&#36;"),b=b.replace(c,"<code"+d[1]+">"+d[2]+"</code>")},this)),b)},restoreSelectionMarkers:function(a){return a=a.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">​</span>')},saveFormTags:function(a){return a.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(a){return a.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")},encodeHtml:function(a){return a=a.replace(/”/g,'"'),a=a.replace(/“/g,'"'),a=a.replace(/‘/g,"'"),a=a.replace(/’/g,"'"),a=this.clean.encodeEntities(a)},encodeEntities:function(a){return a=String(a).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},stripTags:function(a,b){if("undefined"==typeof b)return a.replace(/(<([^>]+)>)/gi,"");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return a.replace(c,function(a,c){return b.indexOf(c.toLowerCase())===-1?a:""})},removeMarkers:function(a){return a.replace(/<span(.*?[^>]?)class="redactor-selection-marker"(.*?[^>]?)>([\w\W]*?)<\/span>/gi,"")},removeSpaces:function(b){return b=a.trim(b),b=b.replace(/\n/g,""),b=b.replace(/[\t]*/g,""),b=b.replace(/\n\s*\n/g,"\n"),b=b.replace(/^[\s\n]*/g," "),b=b.replace(/[\s\n]*$/g," "),b=b.replace(/>\s{2,}</g,"> <"),b=b.replace(/\n\n/g,"\n"),b=b.replace(/\u200B/g,"")},removeSpacesHard:function(b){return b=a.trim(b),b=b.replace(/\n/g,""),b=b.replace(/[\t]*/g,""),b=b.replace(/\n\s*\n/g,"\n"),b=b.replace(/^[\s\n]*/g,""),b=b.replace(/[\s\n]*$/g,""),b=b.replace(/>\s{2,}</g,"><"),b=b.replace(/\n\n/g,"\n"),b=b.replace(/\u200B/g,"")},normalizeCurrentHeading:function(){var a=this.selection.block();this.utils.isCurrentOrParentHeader()&&a&&a.normalize()}}},code:function(){return{syncFire:!0,html:!1,start:function(b){b=a.trim(b),b=b.replace(/^(<span id="selection-marker-1" class="redactor-selection-marker">​<\/span>)/,""),"textarea"===this.opts.type?b=this.clean.onSet(b):"div"===this.opts.type&&""===b&&(b=this.opts.emptyHtml),b=b.replace(/<p><span id="selection-marker-1" class="redactor-selection-marker">​<\/span><\/p>/,""),this.events.stopDetectChanges(),this.core.editor().html(b),this.observe.load(),this.events.startDetectChanges()},set:function(b,c){b=a.trim(b),c=c||{},c.start&&(this.start=c.start),"textarea"===this.opts.type?b=this.clean.onSet(b):"div"===this.opts.type&&""===b&&(b=this.opts.emptyHtml),this.core.editor().html(b),"textarea"===this.opts.type&&this.code.sync(),this.placeholder.enable()},get:function(){if("textarea"===this.opts.type)return this.core.textarea().val();var a=this.core.editor().html();return a=this.clean.onGet(a)},sync:function(){if(this.code.syncFire){var b=this.core.editor().html(),c=this.code.cleaned(b);if(!this.code.isSync(c))return this.code.html=c,"textarea"!==this.opts.type?(this.core.callback("sync",b),void this.core.callback("change",b)):void("textarea"===this.opts.type&&setTimeout(a.proxy(function(){this.code.startSync(b)},this),10))}},startSync:function(a){a=this.core.callback("syncBefore",a),a=this.clean.onSync(a),this.core.textarea().val(a),this.core.callback("sync",a),this.start===!1&&this.core.callback("change",a),this.start=!1},isSync:function(a){var b=this.code.html!==!1&&this.code.html;return b!==!1&&b===a},cleaned:function(a){return a=a.replace(/\u200B/g,""),this.clean.removeMarkers(a)}}},core:function(){return{id:function(){return this.$editor.attr("id")},element:function(){return this.$element},editor:function(){return"undefined"==typeof this.$editor?a():this.$editor},textarea:function(){return this.$textarea},box:function(){return"textarea"===this.opts.type?this.$box:this.$element},toolbar:function(){return!!this.$toolbar&&this.$toolbar},air:function(){return!!this.$air&&this.$air},object:function(){return a.extend({},this)},structure:function(){this.core.editor().toggleClass("redactor-structure")},addEvent:function(a){this.core.event=a},getEvent:function(){return this.core.event},callback:function(b,c,d){var e="redactor",f=!1,g=a._data(this.core.element()[0],"events");if("undefined"!=typeof g&&"undefined"!=typeof g[b])for(var h=g[b].length,i=0;i<h;i++){var j=g[b][i].namespace;if(j==="callback."+e){var k=g[b][i].handler,l="undefined"==typeof d?[c]:[c,d];f="undefined"==typeof l?k.call(this,c):k.call(this,c,l)}}if(f)return f;if("undefined"==typeof this.opts.callbacks[b])return"undefined"==typeof d?c:d;var m=this.opts.callbacks[b];return a.isFunction(m)?"undefined"==typeof d?m.call(this,c):m.call(this,c,d):"undefined"==typeof d?c:d},destroy:function(){this.opts.destroyed=!0,this.core.callback("destroy"),this.placeholder.destroy(),this.progress.destroy(),a("#redactor-voice-"+this.uuid).remove(),this.core.editor().removeClass("redactor-in redactor-styles redactor-structure redactor-layer-img-edit"),this.core.editor().off("keydown.redactor-remove-textnode"),this.core.editor().off(".redactor-observe."+this.uuid),this.$element.off(".redactor").removeData("redactor"),this.core.editor().off(".redactor"),a(document).off(".redactor-dropdown"),a(document).off(".redactor-air."+this.uuid),a(document).off("mousedown.redactor-blur."+this.uuid),a(document).off("mousedown.redactor."+this.uuid),a(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),a(window).off(".redactor-toolbar."+this.uuid),a(window).off("touchmove.redactor."+this.uuid),a("body").off("scroll.redactor."+this.uuid),a(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);var b=this;this.opts.plugins!==!1&&a.each(this.opts.plugins,function(c,d){a(window).off(".redactor-plugin-"+d),a(document).off(".redactor-plugin-"+d),a("body").off(".redactor-plugin-"+d),b.core.editor().off(".redactor-plugin-"+d)}),this.$element.off("click.redactor-click-to-edit"),this.$element.removeClass("redactor-click-to-edit"),this.core.editor().removeClass("redactor-layer"),this.core.editor().removeAttr("contenteditable");var c=this.code.get();this.opts.toolbar&&this.$toolbar&&this.$toolbar.find("a").each(function(){var b=a(this);b.data("dropdown")&&(b.data("dropdown").remove(),b.data("dropdown",{}))}),"textarea"===this.opts.type&&(this.$box.after(this.$element),this.$box.remove(),this.$element.val(c).show()),this.opts.air&&this.$air.remove(),this.opts.toolbar&&this.$toolbar&&this.$toolbar.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),a(".redactor-link-tooltip").remove(),clearInterval(this.autosaveTimeout)}}},detect:function(){return{isWebkit:function(){return/webkit/.test(this.opts.userAgent)},isFirefox:function(){return this.opts.userAgent.indexOf("firefox")>-1},isIe:function(a){if(document.documentMode||/Edge/.test(navigator.userAgent))return"edge";var b;return b=RegExp("msie"+(isNaN(a)?"":"\\s"+a),"i").test(navigator.userAgent),b||(b=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),b},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}},dropdown:function(){return{active:!1,button:!1,key:!1,position:[],getDropdown:function(){return this.dropdown.active},build:function(b,c,d){d=this.dropdown.buildFormatting(b,d),a.each(d,a.proxy(function(a,d){var e=this.dropdown.buildItem(a,d);this.observe.addDropdown(e,a,d),c.attr("rel",b).append(e)},this))},buildFormatting:function(b,c){return"format"!==b||this.opts.formattingAdd===!1?c:(a.each(this.opts.formattingAdd,a.proxy(function(a,b){var d=this.utils.isBlockTag(b.args[0])?"block":"inline";c[a]={func:"block"===d?"block.format":"inline.format",args:b.args,title:b.title}},this)),c)},buildItem:function(b,c){var d=a("<li />");if("undefined"!=typeof c.classname&&d.addClass(c.classname),b.search(/^divider/i)!==-1)return d.addClass("redactor-dropdown-divider"),d;var e=a('<a href="#" class="redactor-dropdown-'+b+'" role="button" />'),f=a("<span />").html(c.title);return e.append(f),e.on("mousedown",a.proxy(function(a){a.preventDefault(),this.dropdown.buildClick(a,b,c)},this)),d.append(e),d},buildClick:function(b,c,d){if(!a(b.target).hasClass("redactor-dropdown-link-inactive")){var e=this.dropdown.buildCommand(d);"undefined"!=typeof d.args?this.button.toggle(b,c,e.type,e.callback,d.args):this.button.toggle(b,c,e.type,e.callback)}},buildCommand:function(a){var b={};return b.type="func",b.callback=a.func,a.command?(b.type="command",b.callback=a.command):a.dropdown&&(b.type="dropdown",b.callback=a.dropdown),b},show:function(b,c){return this.detect.isDesktop()&&this.core.editor().focus(),this.dropdown.hideAll(!1,c),this.dropdown.key=c,this.dropdown.button=this.button.get(this.dropdown.key),this.dropdown.button.hasClass("dropact")?void this.dropdown.hide():(this.dropdown.active=this.dropdown.button.data("dropdown").appendTo(document.body),this.core.callback("dropdownShow",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button}),this.button.setActive(this.dropdown.key),this.dropdown.button.addClass("dropact"),this.dropdown.getButtonPosition(),this.button.toolbar().hasClass("toolbar-fixed-box")&&this.detect.isDesktop()?this.dropdown.showIsFixedToolbar():this.dropdown.showIsUnFixedToolbar(),this.detect.isDesktop()&&!this.detect.isFirefox()&&(this.dropdown.active.on("mouseover.redactor-dropdown",a.proxy(this.utils.disableBodyScroll,this)),this.dropdown.active.on("mouseout.redactor-dropdown mousedown.redactor-dropdown",a.proxy(this.utils.enableBodyScroll,this))),void b.stopPropagation())},showIsFixedToolbar:function(){var b=this.dropdown.button.position().top+this.dropdown.button.innerHeight()+this.opts.toolbarFixedTopOffset,c="fixed";this.opts.toolbarFixedTarget!==document&&(b=this.dropdown.button.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,c="absolute"),this.dropdown.active.css({position:c,left:this.dropdown.position.left+"px",top:b+"px"}).show(),this.dropdown.active.redactorAnimation("slideDown",{duration:.2},a.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},showIsUnFixedToolbar:function(){this.dropdown.active.css({position:"absolute",left:this.dropdown.position.left+"px",top:this.dropdown.button.innerHeight()+this.dropdown.position.top+"px"}).show(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideDown":"show",{duration:.2},a.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},enableEvents:function(){a(document).on("mousedown.redactor-dropdown",a.proxy(this.dropdown.hideAll,this)),this.core.editor().on("touchstart.redactor-dropdown",a.proxy(this.dropdown.hideAll,this)),a(document).on("keyup.redactor-dropdown",a.proxy(this.dropdown.closeHandler,this))},enableCallback:function(){this.core.callback("dropdownShown",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button})},getButtonPosition:function(){this.dropdown.position=this.dropdown.button.offset();var b=this.dropdown.active.width();this.dropdown.position.left+b>a(document).width()&&(this.dropdown.position.left=Math.max(0,this.dropdown.position.left-b+parseInt(this.dropdown.button.innerWidth())))},closeHandler:function(a){a.which===this.keyCode.ESC&&(this.dropdown.hideAll(a),this.core.editor().focus())},hideAll:function(b,c){if(this.detect.isDesktop()&&this.utils.enableBodyScroll(),b===!1||0===a(b.target).closest(".redactor-dropdown").length){var d="undefined"==typeof c?this.button.toolbar().find("a.dropact"):this.button.toolbar().find("a.dropact").not(".re-"+c),e="undefined"==typeof c?a(".redactor-dropdown-"+this.uuid):a(".redactor-dropdown-"+this.uuid).not(".redactor-dropdown-box-"+c);0!==e.length&&(a(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),a.each(e,a.proxy(function(b,c){var d=a(c);this.core.callback("dropdownHide",d),d.hide(),d.off("mouseover mouseout").off(".redactor-dropdown")},this)),d.removeClass("redactor-act dropact"))}},hide:function(){this.dropdown.active!==!1&&(this.detect.isDesktop()&&this.utils.enableBodyScroll(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideUp":"hide",{duration:.2},a.proxy(function(){a(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),this.dropdown.hideOut()},this)))},hideOut:function(){this.core.callback("dropdownHide",this.dropdown.active),this.dropdown.button.removeClass("redactor-act dropact"),this.dropdown.active.off("mouseover mouseout").off(".redactor-dropdown"),this.dropdown.button=!1,this.dropdown.key=!1,this.dropdown.active=!1}}},events:function(){return{focused:!1,blured:!0,dropImage:!1,stopChanges:!1,stopDetectChanges:function(){this.events.stopChanges=!0},startDetectChanges:function(){var a=this;setTimeout(function(){a.events.stopChanges=!1},1)},dragover:function(b){b.preventDefault(),b.stopPropagation(),"IMG"===b.target.tagName&&a(b.target).addClass("redactor-image-dragover")},dragleave:function(a){this.core.editor().find("img").removeClass("redactor-image-dragover")},drop:function(a){return a=a.originalEvent||a,this.core.editor().find("img").removeClass("redactor-image-dragover"),"inline"===this.opts.type||"pre"===this.opts.type?(a.preventDefault(),!1):void 0===window.FormData||!a.dataTransfer||(0===a.dataTransfer.files.length?this.events.onDrop(a):(this.events.onDropUpload(a),void this.core.callback("drop",a)))},click:function(a){var b=this.core.getEvent(),c="click"!==b&&"arrow"!==b&&"click";this.core.addEvent(c),this.utils.disableSelectAll(),this.core.callback("click",a)},focus:function(a){if(!this.rtePaste&&(this.events.isCallback("focus")&&this.core.callback("focus",a),this.events.focused=!0,this.events.blured=!1,this.selection.current()===!1)){var b=this.selection.get(),c=this.selection.range(b);c.setStart(this.core.editor()[0],0),c.setEnd(this.core.editor()[0],0),this.selection.update(b,c)}},blur:function(b){this.start||this.rtePaste||0===a(b.target).closest("#"+this.core.id()+", .redactor-toolbar, .redactor-dropdown, #redactor-modal-box").length&&(!this.events.blured&&this.events.isCallback("blur")&&this.core.callback("blur",b),this.events.focused=!1,this.events.blured=!0)},touchImageEditing:function(){var b=-1;this.events.imageEditing=!1,a(window).on("touchmove.redactor."+this.uuid,a.proxy(function(){this.events.imageEditing=!0,b!==-1&&clearTimeout(b),b=setTimeout(a.proxy(function(){this.events.imageEditing=!1},this),500)},this))},init:function(){this.core.editor().on("dragover.redactor dragenter.redactor",a.proxy(this.events.dragover,this)),this.core.editor().on("dragleave.redactor",a.proxy(this.events.dragleave,this)),this.core.editor().on("drop.redactor",a.proxy(this.events.drop,this)),this.core.editor().on("click.redactor",a.proxy(this.events.click,this)),this.core.editor().on("paste.redactor",a.proxy(this.paste.init,this)),this.core.editor().on("keydown.redactor",a.proxy(this.keydown.init,this)),this.core.editor().on("keyup.redactor",a.proxy(this.keyup.init,this)),this.core.editor().on("focus.redactor",a.proxy(this.events.focus,this)),a(document).on("mousedown.redactor-blur."+this.uuid,a.proxy(this.events.blur,this)),this.events.touchImageEditing(),this.events.createObserver(),this.events.setupObserver()},createObserver:function(){var b=this;this.events.observer=new MutationObserver(function(c){c.forEach(a.proxy(b.events.iterateObserver,b))})},iterateObserver:function(a){var b=!1;(("textarea"===this.opts.type||"div"===this.opts.type)&&!this.detect.isFirefox()&&a.target===this.core.editor()[0]||"class"===a.attributeName&&a.target===this.core.editor()[0])&&(b=!0),b||(this.observe.load(),this.events.changeHandler())},setupObserver:function(){this.events.observer.observe(this.core.editor()[0],{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},changeHandler:function(){this.events.stopChanges||(this.code.sync(),this.autosave.is()&&(clearTimeout(this.autosaveTimeout),this.autosaveTimeout=setTimeout(a.proxy(this.autosave.send,this),300)))},onDropUpload:function(a){if(a.preventDefault(),a.stopPropagation(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload)){"IMG"===a.target.tagName&&(this.events.dropImage=a.target);for(var b=a.dataTransfer.files,c=b.length,d=0;d<c;d++)this.upload.directUpload(b[d],a)}},onDrop:function(a){this.core.callback("drop",a)},isCallback:function(b){return"undefined"!=typeof this.opts.callbacks[b]&&a.isFunction(this.opts.callbacks[b])},stopDetect:function(){this.events.stopDetectChanges()},startDetect:function(){this.events.startDetectChanges()}}},file:function(){return{is:function(){return!(!this.opts.fileUpload||!this.opts.fileUpload&&!this.opts.s3)},show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),a("#redactor-filename").val(this.selection.get().toString()),this.modal.show()},insert:function(b,c,d){if("undefined"!=typeof b.error)return this.modal.close(),void this.core.callback("fileUploadError",b);this.file.release(d,c),this.buffer.set(),this.air.collapsed();var e=this.file.text(b),f=a("<a />").attr("href",b.url).text(e),g="undefined"==typeof b.id?"":b.id,h="undefined"==typeof b.s3?"file":"s3";f.attr("data-"+h,g),f=a(this.insert.node(f)),this.caret.after(f),this.storage.add({type:h,node:f[0],url:b.url,id:g}),null!==c&&this.core.callback("fileUpload",f,b)},release:function(a,b){b?(this.marker.remove(),this.insert.nodeToPoint(a,this.marker.get()),this.selection.restore()):this.modal.close()},text:function(b){var c=a("#redactor-filename").val();return"undefined"==typeof c||""===c?b.name:c}}},focus:function(){return{start:function(){if(this.core.editor().focus(),"inline"!==this.opts.type){var a=this.focus.first();a!==!1&&this.caret.start(a)}},end:function(){this.core.editor().focus();var a=this.opts.inline?this.core.editor():this.focus.last();if(0!==a.length){var b=this.focus.lastChild(a);
if(this.detect.isWebkit()||b===!1){var c=this.selection.get(),d=this.selection.range(c);null!==d?(d.selectNodeContents(a[0]),d.collapse(!1),this.selection.update(c,d)):this.caret.end(a)}else this.caret.end(b)}},first:function(){var a=this.core.editor().children().first();return(0!==a.length||0!==a[0].length&&"BR"!==a[0].tagName&&"HR"!==a[0].tagName&&3!==a[0].nodeType)&&("UL"===a[0].tagName||"OL"===a[0].tagName?a.find("li").first():a)},last:function(){return this.core.editor().children().last()},lastChild:function(a){var b=a[0].lastChild;return!(null===b||!this.utils.isInlineTag(b.tagName))&&b},is:function(){return this.core.editor()[0]===document.activeElement}}},image:function(){return{is:function(){return!(!this.opts.imageUpload||!this.opts.imageUpload&&!this.opts.s3)},show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.modal.show()},insert:function(b,c,d){var e;if("undefined"!=typeof b.error)return this.modal.close(),this.events.dropImage=!1,void this.core.callback("imageUploadError",b,d);if(this.events.dropImage!==!1)return e=a(this.events.dropImage),this.core.callback("imageDelete",e[0].src,e),e.attr("src",b.url),this.events.dropImage=!1,void this.core.callback("imageUpload",e,b);this.placeholder.hide();var f=a("<"+this.opts.imageTag+">");e=a("<img>"),e.attr("src",b.url);var g="undefined"==typeof b.id?"":b.id,h="undefined"==typeof b.s3?"image":"s3";e.attr("data-"+h,g),f.append(e);var i=this.utils.isTag(this.selection.current(),"pre");if(c){this.air.collapsed(),this.marker.remove();var j=this.insert.nodeToPoint(d,this.marker.get()),k=a(j).next();this.selection.restore(),this.buffer.set(),"undefined"!=typeof k&&0!==k.length&&"IMG"===k[0].tagName?(this.core.callback("imageDelete",k[0].src,k),k.closest("figure, p",this.core.editor()[0]).replaceWith(f),this.caret.after(f)):(i?a(i).after(f):this.insert.node(f),this.caret.after(f))}else this.modal.close(),this.buffer.set(),this.air.collapsed(),i?a(i).after(f):this.insert.node(f),this.caret.after(f);this.events.dropImage=!1,this.storage.add({type:h,node:e[0],url:b.url,id:g});var l=e[0].nextSibling,m=f.next(),n=a(l).text().replace(/\u200B/g,""),o=m.text().replace(/\u200B/g,"");""===n&&a(l).remove(),1===m.length&&"FIGURE"===m[0].tagName&&""===o&&m.remove(),null!==c?this.core.callback("imageUpload",e,b):this.core.callback("imageInserted",e,b)},setEditable:function(b){if(b.on("dragstart",function(a){a.preventDefault()}),this.opts.imageResizable){var c=a.proxy(function(c){this.observe.image=b,this.image.resizer=this.image.loadEditableControls(b),a(document).on("mousedown.redactor-image-resize-hide."+this.uuid,a.proxy(this.image.hideResize,this)),this.image.resizer&&this.image.resizer.on("mousedown.redactor touchstart.redactor",a.proxy(function(a){this.image.setResizable(a,b)},this))},this);b.off("mousedown.redactor").on("mousedown.redactor",a.proxy(this.image.hideResize,this)),b.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",c)}else b.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",a.proxy(function(c){setTimeout(a.proxy(function(){this.image.showEdit(b)},this),200)},this))},setResizable:function(a,b){a.preventDefault(),this.image.resizeHandle={x:a.pageX,y:a.pageY,el:b,ratio:b.width()/b.height(),h:b.height()},a=a.originalEvent||a,a.targetTouches&&(this.image.resizeHandle.x=a.targetTouches[0].pageX,this.image.resizeHandle.y=a.targetTouches[0].pageY),this.image.startResize()},startResize:function(){a(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",a.proxy(this.image.moveResize,this)),a(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",a.proxy(this.image.stopResize,this))},moveResize:function(a){a.preventDefault(),a=a.originalEvent||a;var b=this.image.resizeHandle.h;b+=a.targetTouches?a.targetTouches[0].pageY-this.image.resizeHandle.y:a.pageY-this.image.resizeHandle.y;var c=Math.round(b*this.image.resizeHandle.ratio);b<50||c<100||(this.image.resizeHandle.el.attr({width:c,height:b}),this.image.resizeHandle.el.width(c),this.image.resizeHandle.el.height(b),this.code.sync())},stopResize:function(){this.handle=!1,a(document).off(".redactor-image-resize"),this.image.hideResize()},hideResize:function(b){if(!b||0===a(b.target).closest("#redactor-image-box",this.$editor[0]).length){if(b&&"IMG"==b.target.tagName){a(b.target)}var c=this.$editor.find("#redactor-image-box");0!==c.length&&(a("#redactor-image-editter").remove(),a("#redactor-image-resizer").remove(),c.find("img").css({marginTop:c[0].style.marginTop,marginBottom:c[0].style.marginBottom,marginLeft:c[0].style.marginLeft,marginRight:c[0].style.marginRight}),c.css("margin",""),c.find("img").css("opacity",""),c.replaceWith(function(){return a(this).contents()}),a(document).off("mousedown.redactor-image-resize-hide."+this.uuid),"undefined"!=typeof this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")))}},loadResizableControls:function(b,c){if(this.opts.imageResizable&&!this.detect.isMobile()){var d=a('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.detect.isDesktop()||d.css({width:"15px",height:"15px"}),d.attr("contenteditable",!1),c.append(d),c.append(b),d}return c.append(b),!1},loadEditableControls:function(b){if(0===a("#redactor-image-box").length){var c=a('<span id="redactor-image-box" data-redactor="verified">');if(c.css("float",b.css("float")).attr("contenteditable",!1),"auto"!=b[0].style.margin?(c.css({marginTop:b[0].style.marginTop,marginBottom:b[0].style.marginBottom,marginLeft:b[0].style.marginLeft,marginRight:b[0].style.marginRight}),b.css("margin","")):c.css({display:"block",margin:"auto"}),b.css("opacity",".5").after(c),this.opts.imageEditable){this.image.editter=a('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",a.proxy(function(){this.image.showEdit(b)},this)),c.append(this.image.editter);var d=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+d/2+"px")}return this.image.loadResizableControls(b,c)}},showEdit:function(b){if(!this.events.imageEditing){this.observe.image=b;var c=b.closest("a",this.$editor[0]),d=b.closest("figure",this.$editor[0]),e=0!==d.length?d:b;if(this.modal.load("image-edit",this.lang.get("edit"),705),this.image.buttonDelete=this.modal.getDeleteButton().text(this.lang.get("delete")),this.image.buttonSave=this.modal.getActionButton().text(this.lang.get("save")),this.image.buttonDelete.on("click",a.proxy(this.image.remove,this)),this.image.buttonSave.on("click",a.proxy(this.image.update,this)),this.opts.imageCaption===!1)a("#redactor-image-caption").val("").hide().prev().hide();else{var f=b.closest(this.opts.imageTag,this.$editor[0]),g=f.find("figcaption");0!==g&&a("#redactor-image-caption").val(g.text()).show()}if(this.opts.imagePosition){var h=0!==d.length?"center"===e.css("text-align"):"block"==e.css("display")&&"none"==e.css("float"),i=h?"center":e.css("float");a("#redactor-image-align").val(i)}else a(".redactor-image-position-option").hide();a("#redactor-image-preview").html(a('<img src="'+b.attr("src")+'" style="max-width: 100%;">')),a("#redactor-image-title").val(b.attr("alt")),0!==c.length&&(a("#redactor-image-link").val(c.attr("href")),"_blank"===c.attr("target")&&a("#redactor-image-link-blank").prop("checked",!0)),a(".redactor-link-tooltip").remove(),this.modal.show(),this.detect.isDesktop()&&a("#redactor-image-title").focus()}},update:function(){var b=this.observe.image,c=b.closest("a",this.core.editor()[0]),d=a("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");b.attr("alt",d).attr("title",d),this.image.setFloating(b);var e=a.trim(a("#redactor-image-link").val()).replace(/(<([^>]+)>)/gi,"");if(""!==e){var f="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",g=new RegExp("^(http|ftp|https)://"+f,"i"),h=new RegExp("^"+f,"i");e.search(g)===-1&&0===e.search(h)&&this.opts.linkProtocol&&(e=this.opts.linkProtocol+"://"+e);var i=!!a("#redactor-image-link-blank").prop("checked");if(0===c.length){var j=a('<a href="'+e+'" id="redactor-img-tmp">'+this.utils.getOuterHtml(b)+"</a>");i&&j.attr("target","_blank"),b=b.replaceWith(j),c=this.core.editor().find("#redactor-img-tmp"),c.removeAttr("id")}else c.attr("href",e),i?c.attr("target","_blank"):c.removeAttr("target")}else 0!==c.length&&c.replaceWith(this.utils.getOuterHtml(b));this.image.addCaption(b,c),this.modal.close(),this.buffer.set()},setFloating:function(b){var c=b.closest("figure",this.$editor[0]),d=0!==c.length?c:b,e=a("#redactor-image-align").val(),f="",g="",h="",i="";switch(e){case"left":f="left",h="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":f="right",h="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":0!==c.length?i="center":(g="block",h="auto")}d.css({float:f,display:g,margin:h,"text-align":i}),d.attr("rel",b.attr("style"))},addCaption:function(b,c){var d=a("#redactor-image-caption").val(),e=0!==c.length?c:b,f=e.next();0!==f.length&&"FIGCAPTION"===f[0].tagName||(f=!1),""!==d?f===!1?(f=a("<figcaption />").text(d),e.after(f)):f.text(d):f!==!1&&f.remove()},remove:function(b,c,d){c="undefined"==typeof c?a(this.observe.image):c,"boolean"!=typeof b&&this.buffer.set(),this.events.stopDetectChanges();var e=c.closest("a",this.core.editor()[0]),f=c.closest(this.opts.imageTag,this.core.editor()[0]),g=c.parent(),h=this.core.callback("imageDelete",b,c[0]);if(h===!1)return b&&b.preventDefault(),!1;0!==a("#redactor-image-box").length&&(g=a("#redactor-image-box").parent());var i,j;0!==f.length?(j=f.prev(),i=f.next(),f.remove()):0!==e.length?(g=e.parent(),e.remove()):c.remove(),a("#redactor-image-box").remove(),b!==!1&&(i&&0!==i.length?this.caret.start(i):j&&0!==j.length&&this.caret.end(j)),"boolean"!=typeof b&&this.modal.close(),this.utils.restoreScroll(),this.observe.image=!1,this.events.startDetectChanges(),this.placeholder.enable(),this.code.sync()}}},indent:function(){return{increase:function(){if(this.list.get()){var b=a(this.selection.current()).closest("li"),c=b.closest("ul, ol",this.core.editor()[0]),d=b.closest("li"),e=d.prev();if(0!==e.length&&"LI"===e[0].tagName)if(this.buffer.set(),this.utils.isCollapsed()){var f=c[0].tagName,g=a("<"+f+" />");this.selection.save();var h=e.find("ol").first();if(1===h.length)h.append(b);else{var f=c[0].tagName,g=a("<"+f+" />");g.append(b),e.append(g)}this.selection.restore()}else document.execCommand("indent"),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},decrease:function(){if(this.list.get()){var b=a(this.selection.current()).closest("li");b.closest("ul, ol",this.core.editor()[0]);this.buffer.set(),document.execCommand("outdent");var c=a(this.selection.current()).closest("li",this.core.editor()[0]);if(this.utils.isCollapsed()&&this.indent.repositionItem(c),0===c.length){document.execCommand("formatblock",!1,"p"),c=a(this.selection.current());var d=c.next();0!==d.length&&"BR"===d[0].tagName&&d.remove()}this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},repositionItem:function(a){var b=a.next();0===b.length||"UL"===b[0].tagName&&"OL"===b[0].tagName||a.append(b);var c=a.prev();if(0!==c.length&&"LI"!==c[0].tagName){this.selection.save();var d=a.parents("li",this.core.editor()[0]);d.after(a),this.selection.restore()}},normalize:function(){this.core.editor().find("li").each(a.proxy(function(b,c){var d=a(c);d.find(this.opts.inlineTags.join(",")).each(function(){a(this).removeAttr("style")});var e=d.parent();if(0!==e.length&&"LI"===e[0].tagName)return void e.after(d);var f=d.next();0===f.length||"UL"!==f[0].tagName&&"OL"!==f[0].tagName||d.append(f)},this))},removeEmpty:function(b){var c=this.core.editor().find("ul, ol"),d=this.core.editor().find("li");d.each(a.proxy(function(a,b){this.indent.removeItemEmpty(b)},this)),c.each(a.proxy(function(a,b){this.indent.removeItemEmpty(b)},this)),d.each(a.proxy(function(a,b){this.indent.removeItemEmpty(b)},this))},removeItemEmpty:function(b){var c=b.innerHTML.replace(/[\t\s\n]/g,"");c=c.replace(/<span><\/span>/g,""),""===c&&a(b).remove()}}},inline:function(){return{format:function(a,b,c,d){if(!this.utils.isCurrentOrParent(["PRE","CODE"])){var e=this.inline.getParams(b,c,d);a=this.inline.arrangeTag(a),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.inline.formatCollapsed(a,e):this.inline.formatUncollapsed(a,e)}},formatCollapsed:function(b,c){var d,e=this.selection.inline();if(e){var f=e.tagName.toLowerCase();if(f===b)if(this.utils.isEmpty(e.innerHTML))this.caret.after(e),a(e).remove();else{var g=this.inline.insertBreakpoint(e,f);this.caret.after(g)}else if(0===a(e).closest(b).length)d=this.inline.insertInline(b),d=this.inline.setParams(d,c);else{var g=this.inline.insertBreakpoint(e,f);this.caret.after(g)}}else d=this.inline.insertInline(b),d=this.inline.setParams(d,c)},formatUncollapsed:function(b,c){this.selection.save();var d=this.inline.getClearedNodes();this.inline.setNodesStriked(d,b,c),this.selection.restore(),document.execCommand("strikethrough"),this.selection.saveInstant();var e=this;this.core.editor().find("strike").each(function(){var d=e.utils.replaceToTag(this,b);e.inline.setParams(d[0],c);var f=d.find(b),g=d.parent(),h=g.parent();return 0!==h.length&&h[0].tagName.toLowerCase()===b&&h.html()==g[0].outerHTML?(d.replaceWith(function(){return a(this).contents()}),void h.replaceWith(function(){return a(this).contents()})):(0!==f.length&&e.inline.cleanInsideOrParent(f,c),g.html()==d[0].outerHTML&&e.inline.cleanInsideOrParent(g,c),void(e.detect.isFirefox()&&e.core.editor().find(b+":empty").remove()))}),this.selection.restoreInstant()},cleanInsideOrParent:function(a,b){if(b)for(var c in b.data)this.inline.removeSpecificAttr(a,c,b.data[c])},getClearedNodes:function(){for(var b=this.selection.nodes(),c=[],d=b.length,e=0,f=0;f<d;f++)if(a(b[f]).hasClass("redactor-selection-marker")){e=f+2;break}for(var f=0;f<d;f++)f>=e&&!this.utils.isBlockTag(b[f].tagName)&&c.push(b[f]);return c},isConvertableAttr:function(b,c,d){var e=a(b).attr(c);if(e)if("style"===c){d=a.trim(d).replace(/;$/,"");for(var f=d.split(";"),g=0,h=0;h<f.length;h++){var i=f[h].split(":"),j=a.trim(i[0]),k=a.trim(i[1]);if(j.search(/color/)!==-1){var l=a(b).css(j);!l||l!==k&&this.utils.rgb2hex(l)!==k||g++}else a(b).css(j)===k&&g++}if(g===f.length)return 1}else if(e===d)return 1;return 0},isConvertable:function(a,b,c,d){if(b===c){if(!d)return!0;var e=0;for(var f in d.data)e+=this.inline.isConvertableAttr(a,f,d.data[f]);if(e===Object.keys(d.data).length)return!0}return!1},setNodesStriked:function(b,c,d){for(var e=0;e<b.length;e++){var f=b[e].tagName?b[e].tagName.toLowerCase():void 0,g=b[e].parentNode,h=g&&g.tagName?g.tagName.toLowerCase():void 0,i=this.inline.isConvertable(g,h,c,d);if(i){var j=a(g).replaceWith(function(){return a("<strike>").append(a(this).contents())});j.attr("data-redactor-inline-converted")}var i=this.inline.isConvertable(b[e],f,c,d);if(i)var j=a(b[e]).replaceWith(function(){return a("<strike>").append(a(this).contents())})}},insertBreakpoint:function(b,c){var d=document.createElement("span");d.id="redactor-inline-breakpoint",d=this.insert.node(d);var e=this.utils.isEndOfElement(b),f=this.utils.getOuterHtml(b),g=e?"":"<"+c+">";f=f.replace(/<span id="redactor-inline-breakpoint"><\/span>/i,"</"+c+">"+g);var h=a(f);return a(b).replaceWith(h),""!==g&&this.utils.cloneAttributes(b,h.last()),h.first()},insertInline:function(a){var b=document.createElement(a);return this.insert.node(b),this.caret.start(b),b},arrangeTag:function(a){var b=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],c=["strong","strong","em","em","u","del","del","sup","sub"];a=a.toLowerCase();for(var d=0;d<b.length;d++)a===b[d]&&(a=c[d]);return a},getStyleParams:function(a){for(var b={},c=a.trim().replace(/;$/,"").split(";"),d=0;d<c.length;d++){var e=c[d].split(":");e&&(b[e[0].trim()]=e[1].trim())}return b},getParams:function(a,b,c){var d=!1,e="toggle";return"object"==typeof a?(d=a,e=void 0!==b?b:e):void 0!==a&&void 0!==b&&(d={},d[a]=b,e=void 0!==c?c:e),!!d&&{func:e,data:d}},setParams:function(b,c){if(c)for(var d in c.data){var e=a(b);"style"===d?(b=this.inline[c.func+"Style"](c.data[d],b),e.attr("data-redactor-style-cache",e.attr("style"))):b="class"===d?this.inline[c.func+"Class"](c.data[d],b):"remove"===c.func?this.inline[c.func+"Attr"](d,b):this.inline[c.func+"Attr"](d,c.data[d],b),"style"===d&&"SPAN"===b.tagName&&e.attr("data-redactor-span",!0)}return b},eachInline:function(a,b){var c,d=void 0===a?this.selection.inlines():[a];if(d)for(var e=0;e<d.length;e++)c=b(d[e])[0];return c},replaceClass:function(b,c){return this.inline.eachInline(c,function(c){return a(c).removeAttr("class").addClass(b)})},toggleClass:function(b,c){return this.inline.eachInline(c,function(c){return a(c).toggleClass(b)})},addClass:function(b,c){return this.inline.eachInline(c,function(c){return a(c).addClass(b)})},removeClass:function(b,c){return this.inline.eachInline(c,function(c){return a(c).removeClass(b)})},removeAllClass:function(b){return this.inline.eachInline(b,function(b){return a(b).removeAttr("class")})},replaceAttr:function(b,c,d){return this.inline.eachInline(d,function(c){return a(c).removeAttr(b).attr(b.value)})},toggleAttr:function(b,c,d){return this.inline.eachInline(d,function(c){var d=a(c).attr(b);return d?a(c).removeAttr(b):a(c).attr(b.value)})},addAttr:function(b,c,d){return this.inline.eachInline(d,function(d){return a(d).attr(b,c)})},removeAttr:function(b,c){return this.inline.eachInline(c,function(c){var d=a(c);return d.removeAttr(b),"style"===b&&d.removeAttr("data-redactor-style-cache"),d})},removeAllAttr:function(b){return this.inline.eachInline(b,function(b){for(var c=a(b),d=b.attributes.length,e=0;e<d;e++)c.removeAttr(b.attributes[e].name);return c})},removeSpecificAttr:function(b,c,d){var e=a(b);if("style"===c){var f=d.split(":"),g=f[0].trim();e.css(g,""),this.utils.removeEmptyAttr(b,"style")&&e.removeAttr("data-redactor-style-cache")}else e.removeAttr(c)[0]},hasParentStyle:function(a){var b=a.parent();return 1===b.length&&b[0].tagName===a[0].tagName&&b.html()===a[0].outerHTML&&b},addParentStyle:function(b){var c=this.inline.hasParentStyle(b);if(c){var d=this.inline.getStyleParams(b.attr("style"));c.css(d),c.attr("data-redactor-style-cache",c.attr("style")),b.replaceWith(function(){return a(this).contents()})}else b.attr("data-redactor-style-cache",b.attr("style"));return b},replaceStyle:function(b,c){b=this.inline.getStyleParams(b);var d=this;return this.inline.eachInline(c,function(c){var e=a(c);e.removeAttr("style").css(b);var f=e.attr("style");return f&&e.attr("style",f.replace(/"/g,"'")),e=d.inline.addParentStyle(e)})},toggleStyle:function(b,c){b=this.inline.getStyleParams(b);var d=this;return this.inline.eachInline(c,function(c){var e=a(c);for(var f in b){var g=b[f],h=e.css(f);h=d.utils.isRgb(h)?d.utils.rgb2hex(h):h.replace(/"/g,""),g=d.utils.isRgb(g)?d.utils.rgb2hex(g):g.replace(/"/g,""),h===g?e.css(f,""):e.css(f,g)}var i=e.attr("style");return i&&e.attr("style",i.replace(/"/g,"'")),d.utils.removeEmptyAttr(c,"style")?e.removeAttr("data-redactor-style-cache"):e=d.inline.addParentStyle(e),e})},addStyle:function(b,c){b=this.inline.getStyleParams(b);var d=this;return this.inline.eachInline(c,function(c){var e=a(c);e.css(b);var f=e.attr("style");return f&&e.attr("style",f.replace(/"/g,"'")),e=d.inline.addParentStyle(e)})},removeStyle:function(b,c){b=this.inline.getStyleParams(b);var d=this;return this.inline.eachInline(c,function(c){var e=a(c);for(var f in b)e.css(f,"");return d.utils.removeEmptyAttr(c,"style")?e.removeAttr("data-redactor-style-cache"):e.attr("data-redactor-style-cache",e.attr("style")),e})},removeAllStyle:function(b){return this.inline.eachInline(b,function(b){return a(b).removeAttr("style").removeAttr("data-redactor-style-cache")})},removeStyleRule:function(b){var c=this.selection.parent(),d=this.selection.inlines();this.buffer.set(),c&&"SPAN"===c.tagName&&this.inline.removeStyleRuleAttr(a(c),b);for(var e=0;e<d.length;e++){var f=d[e],g=a(f);a.inArray(f.tagName.toLowerCase(),this.opts.inlineTags)==-1||g.hasClass("redactor-selection-marker")||this.inline.removeStyleRuleAttr(g,b)}},removeStyleRuleAttr:function(a,b){a.css(b,""),this.utils.removeEmptyAttr(a,"style")?a.removeAttr("data-redactor-style-cache"):a.attr("data-redactor-style-cache",a.attr("style"))},update:function(a,b,c,d){a=this.inline.arrangeTag(a);var e=this.inline.getParams(b,c,d),f=this.selection.inlines(),g=[];if(f)for(var h=0;h<f.length;h++){var i=f[h];"*"!==a&&i.tagName.toLowerCase()!==a||g.push(this.inline.setParams(i,e))}return g},removeFormat:function(){this.selection.save();for(var b=this.inline.getClearedNodes(),c=0;c<b.length;c++)1===b[c].nodeType&&a(b[c]).replaceWith(function(){return a(this).contents()});this.selection.restore()}}},insert:function(){return{set:function(a){this.placeholder.hide(),this.code.set(a),this.focus.end(),this.placeholder.enable()},html:function(b,c){this.placeholder.hide(),this.core.editor().focus();var d=this.selection.block(),e=this.selection.inline();"undefined"==typeof c&&(c=this.clean.getCurrentType(b,!0),b=this.clean.onPaste(b,c,!0)),b=a.parseHTML(b);var f=a(b).last(),g=this.selection.get(),h=this.selection.range(g);if(h.deleteContents(),this.selection.update(g,h),c.lists){var i=a(b);if(0!==i.length&&("UL"===i[0].tagName||"OL"===i[0].tagName))return void this.insert.appendLists(d,i)}if(c.blocks&&d)if(this.utils.isSelectAll())this.core.editor().html(b),this.focus.end();else{var j=this.utils.breakBlockTag();if(j===!1)this.insert.placeHtml(b);else{var k=a(b).children().last();k.append(this.marker.get()),"start"===j.type?j.$block.before(b):j.$block.after(b),this.selection.restore(),this.core.editor().find("p").each(function(){""===a.trim(this.innerHTML)&&a(this).remove()})}}else{if(e){var l=a("<div/>").html(b);l.find(e.tagName.toLowerCase()).each(function(){a(this).contents().unwrap()}),b=l.html()}if(this.utils.isSelectAll()){var m=a(this.opts.emptyHtml);this.core.editor().html("").append(m),m.html(b),this.caret.end(m)}else this.insert.placeHtml(b)}this.utils.disableSelectAll(),c.pre&&this.clean.cleanPre(),this.caret.end(f),this.linkify.format()},text:function(b){b=b.toString(),b=a.trim(b);var c=document.createElement("div");if(c.innerHTML=b,b=c.textContent||c.innerText,"undefined"!=typeof b){this.placeholder.hide(),this.core.editor().focus();var d=this.selection.blocks();if(b=b.replace(/\n/g," "),this.utils.isSelectAll()){var e=a(this.opts.emptyHtml);this.core.editor().html("").append(e),e.html(b),this.caret.end(e)}else{var f=this.selection.get(),g=document.createTextNode(b);if(f.getRangeAt&&f.rangeCount){var h=f.getRangeAt(0);h.deleteContents(),h.insertNode(g),h.setStartAfter(g),h.collapse(!0),this.selection.update(f,h)}d.length>1&&(a(g).wrap("<p>"),this.caret.after(g))}this.utils.disableSelectAll(),this.linkify.format(),this.clean.normalizeCurrentHeading()}},raw:function(a){this.placeholder.hide(),this.core.editor().focus();var b=this.selection.get(),c=this.selection.range(b);c.deleteContents();var d=document.createElement("div");d.innerHTML=a;for(var e,f,g=document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))},node:function(b,c){this.placeholder.hide(),"undefined"!=typeof this.start&&this.core.editor().focus(),b=b[0]||b;var d=this.selection.block(),e=this.utils.isBlockTag(b.tagName),f=!0;if(this.utils.isSelectAll())e?this.core.editor().html(b):this.core.editor().html(a("<p>").html(b)),this.code.sync();else if(e&&d){var g=this.utils.breakBlockTag();g===!1?this.insert.placeNode(b,c):("start"===g.type?g.$block.before(b):g.$block.after(b),this.core.editor().find("p:empty").remove())}else f=this.insert.placeNode(b,c);return this.utils.disableSelectAll(),f&&this.caret.end(b),b},appendLists:function(b,c){var d,e=a(b),f=this.utils.isEmpty(b.innerHTML);if(f||this.utils.isEndOfElement(b))d=e,c.find("li").each(function(){d.after(this),d=a(this)}),f&&e.remove();else if(this.utils.isStartOfElement(b))c.find("li").each(function(){e.before(this),d=a(this)});else{var g=this.selection.extractEndOfNode(b);e.after(a("<li>").append(g)),e.append(c),d=c}this.marker.remove(),d&&this.caret.end(d),this.linkify.format()},placeHtml:function(b){var c=document.createElement("span");c.id="redactor-insert-marker",c=this.insert.node(c),a(c).before(b),this.selection.restore(),this.caret.after(c),a(c).remove()},placeNode:function(a,b){var c=this.selection.get(),d=this.selection.range(c);return null!=d&&(b!==!1&&d.deleteContents(),d.insertNode(a),d.collapse(!1),void this.selection.update(c,d))},nodeToPoint:function(b,c){if(this.placeholder.hide(),c=c[0]||c,this.utils.isEmpty())return c=this.utils.isBlock(c)?c:a("<p />").append(c),this.core.editor().html(c),c;var d,e=b.clientX,f=b.clientY;if(document.caretPositionFromPoint){var g=document.caretPositionFromPoint(e,f),h=document.getSelection();d=h.getRangeAt(0),d.setStart(g.offsetNode,g.offset),d.collapse(!0),d.insertNode(c)}else if(document.caretRangeFromPoint)d=document.caretRangeFromPoint(e,f),d.insertNode(c);else if("undefined"!=typeof document.body.createTextRange){d=document.body.createTextRange(),d.moveToPoint(e,f);var i=d.duplicate();i.moveToPoint(e,f),d.setEndPoint("EndToEnd",i),d.select()}return c},nodeToCaretPositionFromPoint:function(a,b){this.insert.nodeToPoint(a,b)},marker:function(){this.marker.insert()}}},keydown:function(){return{init:function(b){if(!this.rtePaste){var c=b.which,d=c>=37&&c<=40;this.keydown.ctrl=b.ctrlKey||b.metaKey,this.keydown.parent=this.selection.parent(),this.keydown.current=this.selection.current(),this.keydown.block=this.selection.block(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.keydown.figure=this.utils.isTag(this.keydown.current,"figure");var e=this.core.callback("keydown",b);if(e===!1)return b.preventDefault(),!1;if(this.shortcuts.init(b,c),this.keydown.checkEvents(d,c),this.keydown.setupBuffer(b,c),this.utils.isSelectAll()&&(c===this.keyCode.ENTER||c===this.keyCode.BACKSPACE||c===this.keyCode.DELETE))return b.preventDefault(),void this.code.set(this.opts.emptyHtml);if(this.keydown.addArrowsEvent(d),this.keydown.setupSelectAll(b,c),!this.opts.enterKey&&c===this.keyCode.ENTER){b.preventDefault();var f=this.selection.get(),g=this.selection.range(f);return void(g.collapsed||g.deleteContents())}if(this.opts.enterKey&&c===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey&&c===this.keyCode.UP&&this.keydown.onArrowUp(),("textarea"===this.opts.type||"div"===this.opts.type)&&this.keydown.current&&3===this.keydown.current.nodeType&&a(this.keydown.parent).hasClass("redactor-in")&&this.keydown.wrapToParagraph(),!this.keyup.lastShiftKey&&c===this.keyCode.SPACE&&(b.ctrlKey||b.shiftKey))return b.preventDefault(),this.keydown.onShiftSpace();if(c===this.keyCode.ENTER&&(b.ctrlKey||b.shiftKey))return b.preventDefault(),this.keydown.onShiftEnter(b);if(c===this.keyCode.ENTER&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey)return this.keydown.onEnter(b);if(c===this.keyCode.TAB||b.metaKey&&221===c||b.metaKey&&219===c)return this.keydown.onTab(b,c);if(this.detect.isFirefox()&&c===this.keyCode.BACKSPACE&&this.keydown.block&&"P"===this.keydown.block.tagName&&this.utils.isStartOfElement(this.keydown.block)){var h=a(this.keydown.block).prev();if(0!==h.length)return b.preventDefault(),h.append(this.marker.get()),h.append(a(this.keydown.block).html()),a(this.keydown.block).remove(),void this.selection.restore()}if(c===this.keyCode.BACKSPACE||c===this.keyCode.DELETE){if(this.observe.image&&"undefined"!=typeof this.observe.image&&0!==a("#redactor-image-box").length){b.preventDefault();var h=this.observe.image.closest("figure, p").prev();return this.image.remove(!1),this.observe.image=!1,void(h&&0!==h.length?this.caret.end(h):this.core.editor().focus())}this.keydown.onBackspaceAndDeleteBefore()}if(c===this.keyCode.DELETE){var i=a(this.keydown.block).next();if(this.utils.isEndOfElement(this.keydown.block)&&0!==i.length&&"FIGURE"===i[0].tagName)return i.remove(),!1;var j=!(!this.keydown.block||"LI"!==this.keydown.block.tagName)&&this.keydown.block;if(j){var k=a(this.keydown.block).parents("ul, ol").last(),l=k.next();if(this.utils.isRedactorParent(k)&&this.utils.isEndOfElement(k)&&0!==l.length&&("UL"===l[0].tagName||"OL"===l[0].tagName))return b.preventDefault(),k.append(l.contents()),l.remove(),!1}if(this.utils.isEndOfElement(this.keydown.block)&&0!==i.length&&"PRE"===i[0].tagName)return a(this.keydown.block).append(i.text()),i.remove(),!1}if(c===this.keyCode.DELETE&&0!==a("#redactor-image-box").length&&this.image.remove(),c===this.keyCode.BACKSPACE){if(this.detect.isFirefox()&&this.line.removeOnBackspace(b),this.list.combineAfterAndBefore(this.keydown.block))return void b.preventDefault();var m=this.selection.block();if(m&&"LI"===m.tagName&&this.utils.isCollapsed()&&this.utils.isStartOfElement())return this.indent.decrease(),void b.preventDefault();this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(b)}c!==this.keyCode.BACKSPACE&&c!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteAfter(b)}},onShiftSpace:function(){return this.buffer.set(),this.insert.raw("&nbsp;"),!1},onShiftEnter:function(a){return this.buffer.set(),this.keydown.pre?this.keydown.insertNewLine(a):this.insert.raw("<br>")},onBackspaceAndDeleteBefore:function(){this.utils.saveScroll()},onBackspaceAndDeleteAfter:function(b){setTimeout(a.proxy(function(){this.code.syncFire=!1,this.keydown.removeEmptyLists();var a="";0!==this.opts.keepStyleAttr.length&&(a=","+this.opts.keepStyleAttr.join(","));var c=this.core.editor().find("*[style]");c.not("img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]"+a).removeAttr("style"),this.keydown.formatEmpty(b),this.code.syncFire=!0},this),1)},onEnter:function(b){var c=this.core.callback("enter",b);if(c===!1)return b.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(b)===!0)return!1;if(this.keydown.pre)return this.keydown.insertNewLine(b);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(b);if(this.keydown.figure)setTimeout(a.proxy(function(){this.keydown.replaceToParagraph("FIGURE")},this),1);else if(this.keydown.block){if(setTimeout(a.proxy(function(){this.keydown.replaceToParagraph("DIV")},this),1),"LI"===this.keydown.block.tagName){var d=this.selection.current(),e=a(d).closest("li",this.$editor[0]),f=e.parents("ul,ol",this.$editor[0]).last();if(0!==e.length&&this.utils.isEmpty(e.html())&&0===f.next().length&&this.utils.isEmpty(f.find("li").last().html())){f.find("li").last().remove();var g=a(this.opts.emptyHtml);return f.after(g),this.caret.start(g),!1}}}else if(!this.keydown.block)return this.keydown.insertParagraph(b);return this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?void this.keydown.insertBreakLine(b):void setTimeout(a.proxy(function(){var b=this.selection.inline();if(b&&this.utils.isEmpty(b.innerHTML)){var c=this.selection.block();a(b).remove();var d=document.createRange();d.setStart(c,0);var e=document.createTextNode("​");d.insertNode(e),d.setStartAfter(e),d.collapse(!0);var f=window.getSelection();f.removeAllRanges(),f.addRange(d)}},this),1)},checkEvents:function(a,b){a||"click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(b)&&this.buffer.set())},checkKeyEvents:function(b){var c=this.keyCode,d=[c.BACKSPACE,c.DELETE,c.ENTER,c.ESC,c.TAB,c.CTRL,c.META,c.ALT,c.SHIFT];
return a.inArray(b,d)===-1},addArrowsEvent:function(a){if(a)return"click"===this.core.getEvent()||"arrow"===this.core.getEvent()?void this.core.addEvent(!1):void this.core.addEvent("arrow")},setupBuffer:function(a,b){return this.keydown.ctrl&&90===b&&!a.shiftKey&&!a.altKey&&this.opts.buffer.length?(a.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===b&&a.shiftKey&&!a.altKey&&0!==this.opts.rebuffer.length?(a.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||b!==this.keyCode.SPACE&&b!==this.keyCode.BACKSPACE&&b!==this.keyCode.DELETE&&(b!==this.keyCode.ENTER||a.ctrlKey||a.shiftKey)||this.buffer.set())},exitFromBlockquote:function(b){if(this.utils.isEndOfElement(this.keydown.blockquote)){var c=this.clean.removeSpacesHard(a(this.keydown.blockquote).html());if(c.search(/(<br\s?\/?>){1}$/i)!==-1){b.preventDefault();var d=a(this.keydown.blockquote).children().last();d.filter("br").remove(),a(this.keydown.blockquote).children().last().filter("span").remove();var e=a(this.opts.emptyHtml);return a(this.keydown.blockquote).after(e),this.caret.start(e),!0}}},onArrowDown:function(){for(var a=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],b=0;b<a.length;b++)if(a[b])return this.keydown.insertAfterLastElement(a[b]),!1},onArrowUp:function(){for(var a=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],b=0;b<a.length;b++)if(a[b])return this.keydown.insertBeforeFirstElement(a[b]),!1},insertAfterLastElement:function(b){if(this.utils.isEndOfElement(b)){var c=this.core.editor().contents().last(),d="FIGCAPTION"===b.tagName?a(this.keydown.block).parent().next():a(this.keydown.block).next();if(0===d.length){if(0===c.length&&c[0]!==b)return void this.caret.start(c);var e=a(this.opts.emptyHtml);"FIGCAPTION"===b.tagName?a(b).parent().after(e):a(b).after(e),this.caret.start(e)}}},insertBeforeFirstElement:function(b){if(this.utils.isStartOfElement()&&!(this.core.editor().contents().length>1&&this.core.editor().contents().first()[0]!==b)){var c=a(this.opts.emptyHtml);a(b).before(c),this.caret.start(c)}},onTab:function(a,b){if(!this.opts.tabKey)return!0;var c=this.keydown.block&&"LI"===this.keydown.block.tagName;if(this.utils.isEmpty(this.code.get())||!c&&!this.keydown.pre&&this.opts.tabAsSpaces===!1)return!0;a.preventDefault(),this.buffer.set();var d,e=c&&this.utils.isStartOfElement(this.keydown.block);return this.keydown.pre&&!a.shiftKey?(d=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("\t"),this.insert.node(d)):this.opts.tabAsSpaces===!1||e?a.metaKey&&219===b?this.indent.decrease():a.metaKey&&221===b?this.indent.increase():a.shiftKey?this.indent.decrease():this.indent.increase():(d=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(d)),!1},setupSelectAll:function(a,b){this.keydown.ctrl&&65===b?this.utils.enableSelectAll():b===this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},insertNewLine:function(a){a.preventDefault();var b=document.createTextNode("\n"),c=this.selection.get(),d=this.selection.range(c);return d.deleteContents(),d.insertNode(b),this.caret.after(b),!1},insertParagraph:function(a){a.preventDefault();var b=document.createElement("p");b.innerHTML="<br>";var c=this.selection.get(),d=this.selection.range(c);return d.deleteContents(),d.insertNode(b),this.caret.start(b),!1},insertBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a)},insertDblBreakLine:function(a){return this.keydown.insertBreakLineProcessing(a,!0)},insertBreakLineProcessing:function(a,b){a.stopPropagation();var c=document.createElement("br");if(this.insert.node(c),b===!0){var d=document.createElement("br");this.insert.node(d),this.caret.after(d)}else this.caret.after(c);return!1},wrapToParagraph:function(){var b=a(this.keydown.current),c=a("<p>").append(b.clone());b.replaceWith(c);var d=a(c).next();"undefined"!=typeof d[0]&&"BR"===d[0].tagName&&d.remove(),this.caret.end(c)},replaceToParagraph:function(b){var c=this.selection.block(),d=a(c).prev(),e=c.innerHTML.replace(/<br\s?\/?>/gi,"");if(c.tagName===b&&this.utils.isEmpty(e)&&!a(c).hasClass("redactor-in")){var f=document.createElement("p");return a(c).replaceWith(f),this.keydown.setCaretToParagraph(f),!1}if("P"===c.tagName)return a(c).removeAttr("class").removeAttr("style"),this.detect.isIe()&&this.utils.isEmpty(e)&&this.utils.isInline(this.keydown.parent)&&a(c).on("input",a.proxy(function(){var b=this.selection.parent();if(this.utils.isInline(b)){var d=a(b).html();a(c).html(d),this.caret.end(c)}a(c).off("keyup")},this)),!1;if(d.hasClass(this.opts.videoContainerClass)){d.removeAttr("class");var f=document.createElement("p");return d.replaceWith(f),this.keydown.setCaretToParagraph(f),!1}},setCaretToParagraph:function(a){var b=document.createRange();b.setStart(a,0);var c=document.createTextNode("​");b.insertNode(c),b.setStartAfter(c),b.collapse(!0);var d=window.getSelection();d.removeAllRanges(),d.addRange(b)},removeInvisibleSpace:function(){var b=a(this.keydown.current);0===b.text().search(/^\u200B$/g)&&b.remove()},removeEmptyListInTable:function(b){var c=a(this.keydown.current),d=a(this.keydown.parent),e=c.closest("td",this.$editor[0]);if(0!==e.length&&c.closest("li",this.$editor[0])&&1===d.children("li").length){if(!this.utils.isEmpty(c.text()))return;b.preventDefault(),c.remove(),d.remove(),this.caret.start(e)}},removeEmptyLists:function(){var b=function(){var b=a.trim(this.innerHTML).replace(/\/t\/n/g,"");""===b&&a(this).remove()};this.core.editor().find("li").each(b),this.core.editor().find("ul, ol").each(b)},formatEmpty:function(b){var c=a.trim(this.core.editor().html());if(this.utils.isEmpty(c))return b.preventDefault(),"inline"===this.opts.type||"pre"===this.opts.type?(this.core.editor().html(this.marker.html()),this.selection.restore()):(this.core.editor().html(this.opts.emptyHtml),this.focus.start()),!1}}},keyup:function(){return{init:function(b){if(!this.rtePaste){var c=b.which;this.keyup.block=this.selection.block(),this.keyup.current=this.selection.current(),this.keyup.parent=this.selection.parent(),this.keyup.lastShiftKey=b.shiftKey;var d=this.core.callback("keyup",b);if(d===!1)return b.preventDefault(),!1;if(c===this.keyCode.ENTER&&this.keyup.block&&"FIGURE"===this.keyup.block.tagName){var e=a(this.keyup.block).prev();if(0!==e.length&&"FIGURE"===e[0].tagName){var f=this.utils.replaceToTag(e,"p");return void this.caret.start(f)}}if(c===this.keyCode.BACKSPACE||c===this.keyCode.DELETE){if(this.utils.isSelectAll())return this.focus.start(),void this.toolbar.setUnfixed();if(this.keyup.block&&this.keydown.block&&"FIGURE"===this.keyup.block.tagName&&this.utils.isStartOfElement(this.keydown.block)){b.preventDefault(),this.selection.save(),a(this.keyup.block).find("figcaption").remove(),a(this.keyup.block).find("img").first().remove(),this.utils.replaceToTag(this.keyup.block,"p");var g=this.marker.find();return a("html, body").animate({scrollTop:g.position().top+20},500),void this.selection.restore()}if(this.keyup.block&&"P"===this.keyup.block.tagName){var h=a(this.keyup.block).find("img").length,i=a(this.keyup.block).text().replace(/\u200B/g,"");""===i&&0!==h&&this.utils.replaceToTag(this.keyup.block,"figure")}this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0===a(this.keyup.block).find("img").length&&(this.selection.save(),this.utils.replaceToTag(this.keyup.block,"p"),this.selection.restore())}this.linkify.isKey(c)&&this.linkify.format()}}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(a){return"undefined"!=typeof this.opts.curLang[a]?this.opts.curLang[a]:""}}},line:function(){return{insert:function(){this.buffer.set(),this.insert.html(this.line.getLineHtml());var a=this.core.editor().find("#redactor-hr-tmp-id");return a.removeAttr("id"),this.core.callback("insertedLine",a),a},getLineHtml:function(){var a='<hr id="redactor-hr-tmp-id" />';return!this.detect.isFirefox()&&this.utils.isEmpty()&&(a+="<p>"+this.opts.emptyHtml+"</p>"),a},removeOnBackspace:function(b){if(this.utils.isCollapsed()){var c=a(this.selection.block());if(0!==c.length&&this.utils.isStartOfElement(c)){var d=c.prev();d&&0!==d.length&&"HR"===d[0].tagName&&(b.preventDefault(),d.remove())}}}}},link:function(){return{get:function(){return a(this.selection.inlines("a"))},is:function(){var b=this.selection.nodes(),c=a(this.selection.current()).closest("a",this.core.editor()[0]);return!(0===c.length||b.length>1)&&c},unlink:function(a){"undefined"!=typeof a&&a.preventDefault&&a.preventDefault(),this.buffer.set();var b=this.selection.inlines("a");if(0!==b.length){var c=this.link.replaceLinksToText(b);this.observe.closeAllTooltip(),this.core.callback("deletedLink",c)}},insert:function(b,c){var d=this.link.is();if(c!==!0&&(b=this.link.buildLinkFromObject(d,b),b===!1))return!1;if(this.buffer.set(),b=this.core.callback("beforeInsertingLink",b),d===!1){d=a("<a />"),d=this.link.update(d,b),d=a(this.insert.node(d));var e=d.parent();this.utils.isRedactorParent(e)===!1&&d.wrap("<p>"),e.hasClass("redactor-unlink")&&e.replaceWith(function(){return a(this).contents()}),this.caret.after(d),this.core.callback("insertedLink",d)}else d=this.link.update(d,b),this.caret.after(d);return d},update:function(a,b){return a.text(b.text),a.attr("href",b.url),this.link.target(a,b.target),a},target:function(a,b){return b?a.attr("target","_blank"):a.removeAttr("target")},show:function(b){"undefined"!=typeof b&&b.preventDefault&&b.preventDefault(),this.observe.closeAllTooltip();var c=this.link.is();this.link.buildModal(c);var d=this.link.buildLinkFromElement(c);d.url=this.link.removeSelfHostFromUrl(d.url),this.opts.linkNewTab&&!c&&(d.target=!0),this.link.setModalValues(d),this.modal.show(),this.detect.isDesktop()&&a("#redactor-link-url").focus()},setModalValues:function(b){a("#redactor-link-blank").prop("checked",b.target),a("#redactor-link-url").val(b.url),a("#redactor-link-url-text").val(b.text)},buildModal:function(b){this.modal.load("link",this.lang.get(b===!1?"link-insert":"link-edit"),600);var c=this.modal.getActionButton();c.text(this.lang.get(b===!1?"insert":"save")).on("click",a.proxy(this.link.callback,this))},callback:function(){var a=this.link.buildLinkFromModal();return a!==!1&&(this.modal.close(),void this.link.insert(a,!0))},cleanUrl:function(b){return"undefined"==typeof b?"":a.trim(b.replace(/[^\W\w\D\d+&\'@#\/%?=~_|!:,.;\(\)]/gi,""))},cleanText:function(b){return"undefined"==typeof b?"":a.trim(b.replace(/(<([^>]+)>)/gi,""))},getText:function(a){return""===a.text&&""!==a.url?this.link.truncateUrl(a.url.replace(/<|>/g,"")):a.text},isUrl:function(a){var b="((xn--)?[\\W\\w\\D\\d]+(-[\\W\\w\\D\\d]+)*\\.)+[\\W\\w]{2,}",c=new RegExp("^(http|ftp|https)://"+b,"i"),d=new RegExp("^"+b,"i"),e=new RegExp(".(html|php)$","i"),f=new RegExp("^/","i"),g=new RegExp("^tel:(.*?)","i");return a.search(c)===-1&&a.search(d)!==-1&&a.search(e)===-1&&"/"!==a.substring(0,1)&&(a="http://"+a),(a.search(c)!==-1||a.search(e)!==-1||a.search(f)!==-1||a.search(g)!==-1)&&a},isMailto:function(a){return a.search("@")!==-1&&/(http|ftp|https):\/\//i.test(a)===!1},isEmpty:function(a){return""===a.url||""===a.text&&""===a.url},truncateUrl:function(a){return a.length>this.opts.linkSize?a.substring(0,this.opts.linkSize)+"...":a},parse:function(a){return this.link.isMailto(a.url)?a.url="mailto:"+a.url.replace("mailto:",""):0!==a.url.search("#")&&(a.url=this.link.isUrl(a.url)),!this.link.isEmpty(a)&&a.url!==!1&&a},buildLinkFromModal:function(){var b={};return b.url=this.link.cleanUrl(a("#redactor-link-url").val()),b.text=this.link.cleanText(a("#redactor-link-url-text").val()),b.text=this.link.getText(b),b.target=!!a("#redactor-link-blank").prop("checked"),this.link.parse(b)},buildLinkFromObject:function(a,b){return b.url=this.link.cleanUrl(b.url),b.text="undefined"==typeof b.text&&this.selection.is()?this.selection.text():this.link.cleanText(b.text),b.text=this.link.getText(b),b.target=a===!1?b.target:this.link.buildTarget(a),this.link.parse(b)},buildLinkFromElement:function(a){var b={url:"",text:this.selection.is()?this.selection.text():"",target:!1};return a!==!1&&(b.url=a.attr("href"),b.text=a.text(),b.target=this.link.buildTarget(a)),b},buildTarget:function(a){return"undefined"!=typeof a.attr("target")&&"_blank"===a.attr("target")},removeSelfHostFromUrl:function(a){var b=self.location.href.replace("#","").replace(/\/$/i,"");return a.replace(/^\/\#/,"#").replace(b,"").replace("mailto:","")},replaceLinksToText:function(b){var c,d=a.each(b,function(b,d){var e=a(d),f=a('<span class="redactor-unlink" />').append(e.contents());return e.replaceWith(f),0===b&&(c=f),e});return 1===b.length&&this.selection.isCollapsed()&&this.caret.after(c),d}}},linkify:function(){return{isKey:function(a){return a===this.keyCode.ENTER||a===this.keyCode.SPACE},isLink:function(a){return a.nodeValue.match(this.opts.regexps.linkyoutube)||a.nodeValue.match(this.opts.regexps.linkvimeo)||a.nodeValue.match(this.opts.regexps.linkimage)||a.nodeValue.match(this.opts.regexps.url)},isFiltered:function(b,c){return 3===c.nodeType&&""!==a.trim(c.nodeValue)&&!a(c).parent().is("pre")&&this.linkify.isLink(c)},handler:function(b,c){var d=a(c),e=d.text(),f=e;f=f.match(this.opts.regexps.linkyoutube)||f.match(this.opts.regexps.linkvimeo)?this.linkify.convertVideoLinks(f):f.match(this.opts.regexps.linkimage)?this.linkify.convertImages(f):this.linkify.convertLinks(f),d.before(e.replace(e,f)).remove()},format:function(){if(this.opts.linkify&&!this.utils.isCurrentOrParent("pre")){this.core.editor().find(":not(iframe,img,a,pre,code,.redactor-unlink)").addBack().contents().filter(a.proxy(this.linkify.isFiltered,this)).each(a.proxy(this.linkify.handler,this));var b=this.core.editor().find(".redactor-linkify-object").each(a.proxy(function(b,c){var d=a(c);return d.removeClass("redactor-linkify-object"),""===d.attr("class")&&d.removeAttr("class"),"DIV"===c.tagName?this.linkify.breakBlockTag(d,"video"):"IMG"===c.tagName?this.linkify.breakBlockTag(d,"image"):"A"===c.tagName&&this.core.callback("insertedLink",d),d},this));setTimeout(a.proxy(function(){this.code.sync(),this.core.callback("linkify",b)},this),100)}},breakBlockTag:function(b,c){var d=this.utils.breakBlockTag();if(d!==!1){var e=b;"image"===c&&(e=a("<figure />").append(b)),"start"===d.type?d.$block.before(e):d.$block.after(e),"image"===c&&this.caret.after(e)}},convertVideoLinks:function(a){var b='<div class="'+this.opts.videoContainerClass+' redactor-linkify-object"><iframe class="redactor-linkify-object" width="500" height="281" src="',c='" frameborder="0" allowfullscreen></iframe></div>';return a.match(this.opts.regexps.linkyoutube)&&(a=a.replace(this.opts.regexps.linkyoutube,b+"//www.youtube.com/embed/$1"+c)),a.match(this.opts.regexps.linkvimeo)&&(a=a.replace(this.opts.regexps.linkvimeo,b+"//player.vimeo.com/video/$2"+c)),a},convertImages:function(a){var b=a.match(this.opts.regexps.linkimage);return b?a.replace(a,'<img src="'+b+'" class="redactor-linkify-object" />'):a},convertLinks:function(b){var c=b.match(this.opts.regexps.url);if(!c)return b;c=a.grep(c,function(b,d){return a.inArray(b,c)===d});for(var d=c.length,e=0;e<d;e++){var f=c[e],g=f,h=null!==f.match(/(https?|ftp):\/\//i)?"":"http://";g.length>this.opts.linkSize&&(g=g.substring(0,this.opts.linkSize)+"..."),g.search("%")===-1&&(g=decodeURIComponent(g));var i="\\b";a.inArray(f.slice(-1),["/","&","="])!==-1&&(i="");var j=new RegExp("("+f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+i+")","g"),k="";this.opts.pasteLinkTarget!==!1&&(k=' target="'+this.opts.pasteLinkTarget+'"'),b=b.replace(j,'<a href="'+h+a.trim(f)+'"'+k+' class="redactor-linkify-object">'+a.trim(g)+"</a>")}return b}}},list:function(){return{toggle:function(b){if(!this.utils.inBlocks(["table","td","th","tr"])){var c="orderedlist"===b||"ol"===b?"OL":"UL";b="OL"===c?"orderedlist":"unorderedlist";var d=a(this.selection.current()).parentsUntil(".redactor-in","ul, ol").first();if(this.placeholder.hide(),this.buffer.set(),0!==d.length&&d[0].tagName===c&&this.utils.isRedactorParent(d))return this.selection.save(),d.find("ul, ol").each(function(){var b=a(this).closest("li");a(this).find("li").each(function(){a(b).after(this)})}),d.find("ul, ol").remove(),d.find("li").each(function(){return a(this).replaceWith(function(){return a("<p />").append(a(this).contents())})}),d.replaceWith(function(){return a(this).contents()}),void this.selection.restore();this.selection.save(),0!==d.length&&d[0].tagName!==c?d.each(a.proxy(function(a,b){this.utils.replaceToTag(b,c)},this)):document.execCommand("insert"+b),this.selection.restore();var e=this.list.get();if(!e)return void(this.selection.block()||document.execCommand("formatblock",!1,"p"));e.find("span").replaceWith(function(){return a(this).contents()}),e.find(this.opts.inlineTags.join(",")).each(function(){a(this).removeAttr("style")});var f=e.parent();this.utils.isRedactorParent(f)&&"LI"!==f[0].tagName&&this.utils.isBlock(f)&&(this.selection.save(),f.replaceWith(f.contents()),this.selection.restore())}},get:function(){var b=this.selection.current(),c=a(b).closest("ul, ol",this.core.editor()[0]);return 0!==c.length&&c},combineAfterAndBefore:function(b){var c=a(b).prev(),d=a(b).next(),e=b&&"P"===b.tagName&&("<br>"===b.innerHTML||""===b.innerHTML),f=1===c.closest("ol, ul",this.core.editor()[0]).length&&1===d.closest("ol, ul",this.core.editor()[0]).length;return!(!e||!f)&&(c.children("li").last().append(this.marker.get()),c.append(d.contents()),this.selection.restore(),!0)}}},marker:function(){return{get:function(a){a="undefined"==typeof a?1:a;var b=document.createElement("span");return b.id="selection-marker-"+a,b.className="redactor-selection-marker",b.innerHTML=this.opts.invisibleSpace,b},html:function(a){return this.utils.getOuterHtml(this.marker.get(a))},find:function(a){return a="undefined"==typeof a?1:a,this.core.editor().find("span#selection-marker-"+a)},insert:function(){var a=this.selection.get(),b=this.selection.range(a);this.marker.insertNode(b,this.marker.get(1),!0),b&&b.collapsed===!1&&this.marker.insertNode(b,this.marker.get(2),!1)},remove:function(){this.core.editor().find(".redactor-selection-marker").each(this.marker.iterateRemove)},insertNode:function(b,c,d){var e=this.selection.parent();if(null!==b&&0!==a(e).closest(".redactor-in").length){b=b.cloneRange();try{b.collapse(d),b.insertNode(c)}catch(a){this.focus.start()}}},iterateRemove:function(b,c){var d=a(c),e=d.text().replace(/\u200B/g,"");return""===e?d.remove():d.replaceWith(function(){return a(this).contents()})}}},modal:function(){return{callbacks:{},templates:function(){this.opts.modal={"image-edit":String()+'<div class="redactor-modal-tab redactor-group" data-title="General"><div id="redactor-image-preview" class="redactor-modal-tab-side"></div><div class="redactor-modal-tab-area"><section><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /></section><section><label>'+this.lang.get("caption")+'</label><input type="text" id="redactor-image-caption" aria-label="'+this.lang.get("caption")+'" /></section><section><label>'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" aria-label="'+this.lang.get("link")+'" /></section><section><label class="redactor-image-position-option">'+this.lang.get("image-position")+'</label><select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image-position")+'"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+'</option></select></section><section><label class="checkbox"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link-in-new-tab")+'"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+'</button><button id="redactor-modal-button-delete" class="redactor-modal-button-offset">'+this.lang.get("delete")+"</button></section></div></div>",image:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><div id="redactor-modal-image-droparea"></div></section></div>',file:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><label>'+this.lang.get("filename")+' <span class="desc">('+this.lang.get("optional")+')</span></label><input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br></section><section><div id="redactor-modal-file-upload"></div></section></div>',link:String()+'<div class="redactor-modal-tab" data-title="General"><section><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /></section><section><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /></section><section><label class="checkbox"><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},a.extend(this.opts,this.opts.modal)},addCallback:function(a,b){this.modal.callbacks[a]=b},addTemplate:function(a,b){this.opts.modal[a]=b},getTemplate:function(a){return this.opts.modal[a]},getModal:function(){return this.$modalBody},getActionButton:function(){return this.$modalBody.find("#redactor-modal-button-action")},getCancelButton:function(){return this.$modalBody.find("#redactor-modal-button-cancel")},getDeleteButton:function(){return this.$modalBody.find("#redactor-modal-button-delete")},load:function(a,b,c){"undefined"!=typeof this.$modalBox&&this.$modalBox.hasClass("open")||(this.modal.templateName=a,this.modal.width=c,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(b),this.modal.setDraggable(),this.modal.setContent(),"undefined"!=typeof this.modal.callbacks[a]&&this.modal.callbacks[a].call(this))},show:function(){this.detect.isDesktop()||document.activeElement.blur(),this.selection.save(),this.modal.buildTabber(),this.detect.isMobile()&&(this.modal.width="96%"),setTimeout(a.proxy(this.modal.buildWidth,this),0),a(window).on("resize.redactor-modal",a.proxy(this.modal.buildWidth,this)),this.$modalOverlay.redactorAnimation("fadeIn",{duration:.25}),this.$modalBox.appendTo(document.body),this.$modalBox.addClass("open").show(),this.$modal.redactorAnimation("fadeIn",{timing:"cubic-bezier(0.175, 0.885, 0.320, 1.105)"},a.proxy(function(){this.utils.saveScroll(),this.utils.disableBodyScroll(),this.core.callback("modalOpened",this.modal.templateName,this.$modal),a(document).off("focusin.modal");var b=this.$modal.find("input[type=text],input[type=url],input[type=email]");b.on("keydown.redactor-modal",a.proxy(this.modal.setEnter,this))},this))},buildWidth:function(){var b=a(window).height(),c=a(window).width(),d="number"==typeof this.modal.width;!d&&this.modal.width.match(/%$/)?this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}):parseInt(this.modal.width)>c?this.$modal.css({width:"96%","margin-bottom":"2%"}):(d&&(this.modal.width+="px"),this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}));var e=this.$modal.outerHeight(),f=b/2-e/2+"px";this.detect.isMobile()?f="2%":e>b&&(f="16px"),this.$modal.css("margin-top",f)},buildTabber:function(){this.modal.tabs=this.$modal.find(".redactor-modal-tab"),this.modal.tabs.length<2||(this.modal.$tabsBox=a('<div id="redactor-modal-tabber" />'),a.each(this.modal.tabs,a.proxy(function(b,c){var d=a('<a href="#" rel="'+b+'" />').text(a(c).attr("data-title"));d.on("click",a.proxy(this.modal.showTab,this)),0===b&&d.addClass("active"),this.modal.$tabsBox.append(d)},this)),this.$modalBody.prepend(this.modal.$tabsBox))},showTab:function(b){b.preventDefault();var c=a(b.target),d=c.attr("rel");return this.modal.tabs.hide(),this.modal.tabs.eq(d).show(),a("#redactor-modal-tabber").find("a").removeClass("active"),c.addClass("active"),!1},setTitle:function(a){this.$modalHeader.html(a)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName)),this.modal.getCancelButton().on("mousedown",a.proxy(this.modal.close,this))},setDraggable:function(){"undefined"!=typeof a.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(a){13===a.which&&(a.preventDefault(),this.modal.getActionButton().click())},build:function(){this.modal.buildOverlay(),this.$modalBox=a('<div id="redactor-modal-box"/>').hide(),this.$modal=a('<div id="redactor-modal" role="dialog" />'),this.$modalHeader=a('<div id="redactor-modal-header" />'),this.$modalClose=a('<button type="button" id="redactor-modal-close" aria-label="'+this.lang.get("close")+'" />').html("&times;"),this.$modalBody=a('<div id="redactor-modal-body" />'),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalClose),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=a('<div id="redactor-modal-overlay">').hide(),a("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("mousedown.redactor-modal",a.proxy(this.modal.close,this)),a(document).on("keyup.redactor-modal",a.proxy(this.modal.closeHandler,this)),this.core.editor().on("keyup.redactor-modal",a.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",a.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("mousedown.redactor-modal"),a(document).off("keyup.redactor-modal"),this.core.editor().off("keyup.redactor-modal"),this.$modalBox.off("click§.redactor-modal"),a(window).off("resize.redactor-modal")},closeHandler:function(a){a.which===this.keyCode.ESC&&this.modal.close(!1)},close:function(b){if(b){if("redactor-modal-button-cancel"!==a(b.target).attr("id")&&b.target!==this.$modalClose[0]&&b.target!==this.$modalBox[0])return;b.preventDefault()}this.$modalBox&&(this.selection.restore(),this.modal.disableEvents(),this.utils.enableBodyScroll(),this.utils.restoreScroll(),this.$modalOverlay.redactorAnimation("fadeOut",{duration:.4},a.proxy(function(){this.$modalOverlay.remove()},this)),this.$modal.redactorAnimation("fadeOut",{duration:.3,timing:"cubic-bezier(0.175, 0.885, 0.320, 1.175)"},a.proxy(function(){"undefined"!=typeof this.$modalBox&&(this.$modalBox.remove(),this.$modalBox=void 0),a(document.body).css("overflow",this.modal.bodyOveflow),this.core.callback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){"undefined"==typeof this.opts.destroyed&&(this.observe.links(),this.observe.images())},isCurrent:function(b,c){return"undefined"==typeof c&&(c=a(this.selection.current())),c.is(b)||c.parents(b).length>0},toolbar:function(){this.observe.buttons(),this.observe.dropdowns()},buttons:function(b,c){var d=this.selection.current(),e=this.selection.parent();return b!==!1?this.button.setInactiveAll():this.button.setInactiveAll(c),b===!1&&"html"!==c?void(a.inArray(c,this.opts.activeButtons)!==-1&&this.button.toggleActive(c)):void(this.utils.isRedactorParent(d)&&("none"!==this.core.editor().css("display")&&(this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):this.button.enable("horizontalrule")),a.each(this.opts.activeButtonsStates,a.proxy(function(b,c){var f=a(e).closest(b,this.$editor[0]),g=a(d).closest(b,this.$editor[0]);(0===f.length||this.utils.isRedactorParent(f))&&this.utils.isRedactorParent(g)&&(0===f.length&&0===g.closest(b,this.$editor[0]).length||this.button.setActive(c))},this))))},dropdowns:function(){var b=a("<div />").html(this.selection.html()).find("a").length,c=a(this.selection.current()),d=this.utils.isRedactorParent(c);a.each(this.opts.observe.dropdowns,a.proxy(function(a,e){var f=e.observe,g=f.element,h=e.item,i="undefined"!=typeof f.in&&f.in,j="undefined"!=typeof f.out&&f.out;c.closest(g).length>0&&d||"a"===g&&0!==b?this.observe.setDropdownProperties(h,i,j):this.observe.setDropdownProperties(h,j,i)},this))},setDropdownProperties:function(a,b,c){c&&"undefined"!=typeof c.attr&&this.observe.setDropdownAttr(a,c.attr,!0),"undefined"!=typeof b.attr&&this.observe.setDropdownAttr(a,b.attr),"undefined"!=typeof b.title&&a.find("span").text(b.title)},setDropdownAttr:function(b,c,d){a.each(c,function(a,c){"class"===a?d?b.removeClass(c):b.addClass(c):d?b.removeAttr(a):b.attr(a,c)})},addDropdown:function(a,b,c){"undefined"!=typeof c.observe&&(c.item=a,this.opts.observe.dropdowns.push(c))},images:function(){this.opts.imageEditable&&(this.core.editor().addClass("redactor-layer-img-edit"),this.core.editor().find("img").each(a.proxy(function(b,c){var d=a(c);d.closest("a",this.$editor[0]).on("click",function(a){a.preventDefault()}),this.image.setEditable(d)},this)))},links:function(){this.opts.linkTooltip&&this.core.editor().find("a").each(a.proxy(function(b,c){var d=a(c);d.data("cached")!==!0&&(d.data("cached",!0),d.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.showTooltip,this)))},this))},getTooltipPosition:function(a){return a.offset()},showTooltip:function(b){var c=a(b.target);if("IMG"!==c[0].tagName&&("A"!==c[0].tagName&&(c=c.closest("a",this.$editor[0])),"A"===c[0].tagName)){var d=c,e=this.observe.getTooltipPosition(d),f=a('<span class="redactor-link-tooltip"></span>'),g=d.attr("href");void 0===g&&(g=""),g.length>24&&(g=g.substring(0,24)+"...");var h=a('<a href="'+d.attr("href")+'" target="_blank" />').html(g).addClass("redactor-link-tooltip-action"),i=a('<a href="#" />').html(this.lang.get("edit")).on("click",a.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),j=a('<a href="#" />').html(this.lang.get("unlink")).on("click",a.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");f.append(h).append(" | ").append(i).append(" | ").append(j);var k=parseInt(d.css("line-height"),10),l=Math.ceil((b.pageY-e.top)/k),m=e.top+l*k;f.css({top:m+"px",left:e.left+"px"}),a(".redactor-link-tooltip").remove(),a("body").append(f),this.core.editor().on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this)),a(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this))}},closeAllTooltip:function(){a(".redactor-link-tooltip").remove()},closeTooltip:function(b){b=b.originalEvent||b;var c=b.target,d=a(c).closest("a",this.$editor[0]);0!==d.length&&"A"===d[0].tagName&&"A"!==c.tagName||"A"===c.tagName&&this.utils.isRedactorParent(c)||a(c).hasClass("redactor-link-tooltip-action")||(this.observe.closeAllTooltip(),this.core.editor().off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this)),a(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,a.proxy(this.observe.closeTooltip,this)))}}},offset:function(){return{get:function(b){var c=this.offset.clone(b);if(c===!1)return 0;var d=document.createElement("div");d.appendChild(c.cloneContents()),d.innerHTML=d.innerHTML.replace(/<img(.*?[^>])>$/gi,"i");var e=a.trim(a(d).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"");return e.length},clone:function(a){var b=this.selection.get(),c=this.selection.range(b);if(null===c&&"undefined"==typeof a)return!1;if(a="undefined"==typeof a?this.$editor:a,a===!1)return!1;a=a[0]||a;var d=c.cloneRange();return d.selectNodeContents(a),d.setEnd(c.endContainer,c.endOffset),d},set:function(a,b){b="undefined"==typeof b?a:b,this.focus.is()||this.focus.start();for(var c,d=this.selection.get(),e=this.selection.range(d),f=0,g=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);null!==(c=g.nextNode());)if(f+=c.nodeValue.length,
f>a&&(e.setStart(c,c.nodeValue.length+a-f),a=1/0),f>=b){e.setEnd(c,c.nodeValue.length+b-f);break}e.collapse(!1),this.selection.update(d,e)}}},paragraphize:function(){return{load:function(b){return this.opts.paragraphize===!1||"inline"===this.opts.type||"pre"===this.opts.type?b:""===b||"<p></p>"===b?this.opts.emptyHtml:(b+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,b=b.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),b=b.replace(/<\/pre>/gi,"</pre>\n\n"),b=b.replace(/<p>\s<br><\/p>/gi,"<p></p>"),b=this.paragraphize.getSafes(b),b=b.replace("<br>","\n"),b=this.paragraphize.convert(b),b=this.paragraphize.clear(b),b=this.paragraphize.restoreSafes(b),b=b.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),a.trim(b))},getSafes:function(b){var c=a("<div />").append(b);return c.find("blockquote p").replaceWith(function(){return a(this).append("<br />").contents()}),c.find(this.opts.paragraphizeBlocks.join(", ")).each(a.proxy(function(b,c){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c.outerHTML,a(c).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),c.find("span.redactor-selection-marker").each(a.proxy(function(b,c){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=c.outerHTML,a(c).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),c.html()},restoreSafes:function(b){return a.each(this.paragraphize.safes,function(a,c){c="undefined"!=typeof c?c.replace(/\$/g,"&#36;"):c,b=b.replace("#####replace"+a+"#####",c)}),b},convert:function(b){b=b.replace(/\r\n/g,"xparagraphmarkerz"),b=b.replace(/\n/g,"xparagraphmarkerz"),b=b.replace(/\r/g,"xparagraphmarkerz");var c=/\s+/g;b=b.replace(c," "),b=a.trim(b);var d=/xparagraphmarkerzxparagraphmarkerz/gi;b=b.replace(d,"</p><p>");var e=/xparagraphmarkerz/gi;return b=b.replace(e,"<br>"),b="<p>"+b+"</p>",b=b.replace("<p></p>",""),b=b.replace("\r\n\r\n",""),b=b.replace(/<\/p><p>/g,"</p>\r\n\r\n<p>"),b=b.replace(new RegExp("<br\\s?/?></p>","g"),"</p>"),b=b.replace(new RegExp("<p><br\\s?/?>","g"),"<p>"),b=b.replace(new RegExp("<p><br\\s?/?>","g"),"<p>"),b=b.replace(new RegExp("<br\\s?/?></p>","g"),"</p>"),b=b.replace(/<p>&nbsp;<\/p>/gi,""),b=b.replace(/<p>\s?<br>&nbsp;<\/p>/gi,""),b=b.replace(/<p>\s?<br>/gi,"<p>")},clear:function(a){return a=a.replace(/<p>(.*?)#####replace(.*?)#####\s?<\/p>/gi,"<p>$1</p>#####replace$2#####"),a=a.replace(/(<br\s?\/?>){2,}<\/p>/gi,"</p>"),a=a.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),a=a.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),a=a.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),a=a.replace(new RegExp("<p><p ","gi"),"<p "),a=a.replace(new RegExp("<p><p>","gi"),"<p>"),a=a.replace(new RegExp("</p></p>","gi"),"</p>"),a=a.replace(new RegExp("<p>\\s?</p>","gi"),""),a=a.replace(new RegExp("\n</p>","gi"),"</p>"),a=a.replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>"),a=a.replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(b){this.rtePaste=!0;var c=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre"));return this.detect.isDesktop()&&!this.paste.pre&&this.opts.clipboardImageUpload&&this.opts.imageUpload&&this.paste.detectClipboardUpload(b)?void(this.detect.isIe()&&setTimeout(a.proxy(this.paste.clipboardUpload,this),100)):(this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(c),a(window).on("scroll.redactor-freeze",a.proxy(function(){a(window).scrollTop(this.saveBodyScroll)},this)),void setTimeout(a.proxy(function(){var b=this.paste.getPasteBoxCode(c);this.buffer.set(),this.selection.restore(),this.utils.restoreScroll();var d=this.clean.getCurrentType(b);b=this.clean.onPaste(b,d);var e=this.core.callback("paste",b);b="undefined"==typeof e?b:e,this.paste.insert(b,d),this.rtePaste=!1,c&&this.clean.cleanPre(),a(window).off("scroll.redactor-freeze")},this),1))},getPasteBoxCode:function(a){var b=a?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),b},createPasteBox:function(b){var c={position:"fixed",width:"1px",top:0,left:"-9999px"};this.$pasteBox=b?a("<textarea>").css(c):a("<div>").attr("contenteditable","true").css(c),this.paste.appendPasteBox(),this.$pasteBox.focus()},appendPasteBox:function(){if(this.detect.isIe())this.core.box().append(this.$pasteBox);else{var b=a(".modal-body:visible");b.length>0?b.append(this.$pasteBox):a("body").prepend(this.$pasteBox)}},detectClipboardUpload:function(b){b=b.originalEvent||b;var c=b.clipboardData;if(this.detect.isIe()||this.detect.isFirefox())return!1;var d=c.types;if(d.indexOf("public.tiff")!==-1)return b.preventDefault(),!1;if(c.items&&c.items.length){var e=c.items[0].getAsFile();if(null===e)return!1;var f=new FileReader;return f.readAsDataURL(e),f.onload=a.proxy(this.paste.insertFromClipboard,this),!0}},clipboardUpload:function(){var b=this.$editor.find("img");a.each(b,a.proxy(function(b,c){if(c.src.search(/^data\:image/i)!==-1){var d=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=a.proxy(function(b){if(this.detect.isIe())a(c).wrap(a("<figure />"));else{var d=a(c).parent();this.utils.replaceToTag(d,"figure")}c.src=b.url,this.core.callback("imageUpload",a(c),b)},this);var e=this.utils.dataURItoBlob(c.src);d.append("clipboard",1),d.append(this.opts.imageUploadParam,e),this.progress.show(),this.upload.send(d,!1),this.code.sync(),this.rtePaste=!1}}},this))},insertFromClipboard:function(a){var b=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=this.image.insert;var c=this.utils.dataURItoBlob(a.target.result);b.append("clipboard",1),b.append(this.opts.imageUploadParam,c),this.progress.show(),this.upload.send(b,a),this.rtePaste=!1}},insert:function(b,c){c.pre?this.insert.raw(b):c.text?this.insert.text(b):this.insert.html(b,c),this.detect.isFirefox()&&this.opts.clipboardImageUpload&&setTimeout(a.proxy(this.paste.clipboardUpload,this),100)}}},placeholder:function(){return{enable:function(){setTimeout(a.proxy(function(){return this.placeholder.isEditorEmpty()?this.placeholder.show():this.placeholder.hide()},this),5)},show:function(){this.core.editor().addClass("redactor-placeholder")},update:function(a){this.opts.placeholder=a,this.core.editor().attr("placeholder",a)},hide:function(){this.core.editor().removeClass("redactor-placeholder")},is:function(){return this.core.editor().hasClass("redactor-placeholder")},init:function(){this.placeholder.enabled()&&(this.utils.isEditorRelative()||this.utils.setEditorRelative(),this.placeholder.build(),this.placeholder.buildPosition(),this.placeholder.enable(),this.placeholder.enableEvents())},enabled:function(){return this.opts.placeholder?this.core.element().attr("placeholder",this.opts.placeholder):this.placeholder.isAttr()},enableEvents:function(){this.core.editor().on("keydown.redactor-placeholder."+this.uuid,a.proxy(this.placeholder.enable,this))},disableEvents:function(){this.core.editor().off(".redactor-placeholder."+this.uuid)},build:function(){this.core.editor().attr("placeholder",this.core.element().attr("placeholder"))},buildPosition:function(){var b=a("<style />");b.addClass("redactor-placeholder-style-tag"),b.html("#"+this.core.id()+".redactor-placeholder::after "+this.placeholder.getPosition()),a("head").append(b)},getPosition:function(){return"{ top: "+this.core.editor().css("padding-top")+"; left: "+this.core.editor().css("padding-left")+"; }"},isEditorEmpty:function(){var b=a.trim(this.core.editor().html()).replace(/[\t\n]/g,""),c=["","<p>​</p>","<p>​<br></p>",this.opts.emptyHtmlRendered];return a.inArray(b,c)!==-1},isAttr:function(){return"undefined"!=typeof this.core.element().attr("placeholder")&&""!==this.core.element().attr("placeholder")},destroy:function(){this.core.editor().removeAttr("placeholder"),this.placeholder.hide(),this.placeholder.disableEvents(),a(".redactor-placeholder-style-tag").remove()}}},progress:function(){return{$box:null,$bar:null,target:document.body,show:function(){this.progress.is()?this.progress.$box.show():(this.progress.build(),this.progress.$box.redactorAnimation("fadeIn"))},hide:function(){this.progress.is()&&this.progress.$box.redactorAnimation("fadeOut",{duration:.35},a.proxy(this.progress.destroy,this))},update:function(a){this.progress.show(),this.progress.$bar.css("width",a+"%")},is:function(){return null!==this.progress.$box},build:function(){this.progress.$bar=a("<span />"),this.progress.$box=a('<div id="redactor-progress" />'),this.progress.$box.append(this.progress.$bar),a(this.progress.target).append(this.progress.$box)},destroy:function(){this.progress.is()&&this.progress.$box.remove(),this.progress.$box=null,this.progress.$bar=null}}},selection:function(){return{get:function(){return window.getSelection?window.getSelection():document.selection&&"Control"!==document.selection.type?document.selection:null},range:function(a){return"undefined"==typeof a&&(a=this.selection.get()),a.getRangeAt&&a.rangeCount?a.getRangeAt(0):null},is:function(){return!this.selection.isCollapsed()},isRedactor:function(){var b=this.selection.range();if(null!==b){var c=b.startContainer.parentNode;if(a(c).hasClass("redactor-in")||0!==a(c).parents(".redactor-in").length)return!0}return!1},isCollapsed:function(){var a=this.selection.get();return null!==a&&a.isCollapsed},update:function(a,b){null!==b&&(a.removeAllRanges(),a.addRange(b))},current:function(){var a=this.selection.get();return null!==a&&a.anchorNode},parent:function(){var a=this.selection.current();return null!==a&&a.parentNode},block:function(b){for(b=b||this.selection.current();b;){if(this.utils.isBlockTag(b.tagName))return!a(b).hasClass("redactor-in")&&b;b=b.parentNode}return!1},inline:function(b){for(b=b||this.selection.current();b;){if(this.utils.isInlineTag(b.tagName))return!a(b).hasClass("redactor-in")&&b;b=b.parentNode}return!1},element:function(b){for(b||(b=this.selection.current());b;){if(1===b.nodeType)return!a(b).hasClass("redactor-in")&&b;b=b.parentNode}return!1},prev:function(){var a=this.selection.current();return null!==a&&this.selection.current().previousSibling},next:function(){var a=this.selection.current();return null!==a&&this.selection.current().nextSibling},blocks:function(b){var c=[],d=this.selection.nodes(b);a.each(d,a.proxy(function(a,b){this.utils.isBlock(b)&&c.push(b)},this));var e=this.selection.block();return 0===c.length&&e===!1?[]:0===c.length&&e!==!1?[e]:c},inlines:function(b){var c=[],d=this.selection.nodes(b);a.each(d,a.proxy(function(a,b){this.utils.isInline(b)&&c.push(b)},this));var e=this.selection.inline();return 0===c.length&&e===!1?[]:0===c.length&&e!==!1?[e]:c},nodes:function(b){var c="undefined"==typeof b?[]:a.isArray(b)?b:[b],d=this.selection.get(),e=this.selection.range(d),f=[],g=[];if(this.utils.isCollapsed())f=[this.selection.current()];else{var h=e.startContainer,i=e.endContainer;if(h===i)return[this.selection.parent()];for(;h&&h!==i;)f.push(h=this.selection.nextNode(h));for(h=e.startContainer;h&&h!==e.commonAncestorContainer;)f.unshift(h),h=h.parentNode}return a.each(f,function(b,d){if(d){var e=1===d.nodeType&&d.tagName.toLowerCase();if(a(d).hasClass("redactor-script-tag")||a(d).hasClass("redactor-selection-marker"))return;if(e&&0!==c.length&&a.inArray(e,c)===-1)return;g.push(d)}}),0===g.length?[]:g},nextNode:function(a){if(a.hasChildNodes())return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null},save:function(){this.marker.insert(),this.savedSel=this.core.editor().html()},restore:function(a){var b=this.marker.find(1),c=this.marker.find(2);this.detect.isFirefox()&&this.core.editor().focus(),0!==b.length&&0!==c.length?this.caret.set(b,c):0!==b.length?this.caret.start(b):this.core.editor().focus(),a!==!1&&(this.marker.remove(),this.savedSel=!1)},saveInstant:function(){var a=this.core.editor()[0],b=a.ownerDocument,c=b.defaultView,d=c.getSelection();if(d.getRangeAt&&d.rangeCount){var e=d.getRangeAt(0),f=e.cloneRange();f.selectNodeContents(a),f.setEnd(e.startContainer,e.startOffset);var g=f.toString().length;return this.saved={start:g,end:g+e.toString().length,node:e.startContainer},this.saved}},restoreInstant:function(a){if("undefined"!=typeof a||this.saved){this.saved="undefined"!=typeof a?a:this.saved;var b=this.core.editor().find(this.saved.node);if(0===b.length||0!==b.text().trim().replace(/\u200B/g,"").length){var c=this.core.editor()[0],d=c.ownerDocument,e=d.defaultView,f=0,g=d.createRange();g.setStart(c,0),g.collapse(!0);for(var h,i=[c],j=!1,k=!1;!k&&(h=i.pop());)if(3==h.nodeType){var l=f+h.length;!j&&this.saved.start>=f&&this.saved.start<=l&&(g.setStart(h,this.saved.start-f),j=!0),j&&this.saved.end>=f&&this.saved.end<=l&&(g.setEnd(h,this.saved.end-f),k=!0),f=l}else for(var m=h.childNodes.length;m--;)i.push(h.childNodes[m]);var n=e.getSelection();n.removeAllRanges(),n.addRange(g)}else try{var g=document.createRange();g.setStart(b[0],0);var n=window.getSelection();n.removeAllRanges(),n.addRange(g)}catch(a){}}},node:function(b){a(b).prepend(this.marker.get(1)),a(b).append(this.marker.get(2)),this.selection.restore()},all:function(){this.core.editor().focus();var a=this.selection.get(),b=this.selection.range(a);b.selectNodeContents(this.core.editor()[0]),this.selection.update(a,b)},remove:function(){this.selection.get().removeAllRanges()},replace:function(a){this.insert.html(a)},text:function(){return this.selection.get().toString()},html:function(){var a="",b=this.selection.get();if(b.rangeCount){for(var c=document.createElement("div"),d=b.rangeCount,e=0;e<d;++e)c.appendChild(b.getRangeAt(e).cloneContents());a=this.clean.onGet(c.innerHTML)}return a},extractEndOfNode:function(a){var b=this.selection.get(),c=this.selection.range(b),d=c.cloneRange();return d.selectNodeContents(a),d.setStart(c.endContainer,c.endOffset),d.extractContents()},removeMarkers:function(){this.marker.remove()},marker:function(a){return this.marker.get(a)},markerHtml:function(a){return this.marker.html(a)}}},shortcuts:function(){return{hotkeysSpecialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hotkeysShiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},init:function(b,c){return this.opts.shortcuts===!1?(!b.ctrlKey&&!b.metaKey||66!==c&&73!==c||b.preventDefault(),!1):void a.each(this.opts.shortcuts,a.proxy(function(a,c){this.shortcuts.build(b,a,c)},this))},build:function(b,c,d){for(var e=a.proxy(function(){this.shortcuts.buildHandler(d)},this),f=c.split(","),g=f.length,h=0;h<g;h++)"string"==typeof f[h]&&this.shortcuts.handler(b,a.trim(f[h]),e)},buildHandler:function(a){var b;"-1"!==a.func.search(/\./)?(b=a.func.split("."),"undefined"!=typeof this[b[0]]&&this[b[0]][b[1]].apply(this,a.params)):this[a.func].apply(this,a.params)},handler:function(b,c,d){c=c.toLowerCase().split(" ");var e=this.shortcuts.hotkeysSpecialKeys[b.keyCode],f=String.fromCharCode(b.which).toLowerCase(),g="",h={};a.each(["alt","ctrl","meta","shift"],function(a,c){b[c+"Key"]&&e!==c&&(g+=c+"+")}),e&&(h[g+e]=!0),f&&(h[g+f]=!0,h[g+this.shortcuts.hotkeysShiftNums[f]]=!0,"shift+"===g&&(h[this.shortcuts.hotkeysShiftNums[f]]=!0));for(var i=c.length,j=0;j<i;j++)if(h[c[j]])return b.preventDefault(),d.apply(this,arguments)}}},storage:function(){return{data:[],add:function(a){a.status=!0,a.url=decodeURI(a.url),this.storage.data[a.url]=a},status:function(a,b){this.storage.data[decodeURI(a)].status=b},observe:function(){var b=this,c=this.core.editor().find("[data-image]");c.each(function(c,d){b.storage.add({type:"image",node:d,url:d.src,id:a(d).attr("data-image")})});var d=this.core.editor().find("[data-file]");d.each(function(c,d){b.storage.add({type:"file",node:d,url:d.href,id:a(d).attr("data-file")})});var e=this.core.editor().find("[data-s3]");e.each(function(c,d){var e="IMG"===d.tagName?d.src:d.href;b.storage.add({type:"s3",node:d,url:e,id:a(d).attr("data-s3")})})},changes:function(){for(var a in this.storage.data){var b=this.storage.data[a],c="IMG"===b.node.tagName?"src":"href",d=this.core.editor().find("[data-"+b.type+"]["+c+'="'+b.url+'"]');0===d.length?this.storage.status(b.url,!1):this.storage.status(b.url,!0)}return this.storage.data}}},toolbar:function(){return{build:function(){this.button.hideButtons(),this.button.hideButtonsOnMobile(),this.$toolbar=this.toolbar.createContainer(),this.toolbar.append(),this.button.$toolbar=this.$toolbar,this.button.setFormatting(),this.button.load(this.$toolbar),this.toolbar.setOverflow(),this.toolbar.setFixed()},createContainer:function(){return a("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),a(this.opts.toolbarExternal).html(this.$toolbar)):"textarea"===this.opts.type?this.$box.prepend(this.$toolbar):this.$element.before(this.$toolbar)},setOverflow:function(){this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},setFixed:function(){if(this.opts.toolbarFixed&&!this.opts.toolbarExternal){if(this.opts.toolbarFixedTarget!==document){var b=a(this.opts.toolbarFixedTarget);this.toolbar.toolbarOffsetTop=0===b.length?0:this.core.box().offset().top-b.offset().top}var c=0!==this.core.box().closest(".modal-body").length?1e3:0;setTimeout(a.proxy(function(){var b=this;this.toolbar.observeScroll(!1),this.detect.isDesktop()?a(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){b.core.editor().height()<100||b.placeholder.isEditorEmpty()||b.toolbar.observeScroll()}):a(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){b.core.editor().height()<100||b.placeholder.isEditorEmpty()||(b.core.toolbar().hide(),clearTimeout(a.data(this,"scrollCheck")),a.data(this,"scrollCheck",setTimeout(function(){b.core.toolbar().show(),b.toolbar.observeScroll()},250)))})},this),c)}},setUnfixed:function(){this.toolbar.observeScrollDisable()},getBoxTop:function(){return this.opts.toolbarFixedTarget===document?this.core.box().offset().top:this.toolbar.toolbarOffsetTop},observeScroll:function(b){var c=0;b!==!1&&(c=this.opts.toolbarFixedTarget===document?20:0);var d=a(this.opts.toolbarFixedTarget).scrollTop(),e=this.toolbar.getBoxTop();d!==e&&(d+this.opts.toolbarFixedTopOffset+c>e?this.toolbar.observeScrollEnable(d,e):this.toolbar.observeScrollDisable())},observeScrollResize:function(){this.$toolbar.css({width:this.core.box().innerWidth(),left:this.core.box().offset().left})},observeScrollEnable:function(b,c){if("undefined"!=typeof this.fullscreen&&this.fullscreen.isOpened===!1)return void this.toolbar.observeScrollDisable();var d=c+this.core.box().outerHeight()-32,e=this.core.box().innerWidth(),f=this.detect.isDesktop()?"fixed":"absolute",g=this.detect.isDesktop()?this.opts.toolbarFixedTopOffset:a(this.opts.toolbarFixedTarget).scrollTop()-c+this.opts.toolbarFixedTopOffset,h=this.detect.isDesktop()?this.core.box().offset().left:0;this.opts.toolbarFixedTarget!==document&&(f="absolute",g=this.opts.toolbarFixedTopOffset+a(this.opts.toolbarFixedTarget).scrollTop()-c,h=0),this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:f,width:e,top:g,left:h}),b>d&&a(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",b<d?"visible":"hidden"),a(window).on("resize.redactor-toolbar."+this.uuid,a.proxy(this.toolbar.observeScrollResize,this))},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box"),a(window).off("resize.redactor-toolbar."+this.uuid)},setDropdownsFixed:function(){var a=this.opts.toolbarFixedTarget===document&&this.detect.isDesktop()?"fixed":"absolute";this.toolbar.setDropdownPosition(a)},unsetDropdownsFixed:function(){this.toolbar.setDropdownPosition("absolute")},setDropdownPosition:function(b){var c=this;a(".redactor-dropdown-"+this.uuid).each(function(){var d=a(this),e=c.button.get(d.attr("rel")),f="fixed"===b?c.opts.toolbarFixedTopOffset:e.offset().top;d.css({position:b,top:e.innerHeight()+f+"px"})})}}},upload:function(){return{init:function(b,c,d){this.upload.direct=!1,this.upload.callback=d,this.upload.url=c,this.upload.$el=a(b),this.upload.$droparea=a('<div id="redactor-droparea" />'),this.upload.$placeholdler=a('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload-label")),this.upload.$input=a('<input type="file" name="file" multiple />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",a.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",a.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",a.proxy(function(a){a=a.originalEvent||a;for(var b=this.upload.$input[0].files.length,c=0;c<b;c++){var d=b-1-c;this.upload.traverseFile(this.upload.$input[0].files[d],a)}},this)),this.upload.$droparea.on("drop.redactor.upload",a.proxy(function(a){a.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(a)},this))},directUpload:function(a,b){this.upload.direct=!0,this.upload.traverseFile(a,b)},onDrop:function(a){a=a.originalEvent||a;var b=a.dataTransfer.files;if(this.opts.multipleImageUpload)for(var c=b.length,d=0;d<c;d++)this.upload.traverseFile(b[d],a);else this.upload.traverseFile(b[0],a)},traverseFile:function(a,b){if(this.opts.s3)return this.upload.setConfig(a),void this.uploads3.send(a,b);var c=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(a);var d="image"===this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;c.append(d,a)}this.progress.show();var e=this.core.callback("uploadStart",b,c);e!==!1&&this.upload.send(c,b)},setConfig:function(a){this.upload.getType(a),this.upload.direct&&(this.upload.url="image"===this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"===this.upload.type?this.image.insert:this.file.insert)},getType:function(a){this.upload.type=this.opts.imageTypes.indexOf(a.type)===-1?"file":"image",null===this.opts.imageUpload&&null!==this.opts.fileUpload&&(this.upload.type="file")},getHiddenFields:function(b,c){return b===!1||"object"!=typeof b?c:(a.each(b,a.proxy(function(b,d){null!==d&&0===d.toString().indexOf("#")&&(d=a(d).val()),c.append(b,d)},this)),c)},send:function(b,c){"image"===this.upload.type?(b=this.utils.appendFields(this.opts.imageUploadFields,b),b=this.utils.appendForms(this.opts.imageUploadForms,b),b=this.upload.getHiddenFields(this.upload.imageFields,b)):(b=this.utils.appendFields(this.opts.fileUploadFields,b),b=this.utils.appendForms(this.opts.fileUploadForms,b),b=this.upload.getHiddenFields(this.upload.fileFields,b));var d=new XMLHttpRequest;d.open("POST",this.upload.url),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.onreadystatechange=a.proxy(function(){if(4===d.readyState){var a=d.responseText;a=a.replace(/^\[/,""),a=a.replace(/\]$/,"");var b;try{b="string"==typeof a?JSON.parse(a):a}catch(a){b={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(b,this.upload.direct,c)}},this);var e=this.core.callback("uploadBeforeSend",d);e!==!1&&d.send(b)},onDrag:function(a){a.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(a){a.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(a,b){this.upload.imageFields[a]=b},removeImageFields:function(a){delete this.upload.imageFields[a]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(a,b){this.upload.fileFields[a]=b},removeFileFields:function(a){delete this.upload.fileFields[a]}}},uploads3:function(){return{send:function(b,c){this.uploads3.executeOnSignedUrl(b,a.proxy(function(a){this.uploads3.sendToS3(b,a,c)},this))},executeOnSignedUrl:function(a,b){var c=new XMLHttpRequest,d=this.opts.s3.search(/\?/)===-1?"?":"&";c.open("GET",this.opts.s3+d+"name="+a.name+"&type="+a.type,!0),c.overrideMimeType&&c.overrideMimeType("text/plain; charset=x-user-defined");var e=this;c.onreadystatechange=function(a){4===this.readyState&&200===this.status&&(e.progress.show(),b(decodeURIComponent(this.responseText)))},c.send()},createCORSRequest:function(a,b){var c=new XMLHttpRequest;return"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null,c},sendToS3:function(b,c,d){var e=this.uploads3.createCORSRequest("PUT",c);e&&(e.onload=a.proxy(function(){var a;if(this.progress.hide(),200!==e.status)return a={error:!0},void this.upload.callback(a,this.upload.direct,e);var b=c.split("?");if(!b[0])return!1;if(this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),a={url:b[0],id:b[0],s3:!0},"file"===this.upload.type){var f=b[0].split("/");a.name=f[f.length-1]}this.upload.callback(a,this.upload.direct,d)},this),e.onerror=function(){},e.upload.onprogress=function(a){},e.setRequestHeader("Content-Type",b.type),e.setRequestHeader("x-amz-acl","public-read"),e.send(b))}}},utils:function(){return{isEmpty:function(b){return b="undefined"==typeof b?this.core.editor().html():b,b=b.replace(/[\u200B-\u200D\uFEFF]/g,""),b=b.replace(/&nbsp;/gi,""),b=b.replace(/<\/?br\s?\/?>/g,""),b=b.replace(/\s/g,""),b=b.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),b=b.replace(/<iframe(.*?[^>])>$/i,"iframe"),b=b.replace(/<source(.*?[^>])>$/i,"source"),b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),b=b.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),b=a.trim(b),""===b},isElement:function(a){try{return a instanceof HTMLElement}catch(b){return"object"==typeof a&&1===a.nodeType&&"object"==typeof a.style&&"object"==typeof a.ownerDocument}},strpos:function(a,b,c){var d=a.indexOf(b,c);return d>=0&&d},dataURItoBlob:function(a){var b;b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):unescape(a.split(",")[1]);for(var c=a.split(",")[0].split(":")[1].split(";")[0],d=new Uint8Array(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return new Blob([d],{type:c})},getOuterHtml:function(b){return a("<div>").append(a(b).eq(0).clone()).html()},cloneAttributes:function(b,c){b=b[0]||b,c=a(c);for(var d=b.attributes,e=d.length;e--;){var f=d[e];c.attr(f.name,f.value)}return c},breakBlockTag:function(){var b=this.selection.block();if(!b)return!1;var c=this.utils.isEmpty(b.innerHTML),d=b.tagName.toLowerCase();if("pre"===d||"li"===d||"td"===d||"th"===d)return!1;if(!c&&this.utils.isStartOfElement(b))return{$block:a(b),$next:a(b).next(),type:"start"};if(!c&&this.utils.isEndOfElement(b))return{$block:a(b),$next:a(b).next(),type:"end"};var e=this.selection.extractEndOfNode(b),f=a("<"+d+" />").append(e);return f=this.utils.cloneAttributes(b,f),a(b).after(f),{$block:a(b),$next:f,type:"break"}},inBlocks:function(b){b=a.isArray(b)?b:[b];for(var c=this.selection.blocks(),d=c.length,e=!1,f=0;f<d;f++)if(c[f]!==!1){var g=c[f].tagName.toLowerCase();a.inArray(g,b)!==-1&&(e=!0)}return e},inInlines:function(b){b=a.isArray(b)?b:[b];for(var c=this.selection.inlines(),d=c.length,e=!1,f=0;f<d;f++){var g=c[f].tagName.toLowerCase();a.inArray(g,b)!==-1&&(e=!0)}return e},isTag:function(b,c){var d=a(b).closest(c,this.core.editor()[0]);return 1===d.length&&d[0]},isBlock:function(a){return null!==a&&(a=a[0]||a,a&&this.utils.isBlockTag(a.tagName))},isBlockTag:function(a){return"undefined"!=typeof a&&this.reIsBlock.test(a)},isInline:function(a){return a=a[0]||a,a&&this.utils.isInlineTag(a.tagName)},isInlineTag:function(a){return"undefined"!=typeof a&&this.reIsInline.test(a)},isRedactorParent:function(b){return!!b&&(0!==a(b).parents(".redactor-in").length&&!a(b).hasClass("redactor-in")&&b)},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(b){var c=this.selection.parent(),d=this.selection.current();if(a.isArray(b)){var e=0;return a.each(b,a.proxy(function(a,b){this.utils.isCurrentOrParentOne(d,c,b)&&e++},this)),0!==e}return this.utils.isCurrentOrParentOne(d,c,b)},isCurrentOrParentOne:function(a,b,c){return c=c.toUpperCase(),b&&b.tagName===c?b:!(!a||a.tagName!==c)&&a},isEditorRelative:function(){var b=this.core.editor().css("position"),c=["absolute","fixed","relative"];return a.inArray(c,b)!==-1},setEditorRelative:function(){this.core.editor().addClass("redactor-relative")},getScrollTarget:function(){var b=a(this.opts.scrollTarget);return 0!==b.length?b:a(document)},freezeScroll:function(){this.freezeScrollTop=this.utils.getScrollTarget().scrollTop(),this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},unfreezeScroll:function(){"undefined"!=typeof this.freezeScrollTop&&this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},saveScroll:function(){this.tmpScrollTop=this.utils.getScrollTarget().scrollTop()},restoreScroll:function(){"undefined"!=typeof this.tmpScrollTop&&this.utils.getScrollTarget().scrollTop(this.tmpScrollTop)},isStartOfElement:function(a){return!("undefined"==typeof a&&!(a=this.selection.block()))&&0===this.offset.get(a)},isEndOfElement:function(b){if("undefined"==typeof b&&(b=this.selection.block(),!b))return!1;var c=a.trim(a(b).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,""),d=this.offset.get(b);return d===c.length},removeEmptyAttr:function(b,c){var d=a(b);return"undefined"==typeof d.attr(c)||""===d.attr(c)&&(d.removeAttr(c),!0)},replaceToTag:function(b,c){var d;return a(b).replaceWith(function(){d=a("<"+c+" />").append(a(this).contents());for(var b=0;b<this.attributes.length;b++)d.attr(this.attributes[b].name,this.attributes[b].value);return d}),d},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},disableBodyScroll:function(){var b=a("html"),c=window.innerWidth;if(!c){var d=document.documentElement.getBoundingClientRect();c=d.right-Math.abs(d.left)}var e=document.body.clientWidth<c,f=this.utils.measureScrollbar();b.css("overflow","hidden"),e&&b.css("padding-right",f)},measureScrollbar:function(){var b=a("body"),c=document.createElement("div");c.className="redactor-scrollbar-measure",b.append(c);var d=c.offsetWidth-c.clientWidth;return b[0].removeChild(c),d},enableBodyScroll:function(){a("html").css({overflow:"","padding-right":""}),a("body").remove("redactor-scrollbar-measure")},appendFields:function(b,c){if(!b)return c;if("object"==typeof b)return a.each(b,function(b,d){null!==d&&0===d.toString().indexOf("#")&&(d=a(d).val()),c.append(b,d)}),c;var d=a(b);if(0===d.length)return c;return d.each(function(){c.append(a(this).attr("name"),a(this).val())}),c},appendForms:function(b,c){if(!b)return c;var d=a(b);if(0===d.length)return c;var e=d.serializeArray();return a.each(e,function(a,b){c.append(b.name,b.value)}),c},isRgb:function(a){return 0===a.search(/^rgb/i)},rgb2hex:function(a){return a=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),
a&&4===a.length?"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2):""},isCollapsed:function(){return this.selection.isCollapsed()},isMobile:function(){return this.detect.isMobile()},isDesktop:function(){return this.detect.isDesktop()},isPad:function(){return this.detect.isIpad()}}},browser:function(){return{webkit:function(){return this.detect.isWebkit()},ff:function(){return this.detect.isFirefox()},ie:function(){return this.detect.isIe()}}}},a(window).on("load.tools.redactor",function(){a('[data-tools="redactor"]').redactor()}),b.prototype.init.prototype=b.prototype}(jQuery),function(a){function b(b,c,d,e){var f={duration:.5,iterate:1,delay:0,prefix:"redactor-",timing:"linear"};this.animation=c,this.slide="slideDown"===this.animation||"slideUp"===this.animation,this.$element=a(b),this.prefixes=["","-moz-","-o-animation-","-webkit-"],this.queue=[],"function"==typeof d?(e=d,this.opts=f):this.opts=a.extend(f,d),this.slide&&this.$element.height(this.$element.height()),this.init(e)}a.fn.redactorAnimation=function(a,c,d){return this.each(function(){new b(this,a,c,d)})},b.prototype={init:function(a){this.queue.push(this.animation),this.clean(),"show"===this.animation?(this.opts.timing="linear",this.$element.removeClass("hide").show(),"function"==typeof a&&a(this)):"hide"===this.animation?(this.opts.timing="linear",this.$element.hide(),"function"==typeof a&&a(this)):this.animate(a)},animate:function(b){this.$element.addClass("redactor-animated").css("display","").removeClass("hide"),this.$element.addClass(this.opts.prefix+this.queue[0]),this.set(this.opts.duration+"s",this.opts.delay+"s",this.opts.iterate,this.opts.timing);var c=this.queue.length>1?null:b;this.complete("AnimationEnd",a.proxy(function(){this.$element.hasClass(this.opts.prefix+this.queue[0])&&(this.clean(),this.queue.shift(),this.queue.length&&this.animate(b))},this),c)},set:function(a,b,c,d){for(var e=this.prefixes.length;e--;)this.$element.css(this.prefixes[e]+"animation-duration",a),this.$element.css(this.prefixes[e]+"animation-delay",b),this.$element.css(this.prefixes[e]+"animation-iteration-count",c),this.$element.css(this.prefixes[e]+"animation-timing-function",d)},clean:function(){this.$element.removeClass("redactor-animated"),this.$element.removeClass(this.opts.prefix+this.queue[0]),this.set("","","","")},complete:function(b,c,d){this.$element.one(b.toLowerCase()+" webkit"+b+" o"+b+" MS"+b,a.proxy(function(){"function"==typeof c&&c(),"function"==typeof d&&d(this);var b=["fadeOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"];a.inArray(this.animation,b)!==-1&&this.$element.css("display","none"),this.slide&&this.$element.css("height","")},this))}}}(jQuery);
//# sourceMappingURL=redactor.min.js.map