{"version":3,"sources":["fabric.js"],"names":["fabric","version","exports","document","window","require","jsdom","decodeURIComponent","createWindow","parentWindow","isTouchSupported","documentElement","isLikelyNode","Buffer","SHARED_ATTRIBUTES","DPI","reNum","fontPaths","iMatrix","canvasModule","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","_removeEventListener","eventName","handler","this","__eventListeners","eventListener","indexOf","util","array","fill","observe","arguments","length","prop","on","push","stopObserving","call","fire","options","listenersForEvent","i","len","filter","value","Observable","off","trigger","Collection","_objects","add","apply","_onObjectAdded","renderOnAddRemove","renderAll","insertAt","object","index","nonSplicing","objects","getObjects","splice","remove","somethingRemoved","_onObjectRemoved","forEachObject","callback","context","type","o","item","isEmpty","size","contains","complexity","reduce","memo","current","CommonMethods","_setOptions","set","_initGradient","filler","property","colorStops","Gradient","_initPattern","source","Pattern","_initClipping","clipTo","functionBody","getFunctionBody","Function","_setObject","obj","_set","key","get","toggle","global","sqrt","Math","atan2","pow","abs","PiBy180","PI","removeFromArray","idx","getRandomInt","min","max","floor","random","degreesToRadians","degrees","radiansToDegrees","radians","rotatePoint","point","origin","subtractEquals","v","rotateVector","Point","x","y","addEquals","vector","sin","cos","transformPoint","p","t","ignoreOffset","makeBoundingBoxFromPoints","points","xPoints","minX","maxX","width","yPoints","minY","maxY","left","top","height","invertTransform","a","r","toFixed","number","fractionDigits","parseFloat","Number","parseUnit","fontSize","unit","exec","Text","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","namespace","string","camelize","charAt","toUpperCase","slice","resolveNamespace","parts","split","loadImage","url","crossOrigin","img","createImage","onload","onerror","log","src","enlivenObjects","reviver","onLoaded","numLoadedObjects","numTotalObjects","enlivenedObjects","forEach","fromObject","error","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","path","PathGroup","sourcePath","populateWithProperties","destination","properties","Object","prototype","toString","drawDashedLine","ctx","x2","y2","da","dx","dy","rot","dc","di","draw","save","translate","moveTo","rotate","restore","createCanvasElement","canvasEl","createElement","getContext","G_vmlCanvasManager","initElement","createAccessors","klass","propName","capitalizedPropName","setterName","getterName","proto","stateProperties","clipContext","receiver","beginPath","clip","multiplyTransformMatrices","b","is2x2","qrDecompose","angle","denom","scaleX","scaleY","skewX","skewY","translateX","translateY","customTransformMatrix","skewMatrixX","tan","scaleMatrix","resetObjectTransform","target","flipX","flipY","setAngle","fn","String","match","isTransparent","tolerance","temp","_isTransparent","imageData","getImageData","l","data","parsePreserveAspectRatioAttribute","attribute","align","meetOrSlice","alignX","alignY","aspectRatioAttrs","pop","clearFabricFontCache","fontFamily","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","arcToSegments","toX","toY","rx","ry","large","sweep","rotateX","argsString","_join","arcToSegmentsCache","th","sinTh","cosTh","fromX","fromY","px","py","rx2","ry2","py2","px2","pl","root","s","cx","cy","cx1","cy1","mTheta","calcVectorAngle","dtheta","segments","ceil","result","mDelta","mT","th3","segmentToBezier","th2","argsString2","segmentToBezierCache","costh2","sinth2","costh3","sinth3","cp1X","cp1Y","cp2X","cp2Y","ux","uy","vx","vy","ta","tb","getBoundsOfCurve","x0","y0","x1","y1","x3","y3","boundsOfCurveCache","c","t1","t2","b2ac","sqrtb2ac","tvalues","bounds","mt","j","jlen","Array","join","drawArc","fx","fy","coords","segs","segsNorm","bezierCurveTo","getBoundsOfArc","tx","ty","bound","find","byProperty","condition","searchElement","TypeError","n","POSITIVE_INFINITY","NEGATIVE_INFINITY","k","map","every","some","val","rv","invoke","method","args","value1","value2","extend","deep","Element","hasOwnProperty","clone","trim","replace","character","capitalize","firstLetterOnly","toLowerCase","escapeXml","Dummy","bind","thisArg","_this","concat","Subclass","callSuper","methodName","parentMethod","constructor","superclass","superClassMethod","console","emptyFunction","IS_DONTENUM_BUGGY","addMethods","parent","returnValue","valueOf","createClass","initialize","shift","subclasses","areHostMethods","methodNames","test","createListener","uid","wrappedHandler","createWrappedHandler","e","getElement","event","createDispatcher","handlers","handlersForEvent","_getPointer","pageProp","clientProp","touchProp","setElement","unknown","getUniqueId","element","__uniqueID","addListener","removeListener","shouldUseAddListenerRemoveListener","shouldUseAttachEventDetachEvent","listeners","addEventListener","removeEventListener","listener","attachEvent","detachEvent","existingHandler","pointerX","clientX","pointerY","clientY","getPointer","srcElement","scroll","getScrollLeftTop","parseEl","supportsOpacity","style","opacity","supportsFilters","reOpacity","setOpacity","es","currentStyle","hasLayout","zoom","setStyle","styles","elementStyle","cssText","styleFloat","makeElement","tagName","attributes","el","className","htmlFor","setAttribute","docElement","body","scrollLeft","scrollTop","parentNode","host","nodeType","getElementStyle","sliceCanConvertNodelists","_slice","toArray","arrayLike","childNodes","err","arr","defaultView","getComputedStyle","attr","undefined","selectProp","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","getScript","headEl","getElementsByTagName","scriptEl","loading","onreadystatechange","readyState","appendChild","getById","id","getElementById","addClass","wrapElement","wrapper","replaceChild","getElementOffset","docElem","scrollLeftTop","doc","ownerDocument","box","offset","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","parseInt","getBoundingClientRect","clientLeft","clientTop","addParamToUrl","param","emptyFn","makeXHR","factories","ActiveXObject","XMLHttpRequest","request","onComplete","xhr","parameters","open","setRequestHeader","send","warn","noop","requestAnimFrame","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","animate","timestamp","time","start","Date","duration","finish","onChange","abort","easing","d","startValue","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","valuePerc","calculateColor","begin","end","pos","color","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","colorEasing","normalize","asin","elastic","opts","easeInBounce","easeOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInOutBounce","normalizeAttr","attributesMap","normalizeValue","parentAttributes","parsed","isArray","transformMatrix","parseTransformAttribute","visible","isNaN","_setStrokeFillOpacity","colorAttributes","setAlpha","getAlpha","toRgba","_getMultipleNodes","nodeNames","nodeName","nodeList","nodeArray","parseStyleString","oStyle","chunk","pair","parseStyleObject","getGlobalStylesForElement","svgUid","rule","cssRules","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","doesSomeParentMatch","selector","matcher","classNames","getAttribute","RegExp","elementById","node","nodelist","parseUseDirectives","attrs","xlink","substr","el2","cloneNode","currentTrans","oldLength","applyViewboxTransform","el3","nodeValue","firstChild","removeAttribute","viewBoxWidth","viewBoxHeight","matrix","viewBoxAttr","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","reViewBoxTagNames","reViewBoxAttrValue","missingDimAttr","toBeParsed","parsedDim","translateMatrix","hasAncestorWithNodeName","reAllowedSVGTagNames","reNotAllowedAncestors","reAllowedParents","display","visibility","transform","fill-opacity","fill-rule","font-family","font-size","font-style","font-weight","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-decoration","text-anchor","stroke","gradientDefs","rotateMatrix","multiplierX","multiplierY","skewMatrix","commaWsp","transformList","reTransformList","reTransform","attributeValue","matrices","m","operation","combinedMatrix","parseSVGDocument","parsingOptions","__uid","descendants","selectNodes","getGradientDefs","getCSSRules","parseElements","instances","reFontDeclaration","parseFontDeclaration","fontStyle","fontWeight","lineHeight","elList","idsToXlinkMap","parseAttributes","ownAttributes","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","font","mergedAttrs","ElementsParser","parse","parsePointsAttribute","parsedPoints","allRules","styleContents","textContent","text","ruleObj","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","responseText","async","loadXML","results","_options","loadSVGFromString","DOMParser","parser","parseFromString","numElements","createObjects","_obj","createObject","fromElement","_createObject","checkIfDone","createCallback","resolveGradient","instanceFillValue","gradientId","that","scalarAdd","scalar","scalarAddEquals","subtract","scalarSubtract","scalarSubtractEquals","multiply","multiplyEquals","divide","divideEquals","eq","lt","lte","gt","gte","lerp","distanceFrom","midPointFrom","setXY","setX","setY","setFromPoint","swap","Intersection","status","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","_tryParsingColor","setSource","hue2rgb","q","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","h","round","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","alpha","toGrayscale","average","currentAlpha","toBlackWhite","threshold","overlayWith","otherColor","otherSource","reRGBa","reHSLa","reHex","aqua","black","blue","fuchsia","gray","grey","green","lime","maroon","navy","olive","orange","purple","red","silver","teal","white","yellow","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","substring","oColor","getColorStop","colorAlpha","keyValuePairs","getLinearCoords","getRadialCoords","_convertPercentUnitsToValues","gradientUnits","propValue","addFactor","multFactor","ellipseMatrix","scaleFactor","offsetX","offsetY","gradientTransform","addColorStop","position","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","sort","group","reverse","minRadius","percentageShift","colorStop","toLive","gradient","createLinearGradient","createRadialGradient","instance","colorStopEls","forObject","repeat","setOptions","NUM_FRACTION_DIGITS","toDataURL","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","complete","naturalWidth","naturalHeight","createPattern","Shadow","blur","affectStroke","includeDefaultValues","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","StaticCanvas","CANVAS_INIT_ERROR","Error","_initStatic","backgroundColor","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","imageSmoothingEnabled","viewportTransform","backgroundVpt","overlayVpt","onBeforeScaleRotate","enableRetinaScaling","vptCoords","skipOffscreen","cb","_createLowerCanvas","_initOptions","_setImageSmoothing","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","lowerCanvasEl","contextContainer","scale","_offset","image","__setBgOverlayImage","__setBgOverlayColor","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","Image","_createCanvasElement","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","backstoreOnly","_setCssDimension","upperCanvasEl","cacheCanvasEl","wrapperEl","getZoom","setViewportTransform","vpt","activeGroup","_activeGroup","setCoords","calcViewportBoundaries","zoomToPoint","before","after","setZoom","absolutePan","relativePan","setupState","canvas","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","canvasToDrawOn","renderCanvas","iVpt","tl","br","tr","bl","_renderBackground","_renderObjects","drawControls","_renderOverlay","render","_renderBackgroundOrOverlay","fillStyle","fillRect","getCenter","centerObjectH","_centerObject","getCenterPoint","centerObjectV","centerObject","center","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","setPositionByOrigin","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","__serializeBgOverlay","excludeFromExport","_toObject","originalValue","background","overlay","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","encoding","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","row","rowIndex","charIndex","fontList","_setSVGObject","sendToBack","objs","unshift","bringToFront","sendBackwards","intersecting","newIdx","_findNewLowerIndex","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","DataURLExporter","EMPTY_JSON","supports","setLineDash","toJSON","BaseBrush","strokeLineCap","strokeLineJoin","strokeDashArray","setShadow","_setBrushStyles","contextTop","strokeStyle","lineWidth","lineCap","lineJoin","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","_resetShadow","PencilBrush","_points","onMouseDown","pointer","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","p1","p2","midPoint","quadraticCurveTo","lineTo","convertPointsToSVGPath","createPath","pathData","Path","strokeWidth","originX","originY","closePath","CircleBrush","drawDot","addPoint","arc","radius","originalRenderOnAddRemove","circles","circle","Circle","Group","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","sprayChunkPoints","globalAlpha","PatternBrush","getPatternSrc","patternCanvas","patternCtx","getPatternSrcFunction","getPattern","topLeft","_getLeftTopCoords","supportLineDash","Canvas","_initInteractive","_createCacheCanvas","uniScaleTransform","uniScaleKey","centeredScaling","centeredRotation","centeredKey","altActionKey","selection","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","rotationCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","snapAngle","snapThreshold","stopContextMenu","fireRightClick","fireMiddleClick","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","freeDrawingBrush","_chooseObjectsToRender","getActiveGroup","activeObject","getActiveObject","objsToRender","activeGroupObjects","contextTopDirty","renderTop","_drawSelection","_resetCurrentTransform","original","_shouldCenterTransform","action","_setOriginToCenter","mouseXSign","mouseYSign","containsPoint","xy","_normalizePointer","_findTargetCorner","calcTransformMatrix","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","hasBorders","transparentCorners","contextCache","originalColor","selectionBackgroundColor","active","_renderControls","_shouldClearSelection","evented","selectable","centerTransform","altKey","_getOriginFromCorner","corner","_getActionFromCorner","_setupCurrentTransform","ex","ey","lastX","lastY","theta","shiftKey","_translateObject","newLeft","newTop","moveX","moveY","_changeSkewTransformOrigin","mouseMove","by","origins","0","skew","originA","originB","flipSign","skewSign","_skewObject","skewed","lockSkewingX","lockSkewingY","actualMouseByOrigin","constraintPosition","actualMouseByCenter","toLocalPoint","lastMouseByCenter","dim","_getTransformedDimensions","translateToOriginPoint","_setObjectSkew","localMouse","_dim","newValue","newDim","dimNoSkew","otherBy","_otherBy","_by","newDimMouse","atan","_scaleObject","lockScalingX","lockScalingY","lockScalingFlip","scaled","_setLocalMouse","_setObjectScale","changeX","changeY","forbidScalingX","forbidScalingY","_scaleObjectEqually","newScaleX","newScaleY","_flipObject","dist","lastDist","padding","_rotateObject","lastAngle","curAngle","hasRoated","rightAngleLocked","leftAngleLocked","setCursor","cursor","_resetObjectTransform","groupSelector","aleft","atop","_setLineDash","strokeRect","findTarget","skipGroup","activeTarget","targets","_searchPossibleTargets","_fireOverOutEvents","overOpt","outOpt","hoveredTarget","_hoveredTarget","previousTarget","nextTarget","_checkTarget","isEditing","normalizedPointer","subTarget","subTargetCheck","ignoreZoom","cssScale","boundsWidth","boundsHeight","bottom","right","lowerCanvasClass","_copyCanvasStyle","class","touch-action","fromEl","toEl","getSelectionContext","getSelectionElement","_setActiveObject","_activeObject","onDeselect","setActiveObject","currentActiveObject","_discardActiveObject","discardActiveObject","_setActiveGroup","setActiveGroup","_discardActiveGroup","destroy","discardActiveGroup","deactivateAll","allObjects","deactivateAllWithDispatch","removeListeners","removeChild","_drawObjectsControls","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","originalValues","realizeTransform","_setCursorFromEvent","checkClick","which","button","cursorOffset","mr","mb","ml","cursorMap","_bindEvents","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","passive","eventjs","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","eventsBinded","_onMouseUp","self","__onTransformGesture","__onDrag","__onMouseWheel","hiddenTextarea","focus","__onOrientationChange","__onShake","__onLongPress","stopPropagation","preventDefault","__onMouseDown","__onMouseUp","__onMouseMove","_shouldRender","isMoving","_previousPointer","_handleEvent","_isCurrentlyDrawing","_onMouseUpInDrawingMode","searchTarget","isClick","_finalizeCurrentTransform","actionPerformed","shouldRender","_maybeGroupObjects","__corner","eventType","targetObj","subTargets","_scaling","_restoreOriginXY","hasStateChanged","_previousOriginX","_previousOriginY","originPoint","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","shouldGroup","_shouldGroup","_handleGrouping","_beforeTransform","saveState","_setCenterToOrigin","touches","_transformObject","reset","_beforeScaleTransform","_performTransformAction","_fire","_onScale","currentAction","_setCornerCursor","_getRotatedCornerCursor","hasRotatingPoint","getAngle","_updateActiveGroup","_createActiveGroup","saveCoords","removeWithUpdate","addWithUpdate","_createGroup","groupObjects","exitEditing","_groupSelectedObjects","_collectObjects","currentObject","selectionX1Y1","selectionX2Y2","intersectsWithRect","isContainedWithinRect","setObjectsCoords","supportQuality","format","quality","multiplier","cropping","__toDataURLWithMultiplier","origWidth","origHeight","scaledWidth","scaledHeight","newZoom","vp","newVp","originalInteractive","__toDataURL","toDataURLWithMultiplier","loadFromDatalessJSON","json","loadFromJSON","serialized","JSON","_enlivenObjects","_setBgOverlay","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","stringify","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","supportsLineDash","objectCaching","cornerSize","borderColor","borderDashArray","cornerColor","cornerStrokeColor","cornerStyle","cornerDashArray","fillRule","globalCompositeOperation","strokeMiterLimit","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","rotatingPointOffset","lockMovementX","lockMovementY","lockRotation","lockUniScaling","statefullCache","noScaleCache","dirty","cacheProperties","_cacheProperties","_cacheCanvas","_cacheContext","_updateCacheCanvas","_limitCacheSize","dims","maximumSide","cacheSideLimit","limitedDims","zoomX","zoomY","_getCacheCanvasDimensions","objectScale","getObjectScaling","_getNonTransformedDimensions","retina","minCacheSize","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","sizeShrinking","cacheTranslationX","cacheTranslationY","setTransform","fromLeft","_transformDone","_removeDefaultValues","scaling","_constrainScale","setOnGroup","setSourcePath","getViewportTransform","isNotVisible","noTransform","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","shouldCache","isCacheDirty","propertySet","drawObject","drawCacheOnCanvas","needsItsOwnCache","isCaching","willDrawShadow","_setStrokeStyles","_setFillStyles","drawImage","skipCanvas","_removeShadow","miterLimit","dashArray","alternative","drawBordersInGroup","drawBorders","multX","multY","_applyPatternGradientTransform","patternTransform","_renderFill","_renderStroke","_renderDashedStroke","cloneAsImage","dataUrl","boundingRect","getBoundingRect","origParams","getLeft","getTop","originalCanvas","isType","setGradient","setPatternFill","setColor","shouldCenterOrigin","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","_fromObject","forceAsync","extraParam","originXOffset","originYOffset","translateToGivenOrigin","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","to","offsetFrom","offsetTo","hypotFull","xFull","yFull","_originalOriginX","_originalOriginY","getCoords","multiplyMatrices","oCoords","aCoords","absolute","calculate","calcCoords","pointTL","pointBR","other","lines","_getImageLines","_findCrossPoints","centerPoint","topline","rightline","bottomline","leftline","xi","iLine","xcount","lineKey","getBoundingRectWidth","getBoundingRectHeight","scaleToWidth","boundingRectFactor","scaleToHeight","_calculateCurrentDimensions","currentWidth","currentHeight","_angle","_hypotenuse","mtr","skipAbsolute","_setCornerCoords","_calcRotateMatrix","dimensionMatrix","_calcDimensionsTransformMatrix","flipping","bbox","dimX","dimY","getSvgColorString","str","getSvgStyles","skipShadow","getSvgFilter","getSvgId","getSvgTransform","getSkewX","getSkewY","translatePart","anglePart","scalePart","skewXPart","skewYPart","addTranslateX","flipXPart","addTranslateY","getSvgTransformMatrix","_createBaseSVGMarkup","saveProps","props","tmpObj","_isEqual","origValue","currentValue","firstPass","keys","dashedPropertySet","isVML","_controlsVisibility","isControlVisible","newTheta","cornerHypotenuse","cosHalfOffset","sinHalfOffset","wh","rotateHeight","scaleOffset","_drawControl","control","controlName","_getControlsVisibility","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","skipCallbacks","propsToAnimate","_animate","propPair","from","valueProgress","timeProgress","makeEdgeToOriginGetter","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","coordProps","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","cp","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","line","isValidRadius","pi","startAngle","endAngle","setRadius","startX","startY","endX","endY","largeFlag","getRadiusX","getRadiusY","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","ellipse","_initRxRy","w","isRounded","Polyline","_calcDimensions","pathOffset","diffX","diffY","commonRender","Polygon","_toString","commandLengths","repeatedCommands","M","fromArray","_parsePath","_setPositionDimensions","calcDim","_parseDimensions","_renderPathCommands","tempX","tempY","previous","subpathStartX","subpathStartY","controlX","controlY","chunks","addTransform","currentPath","coordsStr","coordsParsed","re","command","commandLength","repeatedCommand","klen","aX","aY","pathUrl","paths","parseDimensionsFromPaths","xC","yC","parentCache","caching","isSameColor","pathsToObject","originalDefaults","firstPathFill","pathFill","total","originalPaths","pathGroup","_lockProperties","isAlreadyGrouped","_updateObjectsCoords","_calcBounds","skipCoordsChange","_updateObjectCoords","__origHasControls","objectLeft","objectTop","_restoreObjectsState","_setObjectActive","delegatedProperties","textDecoration","textAlign","objsToObject","_renderObject","originalHasRotatingPoint","_restoreObjectState","_originalLeft","_originalTop","hasMoved","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","_lastScaleX","_lastScaleY","minimumScaleTrigger","filters","resizeFilters","_initElement","_element","_callback","_originalElement","_initConfig","applyFilters","_filteredEl","setCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","getSvgSrc","origFill","filtered","_src","setSrc","imgElement","forResizing","replacement","retinaScaling","minimumScale","applyTo","toBuffer","pngCompression","elementToDraw","imageMargins","_findMargins","_needsResize","marginX","marginY","scales","_resetWidthHeight","CSS_CANVAS","_initFilters","fromURL","imgOptions","preserveAR","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","BaseFilter","Brightness","brightness","putImageData","Convolute","opaque","dstOff","scx","scy","srcOff","wt","weights","pixels","side","halfSide","sw","sh","output","createImageData","dst","alphaFac","GradientTransparency","Grayscale","Invert","Mask","mask","channel","maskEl","maskCanvasEl","maskData","Noise","noise","rand","Pixelate","blocksize","_i","_ilen","_j","_jlen","RemoveWhite","distance","limit","Sepia","avg","Sepia2","Tint","tintR","tintG","tintB","alpha1","Multiply","Blend","mode","tg","_r","_g","_b","isImage","_el","tmpCanvas","Resize","resizeType","lanczosLobes","rcpScaleX","rcpScaleY","oW","oH","dW","dH","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","multW","multH","signW","signH","doneW","doneH","stepW","stepH","tmpCtx","process","u","weight","fX","fY","ratioX","icenter","ratioY","range2X","cacheLanc","range2Y","lanczos","rcpRatioX","rcpRatioY","srcData","destData","destImg","srcImg","lobes","xx","lanczosCreate","xDiff","yDiff","chnl","origPix","w4","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","centerY","yy","centerX","w0","ColorMatrix","Contrast","contrast","contrastF","Saturate","saturate","adjust","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","textBackgroundColor","_fontSizeFraction","_fontSizeMult","charSpacing","__skipDimension","_initDimensions","_setTextStyles","_textLines","_splitTextIntoLines","_clearCache","_getTextWidth","cursorWidth","_getTextHeight","_renderTextLinesBackground","_renderText","_renderTextDecoration","_renderTextFill","_renderTextStroke","textBaseline","_getFontDeclaration","_getHeightOfSingleLine","_getHeightOfLine","maxWidth","_getLineWidth","currentLineWidth","_renderChars","chars","_char","shortM","additionalSpace","_getWidthOfCharSpacing","measureText","_renderTextLine","lineIndex","word","words","charOffset","wordsWidth","_getWidthOfWords","widthDiff","numSpaces","spaceWidth","leftOffset","_getLeftOffset","_getTopOffset","isEmptyStyles","_renderTextCommon","lineHeights","heightOfLine","maxHeight","_getLineLeftOffset","lineLeftOffset","lineTopOffset","originalFill","__lineWidths","__lineHeights","_shouldClearDimensionCache","shouldClear","_forceClearCache","_measureLine","finalWidth","halfOfVerticalBox","offsets","oLen","renderLinesAtOffset","additionalProperties","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","_wrapSVGTextAndBg","lineTop","textBgRects","textSpans","textTopOffset","textLeftOffset","_setSVGBg","_setSVGTextLineBg","_setSVGTextLineText","yPos","_getFillAttributes","_setSVGTextLineJustifed","fillColor","textHeightScaleFactor","scaledDiff","textHeight","offX","IText","selectionStart","selectionEnd","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","initBehavior","p3","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","getSelectionStyles","startIndex","endIndex","loc","get2DCursorLocation","_getStyleDeclaration","setSelectionStyles","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","clearContextTop","cursorOffsetCache","renderCursorOrSelection","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","getCurrentCharStyle","getCurrentCharFontSize","getCurrentCharColor","typeOfBoundaries","_getCursorBoundariesOffsets","lineLeft","topOffset","_getWidthOfChar","cursorLocation","charHeight","__isMousedown","startLine","endLine","lineOffset","realLineHeight","boxWidth","j2","j2len","_renderCharsFast","prevStyle","thisStyle","charsToRender","_hasStyleChanged","_renderChar","skipFillStrokeCheck","charWidth","shouldFill","shouldStroke","_charWidth","decl","_getHeightOfChar","_applyCharStylesGetWidth","jChar","fillText","strokeText","_renderCharDecoration","decoration","decorationWeight","positions","underline","line-through","overline","decorations","leftCache","topCache","widthCache","heightCache","colorCache","_getWidthOfCharsAt","_getCacheProp","styleDeclaration","_getFontCache","cacheProp","charDecl","_applyFontStyles","returnCloneOrEmpty","_deleteStyleDeclaration","_deleteLineStyle","_isMeasuring","_getWidthOfSpace","currentCharHeight","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","selected","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","clearTimeout","_currentTickCompleteState","initDelayedCursor","restart","delay","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","getNumNewLinesInSelectedText","selectedText","numNewLines","searchWordBoundary","direction","reNonWord","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","inCompositionMode","_calcTextareaPosition","upperCanvas","_savedProps","_restoreEditingProps","overCursor","isTextChanged","_removeExtraneousStyles","_removeCharsFromTo","_removeSingleCharAndStyle","isBeginningOfLine","indexStyle","removeStyleObject","insertChars","_chars","useCopiedStyle","copiedTextStyle","insertChar","skipUpdate","styleObject","isEndOfLine","insertStyleObjects","insertNewlineStyleObject","shiftLineStyles","currentCharStyle","newLineStyles","somethingAdded","numIndex","insertCharStyleObject","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","clonedStyles","numericLine","_removeStyleObject","_getTextOnPreviousLine","lIndex","textOnPreviousLine","newCharIndexOnPrevLine","insertNewline","setSelectionStartEndWithShift","newSelection","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","isDoubleClick","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","__mousedownX","__mousedownY","setCursorByClick","_isObjectMoved","mouseOffset","prevWidth","widthOfLine","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","onKeyDown","onKeyUp","onInput","copy","cut","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","onClick","keysMap","8","9","27","13","33","34","35","36","37","38","39","40","46","ctrlKeysMapUp","67","88","ctrlKeysMapDown","65","keyCode","ctrlKey","metaKey","stopImmediatePropagation","_copyDone","diff","charsToInsert","offsetEnd","textLength","newTextLength","prevCompositionLength","compositionStart","forwardDelete","moveCursorRight","removeChars","clipboardData","_getClipboardData","setData","copiedText","getData","_getWidthBeforeCursor","textBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","getUpCursorOffset","foundMatch","textOnLine","widthOfCharsOnLine","indexOnLine","widthOfChar","leftEdge","rightEdge","offsetFromLeftEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","actionName","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","_removeCharsNearCursor","leftLineBoundary","leftWordBoundary","_setSVGTextLineChars","_getSVGLineTopOffset","styleDecl","_createTextCharSpan","_createTextCharBg","lastHeight","fillStyles","Textbox","minWidth","dynamicMinWidth","__cachedLines","getTextboxControlVisibility","_generateStyleMap","realLineCount","realLineCharCount","charCount","_styleMap","_wrapText","wrapped","_wrapLine","_measureText","wordWidth","infixWidth","largestWordWidth","lineJustStarted","originalAlign","__oldScaleX","numLines","removed","lineLen","lineChars","getMinWidth","setObjectScaleOverridden","_refreshControlsVisibility","override","tmp","oURL","URL","port","protocol","req","HTTPS","HTTP","hostname","response","setEncoding","statusCode","errno","ECONNREFUSED","message","requestFs","readFile","createImageAndCallBack","eval","createCanvasForNode","nodeCanvasOptions","nodeCanvas","nodeCacheCanvas","fabricCanvas","Font","originaInitStatic","createPNGStream","createJPEGStream","origSetBackstoreDimension"],"mappings":"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","file":"fabric.js","sourcesContent":["/* build: `node build.js modules=ALL exclude=json,gestures minifier=uglifyjs` */\n /*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: \"1.7.16\" };\nif (typeof exports !== 'undefined') {\n  exports.fabric = fabric;\n}\n\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  fabric.document = document;\n  fabric.window = window;\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  fabric.document = require(\"jsdom\")\n    .jsdom(\n      decodeURIComponent(\"%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E\")\n    );\n\n  if (fabric.document.createWindow) {\n    fabric.window = fabric.document.createWindow();\n  } else {\n    fabric.window = fabric.document.parentWindow;\n  }\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\nfabric.isTouchSupported = \"ontouchstart\" in fabric.document.documentElement;\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\n                      typeof window === 'undefined';\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  \"display\",\n  \"transform\",\n  \"fill\", \"fill-opacity\", \"fill-rule\",\n  \"opacity\",\n  \"stroke\", \"stroke-dasharray\", \"stroke-linecap\",\n  \"stroke-linejoin\", \"stroke-miterlimit\",\n  \"stroke-opacity\", \"stroke-width\",\n  \"id\"\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:e[-+]?\\\\d+)?)';\nfabric.fontPaths = { };\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.canvasModule = 'canvas';\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = { };\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\n                          fabric.window.webkitDevicePixelRatio ||\n                          fabric.window.mozDevicePixelRatio ||\n                          1;\n\n\n(function() {\n\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    }\n    else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @deprecated `observe` deprecated since 0.8.34 (use `on` instead)\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function observe(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @deprecated `stopObserving` deprecated since 0.8.34 (use `off` instead)\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function stopObserving(eventName, handler) {\n    if (!this.__eventListeners) {\n      return;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @deprecated `fire` deprecated since 1.0.7 (use `trigger` instead)\n   * @memberOf fabric.Observable\n   * @alias trigger\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    observe: observe,\n    stopObserving: stopObserving,\n    fire: fire,\n\n    on: observe,\n    off: stopObserving,\n    trigger: fire\n  };\n})();\n\n\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.renderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this.getObjects();\n    if (nonSplicing) {\n      objects[index] = object;\n    }\n    else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.renderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function() {\n    var objects = this.getObjects(),\n        index, somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.renderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function(callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function(type) {\n    if (typeof type === 'undefined') {\n      return this._objects;\n    }\n    return this._objects.filter(function(o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this.getObjects()[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this.getObjects().length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function() {\n    return this.getObjects().length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function(object) {\n    return this.getObjects().indexOf(object) > -1;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this.getObjects().reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  }\n};\n\n\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function(options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function(filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function(filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    }\n    else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [options] Options object\n   */\n  _initClipping: function(options) {\n    if (!options.clipTo || typeof options.clipTo !== 'string') {\n      return;\n    }\n\n    var functionBody = fabric.util.getFunctionBody(options.clipTo);\n    if (typeof functionBody !== 'undefined') {\n      this.clipTo = new Function('ctx', functionBody);\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function(obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function(key, value) {\n    if (typeof key === 'object') {\n      this._setObject(key);\n    }\n    else {\n      if (typeof value === 'function' && key !== 'clipTo') {\n        this._set(key, value(this.get(key)));\n      }\n      else {\n        this._set(key, value);\n      }\n    }\n    return this;\n  },\n\n  _set: function(key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function(property) {\n    var value = this.get(property);\n    if (typeof value === 'boolean') {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function(property) {\n    return this[property];\n  }\n};\n\n\n(function(global) {\n\n  var sqrt = Math.sqrt,\n      atan2 = Math.atan2,\n      pow = Math.pow,\n      abs = Math.abs,\n      PiBy180 = Math.PI / 180;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function(array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function(min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function(degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function(radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function(point, origin, radians) {\n      point.subtractEquals(origin);\n      var v = fabric.util.rotateVector(point, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function(vector, radians) {\n      var sin = Math.sin(radians),\n          cos = Math.cos(radians),\n          rx = vector.x * cos - vector.y * sin,\n          ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry\n      };\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function(p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function(points) {\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n          minX = fabric.util.array.min(xPoints),\n          maxX = fabric.util.array.max(xPoints),\n          width = Math.abs(minX - maxX),\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n          minY = fabric.util.array.min(yPoints),\n          maxY = fabric.util.array.max(yPoints),\n          height = Math.abs(minY - maxY);\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function(t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function(number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function(value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n          number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case 'mm':\n          return number * fabric.DPI / 25.4;\n\n        case 'cm':\n          return number * fabric.DPI / 2.54;\n\n        case 'in':\n          return number * fabric.DPI;\n\n        case 'pt':\n          return number * fabric.DPI / 72; // or * 4 / 3\n\n        case 'pc':\n          return number * fabric.DPI / 72 * 12; // or * 16\n\n        case 'em':\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function() {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function(type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function(namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split('.'),\n          len = parts.length, i,\n          obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function(url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      img.onload = function () {\n        callback && callback.call(context, img);\n        img = img.onload = img.onerror = null;\n      };\n\n      /** @ignore */\n      img.onerror = function() {\n        fabric.log('Error loading ' + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      if (url.indexOf('data') !== 0 && crossOrigin) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function(objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback && callback(enlivenedObjects);\n        }\n      }\n\n      var enlivenedObjects = [],\n          numLoadedObjects = 0,\n          numTotalObjects = objects.length,\n          forceAsync = true;\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        }, forceAsync);\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function(patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n          numLoadedPatterns = 0,\n          numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function(pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        }\n        else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.PathGroup}\n     */\n    groupSVGElements: function(elements, options, path) {\n      var object;\n\n      object = new fabric.PathGroup(elements, options);\n\n      if (typeof path !== 'undefined') {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Propertie names to include\n     */\n    populateWithProperties: function(source, destination, properties) {\n      if (properties && Object.prototype.toString.call(properties) === '[object Array]') {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Draws a dashed line between two points\n     *\n     * This method is used to draw dashed line around selection area.\n     * See <a href=\"http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas\">dotted stroke in canvas</a>\n     *\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x  start x coordinate\n     * @param {Number} y start y coordinate\n     * @param {Number} x2 end x coordinate\n     * @param {Number} y2 end y coordinate\n     * @param {Array} da dash array pattern\n     */\n    drawDashedLine: function(ctx, x, y, x2, y2, da) {\n      var dx = x2 - x,\n          dy = y2 - y,\n          len = sqrt(dx * dx + dy * dy),\n          rot = atan2(dy, dx),\n          dc = da.length,\n          di = 0,\n          draw = true;\n\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.moveTo(0, 0);\n      ctx.rotate(rot);\n\n      x = 0;\n      while (len > x) {\n        x += da[di++ % dc];\n        if (x > len) {\n          x = len;\n        }\n        ctx[draw ? 'lineTo' : 'moveTo'](x, 0);\n        draw = !draw;\n      }\n\n      ctx.restore();\n    },\n\n    /**\n     * Creates canvas element and initializes it via excanvas if necessary\n     * @static\n     * @memberOf fabric.util\n     * @param {CanvasElement} [canvasEl] optional canvas element to initialize;\n     * when not given, element is created implicitly\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function(canvasEl) {\n      canvasEl || (canvasEl = fabric.document.createElement('canvas'));\n      /* eslint-disable camelcase */\n      if (!canvasEl.getContext && typeof G_vmlCanvasManager !== 'undefined') {\n        G_vmlCanvasManager.initElement(canvasEl);\n      }\n      /* eslint-enable camelcase */\n      return canvasEl;\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function() {\n      return fabric.isLikelyNode\n        ? new (require('canvas').Image)()\n        : fabric.document.createElement('img');\n    },\n\n    /**\n     * Creates accessors (getXXX, setXXX) for a \"class\", based on \"stateProperties\" array\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} klass \"Class\" to create accessors for\n     */\n    createAccessors: function(klass) {\n      var proto = klass.prototype, i, propName,\n          capitalizedPropName, setterName, getterName;\n\n      for (i = proto.stateProperties.length; i--; ) {\n\n        propName = proto.stateProperties[i];\n        capitalizedPropName = propName.charAt(0).toUpperCase() + propName.slice(1);\n        setterName = 'set' + capitalizedPropName;\n        getterName = 'get' + capitalizedPropName;\n\n        // using `new Function` for better introspection\n        if (!proto[getterName]) {\n          proto[getterName] = (function(property) {\n            return new Function('return this.get(\"' + property + '\")');\n          })(propName);\n        }\n        if (!proto[setterName]) {\n          proto[setterName] = (function(property) {\n            return new Function('value', 'return this.set(\"' + property + '\", value)');\n          })(propName);\n        }\n      }\n    },\n\n    /**\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Object} receiver Object implementing `clipTo` method\n     * @param {CanvasRenderingContext2D} ctx Context to clip\n     */\n    clipContext: function(receiver, ctx) {\n      ctx.save();\n      ctx.beginPath();\n      receiver.clipTo(ctx);\n      ctx.clip();\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function(a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x2 matrix into transform componentes\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function(a) {\n      var angle = atan2(a[1], a[0]),\n          denom = pow(a[0], 2) + pow(a[1], 2),\n          scaleX = sqrt(denom),\n          scaleY = (a[0] * a[3] - a[2] * a [1]) / scaleX,\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\n      return {\n        angle: angle  / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5]\n      };\n    },\n\n    customTransformMatrix: function(scaleX, scaleY, skewX) {\n      var skewMatrixX = [1, 0, abs(Math.tan(skewX * PiBy180)), 1],\n          scaleMatrix = [abs(scaleX), 0, 0, abs(scaleY)];\n      return fabric.util.multiplyTransformMatrices(scaleMatrix, skewMatrixX, true);\n    },\n\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.setAngle(0);\n    },\n\n    /**\n     * Returns string representation of function body\n     * @param {Function} fn Function to get body of\n     * @return {String} Function body\n     */\n    getFunctionBody: function(fn) {\n      return (String(fn).match(/function[^{]*\\{([\\s\\S]*)\\}/) || {})[1];\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function(ctx, x, y, tolerance) {\n\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        }\n        else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        }\n        else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true, i, temp,\n          imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1),\n          l = imageData.data.length;\n\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if colour found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function(attribute) {\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\n          aspectRatioAttrs = attribute.split(' '), align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\n          align = meetOrSlice;\n          meetOrSlice = 'meet';\n        }\n        else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY\n      };\n    },\n\n    /**\n     * Clear char widths cache for a font family.\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function(fontFamily) {\n      if (!fontFamily) {\n        fabric.charWidthsCache = { };\n      }\n      else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Clear char widths cache for a font family.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @param {Number} maximumSide biggest side allowed\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function(ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function(min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var arcToSegmentsCache = { },\n      segmentToBezierCache = { },\n      boundsOfCurveCache = { },\n      _join = Array.prototype.join;\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var argsString = _join.call(arguments);\n    if (arcToSegmentsCache[argsString]) {\n      return arcToSegmentsCache[argsString];\n    }\n\n    var PI = Math.PI, th = rotateX * PI / 180,\n        sinTh = Math.sin(th),\n        cosTh = Math.cos(th),\n        fromX = 0, fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n        root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    }\n    else {\n      root = (large === sweep ? -1.0 : 1.0) *\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = root * rx * py / ry,\n        cy = -root * ry * px / rx,\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    }\n    else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\n        result = [], mDelta = dtheta / segments,\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\n        th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\n      fromX = result[i][4];\n      fromY = result[i][5];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    arcToSegmentsCache[argsString] = result;\n    return result;\n  }\n\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\n    var argsString2 = _join.call(arguments);\n    if (segmentToBezierCache[argsString2]) {\n      return segmentToBezierCache[argsString2];\n    }\n\n    var costh2 = Math.cos(th2),\n        sinth2 = Math.sin(th2),\n        costh3 = Math.cos(th3),\n        sinth3 = Math.sin(th3),\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    segmentToBezierCache[argsString2] = [\n      cp1X, cp1Y,\n      cp2X, cp2Y,\n      toX, toY\n    ];\n    return segmentToBezierCache[argsString2];\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n        tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    }\n    else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Draws arc\n   * @param {CanvasRenderingContext2D} ctx\n   * @param {Number} fx\n   * @param {Number} fy\n   * @param {Array} coords\n   */\n  fabric.util.drawArc = function(ctx, fx, fy, coords) {\n    var rx = coords[0],\n        ry = coords[1],\n        rot = coords[2],\n        large = coords[3],\n        sweep = coords[4],\n        tx = coords[5],\n        ty = coords[6],\n        segs = [[], [], [], []],\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segs[i][0] = segsNorm[i][0] + fx;\n      segs[i][1] = segsNorm[i][1] + fy;\n      segs[i][2] = segsNorm[i][2] + fx;\n      segs[i][3] = segsNorm[i][3] + fy;\n      segs[i][4] = segsNorm[i][4] + fx;\n      segs[i][5] = segsNorm[i][5] + fy;\n      ctx.bezierCurveTo.apply(ctx, segs[i]);\n    }\n  };\n\n  /**\n   * Calculate bounding box of a elliptic-arc\n   * @param {Number} fx start point of arc\n   * @param {Number} fy\n   * @param {Number} rx horizontal radius\n   * @param {Number} ry vertical radius\n   * @param {Number} rot angle of horizontal axe\n   * @param {Number} large 1 or 0, whatever the arc is the big or the small on the 2 points\n   * @param {Number} sweep 1 or 0, 1 clockwise or counterclockwise direction\n   * @param {Number} tx end point of arc\n   * @param {Number} ty\n   */\n  fabric.util.getBoundsOfArc = function(fx, fy, rx, ry, rot, large, sweep, tx, ty) {\n\n    var fromX = 0, fromY = 0, bound, bounds = [],\n        segs = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segs.length; i < len; i++) {\n      bound = getBoundsOfCurve(fromX, fromY, segs[i][0], segs[i][1], segs[i][2], segs[i][3], segs[i][4], segs[i][5]);\n      bounds.push({ x: bound[0].x + fx, y: bound[0].y + fy });\n      bounds.push({ x: bound[1].x + fx, y: bound[1].y + fy });\n      fromX = segs[i][4];\n      fromY = segs[i][5];\n    }\n    return bounds;\n  };\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of beizer\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString = _join.call(arguments);\n    if (boundsOfCurveCache[argsString]) {\n      return boundsOfCurveCache[argsString];\n    }\n\n    var sqrt = Math.sqrt,\n        min = Math.min, max = Math.max,\n        abs = Math.abs, tvalues = [],\n        bounds = [[], []],\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x, y, j = tvalues.length, jlen = j, mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n      bounds[0][j] = x;\n\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1])\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1])\n      }\n    ];\n    boundsOfCurveCache[argsString] = result;\n    return result;\n  }\n\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice;\n\n  /* _ES5_COMPAT_START_ */\n\n  if (!Array.prototype.indexOf) {\n    /**\n     * Finds index of an element in an array\n     * @param {*} searchElement\n     * @return {Number}\n     */\n    Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {\n      if (this === void 0 || this === null) {\n        throw new TypeError();\n      }\n      var t = Object(this), len = t.length >>> 0;\n      if (len === 0) {\n        return -1;\n      }\n      var n = 0;\n      if (arguments.length > 0) {\n        n = Number(arguments[1]);\n        if (n !== n) { // shortcut for verifying if it's NaN\n          n = 0;\n        }\n        else if (n !== 0 && n !== Number.POSITIVE_INFINITY && n !== Number.NEGATIVE_INFINITY) {\n          n = (n > 0 || -1) * Math.floor(Math.abs(n));\n        }\n      }\n      if (n >= len) {\n        return -1;\n      }\n      var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\n      for (; k < len; k++) {\n        if (k in t && t[k] === searchElement) {\n          return k;\n        }\n      }\n      return -1;\n    };\n  }\n\n  if (!Array.prototype.forEach) {\n    /**\n     * Iterates an array, invoking callback for each element\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Array}\n     */\n    Array.prototype.forEach = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          fn.call(context, this[i], i, this);\n        }\n      }\n    };\n  }\n\n  if (!Array.prototype.map) {\n    /**\n     * Returns a result of iterating over an array, invoking callback for each element\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Array}\n     */\n    Array.prototype.map = function(fn, context) {\n      var result = [];\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          result[i] = fn.call(context, this[i], i, this);\n        }\n      }\n      return result;\n    };\n  }\n\n  if (!Array.prototype.every) {\n    /**\n     * Returns true if a callback returns truthy value for all elements in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Boolean}\n     */\n    Array.prototype.every = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this && !fn.call(context, this[i], i, this)) {\n          return false;\n        }\n      }\n      return true;\n    };\n  }\n\n  if (!Array.prototype.some) {\n    /**\n     * Returns true if a callback returns truthy value for at least one element in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Boolean}\n     */\n    Array.prototype.some = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this && fn.call(context, this[i], i, this)) {\n          return true;\n        }\n      }\n      return false;\n    };\n  }\n\n  if (!Array.prototype.filter) {\n    /**\n     * Returns the result of iterating over elements in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Array}\n     */\n    Array.prototype.filter = function(fn, context) {\n      var result = [], val;\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          val = this[i]; // in case fn mutates this\n          if (fn.call(context, val, i, this)) {\n            result.push(val);\n          }\n        }\n      }\n      return result;\n    };\n  }\n\n  if (!Array.prototype.reduce) {\n    /**\n     * Returns \"folded\" (reduced) result of iterating over elements in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @return {*}\n     */\n    Array.prototype.reduce = function(fn /*, initial*/) {\n      var len = this.length >>> 0,\n          i = 0,\n          rv;\n\n      if (arguments.length > 1) {\n        rv = arguments[1];\n      }\n      else {\n        do {\n          if (i in this) {\n            rv = this[i++];\n            break;\n          }\n          // if array contains no values, no initial value to return\n          if (++i >= len) {\n            throw new TypeError();\n          }\n        }\n        while (true);\n      }\n      for (; i < len; i++) {\n        if (i in this) {\n          rv = fn.call(null, rv, this[i], i, this);\n        }\n      }\n      return rv;\n    };\n  }\n\n  /* _ES5_COMPAT_END_ */\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n\n})();\n\n\n(function() {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * Does not clone or extend fabric.Object subclasses.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      }\n      else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({ }, source[i], deep);\n        }\n      }\n      else if (source && typeof source === 'object') {\n        for (var property in source) {\n          if (source.hasOwnProperty(property)) {\n            destination[property] = extend({ }, source[property], deep);\n          }\n        }\n      }\n      else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    }\n    else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @memberOf fabric.util.object\n   * @param {Object} object Object to clone\n   * @return {Object}\n   */\n  function clone(object, deep) {\n    return extend({ }, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n\n})();\n\n\n(function() {\n\n  /* _ES5_COMPAT_START_ */\n  if (!String.prototype.trim) {\n    /**\n     * Trims a string (removing whitespace from the beginning and the end)\n     * @function external:String#trim\n     * @see <a href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String/Trim\">String#trim on MDN</a>\n     */\n    String.prototype.trim = function () {\n      // this trim is not fully ES3 or ES5 compliant, but it should cover most cases for now\n      return this.replace(/^[\\s\\xA0]+/, '').replace(/[\\s\\xA0]+$/, '');\n    };\n  }\n  /* _ES5_COMPAT_END_ */\n\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function(match, character) {\n      return character ? character.toUpperCase() : '';\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string.replace(/&/g, '&amp;')\n       .replace(/\"/g, '&quot;')\n       .replace(/'/g, '&apos;')\n       .replace(/</g, '&lt;')\n       .replace(/>/g, '&gt;');\n  }\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml\n  };\n})();\n\n\n/* _ES5_COMPAT_START_ */\n(function() {\n\n  var slice = Array.prototype.slice,\n      apply = Function.prototype.apply,\n      Dummy = function() { };\n\n  if (!Function.prototype.bind) {\n    /**\n     * Cross-browser approximation of ES5 Function.prototype.bind (not fully spec conforming)\n     * @see <a href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind\">Function#bind on MDN</a>\n     * @param {Object} thisArg Object to bind function to\n     * @param {Any[]} Values to pass to a bound function\n     * @return {Function}\n     */\n    Function.prototype.bind = function(thisArg) {\n      var _this = this, args = slice.call(arguments, 1), bound;\n      if (args.length) {\n        bound = function() {\n          return apply.call(_this, this instanceof Dummy ? this : thisArg, args.concat(slice.call(arguments)));\n        };\n      }\n      else {\n        /** @ignore */\n        bound = function() {\n          return apply.call(_this, this instanceof Dummy ? this : thisArg, arguments);\n        };\n      }\n      Dummy.prototype = this.prototype;\n      bound.prototype = new Dummy();\n\n      return bound;\n    };\n  }\n\n})();\n/* _ES5_COMPAT_END_ */\n\n\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { },\n\n      IS_DONTENUM_BUGGY = (function() {\n        for (var p in { toString: 1 }) {\n          if (p === 'toString') {\n            return false;\n          }\n        }\n        return true;\n      })(),\n\n      /** @ignore */\n      addMethods = function(klass, source, parent) {\n        for (var property in source) {\n\n          if (property in klass.prototype &&\n              typeof klass.prototype[property] === 'function' &&\n              (source[property] + '').indexOf('callSuper') > -1) {\n\n            klass.prototype[property] = (function(property) {\n              return function() {\n\n                var superclass = this.constructor.superclass;\n                this.constructor.superclass = parent;\n                var returnValue = source[property].apply(this, arguments);\n                this.constructor.superclass = superclass;\n\n                if (property !== 'initialize') {\n                  return returnValue;\n                }\n              };\n            })(property);\n          }\n          else {\n            klass.prototype[property] = source[property];\n          }\n\n          if (IS_DONTENUM_BUGGY) {\n            if (source.toString !== Object.prototype.toString) {\n              klass.prototype.toString = source.toString;\n            }\n            if (source.valueOf !== Object.prototype.valueOf) {\n              klass.prototype.valueOf = source.valueOf;\n            }\n          }\n        }\n      };\n\n  function Subclass() { }\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n        _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\n    }\n\n    return (arguments.length > 1)\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n\n\n(function () {\n\n  var unknown = 'unknown';\n\n  /* EVENT HANDLING */\n\n  function areHostMethods(object) {\n    var methodNames = Array.prototype.slice.call(arguments, 1),\n        t, i, len = methodNames.length;\n    for (i = 0; i < len; i++) {\n      t = typeof object[methodNames[i]];\n      if (!(/^(?:function|object|unknown)$/).test(t)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /** @ignore */\n  var getElement,\n      setElement,\n      getUniqueId = (function () {\n        var uid = 0;\n        return function (element) {\n          return element.__uniqueID || (element.__uniqueID = 'uniqueID__' + uid++);\n        };\n      })();\n\n  (function () {\n    var elements = { };\n    /** @ignore */\n    getElement = function (uid) {\n      return elements[uid];\n    };\n    /** @ignore */\n    setElement = function (uid, element) {\n      elements[uid] = element;\n    };\n  })();\n\n  function createListener(uid, handler) {\n    return {\n      handler: handler,\n      wrappedHandler: createWrappedHandler(uid, handler)\n    };\n  }\n\n  function createWrappedHandler(uid, handler) {\n    return function (e) {\n      handler.call(getElement(uid), e || fabric.window.event);\n    };\n  }\n\n  function createDispatcher(uid, eventName) {\n    return function (e) {\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          handlersForEvent[i].call(this, e || fabric.window.event);\n        }\n      }\n    };\n  }\n\n  var shouldUseAddListenerRemoveListener = (\n        areHostMethods(fabric.document.documentElement, 'addEventListener', 'removeEventListener') &&\n        areHostMethods(fabric.window, 'addEventListener', 'removeEventListener')),\n\n      shouldUseAttachEventDetachEvent = (\n        areHostMethods(fabric.document.documentElement, 'attachEvent', 'detachEvent') &&\n        areHostMethods(fabric.window, 'attachEvent', 'detachEvent')),\n\n      // IE branch\n      listeners = { },\n\n      // DOM L0 branch\n      handlers = { },\n\n      addListener, removeListener;\n\n  if (shouldUseAddListenerRemoveListener) {\n    /** @ignore */\n    addListener = function (element, eventName, handler, options) {\n      // since ie10 or ie9 can use addEventListener but they do not support options, i need to check\n      element.addEventListener(eventName, handler, shouldUseAttachEventDetachEvent ? false : options);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler, options) {\n      element.removeEventListener(eventName, handler, shouldUseAttachEventDetachEvent ? false : options);\n    };\n  }\n\n  else if (shouldUseAttachEventDetachEvent) {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element);\n      setElement(uid, element);\n      if (!listeners[uid]) {\n        listeners[uid] = { };\n      }\n      if (!listeners[uid][eventName]) {\n        listeners[uid][eventName] = [];\n\n      }\n      var listener = createListener(uid, handler);\n      listeners[uid][eventName].push(listener);\n      element.attachEvent('on' + eventName, listener.wrappedHandler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element), listener;\n      if (listeners[uid] && listeners[uid][eventName]) {\n        for (var i = 0, len = listeners[uid][eventName].length; i < len; i++) {\n          listener = listeners[uid][eventName][i];\n          if (listener && listener.handler === handler) {\n            element.detachEvent('on' + eventName, listener.wrappedHandler);\n            listeners[uid][eventName][i] = null;\n          }\n        }\n      }\n    };\n  }\n  else {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element);\n      if (!handlers[uid]) {\n        handlers[uid] = { };\n      }\n      if (!handlers[uid][eventName]) {\n        handlers[uid][eventName] = [];\n        var existingHandler = element['on' + eventName];\n        if (existingHandler) {\n          handlers[uid][eventName].push(existingHandler);\n        }\n        element['on' + eventName] = createDispatcher(uid, eventName);\n      }\n      handlers[uid][eventName].push(handler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      var uid = getUniqueId(element);\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          if (handlersForEvent[i] === handler) {\n            handlersForEvent.splice(i, 1);\n          }\n        }\n      }\n    };\n  }\n\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = addListener;\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = removeListener;\n\n  /**\n   * Cross-browser wrapper for getting event's coordinates\n   * @memberOf fabric.util\n   * @param {Event} event Event object\n   */\n  function getPointer(event) {\n    event || (event = fabric.window.event);\n\n    var element = event.target ||\n                  (typeof event.srcElement !== unknown ? event.srcElement : null),\n\n        scroll = fabric.util.getScrollLeftTop(element);\n\n    return {\n      x: pointerX(event) + scroll.left,\n      y: pointerY(event) + scroll.top\n    };\n  }\n\n  var pointerX = function(event) {\n    // looks like in IE (<9) clientX at certain point (apparently when mouseup fires on VML element)\n    // is represented as COM object, with all the consequences, like \"unknown\" type and error on [[Get]]\n    // need to investigate later\n        return (typeof event.clientX !== unknown ? event.clientX : 0);\n      },\n\n      pointerY = function(event) {\n        return (typeof event.clientY !== unknown ? event.clientY : 0);\n      };\n\n  function _getPointer(event, pageProp, clientProp) {\n    var touchProp = event.type === 'touchend' ? 'changedTouches' : 'touches';\n\n    return (event[touchProp] && event[touchProp][0]\n      ? (event[touchProp][0][pageProp] - (event[touchProp][0][pageProp] - event[touchProp][0][clientProp]))\n        || event[clientProp]\n      : event[clientProp]);\n  }\n\n  if (fabric.isTouchSupported) {\n    pointerX = function(event) {\n      return _getPointer(event, 'pageX', 'clientX');\n    };\n    pointerY = function(event) {\n      return _getPointer(event, 'pageY', 'clientY');\n    };\n  }\n\n  fabric.util.getPointer = getPointer;\n\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n\n})();\n\n\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle[normalizedProperty] = styles[property];\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n\n\n(function() {\n\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n      /**\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\n       * @memberOf fabric.util\n       * @param {Object} arrayLike\n       * @return {Array}\n       */\n      toArray = function(arrayLike) {\n        return _slice.call(arrayLike, 0);\n      };\n\n  try {\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch (err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n\n    var left = 0,\n        top = 0,\n        docElement = fabric.document.documentElement,\n        body = fabric.document.body || {\n          scrollLeft: 0, scrollTop: 0\n        };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop ||  docElement.scrollTop || 0;\n      }\n      else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 &&\n          fabric.util.getElementStyle(element, 'position') === 'fixed') {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n        doc = element && element.ownerDocument,\n        box = { left: 0, top: 0 },\n        offset = { left: 0, top: 0 },\n        scrollLeftTop,\n        offsetAttributes = {\n          borderLeftWidth: 'left',\n          borderTopWidth:  'top',\n          paddingLeft:     'left',\n          paddingTop:      'top'\n        };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\n    getElementStyle = function(element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  }\n  else {\n    getElementStyle = function(element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n        selectProp = 'userSelect' in style\n          ? 'userSelect'\n          : 'MozUserSelect' in style\n            ? 'MozUserSelect'\n            : 'WebkitUserSelect' in style\n              ? 'WebkitUserSelect'\n              : 'KhtmlUserSelect' in style\n                ? 'KhtmlUserSelect'\n                : '';\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  (function() {\n\n    /**\n     * Inserts a script element with a given url into a document; invokes callback, when that script is finished loading\n     * @memberOf fabric.util\n     * @param {String} url URL of a script to load\n     * @param {Function} callback Callback to execute when script is finished loading\n     */\n    function getScript(url, callback) {\n      var headEl = fabric.document.getElementsByTagName('head')[0],\n          scriptEl = fabric.document.createElement('script'),\n          loading = true;\n\n      /** @ignore */\n      scriptEl.onload = /** @ignore */ scriptEl.onreadystatechange = function(e) {\n        if (loading) {\n          if (typeof this.readyState === 'string' &&\n              this.readyState !== 'loaded' &&\n              this.readyState !== 'complete') {\n            return;\n          }\n          loading = false;\n          callback(e || fabric.window.event);\n          scriptEl = scriptEl.onload = scriptEl.onreadystatechange = null;\n        }\n      };\n      scriptEl.src = url;\n      headEl.appendChild(scriptEl);\n      // causes issue in Opera\n      // headEl.removeChild(scriptEl);\n    }\n\n    fabric.util.getScript = getScript;\n  })();\n\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.makeElement = makeElement;\n  fabric.util.addClass = addClass;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getElementStyle = getElementStyle;\n\n})();\n\n\n(function() {\n\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n\n  var makeXHR = (function() {\n    var factories = [\n      function() { return new ActiveXObject('Microsoft.XMLHTTP'); },\n      function() { return new ActiveXObject('Msxml2.XMLHTTP'); },\n      function() { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); },\n      function() { return new XMLHttpRequest(); }\n    ];\n    for (var i = factories.length; i--; ) {\n      try {\n        var req = factories[i]();\n        if (req) {\n          return factories[i];\n        }\n      }\n      catch (err) { }\n    }\n  })();\n\n  function emptyFn() { }\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        xhr = makeXHR(),\n        body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters === 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === 'POST' || method === 'PUT') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n\n\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = function() { };\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = function() { };\n\n/* eslint-disable */\nif (typeof console !== 'undefined') {\n\n  ['log', 'warn'].forEach(function(methodName) {\n\n    if (typeof console[methodName] !== 'undefined' &&\n        typeof console[methodName].apply === 'function') {\n\n      fabric[methodName] = function() {\n        return console[methodName].apply(console, arguments);\n      };\n    }\n  });\n}\n/* eslint-enable */\n\n\n(function() {\n\n  function noop() {\n    return false;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Number} [options.startValue=0] Starting value\n   * @param {Number} [options.endValue=100] Ending value\n   * @param {Number} [options.byValue=100] Value to modify the property by\n   * @param {Function} [options.easing] Easing function\n   * @param {Number} [options.duration=500] Duration of change (in ms)\n   */\n  function animate(options) {\n\n    requestAnimFrame(function(timestamp) {\n      options || (options = { });\n\n      var start = timestamp || +new Date(),\n          duration = options.duration || 500,\n          finish = start + duration, time,\n          onChange = options.onChange || noop,\n          abort = options.abort || noop,\n          onComplete = options.onComplete || noop,\n          easing = options.easing || function(t, b, c, d) {return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;},\n          startValue = 'startValue' in options ? options.startValue : 0,\n          endValue = 'endValue' in options ? options.endValue : 100,\n          byValue = options.byValue || endValue - startValue;\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        if (abort()) {\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : (time - start),\n            timePerc = currentTime / duration,\n            current = easing(currentTime, startValue, byValue, duration),\n            valuePerc = Math.abs((current - startValue) / byValue);\n        onChange(current, valuePerc, timePerc);\n        if (time > finish) {\n          options.onComplete && options.onComplete();\n          return;\n        }\n        requestAnimFrame(tick);\n      })(start);\n    });\n\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback) {\n                            fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n\n})();\n\n\n(function() {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color = 'rgba('\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\n\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += ')';\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n        endColor = new fabric.Color(toColor).getSource();\n\n    options = options || {};\n\n    fabric.util.animate(fabric.util.object.extend(options, {\n      duration: duration || 500,\n      startValue: startColor,\n      endValue: endColor,\n      byValue: endColor,\n      easing: function (currentTime, startValue, byValue, duration) {\n        var posValue = options.colorEasing\n              ? options.colorEasing(currentTime, duration)\n              : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\n        return calculateColor(startValue, byValue, posValue);\n      }\n    }));\n  }\n\n  fabric.util.animateColor = animateColor;\n\n})();\n\n\n(function() {\n\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    }\n    else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = p / (2 * Math.PI) * Math.asin(1);\n      }\n      else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t + b;\n    }\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n    }\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < (1 / 2.75)) {\n      return c * (7.5625 * t * t) + b;\n    }\n    else if (t < (2 / 2.75)) {\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n    }\n    else if (t < (2.5 / 2.75)) {\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n    }\n    else {\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function(t, b, c, d) {\n      t /= (d / 2);\n      if (t < 1) {\n        return c / 2 * t * t + b;\n      }\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      parseUnit = fabric.util.parseUnit,\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n\n      reAllowedSVGTagNames = /^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,\n      reViewBoxTagNames = /^(symbol|image|marker|pattern|view|svg)$/i,\n      reNotAllowedAncestors = /^(?:pattern|defs|symbol|metadata|clipPath|mask)$/i,\n      reAllowedParents = /^(symbol|g|a|svg)$/i,\n\n      attributesMap = {\n        cx:                   'left',\n        x:                    'left',\n        r:                    'radius',\n        cy:                   'top',\n        y:                    'top',\n        display:              'visible',\n        visibility:           'visible',\n        transform:            'transformMatrix',\n        'fill-opacity':       'fillOpacity',\n        'fill-rule':          'fillRule',\n        'font-family':        'fontFamily',\n        'font-size':          'fontSize',\n        'font-style':         'fontStyle',\n        'font-weight':        'fontWeight',\n        'stroke-dasharray':   'strokeDashArray',\n        'stroke-linecap':     'strokeLineCap',\n        'stroke-linejoin':    'strokeLineJoin',\n        'stroke-miterlimit':  'strokeMiterLimit',\n        'stroke-opacity':     'strokeOpacity',\n        'stroke-width':       'strokeWidth',\n        'text-decoration':    'textDecoration',\n        'text-anchor':        'originX',\n        opacity:              'opacity'\n      },\n\n      colorAttributes = {\n        stroke: 'strokeOpacity',\n        fill:   'fillOpacity'\n      };\n\n  fabric.cssRules = { };\n  fabric.gradientDefs = { };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Object.prototype.toString.call(value) === '[object Array]',\n        parsed;\n\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n      value = '';\n    }\n    else if (attr === 'strokeDashArray') {\n      if (value === 'none') {\n        value = null;\n      }\n      else {\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(function(n) {\n          return parseFloat(n);\n        });\n      }\n    }\n    else if (attr === 'transformMatrix') {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\n      }\n      else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    }\n    else if (attr === 'visible') {\n      value = (value === 'none' || value === 'hidden') ? false : true;\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    }\n    else if (attr === 'opacity') {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\n        value *= parentAttributes.opacity;\n      }\n    }\n    else if (attr === 'originX' /* text-anchor */) {\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\n    }\n    else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return (!isArray && isNaN(parsed) ? value : parsed);\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\n        continue;\n      }\n\n      if (typeof attributes[attr] === 'undefined') {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf('url(') === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName, nodeArray = [], nodeList;\n    for (var i = 0; i < nodeNames.length; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var cos = Math.cos(args[0]), sin = Math.sin(args[0]),\n          x = 0, y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = [\n          1, // a\n          0, // b\n          0, // c\n          1, // d\n          0, // e\n          0  // f\n        ],\n\n        // == begin transform regexp\n        number = fabric.reNum,\n\n        commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)',\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + ')' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\n\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transformList),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform, 'g');\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n          matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              // match !== '' && match != null\n              return (!!match);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewMatrix(matrix, args, 2);\n            break;\n          case 'skewY':\n            skewMatrix(matrix, args, 1);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\n      var pair = chunk.split(':');\n\n      attr = pair[0].trim().toLowerCase();\n      value =  pair[1].trim();\n\n      oStyle[attr] = value;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === 'undefined') {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = { };\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(' '))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching, parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && (selectors.length === 0);\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector, parentMatching = true;\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n        classNames = element.getAttribute('class'),\n        id = element.getAttribute('id'), matcher;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp('^' + nodeName, 'i');\n    selector = selector.replace(matcher, '');\n    if (id && selector.length) {\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\n      selector = selector.replace(matcher, '');\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(' ');\n      for (var i = classNames.length; i--;) {\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\n        selector = selector.replace(matcher, '');\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node, i, nodelist = doc.getElementsByTagName('*');\n    for (i = 0; i < nodelist.length; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute('id')) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\n\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n          xlink = el.getAttribute('xlink:href').substr(1),\n          x = el.getAttribute('x') || 0,\n          y = el.getAttribute('y') || 0,\n          el2 = elementById(doc, xlink).cloneNode(true),\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\n          parentNode, oldLength = nodelist.length, attr, j, attrs, l;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElement('g');\n        for (j = 0, attrs = el2.attributes, l = attrs.length; j < l; j++) {\n          attr = attrs.item(j);\n          el3.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, l = attrs.length; j < l; j++) {\n        attr = attrs.item(j);\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' || attr.nodeName === 'xlink:href') {\n          continue;\n        }\n\n        if (attr.nodeName === 'transform') {\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\n        }\n        else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute('transform', currentTrans);\n      el2.setAttribute('instantiated_by_use', '1');\n      el2.removeAttribute('id');\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    '^' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\n    '$'\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n\n    var viewBoxAttr = element.getAttribute('viewBox'),\n        scaleX = 1,\n        scaleY = 1,\n        minX = 0,\n        minY = 0,\n        viewBoxWidth, viewBoxHeight, matrix, el,\n        widthAttr = element.getAttribute('width'),\n        heightAttr = element.getAttribute('height'),\n        x = element.getAttribute('x') || 0,\n        y = element.getAttribute('y') || 0,\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\n        missingViewBox = (!viewBoxAttr || !reViewBoxTagNames.test(element.nodeName)\n                           || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\n        toBeParsed = missingViewBox && missingDimAttr,\n        parsedDim = { }, translateMatrix = '';\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      return parsedDim;\n    }\n\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    }\n    else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\n    if (preserveAspectRatio.alignX !== 'none') {\n      //translate all container for the effect of Mid, Min, Max\n      scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\n    }\n\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\n      return parsedDim;\n    }\n\n    if (x || y) {\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n    }\n\n    matrix = translateMatrix + ' matrix(' + scaleX +\n                  ' 0' +\n                  ' 0 ' +\n                  scaleY + ' ' +\n                  (minX * scaleX) + ' ' +\n                  (minY * scaleY) + ') ';\n\n    if (element.nodeName === 'svg') {\n      el = element.ownerDocument.createElement('g');\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    }\n    else {\n      el = element;\n      matrix = el.getAttribute('transform') + matrix;\n    }\n\n    el.setAttribute('transform', matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\n        && !element.getAttribute('instantiated_by_use')) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid =  fabric.Object.__uid++,\n        options = applyViewboxTransform(doc),\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (var i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function(el) {\n      applyViewboxTransform(el);\n      return reAllowedSVGTagNames.test(el.nodeName.replace('svg:', '')) &&\n            !hasAncestorWithNodeName(el, reNotAllowedAncestors); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(elements, function(instances) {\n      if (callback) {\n        callback(instances, options);\n      }\n    }, clone(options), reviver, parsingOptions);\n  };\n\n  var reFontDeclaration = new RegExp(\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\n      fabric.reNum +\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function(value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n          // font variant is not used\n          // fontVariant = match[2],\n          fontWeight = match[3],\n          fontSize = match[4],\n          lineHeight = match[5],\n          fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function(doc) {\n      var tagArray = [\n            'linearGradient',\n            'radialGradient',\n            'svg:linearGradient',\n            'svg:radialGradient'],\n          elList = _getMultipleNodes(doc, tagArray),\n          el, j = 0, id, xlink,\n          gradientDefs = { }, idsToXlinkMap = { };\n\n      j = elList.length;\n\n      while (j--) {\n        el = elList[j];\n        xlink = el.getAttribute('xlink:href');\n        id = el.getAttribute('id');\n        if (xlink) {\n          idsToXlinkMap[id] = xlink.substr(1);\n        }\n        gradientDefs[id] = el;\n      }\n\n      for (id in idsToXlinkMap) {\n        var el2 = gradientDefs[idsToXlinkMap[id]].cloneNode(true);\n        el = gradientDefs[id];\n        while (el2.firstChild) {\n          el.appendChild(el2.firstChild);\n        }\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function(element, attributes, svgUid) {\n\n      if (!element) {\n        return;\n      }\n\n      var value,\n          parentAttributes = { },\n          fontSize;\n\n      if (typeof svgUid === 'undefined') {\n        svgUid = element.getAttribute('svgUid');\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (element.parentNode && reAllowedParents.test(element.parentNode.nodeName)) {\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\n      }\n      fontSize = (parentAttributes && parentAttributes.fontSize ) ||\n                 element.getAttribute('font-size') || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n\n      var ownAttributes = attributes.reduce(function(memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) { // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, { });\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      ownAttributes = extend(ownAttributes,\n        extend(getGlobalStylesForElement(element, svgUid), fabric.parseStyleAttribute(element)));\n\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return reAllowedParents.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function(element) {\n      var oStyle = { },\n          style = element.getAttribute('style');\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === 'string') {\n        parseStyleString(style, oStyle);\n      }\n      else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function(points) {\n\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, ' ').trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [], i, len;\n\n      i = 0;\n      len = points.length;\n      for (; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1])\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function(doc) {\n      var styles = doc.getElementsByTagName('style'),\n          allRules = { }, rules;\n\n      // very crude parsing of style contents\n      for (var i = 0, len = styles.length; i < len; i++) {\n        // IE9 doesn't support textContent, but provides text instead.\n        var styleContents = styles[i].textContent || styles[i].text;\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n        if (styleContents.trim() === '') {\n          continue;\n        }\n        rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = rules.map(function(rule) { return rule.trim(); });\n        rules.forEach(function(rule) {\n\n          var match = rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),\n              ruleObj = { }, declaration = match[2].trim(),\n              propertyValuePairs = declaration.replace(/;$/, '').split(/\\s*;\\s*/);\n\n          for (var i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(/\\s*:\\s*/),\n                property = pair[0],\n                value = pair[1];\n            ruleObj[property] = value;\n          }\n          rule = match[1];\n          rule.split(',').forEach(function(_rule) {\n            _rule = _rule.replace(/^svg/i, '').trim();\n            if (_rule === '') {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            }\n            else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function(url, callback, reviver, options) {\n\n      url = url.replace(/^\\n\\s*/, '').trim();\n      new fabric.util.request(url, {\n        method: 'get',\n        onComplete: onComplete\n      });\n\n      function onComplete(r) {\n\n        var xml = r.responseXML;\n        if (xml && !xml.documentElement && fabric.window.ActiveXObject && r.responseText) {\n          xml = new ActiveXObject('Microsoft.XMLDOM');\n          xml.async = 'false';\n          //IE chokes on DOCTYPE\n          xml.loadXML(r.responseText.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i, ''));\n        }\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n        }\n\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options) {\n          callback && callback(results, _options);\n        }, reviver, options);\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function(string, callback, reviver, options) {\n      string = string.trim();\n      var doc;\n      if (typeof DOMParser !== 'undefined') {\n        var parser = new DOMParser();\n        if (parser && parser.parseFromString) {\n          doc = parser.parseFromString(string, 'text/xml');\n        }\n      }\n      else if (fabric.window.ActiveXObject) {\n        doc = new ActiveXObject('Microsoft.XMLDOM');\n        doc.async = 'false';\n        // IE chokes on DOCTYPE\n        doc.loadXML(string.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i, ''));\n      }\n\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options) {\n        callback(results, _options);\n      }, reviver, options);\n    }\n  });\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n};\n\nfabric.ElementsParser.prototype.parse = function() {\n  this.instances = new Array(this.elements.length);\n  this.numElements = this.elements.length;\n\n  this.createObjects();\n};\n\nfabric.ElementsParser.prototype.createObjects = function() {\n  for (var i = 0, len = this.elements.length; i < len; i++) {\n    this.elements[i].setAttribute('svgUid', this.svgUid);\n    (function(_obj, i) {\n      setTimeout(function() {\n        _obj.createObject(_obj.elements[i], i);\n      }, 0);\n    })(this, i);\n  }\n};\n\nfabric.ElementsParser.prototype.createObject = function(el, index) {\n  var klass = fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\n  if (klass && klass.fromElement) {\n    try {\n      this._createObject(klass, el, index);\n    }\n    catch (err) {\n      fabric.log(err);\n    }\n  }\n  else {\n    this.checkIfDone();\n  }\n};\n\nfabric.ElementsParser.prototype._createObject = function(klass, el, index) {\n  if (klass.async) {\n    klass.fromElement(el, this.createCallback(index, el), this.options);\n  }\n  else {\n    var obj = klass.fromElement(el, this.options);\n    this.resolveGradient(obj, 'fill');\n    this.resolveGradient(obj, 'stroke');\n    this.reviver && this.reviver(el, obj);\n    this.instances[index] = obj;\n    this.checkIfDone();\n  }\n};\n\nfabric.ElementsParser.prototype.createCallback = function(index, el) {\n  var _this = this;\n  return function(obj) {\n    _this.resolveGradient(obj, 'fill');\n    _this.resolveGradient(obj, 'stroke');\n    _this.reviver && _this.reviver(el, obj);\n    _this.instances[index] = obj;\n    _this.checkIfDone();\n  };\n};\n\nfabric.ElementsParser.prototype.resolveGradient = function(obj, property) {\n\n  var instanceFillValue = obj.get(property);\n  if (!(/^url\\(/).test(instanceFillValue)) {\n    return;\n  }\n  var gradientId = instanceFillValue.slice(5, instanceFillValue.length - 1);\n  if (fabric.gradientDefs[this.svgUid][gradientId]) {\n    obj.set(property,\n      fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][gradientId], obj));\n  }\n};\n\nfabric.ElementsParser.prototype.checkIfDone = function() {\n  if (--this.numElements === 0) {\n    this.instances = this.instances.filter(function(el) {\n      // eslint-disable-next-line no-eq-null, eqeqeq\n      return el != null;\n    });\n    this.callback(this.instances);\n  }\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {\n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n\n    type: 'point',\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Miltiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Miltiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return (this.x === that.x && this.y === that.y);\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n\n    /**\n\n     * Returns true if this point is greater another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === 'undefined') {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + ',' + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    }\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n          ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection('Intersection');\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection();\n      }\n    }\n    else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection('Coincident');\n      }\n      else {\n        result = new Intersection('Parallel');\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\n    var result = new Intersection(),\n        length = points.length,\n        b1, b2, inter;\n\n    for (var i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n        length = points1.length;\n\n    for (var i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i + 1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function(color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === 'transparent') {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function(r, g, b) {\n      r /= 255; g /= 255; b /= 255;\n\n      var h, s, l,\n          max = fabric.util.array.max([r, g, b]),\n          min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      }\n      else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [\n        Math.round(h * 360),\n        Math.round(s * 100),\n        Math.round(l * 100)\n      ];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource(), r, g, b;\n\n      r = source[0].toString(16);\n      r = (r.length === 1) ? ('0' + r) : r;\n\n      g = source[1].toString(16);\n      g = (g.length === 1) ? ('0' + g) : g;\n\n      b = source[2].toString(16);\n      b = (b.length === 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function() {\n      var source = this.getSource(), a;\n\n      a = source[3] * 255;\n      a = a.toString(16);\n      a = (a.length === 1) ? ('0' + a) : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource();\n\n      for (var i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n   // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 17 basic color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: http://www.w3.org/TR/CSS2/syndata.html#color-units\n   */\n  fabric.Color.colorNameMap = {\n    aqua:    '#00FFFF',\n    black:   '#000000',\n    blue:    '#0000FF',\n    fuchsia: '#FF00FF',\n    gray:    '#808080',\n    grey:    '#808080',\n    green:   '#008000',\n    lime:    '#00FF00',\n    maroon:  '#800000',\n    navy:    '#000080',\n    olive:   '#808000',\n    orange:  '#FFA500',\n    purple:  '#800080',\n    red:     '#FF0000',\n    silver:  '#C0C0C0',\n    teal:    '#008080',\n    white:   '#FFFFFF',\n    yellow:  '#FFFF00'\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function(color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function(color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n        r, g, b;\n\n    if (s === 0) {\n      r = g = b = l;\n    }\n    else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n          p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3 || value.length === 4),\n          isRGBa = (value.length === 8 || value.length === 4),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /* _FROM_SVG_START_ */\n  function getColorStop(el) {\n    var style = el.getAttribute('style'),\n        offset = el.getAttribute('offset') || 0,\n        color, colorAlpha, opacity;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (var i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          color = value;\n        }\n        else if (key === 'stop-opacity') {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\n    }\n    if (!opacity) {\n      opacity = el.getAttribute('stop-opacity');\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute('x1') || 0,\n      y1: el.getAttribute('y1') || 0,\n      x2: el.getAttribute('x2') || '100%',\n      y2: el.getAttribute('y2') || 0\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\n      r1: 0,\n      x2: el.getAttribute('cx') || '50%',\n      y2: el.getAttribute('cy') || '50%',\n      r2: el.getAttribute('r') || '50%'\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\n\n    /**\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object with type, coords, gradientUnits and colorStops\n     * @return {fabric.Gradient} thisArg\n     */\n    initialize: function(options) {\n      options || (options = { });\n\n      var coords = { };\n\n      this.id = fabric.Object.__uid++;\n      this.type = options.type || 'linear';\n\n      coords = {\n        x1: options.coords.x1 || 0,\n        y1: options.coords.y1 || 0,\n        x2: options.coords.x2 || 0,\n        y2: options.coords.y2 || 0\n      };\n\n      if (this.type === 'radial') {\n        coords.r1 = options.coords.r1 || 0;\n        coords.r2 = options.coords.r2 || 0;\n      }\n      this.coords = coords;\n      this.colorStops = options.colorStops.slice();\n      if (options.gradientTransform) {\n        this.gradientTransform = options.gradientTransform;\n      }\n      this.offsetX = options.offsetX || this.offsetX;\n      this.offsetY = options.offsetY || this.offsetY;\n    },\n\n    /**\n     * Adds another colorStop\n     * @param {Object} colorStop Object with offset and color\n     * @return {fabric.Gradient} thisArg\n     */\n    addColorStop: function(colorStops) {\n      for (var position in colorStops) {\n        var color = new fabric.Color(colorStops[position]);\n        this.colorStops.push({\n          offset: parseFloat(position),\n          color: color.toRgb(),\n          opacity: color.getAlpha()\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Returns object representation of a gradient\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object}\n     */\n    toObject: function(propertiesToInclude) {\n      var object = {\n        type: this.type,\n        coords: this.coords,\n        colorStops: this.colorStops,\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an gradient\n     * @param {Object} object Object to create a gradient for\n     * @return {String} SVG representation of an gradient (linear/radial)\n     */\n    toSVG: function(object) {\n      var coords = clone(this.coords, true),\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2;\n      // colorStops must be sorted ascending\n      colorStops.sort(function(a, b) {\n        return a.offset - b.offset;\n      });\n\n      if (!(object.group && object.group.type === 'path-group')) {\n        for (var prop in coords) {\n          if (prop === 'x1' || prop === 'x2') {\n            coords[prop] += this.offsetX - object.width / 2;\n          }\n          else if (prop === 'y1' || prop === 'y2') {\n            coords[prop] += this.offsetY - object.height / 2;\n          }\n        }\n      }\n\n      commonAttributes = 'id=\"SVGID_' + this.id +\n                     '\" gradientUnits=\"userSpaceOnUse\"';\n      if (this.gradientTransform) {\n        commonAttributes += ' gradientTransform=\"matrix(' + this.gradientTransform.join(' ') + ')\" ';\n      }\n      if (this.type === 'linear') {\n        markup = [\n          '<linearGradient ',\n          commonAttributes,\n          ' x1=\"', coords.x1,\n          '\" y1=\"', coords.y1,\n          '\" x2=\"', coords.x2,\n          '\" y2=\"', coords.y2,\n          '\">\\n'\n        ];\n      }\n      else if (this.type === 'radial') {\n        // svg radial gradient has just 1 radius. the biggest.\n        markup = [\n          '<radialGradient ',\n          commonAttributes,\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\n          '\">\\n'\n        ];\n      }\n\n      if (this.type === 'radial') {\n        if (needsSwap) {\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\n          colorStops = colorStops.concat();\n          colorStops.reverse();\n          for (var i = 0; i < colorStops.length; i++) {\n            colorStops[i].offset = 1 - colorStops[i].offset;\n          }\n        }\n        var minRadius = Math.min(coords.r1, coords.r2);\n        if (minRadius > 0) {\n          // i have to shift all colorStops and add new one in 0.\n          var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n          for (var i = 0; i < colorStops.length; i++) {\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\n          }\n        }\n      }\n\n      for (var i = 0; i < colorStops.length; i++) {\n        var colorStop = colorStops[i];\n        markup.push(\n          '<stop ',\n            'offset=\"', (colorStop.offset * 100) + '%',\n            '\" style=\"stop-color:', colorStop.color,\n            (colorStop.opacity !== null ? ';stop-opacity: ' + colorStop.opacity : ';'),\n          '\"/>\\n'\n        );\n      }\n\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\n\n      return markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns an instance of CanvasGradient\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} object\n     * @return {CanvasGradient}\n     */\n    toLive: function(ctx, object) {\n      var gradient, prop, coords = fabric.util.object.clone(this.coords);\n\n      if (!this.type) {\n        return;\n      }\n\n      if (object.group && object.group.type === 'path-group') {\n        for (prop in coords) {\n          if (prop === 'x1' || prop === 'x2') {\n            coords[prop] += -this.offsetX + object.width / 2;\n          }\n          else if (prop === 'y1' || prop === 'y2') {\n            coords[prop] += -this.offsetY + object.height / 2;\n          }\n        }\n      }\n\n      if (this.type === 'linear') {\n        gradient = ctx.createLinearGradient(\n          coords.x1, coords.y1, coords.x2, coords.y2);\n      }\n      else if (this.type === 'radial') {\n        gradient = ctx.createRadialGradient(\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\n      }\n\n      for (var i = 0, len = this.colorStops.length; i < len; i++) {\n        var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n        if (typeof opacity !== 'undefined') {\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\n        }\n        gradient.addColorStop(offset, color);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function(el, instance) {\n\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          type,\n          gradientUnits = el.getAttribute('gradientUnits') || 'objectBoundingBox',\n          gradientTransform = el.getAttribute('gradientTransform'),\n          colorStops = [],\n          coords, ellipseMatrix;\n\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\n        type = 'linear';\n      }\n      else {\n        type = 'radial';\n      }\n\n      if (type === 'linear') {\n        coords = getLinearCoords(el);\n      }\n      else if (type === 'radial') {\n        coords = getRadialCoords(el);\n      }\n\n      for (var i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i]));\n      }\n\n      ellipseMatrix = _convertPercentUnitsToValues(instance, coords, gradientUnits);\n\n      var gradient = new fabric.Gradient({\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        offsetX: -instance.left,\n        offsetY: -instance.top\n      });\n\n      if (gradientTransform || ellipseMatrix !== '') {\n        gradient.gradientTransform = fabric.parseTransformAttribute((gradientTransform || '') + ellipseMatrix);\n      }\n      return gradient;\n    },\n    /* _FROM_SVG_END_ */\n\n    /**\n     * Returns {@link fabric.Gradient} instance from its object representation\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {Object} obj\n     * @param {Object} [options] Options object\n     */\n    forObject: function(obj, options) {\n      options || (options = { });\n      _convertPercentUnitsToValues(obj, options.coords, 'userSpaceOnUse');\n      return new fabric.Gradient(options);\n    }\n  });\n\n  /**\n   * @private\n   */\n  function _convertPercentUnitsToValues(object, options, gradientUnits) {\n    var propValue, addFactor = 0, multFactor = 1, ellipseMatrix = '';\n    for (var prop in options) {\n      if (options[prop] === 'Infinity') {\n        options[prop] = 1;\n      }\n      else if (options[prop] === '-Infinity') {\n        options[prop] = 0;\n      }\n      propValue = parseFloat(options[prop], 10);\n      if (typeof options[prop] === 'string' && /^\\d+%$/.test(options[prop])) {\n        multFactor = 0.01;\n      }\n      else {\n        multFactor = 1;\n      }\n      if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\n        multFactor *= gradientUnits === 'objectBoundingBox' ? object.width : 1;\n        addFactor = gradientUnits === 'objectBoundingBox' ? object.left || 0 : 0;\n      }\n      else if (prop === 'y1' || prop === 'y2') {\n        multFactor *= gradientUnits === 'objectBoundingBox' ? object.height : 1;\n        addFactor = gradientUnits === 'objectBoundingBox' ? object.top || 0 : 0;\n      }\n      options[prop] = propValue * multFactor + addFactor;\n    }\n    if (object.type === 'ellipse' &&\n        options.r2 !== null &&\n        gradientUnits === 'objectBoundingBox' &&\n        object.rx !== object.ry) {\n\n      var scaleFactor = object.ry / object.rx;\n      ellipseMatrix = ' scale(1, ' + scaleFactor + ')';\n      if (options.y1) {\n        options.y1 /= scaleFactor;\n      }\n      if (options.y2) {\n        options.y2 /= scaleFactor;\n      }\n    }\n    return ellipseMatrix;\n  }\n})();\n\n\n(function() {\n\n  'use strict';\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\n\n    /**\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @type String\n     * @default\n     */\n    repeat: 'repeat',\n\n    /**\n     * Pattern horizontal offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Pattern vertical offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @param {Function} [callback] function to invoke after callback init.\n     * @return {fabric.Pattern} thisArg\n     */\n    initialize: function(options, callback) {\n      options || (options = { });\n\n      this.id = fabric.Object.__uid++;\n      this.setOptions(options);\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\n        callback && callback(this);\n        return;\n      }\n      // function string\n      if (typeof fabric.util.getFunctionBody(options.source) !== 'undefined') {\n        this.source = new Function(fabric.util.getFunctionBody(options.source));\n        callback && callback(this);\n      }\n      else {\n        // img src string\n        var _this = this;\n        this.source = fabric.util.createImage();\n        fabric.util.loadImage(options.source, function(img) {\n          _this.source = img;\n          callback && callback(_this);\n        });\n      }\n    },\n\n    /**\n     * Returns object representation of a pattern\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of a pattern instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source, object;\n\n      // callback\n      if (typeof this.source === 'function') {\n        source = String(this.source);\n      }\n      // <img> element\n      else if (typeof this.source.src === 'string') {\n        source = this.source.src;\n      }\n      // <canvas> element\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\n        source = this.source.toDataURL();\n      }\n\n      object = {\n        type: 'pattern',\n        source: source,\n        repeat: this.repeat,\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a pattern\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a pattern\n     */\n    toSVG: function(object) {\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = '';\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\n        patternHeight = 1;\n      }\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\n        patternWidth = 1;\n      }\n      if (patternSource.src) {\n        patternImgSrc = patternSource.src;\n      }\n      else if (patternSource.toDataURL) {\n        patternImgSrc = patternSource.toDataURL();\n      }\n\n      return '<pattern id=\"SVGID_' + this.id +\n                    '\" x=\"' + patternOffsetX +\n                    '\" y=\"' + patternOffsetY +\n                    '\" width=\"' + patternWidth +\n                    '\" height=\"' + patternHeight + '\">\\n' +\n               '<image x=\"0\" y=\"0\"' +\n                      ' width=\"' + patternSource.width +\n                      '\" height=\"' + patternSource.height +\n                      '\" xlink:href=\"' + patternImgSrc +\n               '\"></image>\\n' +\n             '</pattern>\\n';\n    },\n    /* _TO_SVG_END_ */\n\n    setOptions: function(options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Returns an instance of CanvasPattern\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\n     * @return {CanvasPattern}\n     */\n    toLive: function(ctx) {\n      var source = typeof this.source === 'function' ? this.source() : this.source;\n\n      // if the image failed to load, return, and allow rest to continue loading\n      if (!source) {\n        return '';\n      }\n\n      // if an image\n      if (typeof source.src !== 'undefined') {\n        if (!source.complete) {\n          return '';\n        }\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n          return '';\n        }\n      }\n      return ctx.createPattern(source, this.repeat);\n    }\n  });\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn('fabric.Shadow is already defined.');\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\n\n    /**\n     * Shadow color\n     * @type String\n     * @default\n     */\n    color: 'rgb(0,0,0)',\n\n    /**\n     * Shadow blur\n     * @type Number\n     */\n    blur: 0,\n\n    /**\n     * Shadow horizontal offset\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Shadow vertical offset\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Whether the shadow should affect stroke operations\n     * @type Boolean\n     * @default\n     */\n    affectStroke: false,\n\n    /**\n     * Indicates whether toObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Constructor\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetX properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px, \"2px 2px 10px rgba(0,0,0,0.2)\")\n     * @return {fabric.Shadow} thisArg\n     */\n    initialize: function(options) {\n\n      if (typeof options === 'string') {\n        options = this._parseShadow(options);\n      }\n\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.id = fabric.Object.__uid++;\n    },\n\n    /**\n     * @private\n     * @param {String} shadow Shadow value to parse\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\n     */\n    _parseShadow: function(shadow) {\n      var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\n\n      return {\n        color: color.trim(),\n        offsetX: parseInt(offsetsAndBlur[1], 10) || 0,\n        offsetY: parseInt(offsetsAndBlur[2], 10) || 0,\n        blur: parseInt(offsetsAndBlur[3], 10) || 0\n      };\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n     * @return {String} Returns CSS3 text-shadow declaration\n     */\n    toString: function() {\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a shadow\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a shadow\n     */\n    toSVG: function(object) {\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)),\n          BLUR_BOX = 20;\n\n      if (object.width && object.height) {\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n        // we add some extra space to filter box to contain the blur ( 20 )\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n      }\n      if (object.flipX) {\n        offset.x *= -1;\n      }\n      if (object.flipY) {\n        offset.y *= -1;\n      }\n      return (\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' + this.color + '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          '\\t<feMerge>\\n' +\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          '\\t</feMerge>\\n' +\n        '</filter>\\n');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns object representation of a shadow\n     * @return {Object} Object representation of a shadow instance\n     */\n    toObject: function() {\n      if (this.includeDefaultValues) {\n        return {\n          color: this.color,\n          blur: this.blur,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          affectStroke: this.affectStroke\n        };\n      }\n      var obj = { }, proto = fabric.Shadow.prototype;\n\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke'].forEach(function(prop) {\n        if (this[prop] !== proto[prop]) {\n          obj[prop] = this[prop];\n        }\n      }, this);\n\n      return obj;\n    }\n  });\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:px)?(?:\\s?|$))?(-?\\d+(?:px)?(?:\\s?|$))?(\\d+(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function () {\n\n  'use strict';\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      toFixed = fabric.util.toFixed,\n      transformPoint = fabric.util.transformPoint,\n      invertTransform = fabric.util.invertTransform,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n\n      this._initStatic(el, options);\n    },\n\n    /**\n     * Background color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    backgroundColor: '',\n\n    /**\n     * Background image of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundImage}.\n     * <b>Backwards incompatibility note:</b> The \"backgroundImageOpacity\"\n     * and \"backgroundImageStretch\" properties are deprecated since 1.3.9.\n     * Use {@link fabric.Image#opacity}, {@link fabric.Image#width} and {@link fabric.Image#height}.\n     * @type fabric.Image\n     * @default\n     */\n    backgroundImage: null,\n\n    /**\n     * Overlay color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n     * @since 1.3.9\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    overlayColor: '',\n\n    /**\n     * Overlay image of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayImage}.\n     * <b>Backwards incompatibility note:</b> The \"overlayImageLeft\"\n     * and \"overlayImageTop\" properties are deprecated since 1.3.9.\n     * Use {@link fabric.Image#left} and {@link fabric.Image#top}.\n     * @type fabric.Image\n     * @default\n     */\n    overlayImage: null,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @type Boolean\n     * @default\n     */\n    stateful: false,\n\n    /**\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove} should also re-render canvas.\n     * Disabling this option could give a great performance boost when adding/removing a lot of objects to/from canvas at once\n     * (followed by a manual rendering after addition/deletion)\n     * @type Boolean\n     * @default\n     */\n    renderOnAddRemove: true,\n\n    /**\n     * Function that determines clipping of entire canvas area\n     * Being passed context as first argument. See clipping canvas area in {@link https://github.com/kangax/fabric.js/wiki/FAQ}\n     * @type Function\n     * @default\n     */\n    clipTo: null,\n\n    /**\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\n     * @type Boolean\n     * @default\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n     * @type Boolean\n     * @default\n     */\n    allowTouchScrolling: false,\n\n    /**\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n     * @type Boolean\n     * @default\n     */\n    imageSmoothingEnabled: true,\n\n    /**\n     * The transformation (in the format of Canvas transform) which focuses the viewport\n     * @type Array\n     * @default\n     */\n    viewportTransform: fabric.iMatrix.concat(),\n\n    /**\n     * if set to false background image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    backgroundVpt: true,\n\n    /**\n     * if set to false overlya image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    overlayVpt: true,\n\n    /**\n     * Callback; invoked right before object is about to be scaled/rotated\n     */\n    onBeforeScaleRotate: function () {\n      /* NOOP */\n    },\n\n    /**\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n     */\n    enableRetinaScaling: true,\n\n    /**\n     * Describe canvas element extension over design\n     * properties are tl,tr,bl,br.\n     * if canvas is not zoomed/panned those points are the four corner of canvas\n     * if canvas is viewportTransformed you those points indicate the extension\n     * of canvas element in plain untrasformed coordinates\n     * The coordinates get updated with @method calcViewportBoundaries.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    vptCoords: { },\n\n    /**\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\n     * are not included in current viewport.\n     * May greatly help in applications with crowded canvas and use of zoom/pan\n     * If One of the corner of the bounding box of the object is on the canvas\n     * the objects get rendered.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    skipOffscreen: false,\n\n    /**\n     * @private\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     */\n    _initStatic: function(el, options) {\n      var cb = fabric.StaticCanvas.prototype.renderAll.bind(this);\n      this._objects = [];\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n      this._setImageSmoothing();\n      // only initialize retina scaling once\n      if (!this.interactive) {\n        this._initRetinaScaling();\n      }\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, cb);\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, cb);\n      }\n      if (options.backgroundColor) {\n        this.setBackgroundColor(options.backgroundColor, cb);\n      }\n      if (options.overlayColor) {\n        this.setOverlayColor(options.overlayColor, cb);\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * @private\n     */\n    _isRetinaScaling: function() {\n      return (fabric.devicePixelRatio !== 1 && this.enableRetinaScaling);\n    },\n\n    /**\n     * @private\n     * @return {Number} retinaScaling if applied, otherwise 1;\n     */\n    getRetinaScaling: function() {\n      return this._isRetinaScaling() ? fabric.devicePixelRatio : 1;\n    },\n\n    /**\n     * @private\n     */\n    _initRetinaScaling: function() {\n      if (!this._isRetinaScaling()) {\n        return;\n      }\n      this.lowerCanvasEl.setAttribute('width', this.width * fabric.devicePixelRatio);\n      this.lowerCanvasEl.setAttribute('height', this.height * fabric.devicePixelRatio);\n\n      this.contextContainer.scale(fabric.devicePixelRatio, fabric.devicePixelRatio);\n    },\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage with different properties</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage loaded from cross-origin</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setOverlayImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/YH9yD/|jsFiddle demo}\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage with different properties</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setBackgroundImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n     * @example <caption>Normal overlayColor - color value</caption>\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setOverlayColor: function(overlayColor, callback) {\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n     * @example <caption>Normal backgroundColor - color value</caption>\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setBackgroundColor: function(backgroundColor, callback) {\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\n    },\n\n    /**\n     * @private\n     * @see {@link http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-imagesmoothingenabled|WhatWG Canvas Standard}\n     */\n    _setImageSmoothing: function() {\n      var ctx = this.getContext();\n\n      ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\n        || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\n      ctx.imageSmoothingEnabled = this.imageSmoothingEnabled;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n     */\n    __setBgOverlayImage: function(property, image, callback, options) {\n      if (typeof image === 'string') {\n        fabric.util.loadImage(image, function(img) {\n          img && (this[property] = new fabric.Image(img, options));\n          callback && callback(img);\n        }, this, options && options.crossOrigin);\n      }\n      else {\n        options && image.setOptions(options);\n        this[property] = image;\n        callback && callback(image);\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\n     * @param {Function} [callback] Callback is invoked when color is set\n     */\n    __setBgOverlayColor: function(property, color, callback) {\n      this[property] = color;\n      this._initGradient(color, property);\n      this._initPattern(color, property, callback);\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _createCanvasElement: function(canvasEl) {\n      var element = fabric.util.createCanvasElement(canvasEl);\n      if (!element.style) {\n        element.style = { };\n      }\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n      return element;\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initOptions: function (options) {\n      this._setOptions(options);\n\n      this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0;\n      this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) {\n        return;\n      }\n\n      this.lowerCanvasEl.width = this.width;\n      this.lowerCanvasEl.height = this.height;\n\n      this.lowerCanvasEl.style.width = this.width + 'px';\n      this.lowerCanvasEl.style.height = this.height + 'px';\n\n      this.viewportTransform = this.viewportTransform.slice();\n    },\n\n    /**\n     * Creates a bottom canvas\n     * @private\n     * @param {HTMLElement} [canvasEl]\n     */\n    _createLowerCanvas: function (canvasEl) {\n      this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement(canvasEl);\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width (in px)\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height (in px)\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @param {Number|String} value                         Value to set width to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value, options) {\n      return this.setDimensions({ width: value }, options);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @param {Number|String} value                         Value to set height to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value, options) {\n      return this.setDimensions({ height: value }, options);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n     * @param {Object}        dimensions                    Object with width/height properties\n     * @param {Number|String} [dimensions.width]            Width of canvas element\n     * @param {Number|String} [dimensions.height]           Height of canvas element\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function (dimensions, options) {\n      var cssValue;\n\n      options = options || {};\n\n      for (var prop in dimensions) {\n        cssValue = dimensions[prop];\n\n        if (!options.cssOnly) {\n          this._setBackstoreDimension(prop, dimensions[prop]);\n          cssValue += 'px';\n        }\n\n        if (!options.backstoreOnly) {\n          this._setCssDimension(prop, cssValue);\n        }\n      }\n      this._initRetinaScaling();\n      this._setImageSmoothing();\n      this.calcOffset();\n\n      if (!options.cssOnly) {\n        this.renderAll();\n      }\n\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setBackstoreDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n      }\n\n      if (this.cacheCanvasEl) {\n        this.cacheCanvasEl[prop] = value;\n      }\n\n      this[prop] = value;\n\n      return this;\n    },\n\n    /**\n     * Helper for setting css width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {String} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setCssDimension: function (prop, value) {\n      this.lowerCanvasEl.style[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.style[prop] = value;\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value;\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns canvas zoom level\n     * @return {Number}\n     */\n    getZoom: function () {\n      return this.viewportTransform[0];\n    },\n\n    /**\n     * Sets viewport transform of this canvas instance\n     * @param {Array} vpt the transform in the form of context.transform\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setViewportTransform: function (vpt) {\n      var activeGroup = this._activeGroup, object, ignoreVpt = false, skipAbsolute = true;\n      this.viewportTransform = vpt;\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        object = this._objects[i];\n        object.group || object.setCoords(ignoreVpt, skipAbsolute);\n      }\n      if (activeGroup) {\n        activeGroup.setCoords(ignoreVpt, skipAbsolute);\n      }\n      this.calcViewportBoundaries();\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Sets zoom level of this canvas instance, zoom centered around point\n     * @param {fabric.Point} point to zoom with respect to\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    zoomToPoint: function (point, value) {\n      // TODO: just change the scale, preserve other transformations\n      var before = point, vpt = this.viewportTransform.slice(0);\n      point = transformPoint(point, invertTransform(this.viewportTransform));\n      vpt[0] = value;\n      vpt[3] = value;\n      var after = transformPoint(point, vpt);\n      vpt[4] += before.x - after.x;\n      vpt[5] += before.y - after.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Sets zoom level of this canvas instance\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setZoom: function (value) {\n      this.zoomToPoint(new fabric.Point(0, 0), value);\n      return this;\n    },\n\n    /**\n     * Pan viewport so as to place point at top left corner of canvas\n     * @param {fabric.Point} point to move to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    absolutePan: function (point) {\n      var vpt = this.viewportTransform.slice(0);\n      vpt[4] = -point.x;\n      vpt[5] = -point.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Pans viewpoint relatively\n     * @param {fabric.Point} point (position vector) to move by\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    relativePan: function (point) {\n      return this.absolutePan(new fabric.Point(\n        -point.x - this.viewportTransform[4],\n        -point.y - this.viewportTransform[5]\n      ));\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was added\n     */\n    _onObjectAdded: function(obj) {\n      this.stateful && obj.setupState();\n      obj._set('canvas', this);\n      obj.setCoords();\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      this.fire('object:removed', { target: obj });\n      obj.fire('removed');\n      delete obj.canvas;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @param {CanvasRenderingContext2D} ctx Context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this._objects.length = 0;\n      this.backgroundImage = null;\n      this.overlayImage = null;\n      this.backgroundColor = '';\n      this.overlayColor = '';\n      if (this._hasITextHandlers) {\n        this.off('mouse:up', this._mouseUpITextHandler);\n        this._iTextInstances = null;\n        this._hasITextHandlers = false;\n      }\n      this.clearContext(this.contextContainer);\n      this.fire('canvas:cleared');\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Renders the canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._objects);\n      return this;\n    },\n\n    /**\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\n     * helps to determinate when an object is in the current rendering viewport using\n     * object absolute coordinates ( aCoords )\n     * @return {Object} points.tl\n     * @chainable\n     */\n    calcViewportBoundaries: function() {\n      var points = { }, width = this.getWidth(), height = this.getHeight(),\n          iVpt = invertTransform(this.viewportTransform);\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n      points.br = transformPoint({ x: width, y: height }, iVpt);\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\n      this.vptCoords = points;\n      return points;\n    },\n\n    /**\n     * Renders background, objects, overlay and controls.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {Array} objects to render\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderCanvas: function(ctx, objects) {\n      this.calcViewportBoundaries();\n      this.clearContext(ctx);\n      this.fire('before:render');\n      if (this.clipTo) {\n        fabric.util.clipContext(this, ctx);\n      }\n      this._renderBackground(ctx);\n\n      ctx.save();\n      //apply viewport transform once for all rendering process\n      ctx.transform.apply(ctx, this.viewportTransform);\n      this._renderObjects(ctx, objects);\n      ctx.restore();\n      if (!this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      if (this.clipTo) {\n        ctx.restore();\n      }\n      this._renderOverlay(ctx);\n      if (this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      this.fire('after:render');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} objects to render\n     */\n    _renderObjects: function(ctx, objects) {\n      for (var i = 0, length = objects.length; i < length; ++i) {\n        objects[i] && objects[i].render(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {string} property 'background' or 'overlay'\n     */\n    _renderBackgroundOrOverlay: function(ctx, property) {\n      var object = this[property + 'Color'];\n      if (object) {\n        ctx.fillStyle = object.toLive\n          ? object.toLive(ctx, this)\n          : object;\n\n        ctx.fillRect(\n          object.offsetX || 0,\n          object.offsetY || 0,\n          this.width,\n          this.height);\n      }\n      object = this[property + 'Image'];\n      if (object) {\n        if (this[property + 'Vpt']) {\n          ctx.save();\n          ctx.transform.apply(ctx, this.viewportTransform);\n        }\n        object.render(ctx);\n        this[property + 'Vpt'] && ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'background');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderOverlay: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @return {Object} object with \"top\" and \"left\" number values\n     */\n    getCenter: function () {\n      return {\n        top: this.getHeight() / 2,\n        left: this.getWidth() / 2\n      };\n    },\n\n    /**\n     * Centers object horizontally in the canvas\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center horizontally\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      return this._centerObject(object, new fabric.Point(this.getCenter().left, object.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically in the canvas\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenter().top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the canvas\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function(object) {\n      var center = this.getCenter();\n\n      return this._centerObject(object, new fabric.Point(center.left, center.top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the viewport\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObject: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, vpCenter);\n    },\n\n    /**\n     * Centers object horizontally in the viewport, object.top is unchanged\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectH: function(object) {\n      var vpCenter = this.getVpCenter();\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\n      return this;\n    },\n\n    /**\n     * Centers object Vertically in the viewport, object.top is unchanged\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectV: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\n    },\n\n    /**\n     * Calculate the point in canvas that correspond to the center of actual viewport.\n     * @return {fabric.Point} vpCenter, viewport center\n     * @chainable\n     */\n    getVpCenter: function() {\n      var center = this.getCenter(),\n          iVpt = invertTransform(this.viewportTransform);\n      return transformPoint({ x: center.left, y: center.top }, iVpt);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} object Object to center\n     * @param {fabric.Point} center Center point\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    _centerObject: function(object, center) {\n      object.setPositionByOrigin(center, 'center', 'center');\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Returs dataless JSON representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {String} json string\n     */\n    toDatalessJSON: function (propertiesToInclude) {\n      return this.toDatalessObject(propertiesToInclude);\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toObject', propertiesToInclude);\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\n    },\n\n    /**\n     * @private\n     */\n    _toObjectMethod: function (methodName, propertiesToInclude) {\n\n      var data = {\n        objects: this._toObjects(methodName, propertiesToInclude)\n      };\n\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\n\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    _toObjects: function(methodName, propertiesToInclude) {\n      return this.getObjects().filter(function(object) {\n        return !object.excludeFromExport;\n      }).map(function(instance) {\n        return this._toObject(instance, methodName, propertiesToInclude);\n      }, this);\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      var originalValue;\n\n      if (!this.includeDefaultValues) {\n        originalValue = instance.includeDefaultValues;\n        instance.includeDefaultValues = false;\n      }\n\n      var object = instance[methodName](propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        instance.includeDefaultValues = originalValue;\n      }\n      return object;\n    },\n\n    /**\n     * @private\n     */\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\n      var data = { };\n\n      if (this.backgroundColor) {\n        data.background = this.backgroundColor.toObject\n          ? this.backgroundColor.toObject(propertiesToInclude)\n          : this.backgroundColor;\n      }\n\n      if (this.overlayColor) {\n        data.overlay = this.overlayColor.toObject\n          ? this.overlayColor.toObject(propertiesToInclude)\n          : this.overlayColor;\n      }\n      if (this.backgroundImage) {\n        data.backgroundImage = this._toObject(this.backgroundImage, methodName, propertiesToInclude);\n      }\n      if (this.overlayImage) {\n        data.overlayImage = this._toObject(this.overlayImage, methodName, propertiesToInclude);\n      }\n\n      return data;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n     * a zoomed canvas will then produce zoomed SVG output.\n     * @type Boolean\n     * @default\n     */\n    svgViewportTransformation: true,\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @param {Object} [options] Options object for SVG output\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n     * @param {Object} [options.viewBox] SVG viewbox object\n     * @param {Number} [options.viewBox.x] x-cooridnate of viewbox\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n     * @param {Number} [options.viewBox.width] Width of viewbox\n     * @param {Number} [options.viewBox.height] Height of viewbox\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n     * @param {String} [options.width] desired width of svg with or without units\n     * @param {String} [options.height] desired height of svg with or without units\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n     * @return {String} SVG string\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n     * @example <caption>Normal SVG output</caption>\n     * var svg = canvas.toSVG();\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n     * var svg = canvas.toSVG({suppressPreamble: true});\n     * @example <caption>SVG output with viewBox attribute</caption>\n     * var svg = canvas.toSVG({\n     *   viewBox: {\n     *     x: 100,\n     *     y: 100,\n     *     width: 200,\n     *     height: 300\n     *   }\n     * });\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n     * @example <caption>Modify SVG output with reviver function</caption>\n     * var svg = canvas.toSVG(null, function(svg) {\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n     * });\n     */\n    toSVG: function(options, reviver) {\n      options || (options = { });\n\n      var markup = [];\n\n      this._setSVGPreamble(markup, options);\n      this._setSVGHeader(markup, options);\n\n      this._setSVGBgOverlayColor(markup, 'backgroundColor');\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\n\n      this._setSVGObjects(markup, reviver);\n\n      this._setSVGBgOverlayColor(markup, 'overlayColor');\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\n\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _setSVGPreamble: function(markup, options) {\n      if (options.suppressPreamble) {\n        return;\n      }\n      markup.push(\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\n          '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n            '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n      );\n    },\n\n    /**\n     * @private\n     */\n    _setSVGHeader: function(markup, options) {\n      var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      if (options.viewBox) {\n        viewBox = 'viewBox=\"' +\n                options.viewBox.x + ' ' +\n                options.viewBox.y + ' ' +\n                options.viewBox.width + ' ' +\n                options.viewBox.height + '\" ';\n      }\n      else {\n        if (this.svgViewportTransformation) {\n          vpt = this.viewportTransform;\n          viewBox = 'viewBox=\"' +\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\n        }\n      }\n\n      markup.push(\n        '<svg ',\n          'xmlns=\"http://www.w3.org/2000/svg\" ',\n          'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n          'version=\"1.1\" ',\n          'width=\"', width, '\" ',\n          'height=\"', height, '\" ',\n          viewBox,\n          'xml:space=\"preserve\">\\n',\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\n        '<defs>\\n',\n          this.createSVGFontFacesMarkup(),\n          this.createSVGRefElementsMarkup(),\n        '</defs>\\n'\n      );\n    },\n\n    /**\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\n     * @return {String}\n     */\n    createSVGRefElementsMarkup: function() {\n      var _this = this,\n          markup = ['backgroundColor', 'overlayColor'].map(function(prop) {\n            var fill = _this[prop];\n            if (fill && fill.toLive) {\n              return fill.toSVG(_this, false);\n            }\n          });\n      return markup.join('');\n    },\n\n    /**\n     * Creates markup containing SVG font faces,\n     * font URLs for font faces must be collected by developers\n     * and are not extracted from the DOM by fabricjs\n     * @param {Array} objects Array of fabric objects\n     * @return {String}\n     */\n    createSVGFontFacesMarkup: function() {\n      var markup = '', fontList = { }, obj, fontFamily,\n          style, row, rowIndex, _char, charIndex,\n          fontPaths = fabric.fontPaths, objects = this.getObjects();\n\n      for (var i = 0, len = objects.length; i < len; i++) {\n        obj = objects[i];\n        fontFamily = obj.fontFamily;\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\n          continue;\n        }\n        fontList[fontFamily] = true;\n        if (!obj.styles) {\n          continue;\n        }\n        style = obj.styles;\n        for (rowIndex in style) {\n          row = style[rowIndex];\n          for (charIndex in row) {\n            _char = row[charIndex];\n            fontFamily = _char.fontFamily;\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n              fontList[fontFamily] = true;\n            }\n          }\n        }\n      }\n\n      for (var j in fontList) {\n        markup += [\n          '\\t\\t@font-face {\\n',\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\n          '\\t\\t}\\n'\n        ].join('');\n      }\n\n      if (markup) {\n        markup = [\n          '\\t<style type=\"text/css\">',\n          '<![CDATA[\\n',\n          markup,\n          ']]>',\n          '</style>\\n'\n        ].join('');\n      }\n\n      return markup;\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObjects: function(markup, reviver) {\n      var instance;\n      for (var i = 0, objects = this.getObjects(), len = objects.length; i < len; i++) {\n        instance = objects[i];\n        if (instance.excludeFromExport) {\n          continue;\n        }\n        this._setSVGObject(markup, instance, reviver);\n      }\n    },\n\n    /**\n     * push single object svg representation in the markup\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      markup.push(instance.toSVG(reviver));\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\n      if (this[property] && this[property].toSVG) {\n        markup.push(this[property].toSVG(reviver));\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayColor: function(markup, property) {\n      var filler = this[property];\n      if (!filler) {\n        return;\n      }\n      if (filler.toLive) {\n        var repeat = filler.repeat;\n        markup.push(\n          '<rect transform=\"translate(', this.width / 2, ',', this.height / 2, ')\"',\n            ' x=\"', filler.offsetX - this.width / 2, '\" y=\"', filler.offsetY - this.height / 2, '\" ',\n            'width=\"',\n              (repeat === 'repeat-y' || repeat === 'no-repeat'\n                ? filler.source.width\n                : this.width),\n            '\" height=\"',\n              (repeat === 'repeat-x' || repeat === 'no-repeat'\n                ? filler.source.height\n                : this.height),\n            '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n          '></rect>\\n'\n        );\n      }\n      else {\n        markup.push(\n          '<rect x=\"0\" y=\"0\" ',\n            'width=\"', this.width,\n            '\" height=\"', this.height,\n            '\" fill=\"', this[property], '\"',\n          '></rect>\\n'\n        );\n      }\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the bottom of the stack of drawn objects\n     * @param {fabric.Object} object Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeGroup = this._activeGroup,\n          i, obj, objs;\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.unshift(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.unshift(object);\n      }\n      return this.renderAll && this.renderAll();\n    },\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the top of the stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeGroup = this._activeGroup,\n          i, obj, objs;\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.push(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.push(object);\n      }\n      return this.renderAll && this.renderAll();\n    },\n\n    /**\n     * Moves an object or a selection down in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeGroup = this._activeGroup,\n          i, obj, idx, newIdx, objs;\n\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx !== 0) {\n            newIdx = idx - 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== 0) {\n          // if object is not on the bottom of stack\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderAll && this.renderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewLowerIndex: function(object, idx, intersecting) {\n      var newIdx;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (var i = idx - 1; i >= 0; --i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx - 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object or a selection up in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeGroup = this._activeGroup,\n          i, obj, idx, newIdx, objs;\n\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx !== this._objects.length - 1) {\n            newIdx = idx + 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== this._objects.length - 1) {\n          // if object is not on top of stack (last item in an array)\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderAll && this.renderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewUpperIndex: function(object, idx, intersecting) {\n      var newIdx;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (var i = idx + 1; i < this._objects.length; ++i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx + 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Number} index Position to move to\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    moveTo: function (object, index) {\n      removeFromArray(this._objects, object);\n      this._objects.splice(index, 0, object);\n      return this.renderAll && this.renderAll();\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      this.clear();\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function () {\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\n               '{ objects: ' + this.getObjects().length + ' }>';\n    }\n  });\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @type String\n     * @default\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @param {String} methodName Method to check support for;\n     *                            Could be one of \"getImageData\", \"toDataURL\", \"toDataURLWithQuality\" or \"setLineDash\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = fabric.util.createCanvasElement();\n\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'getImageData':\n          return typeof ctx.getImageData !== 'undefined';\n\n        case 'setLineDash':\n          return typeof ctx.setLineDash !== 'undefined';\n\n        case 'toDataURL':\n          return typeof el.toDataURL !== 'undefined';\n\n        case 'toDataURLWithQuality':\n          try {\n            el.toDataURL('image/jpeg', 0);\n            return true;\n          }\n          catch (e) { }\n          return false;\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returns JSON representation of canvas\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {String} JSON string\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n})();\n\n\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\n\n  /**\n   * Color of a brush\n   * @type String\n   * @default\n   */\n  color: 'rgb(0, 0, 0)',\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 1,\n\n  /**\n   * Shadow object representing shadow of this shape.\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n   * @type fabric.Shadow\n   * @default\n   */\n  shadow: null,\n\n  /**\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n   * @type String\n   * @default\n   */\n  strokeLineCap: 'round',\n\n  /**\n   * Corner style of a brush (one of \"bevil\", \"round\", \"miter\")\n   * @type String\n   * @default\n   */\n  strokeLineJoin: 'round',\n\n  /**\n   * Stroke Dash Array.\n   * @type Array\n   * @default\n   */\n  strokeDashArray: null,\n\n  /**\n   * Sets shadow of an object\n   * @param {Object|String} [options] Options object or string (e.g. \"2px 2px 10px rgba(0,0,0,0.2)\")\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  setShadow: function(options) {\n    this.shadow = new fabric.Shadow(options);\n    return this;\n  },\n\n  /**\n   * Sets brush styles\n   * @private\n   */\n  _setBrushStyles: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = this.width;\n    ctx.lineCap = this.strokeLineCap;\n    ctx.lineJoin = this.strokeLineJoin;\n    if (this.strokeDashArray && fabric.StaticCanvas.supports('setLineDash')) {\n      ctx.setLineDash(this.strokeDashArray);\n    }\n  },\n\n  /**\n   * Sets brush shadow styles\n   * @private\n   */\n  _setShadow: function() {\n    if (!this.shadow) {\n      return;\n    }\n\n    var ctx = this.canvas.contextTop,\n        zoom = this.canvas.getZoom();\n\n    ctx.shadowColor = this.shadow.color;\n    ctx.shadowBlur = this.shadow.blur * zoom;\n    ctx.shadowOffsetX = this.shadow.offsetX * zoom;\n    ctx.shadowOffsetY = this.shadow.offsetY * zoom;\n  },\n\n  /**\n   * Removes brush shadow styles\n   * @private\n   */\n  _resetShadow: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.shadowColor = '';\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n  }\n});\n\n\n(function() {\n\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function(canvas) {\n      this.canvas = canvas;\n      this._points = [];\n    },\n\n    /**\n     * Inovoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function(pointer) {\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Inovoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function(pointer) {\n      this._captureDrawingPath(pointer);\n      // redraw curve\n      // clear top canvas\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._render();\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function() {\n      this._finalizeAndAddPath();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function(pointer) {\n\n      var p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n\n      this.canvas.contextTop.moveTo(p.x, p.y);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function(point) {\n      this._points.push(point);\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function() {\n      this._points.length = 0;\n\n      this._setBrushStyles();\n      this._setShadow();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function(pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     */\n    _render: function() {\n      var ctx  = this.canvas.contextTop,\n          v = this.canvas.viewportTransform,\n          p1 = this._points[0],\n          p2 = this._points[1];\n\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      ctx.beginPath();\n\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        p1.x -= 0.5;\n        p2.x += 0.5;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (var i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        var midPoint = p1.midPointFrom(p2);\n        ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @return {String} SVG path\n     */\n    convertPointsToSVGPath: function(points) {\n      var path = [],\n          p1 = new fabric.Point(points[0].x, points[0].y),\n          p2 = new fabric.Point(points[1].x, points[1].y);\n\n      path.push('M ', points[0].x, ' ', points[0].y, ' ');\n      for (var i = 1, len = points.length; i < len; i++) {\n        var midPoint = p1.midPointFrom(p2);\n        // p1 is our bezier control point\n        // midpoint is our endpoint\n        // start point is p(i-1) value.\n        path.push('Q ', p1.x, ' ', p1.y, ' ', midPoint.x, ' ', midPoint.y, ' ');\n        p1 = new fabric.Point(points[i].x, points[i].y);\n        if ((i + 1) < points.length) {\n          p2 = new fabric.Point(points[i + 1].x, points[i + 1].y);\n        }\n      }\n      path.push('L ', p1.x, ' ', p1.y, ' ');\n      return path;\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {String} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function(pathData) {\n      var path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n        originX: 'center',\n        originY: 'center'\n      });\n\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.setShadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function() {\n      var ctx = this.canvas.contextTop;\n      ctx.closePath();\n\n      var pathData = this.convertPointsToSVGPath(this._points).join('');\n      if (pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {\n        // do not create 0 width/height paths, as they are\n        // rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot,\n        // whereas Chrome 10 renders nothing\n        this.canvas.renderAll();\n        return;\n      }\n\n      var path = this.createPath(pathData);\n\n      this.canvas.add(path);\n      path.setCoords();\n\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._resetShadow();\n      this.canvas.renderAll();\n\n      // fire event 'path' created\n      this.canvas.fire('path:created', { path: path });\n    }\n  });\n})();\n\n\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 10,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.CircleBrush} Instance of a circle brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.points = [];\n  },\n\n  /**\n   * Invoked inside on mouse down and mouse move\n   * @param {Object} pointer\n   */\n  drawDot: function(pointer) {\n    var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop,\n        v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n\n    ctx.fillStyle = point.fill;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse down\n   */\n  onMouseDown: function(pointer) {\n    this.points.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var circles = [];\n\n    for (var i = 0, len = this.points.length; i < len; i++) {\n      var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: 'center',\n            originY: 'center',\n            fill: point.fill\n          });\n\n      this.shadow && circle.setShadow(this.shadow);\n\n      circles.push(circle);\n    }\n    var group = new fabric.Group(circles, { originX: 'center', originY: 'center' });\n    group.canvas = this.canvas;\n\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.renderAll();\n  },\n\n  /**\n   * @param {Object} pointer\n   * @return {fabric.Point} Just added pointer point\n   */\n  addPoint: function(pointer) {\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n\n        circleRadius = fabric.util.getRandomInt(\n                        Math.max(0, this.width - 20), this.width + 20) / 2,\n\n        circleColor = new fabric.Color(this.color)\n                        .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n                        .toRgba();\n\n    pointerPoint.radius = circleRadius;\n    pointerPoint.fill = circleColor;\n\n    this.points.push(pointerPoint);\n\n    return pointerPoint;\n  }\n});\n\n\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\n\n  /**\n   * Width of a spray\n   * @type Number\n   * @default\n   */\n  width:              10,\n\n  /**\n   * Density of a spray (number of dots per chunk)\n   * @type Number\n   * @default\n   */\n  density:            20,\n\n  /**\n   * Width of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidth:           1,\n\n  /**\n   * Width variance of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidthVariance:   1,\n\n  /**\n   * Whether opacity of a dot should be random\n   * @type Boolean\n   * @default\n   */\n  randomOpacity:        false,\n\n  /**\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n   * @type Boolean\n   * @default\n   */\n  optimizeOverlapping:  true,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.SprayBrush} Instance of a spray brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.sprayChunks = [];\n  },\n\n  /**\n   * Invoked on mouse down\n   * @param {Object} pointer\n   */\n  onMouseDown: function(pointer) {\n    this.sprayChunks.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n\n    this.addSprayChunk(pointer);\n    this.render();\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    this.addSprayChunk(pointer);\n    this.render();\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var rects = [];\n\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      var sprayChunk = this.sprayChunks[i];\n\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n\n        var rect = new fabric.Rect({\n          width: sprayChunk[j].width,\n          height: sprayChunk[j].width,\n          left: sprayChunk[j].x + 1,\n          top: sprayChunk[j].y + 1,\n          originX: 'center',\n          originY: 'center',\n          fill: this.color\n        });\n\n        this.shadow && rect.setShadow(this.shadow);\n        rects.push(rect);\n      }\n    }\n\n    if (this.optimizeOverlapping) {\n      rects = this._getOptimizedRects(rects);\n    }\n\n    var group = new fabric.Group(rects, { originX: 'center', originY: 'center' });\n    group.canvas = this.canvas;\n\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.renderAll();\n  },\n\n  /**\n   * @private\n   * @param {Array} rects\n   */\n  _getOptimizedRects: function(rects) {\n\n    // avoid creating duplicate rects at the same coordinates\n    var uniqueRects = { }, key;\n\n    for (var i = 0, len = rects.length; i < len; i++) {\n      key = rects[i].left + '' + rects[i].top;\n      if (!uniqueRects[key]) {\n        uniqueRects[key] = rects[i];\n      }\n    }\n    var uniqueRectsArray = [];\n    for (key in uniqueRects) {\n      uniqueRectsArray.push(uniqueRects[key]);\n    }\n\n    return uniqueRectsArray;\n  },\n\n  /**\n   * Renders brush\n   */\n  render: function() {\n    var ctx = this.canvas.contextTop;\n    ctx.fillStyle = this.color;\n\n    var v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n\n    for (var i = 0, len = this.sprayChunkPoints.length; i < len; i++) {\n      var point = this.sprayChunkPoints[i];\n      if (typeof point.opacity !== 'undefined') {\n        ctx.globalAlpha = point.opacity;\n      }\n      ctx.fillRect(point.x, point.y, point.width, point.width);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * @param {Object} pointer\n   */\n  addSprayChunk: function(pointer) {\n    this.sprayChunkPoints = [];\n\n    var x, y, width, radius = this.width / 2;\n\n    for (var i = 0; i < this.density; i++) {\n\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n      if (this.dotWidthVariance) {\n        width = fabric.util.getRandomInt(\n          // bottom clamp width to 1\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\n          this.dotWidth + this.dotWidthVariance);\n      }\n      else {\n        width = this.dotWidth;\n      }\n\n      var point = new fabric.Point(x, y);\n      point.width = width;\n\n      if (this.randomOpacity) {\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n      }\n\n      this.sprayChunkPoints.push(point);\n    }\n\n    this.sprayChunks.push(this.sprayChunkPoints);\n  }\n});\n\n\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\n\n  getPatternSrc: function() {\n\n    var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.document.createElement('canvas'),\n        patternCtx = patternCanvas.getContext('2d');\n\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n    patternCtx.fillStyle = this.color;\n    patternCtx.beginPath();\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\n    patternCtx.closePath();\n    patternCtx.fill();\n\n    return patternCanvas;\n  },\n\n  getPatternSrcFunction: function() {\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\n  },\n\n  /**\n   * Creates \"pattern\" instance property\n   */\n  getPattern: function() {\n    return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), 'repeat');\n  },\n\n  /**\n   * Sets brush styles\n   */\n  _setBrushStyles: function() {\n    this.callSuper('_setBrushStyles');\n    this.canvas.contextTop.strokeStyle = this.getPattern();\n  },\n\n  /**\n   * Creates path\n   */\n  createPath: function(pathData) {\n    var path = this.callSuper('createPath', pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n    path.stroke = new fabric.Pattern({\n      source: this.source || this.getPatternSrcFunction(),\n      offsetX: -topLeft.x,\n      offsetY: -topLeft.y\n    });\n    return path;\n  }\n});\n\n\n(function() {\n\n  var getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      radiansToDegrees = fabric.util.radiansToDegrees,\n      atan2 = Math.atan2,\n      abs = Math.abs,\n      supportLineDash = fabric.StaticCanvas.supports('setLineDash'),\n\n      STROKE_OFFSET = 0.5;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:added\n   * @fires object:modified\n   * @fires object:rotating\n   * @fires object:scaling\n   * @fires object:moving\n   * @fires object:selected\n   *\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:created\n   *\n   * @fires path:created\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:over\n   * @fires mouse:out\n   *\n   */\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n\n      this._initStatic(el, options);\n      this._initInteractive();\n      this._createCacheCanvas();\n    },\n\n    /**\n     * When true, objects can be transformed by one side (unproportionally)\n     * @type Boolean\n     * @default\n     */\n    uniScaleTransform:      false,\n\n    /**\n     * Indicates which key enable unproportional scaling\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    uniScaleKey:           'shiftKey',\n\n    /**\n     * When true, objects use center point as the origin of scale transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:        false,\n\n    /**\n     * When true, objects use center point as the origin of rotate transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:       false,\n\n    /**\n     * Indicates which key enable centered Transfrom\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    centeredKey:           'altKey',\n\n    /**\n     * Indicates which key enable alternate action on corner\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    altActionKey:           'shiftKey',\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @type Boolean\n     * @default\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @type Boolean\n     * @default\n     */\n    selection:              true,\n\n    /**\n     * Indicates which key enable multiple click selection\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    selectionKey:           'shiftKey',\n\n    /**\n     * Indicates which key enable alternative selection\n     * in case of target overlapping with active object\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.5\n     * @type null|String\n     * @default\n     */\n    altSelectionKey:           null,\n\n    /**\n     * Color of selection\n     * @type String\n     * @default\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Default dash array pattern\n     * If not empty the selection border is dashed\n     * @type Array\n     */\n    selectionDashArray:     [],\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @type String\n     * @default\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @type Number\n     * @default\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @type String\n     * @default\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used during free drawing\n     * @type String\n     * @default\n     */\n    freeDrawingCursor:      'crosshair',\n\n    /**\n     * Cursor value used for rotation point\n     * @type String\n     * @default\n     */\n    rotationCursor:         'crosshair',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @type String\n     * @default\n     */\n    containerClass:         'canvas-container',\n\n    /**\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:     false,\n\n    /**\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\n     * @type Number\n     * @default\n     */\n    targetFindTolerance:    0,\n\n    /**\n     * When true, target detection is skipped when hovering over canvas. This can be used to improve performance.\n     * @type Boolean\n     * @default\n     */\n    skipTargetFind:         false,\n\n    /**\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n     * After mousedown, mousemove creates a shape,\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n     * @type Boolean\n     * @default\n     */\n    isDrawingMode:          false,\n\n    /**\n     * Indicates whether objects should remain in current stack position when selected.\n     * When false objects are brought to top and rendered as part of the selection group\n     * @type Boolean\n     * @default\n     */\n    preserveObjectStacking: false,\n\n    /**\n     * Indicates the angle that an object will lock to while rotating.\n     * @type Number\n     * @since 1.6.7\n     * @default\n     */\n    snapAngle: 0,\n\n    /**\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n     * When `null`, the snapThreshold will default to the snapAngle.\n     * @type null|Number\n     * @since 1.6.7\n     * @default\n     */\n    snapThreshold: null,\n\n    /**\n     * Indicates if the right click on canvas can output the context menu or not\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    stopContextMenu: false,\n\n    /**\n     * Indicates if the canvas can fire right click events\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    fireRightClick: false,\n\n    /**\n     * Indicates if the canvas can fire middle click events\n     * @type Boolean\n     * @since 1.7.8\n     * @default\n     */\n    fireMiddleClick: false,\n\n    /**\n     * @private\n     */\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEventListeners();\n\n      this._initRetinaScaling();\n\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n      this.calcOffset();\n    },\n\n    /**\n     * Divides objects in two groups, one to render immediately\n     * and one to render as activeGroup.\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n     */\n    _chooseObjectsToRender: function() {\n      var activeGroup = this.getActiveGroup(),\n          activeObject = this.getActiveObject(),\n          object, objsToRender = [], activeGroupObjects = [];\n\n      if ((activeGroup || activeObject) && !this.preserveObjectStacking) {\n        for (var i = 0, length = this._objects.length; i < length; i++) {\n          object = this._objects[i];\n          if ((!activeGroup || !activeGroup.contains(object)) && object !== activeObject) {\n            objsToRender.push(object);\n          }\n          else {\n            activeGroupObjects.push(object);\n          }\n        }\n        if (activeGroup) {\n          activeGroup._set('_objects', activeGroupObjects);\n          objsToRender.push(activeGroup);\n        }\n        activeObject && objsToRender.push(activeObject);\n      }\n      else {\n        objsToRender = this._objects;\n      }\n      return objsToRender;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\n        this.clearContext(this.contextTop);\n        this.contextTopDirty = false;\n      }\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n      return this;\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      var ctx = this.contextTop;\n      this.clearContext(ctx);\n\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection(ctx);\n      }\n\n      this.fire('after:render');\n      this.contextTopDirty = true;\n      return this;\n    },\n\n    /**\n     * Resets the current transform to its original values and chooses the type of resizing based on the event\n     * @private\n     */\n    _resetCurrentTransform: function() {\n      var t = this._currentTransform;\n\n      t.target.set({\n        scaleX: t.original.scaleX,\n        scaleY: t.original.scaleY,\n        skewX: t.original.skewX,\n        skewY: t.original.skewY,\n        left: t.original.left,\n        top: t.original.top\n      });\n\n      if (this._shouldCenterTransform(t.target)) {\n        if (t.action === 'rotate') {\n          this._setOriginToCenter(t.target);\n        }\n        else {\n          if (t.originX !== 'center') {\n            if (t.originX === 'right') {\n              t.mouseXSign = -1;\n            }\n            else {\n              t.mouseXSign = 1;\n            }\n          }\n          if (t.originY !== 'center') {\n            if (t.originY === 'bottom') {\n              t.mouseYSign = -1;\n            }\n            else {\n              t.mouseYSign = 1;\n            }\n          }\n\n          t.originX = 'center';\n          t.originY = 'center';\n        }\n      }\n      else {\n        t.originX = t.original.originX;\n        t.originY = t.original.originY;\n      }\n    },\n\n    /**\n     * Checks if point is contained within an area of given object\n     * @param {Event} e Event object\n     * @param {fabric.Object} target Object to test against\n     * @param {Object} [point] x,y object of point coordinates we want to check.\n     * @return {Boolean} true if point is contained within an area of given object\n     */\n    containsPoint: function (e, target, point) {\n      var ignoreZoom = true,\n          pointer = point || this.getPointer(e, ignoreZoom),\n          xy;\n\n      if (target.group && target.group === this.getActiveGroup()) {\n        xy = this._normalizePointer(target.group, pointer);\n      }\n      else {\n        xy = { x: pointer.x, y: pointer.y };\n      }\n      // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n      // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n      return (target.containsPoint(xy) || target._findTargetCorner(pointer));\n    },\n\n    /**\n     * @private\n     */\n    _normalizePointer: function (object, pointer) {\n      var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n      return fabric.util.transformPoint(vptPointer, invertedM);\n    },\n\n    /**\n     * Returns true if object is transparent at a certain location\n     * @param {fabric.Object} target Object to check\n     * @param {Number} x Left coordinate\n     * @param {Number} y Top coordinate\n     * @return {Boolean}\n     */\n    isTargetTransparent: function (target, x, y) {\n      var hasBorders = target.hasBorders,\n          transparentCorners = target.transparentCorners,\n          ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor;\n\n      target.hasBorders = target.transparentCorners = false;\n      target.selectionBackgroundColor = '';\n\n      ctx.save();\n      ctx.transform.apply(ctx, this.viewportTransform);\n      target.render(ctx);\n      ctx.restore();\n\n      target.active && target._renderControls(ctx);\n\n      target.hasBorders = hasBorders;\n      target.transparentCorners = transparentCorners;\n      target.selectionBackgroundColor = originalColor;\n\n      var isTransparent = fabric.util.isTransparent(\n        ctx, x, y, this.targetFindTolerance);\n\n      this.clearContext(ctx);\n\n      return isTransparent;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _shouldClearSelection: function (e, target) {\n      var activeGroup = this.getActiveGroup(),\n          activeObject = this.getActiveObject();\n\n      return (\n        !target\n        ||\n        (target &&\n          activeGroup &&\n          !activeGroup.contains(target) &&\n          activeGroup !== target &&\n          !e[this.selectionKey])\n        ||\n        (target && !target.evented)\n        ||\n        (target &&\n          !target.selectable &&\n          activeObject &&\n          activeObject !== target)\n      );\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} target\n     */\n    _shouldCenterTransform: function (target) {\n      if (!target) {\n        return;\n      }\n\n      var t = this._currentTransform,\n          centerTransform;\n\n      if (t.action === 'scale' || t.action === 'scaleX' || t.action === 'scaleY') {\n        centerTransform = this.centeredScaling || target.centeredScaling;\n      }\n      else if (t.action === 'rotate') {\n        centerTransform = this.centeredRotation || target.centeredRotation;\n      }\n\n      return centerTransform ? !t.altKey : t.altKey;\n    },\n\n    /**\n     * @private\n     */\n    _getOriginFromCorner: function(target, corner) {\n      var origin = {\n        x: target.originX,\n        y: target.originY\n      };\n\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\n        origin.x = 'right';\n      }\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\n        origin.x = 'left';\n      }\n\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\n        origin.y = 'bottom';\n      }\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\n        origin.y = 'top';\n      }\n\n      return origin;\n    },\n\n    /**\n     * @private\n     */\n    _getActionFromCorner: function(target, corner, e) {\n      if (!corner) {\n        return 'drag';\n      }\n\n      switch (corner) {\n        case 'mtr':\n          return 'rotate';\n        case 'ml':\n        case 'mr':\n          return e[this.altActionKey] ? 'skewY' : 'scaleX';\n        case 'mt':\n        case 'mb':\n          return e[this.altActionKey] ? 'skewX' : 'scaleY';\n        default:\n          return 'scale';\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _setupCurrentTransform: function (e, target) {\n      if (!target) {\n        return;\n      }\n\n      var pointer = this.getPointer(e),\n          corner = target._findTargetCorner(this.getPointer(e, true)),\n          action = this._getActionFromCorner(target, corner, e),\n          origin = this._getOriginFromCorner(target, corner);\n\n      this._currentTransform = {\n        target: target,\n        action: action,\n        corner: corner,\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        offsetX: pointer.x - target.left,\n        offsetY: pointer.y - target.top,\n        originX: origin.x,\n        originY: origin.y,\n        ex: pointer.x,\n        ey: pointer.y,\n        lastX: pointer.x,\n        lastY: pointer.y,\n        left: target.left,\n        top: target.top,\n        theta: degreesToRadians(target.angle),\n        width: target.width * target.scaleX,\n        mouseXSign: 1,\n        mouseYSign: 1,\n        shiftKey: e.shiftKey,\n        altKey: e[this.centeredKey]\n      };\n\n      this._currentTransform.original = {\n        left: target.left,\n        top: target.top,\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        originX: origin.x,\n        originY: origin.y\n      };\n\n      this._resetCurrentTransform();\n    },\n\n    /**\n     * Translates object by \"setting\" its left/top\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @return {Boolean} true if the translation occurred\n     */\n    _translateObject: function (x, y) {\n      var transform = this._currentTransform,\n          target = transform.target,\n          newLeft = x - transform.offsetX,\n          newTop = y - transform.offsetY,\n          moveX = !target.get('lockMovementX') && target.left !== newLeft,\n          moveY = !target.get('lockMovementY') && target.top !== newTop;\n\n      moveX && target.set('left', newLeft);\n      moveY && target.set('top', newTop);\n      return moveX || moveY;\n    },\n\n    /**\n     * Check if we are increasing a positive skew or lower it,\n     * checking mouse direction and pressed corner.\n     * @private\n     */\n    _changeSkewTransformOrigin: function(mouseMove, t, by) {\n      var property = 'originX', origins = { 0: 'center' },\n          skew = t.target.skewX, originA = 'left', originB = 'right',\n          corner = t.corner === 'mt' || t.corner === 'ml' ? 1 : -1,\n          flipSign = 1;\n\n      mouseMove = mouseMove > 0 ? 1 : -1;\n      if (by === 'y') {\n        skew = t.target.skewY;\n        originA = 'top';\n        originB = 'bottom';\n        property = 'originY';\n      }\n      origins[-1] = originA;\n      origins[1] = originB;\n\n      t.target.flipX && (flipSign *= -1);\n      t.target.flipY && (flipSign *= -1);\n\n      if (skew === 0) {\n        t.skewSign = -corner * mouseMove * flipSign;\n        t[property] = origins[-mouseMove];\n      }\n      else {\n        skew = skew > 0 ? 1 : -1;\n        t.skewSign = skew;\n        t[property] = origins[skew * corner * flipSign];\n      }\n    },\n\n    /**\n     * Skew object by mouse events\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @param {String} by Either 'x' or 'y'\n     * @return {Boolean} true if the skewing occurred\n     */\n    _skewObject: function (x, y, by) {\n      var t = this._currentTransform,\n          target = t.target, skewed = false,\n          lockSkewingX = target.get('lockSkewingX'),\n          lockSkewingY = target.get('lockSkewingY');\n\n      if ((lockSkewingX && by === 'x') || (lockSkewingY && by === 'y')) {\n        return false;\n      }\n\n      // Get the constraint point\n      var center = target.getCenterPoint(),\n          actualMouseByCenter = target.toLocalPoint(new fabric.Point(x, y), 'center', 'center')[by],\n          lastMouseByCenter = target.toLocalPoint(new fabric.Point(t.lastX, t.lastY), 'center', 'center')[by],\n          actualMouseByOrigin, constraintPosition, dim = target._getTransformedDimensions();\n\n      this._changeSkewTransformOrigin(actualMouseByCenter - lastMouseByCenter, t, by);\n      actualMouseByOrigin = target.toLocalPoint(new fabric.Point(x, y), t.originX, t.originY)[by];\n      constraintPosition = target.translateToOriginPoint(center, t.originX, t.originY);\n      // Actually skew the object\n      skewed = this._setObjectSkew(actualMouseByOrigin, t, by, dim);\n      t.lastX = x;\n      t.lastY = y;\n      // Make sure the constraints apply\n      target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n      return skewed;\n    },\n\n    /**\n     * Set object skew\n     * @private\n     * @return {Boolean} true if the skewing occurred\n     */\n    _setObjectSkew: function(localMouse, transform, by, _dim) {\n      var target = transform.target, newValue, skewed = false,\n          skewSign = transform.skewSign, newDim, dimNoSkew,\n          otherBy, _otherBy, _by, newDimMouse, skewX, skewY;\n\n      if (by === 'x') {\n        otherBy = 'y';\n        _otherBy = 'Y';\n        _by = 'X';\n        skewX = 0;\n        skewY = target.skewY;\n      }\n      else {\n        otherBy = 'x';\n        _otherBy = 'X';\n        _by = 'Y';\n        skewX = target.skewX;\n        skewY = 0;\n      }\n\n      dimNoSkew = target._getTransformedDimensions(skewX, skewY);\n      newDimMouse = 2 * Math.abs(localMouse) - dimNoSkew[by];\n      if (newDimMouse <= 2) {\n        newValue = 0;\n      }\n      else {\n        newValue = skewSign * Math.atan((newDimMouse / target['scale' + _by]) /\n                                        (dimNoSkew[otherBy] / target['scale' + _otherBy]));\n        newValue = fabric.util.radiansToDegrees(newValue);\n      }\n      skewed = target['skew' + _by] !== newValue;\n      target.set('skew' + _by, newValue);\n      if (target['skew' + _otherBy] !== 0) {\n        newDim = target._getTransformedDimensions();\n        newValue = (_dim[otherBy] / newDim[otherBy]) * target['scale' + _otherBy];\n        target.set('scale' + _otherBy, newValue);\n      }\n      return skewed;\n    },\n\n    /**\n     * Scales object by invoking its scaleX/scaleY methods\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.\n     *                    When not provided, an object is scaled by both dimensions equally\n     * @return {Boolean} true if the scaling occurred\n     */\n    _scaleObject: function (x, y, by) {\n      var t = this._currentTransform,\n          target = t.target,\n          lockScalingX = target.get('lockScalingX'),\n          lockScalingY = target.get('lockScalingY'),\n          lockScalingFlip = target.get('lockScalingFlip');\n\n      if (lockScalingX && lockScalingY) {\n        return false;\n      }\n\n      // Get the constraint point\n      var constraintPosition = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY),\n          localMouse = target.toLocalPoint(new fabric.Point(x, y), t.originX, t.originY),\n          dim = target._getTransformedDimensions(), scaled = false;\n\n      this._setLocalMouse(localMouse, t);\n\n      // Actually scale the object\n      scaled = this._setObjectScale(localMouse, t, lockScalingX, lockScalingY, by, lockScalingFlip, dim);\n\n      // Make sure the constraints apply\n      target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n      return scaled;\n    },\n\n    /**\n     * @private\n     * @return {Boolean} true if the scaling occurred\n     */\n    _setObjectScale: function(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {\n      var target = transform.target, forbidScalingX = false, forbidScalingY = false, scaled = false,\n          changeX, changeY, scaleX, scaleY;\n\n      scaleX = localMouse.x * target.scaleX / _dim.x;\n      scaleY = localMouse.y * target.scaleY / _dim.y;\n      changeX = target.scaleX !== scaleX;\n      changeY = target.scaleY !== scaleY;\n\n      if (lockScalingFlip && scaleX <= 0 && scaleX < target.scaleX) {\n        forbidScalingX = true;\n      }\n\n      if (lockScalingFlip && scaleY <= 0 && scaleY < target.scaleY) {\n        forbidScalingY = true;\n      }\n\n      if (by === 'equally' && !lockScalingX && !lockScalingY) {\n        forbidScalingX || forbidScalingY || (scaled = this._scaleObjectEqually(localMouse, target, transform, _dim));\n      }\n      else if (!by) {\n        forbidScalingX || lockScalingX || (target.set('scaleX', scaleX) && (scaled = scaled || changeX));\n        forbidScalingY || lockScalingY || (target.set('scaleY', scaleY) && (scaled = scaled || changeY));\n      }\n      else if (by === 'x' && !target.get('lockUniScaling')) {\n        forbidScalingX || lockScalingX || (target.set('scaleX', scaleX) && (scaled = scaled || changeX));\n      }\n      else if (by === 'y' && !target.get('lockUniScaling')) {\n        forbidScalingY || lockScalingY || (target.set('scaleY', scaleY) && (scaled = scaled || changeY));\n      }\n      transform.newScaleX = scaleX;\n      transform.newScaleY = scaleY;\n      forbidScalingX || forbidScalingY || this._flipObject(transform, by);\n      return scaled;\n    },\n\n    /**\n     * @private\n     * @return {Boolean} true if the scaling occurred\n     */\n    _scaleObjectEqually: function(localMouse, target, transform, _dim) {\n\n      var dist = localMouse.y + localMouse.x,\n          lastDist = _dim.y * transform.original.scaleY / target.scaleY +\n                     _dim.x * transform.original.scaleX / target.scaleX,\n          scaled;\n\n      // We use transform.scaleX/Y instead of target.scaleX/Y\n      // because the object may have a min scale and we'll loose the proportions\n      transform.newScaleX = transform.original.scaleX * dist / lastDist;\n      transform.newScaleY = transform.original.scaleY * dist / lastDist;\n      scaled = transform.newScaleX !== target.scaleX || transform.newScaleY !== target.scaleY;\n      target.set('scaleX', transform.newScaleX);\n      target.set('scaleY', transform.newScaleY);\n      return scaled;\n    },\n\n    /**\n     * @private\n     */\n    _flipObject: function(transform, by) {\n      if (transform.newScaleX < 0 && by !== 'y') {\n        if (transform.originX === 'left') {\n          transform.originX = 'right';\n        }\n        else if (transform.originX === 'right') {\n          transform.originX = 'left';\n        }\n      }\n\n      if (transform.newScaleY < 0 && by !== 'x') {\n        if (transform.originY === 'top') {\n          transform.originY = 'bottom';\n        }\n        else if (transform.originY === 'bottom') {\n          transform.originY = 'top';\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setLocalMouse: function(localMouse, t) {\n      var target = t.target, zoom = this.getZoom(),\n          padding = target.padding / zoom;\n\n      if (t.originX === 'right') {\n        localMouse.x *= -1;\n      }\n      else if (t.originX === 'center') {\n        localMouse.x *= t.mouseXSign * 2;\n        if (localMouse.x < 0) {\n          t.mouseXSign = -t.mouseXSign;\n        }\n      }\n\n      if (t.originY === 'bottom') {\n        localMouse.y *= -1;\n      }\n      else if (t.originY === 'center') {\n        localMouse.y *= t.mouseYSign * 2;\n        if (localMouse.y < 0) {\n          t.mouseYSign = -t.mouseYSign;\n        }\n      }\n\n      // adjust the mouse coordinates when dealing with padding\n      if (abs(localMouse.x) > padding) {\n        if (localMouse.x < 0) {\n          localMouse.x += padding;\n        }\n        else {\n          localMouse.x -= padding;\n        }\n      }\n      else { // mouse is within the padding, set to 0\n        localMouse.x = 0;\n      }\n\n      if (abs(localMouse.y) > padding) {\n        if (localMouse.y < 0) {\n          localMouse.y += padding;\n        }\n        else {\n          localMouse.y -= padding;\n        }\n      }\n      else {\n        localMouse.y = 0;\n      }\n    },\n\n    /**\n     * Rotates object by invoking its rotate method\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @return {Boolean} true if the rotation occurred\n     */\n    _rotateObject: function (x, y) {\n\n      var t = this._currentTransform;\n\n      if (t.target.get('lockRotation')) {\n        return false;\n      }\n\n      var lastAngle = atan2(t.ey - t.top, t.ex - t.left),\n          curAngle = atan2(y - t.top, x - t.left),\n          angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n          hasRoated = true;\n\n      if (t.target.snapAngle > 0) {\n        var snapAngle  = t.target.snapAngle,\n            snapThreshold  = t.target.snapThreshold || snapAngle,\n            rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n            leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n        if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n          angle = leftAngleLocked;\n        }\n        else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n          angle = rightAngleLocked;\n        }\n      }\n\n      // normalize angle to positive value\n      if (angle < 0) {\n        angle = 360 + angle;\n      }\n      angle %= 360;\n\n      if (t.target.angle === angle) {\n        hasRoated = false;\n      }\n      else {\n        t.target.angle = angle;\n      }\n\n      return hasRoated;\n    },\n\n    /**\n     * Set the cursor type of the canvas element\n     * @param {String} value Cursor type of the canvas element.\n     * @see http://www.w3.org/TR/css3-ui/#cursor\n     */\n    setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * @param {fabric.Object} target to reset transform\n     * @private\n     */\n    _resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.setAngle(0);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\n     */\n    _drawSelection: function (ctx) {\n      var groupSelector = this._groupSelector,\n          left = groupSelector.left,\n          top = groupSelector.top,\n          aleft = abs(left),\n          atop = abs(top);\n\n      if (this.selectionColor) {\n        ctx.fillStyle = this.selectionColor;\n\n        ctx.fillRect(\n          groupSelector.ex - ((left > 0) ? 0 : -left),\n          groupSelector.ey - ((top > 0) ? 0 : -top),\n          aleft,\n          atop\n        );\n      }\n\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\n        return;\n      }\n      ctx.lineWidth = this.selectionLineWidth;\n      ctx.strokeStyle = this.selectionBorderColor;\n\n      // selection border\n      if (this.selectionDashArray.length > 1 && !supportLineDash) {\n\n        var px = groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n            py = groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop);\n\n        ctx.beginPath();\n\n        fabric.util.drawDashedLine(ctx, px, py, px + aleft, py, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py + atop - 1, px + aleft, py + atop - 1, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py, px, py + atop, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px + aleft - 1, py, px + aleft - 1, py + atop, this.selectionDashArray);\n\n        ctx.closePath();\n        ctx.stroke();\n      }\n      else {\n        fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\n        ctx.strokeRect(\n          groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n          groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop),\n          aleft,\n          atop\n        );\n      }\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * the skipGroup parameter is for internal use, is needed for shift+click action\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n     */\n    findTarget: function (e, skipGroup) {\n      if (this.skipTargetFind) {\n        return;\n      }\n\n      var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeGroup = this.getActiveGroup(),\n          activeObject = this.getActiveObject(),\n          activeTarget;\n      // first check current group (if one exists)\n      // active group does not check sub targets like normal groups.\n      // if active group just exits.\n      this.targets = [];\n      if (activeGroup && !skipGroup && activeGroup === this._searchPossibleTargets([activeGroup], pointer)) {\n        this._fireOverOutEvents(activeGroup, e);\n        return activeGroup;\n      }\n      // if we hit the corner of an activeObject, let's return that.\n      if (activeObject && activeObject._findTargetCorner(pointer)) {\n        this._fireOverOutEvents(activeObject, e);\n        return activeObject;\n      }\n      if (activeObject && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        if (!this.preserveObjectStacking) {\n          this._fireOverOutEvents(activeObject, e);\n          return activeObject;\n        }\n        else {\n          activeTarget = activeObject;\n        }\n      }\n\n      var target = this._searchPossibleTargets(this._objects, pointer);\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\n        target = activeTarget;\n      }\n      this._fireOverOutEvents(target, e);\n      return target;\n    },\n\n    /**\n     * @private\n     */\n    _fireOverOutEvents: function(target, e) {\n      var overOpt, outOpt, hoveredTarget = this._hoveredTarget;\n      if (hoveredTarget !== target) {\n        overOpt = { e: e, target: target, previousTarget: this._hoveredTarget };\n        outOpt = { e: e, target: this._hoveredTarget, nextTarget: target };\n        this._hoveredTarget = target;\n      }\n      if (target) {\n        if (hoveredTarget !== target) {\n          if (hoveredTarget) {\n            this.fire('mouse:out', outOpt);\n            hoveredTarget.fire('mouseout', outOpt);\n          }\n          this.fire('mouse:over', overOpt);\n          target.fire('mouseover', overOpt);\n        }\n      }\n      else if (hoveredTarget) {\n        this.fire('mouse:out', outOpt);\n        hoveredTarget.fire('mouseout', outOpt);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _checkTarget: function(pointer, obj) {\n      if (obj &&\n          obj.visible &&\n          obj.evented &&\n          this.containsPoint(null, obj, pointer)){\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\n          var isTransparent = this.isTargetTransparent(obj, pointer.x, pointer.y);\n          if (!isTransparent) {\n            return true;\n          }\n        }\n        else {\n          return true;\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _searchPossibleTargets: function(objects, pointer) {\n\n      // Cache all targets where their bounding box contains point.\n      var target, i = objects.length, normalizedPointer, subTarget;\n      // Do not check for currently grouped objects, since we check the parent group itself.\n      // untill we call this function specifically to search inside the activeGroup\n      while (i--) {\n        if (this._checkTarget(pointer, objects[i])) {\n          target = objects[i];\n          if (target.type === 'group' && target.subTargetCheck) {\n            normalizedPointer = this._normalizePointer(target, pointer);\n            subTarget = this._searchPossibleTargets(target._objects, normalizedPointer);\n            subTarget && this.targets.push(subTarget);\n          }\n          break;\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Returns pointer coordinates without the effect of the viewport\n     * @param {Object} pointer with \"x\" and \"y\" number values\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    restorePointerVpt: function(pointer) {\n      return fabric.util.transformPoint(\n        pointer,\n        fabric.util.invertTransform(this.viewportTransform)\n      );\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * Can return coordinates with or without viewportTransform.\n     * ignoreZoom false gives back coordinates that represent\n     * the point clicked on canvas element.\n     * ignoreZoom true gives back coordinates after being processed\n     * by the viewportTransform ( sort of coordinates of what is displayed\n     * on the canvas where you are clicking.\n     * To interact with your shapes top and left you want to use ignoreZoom true\n     * most of the time, while ignoreZoom false will give you coordinates\n     * compatible with the object.oCoords system.\n     * of the time.\n     * @param {Event} e\n     * @param {Boolean} ignoreZoom\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e, ignoreZoom, upperCanvasEl) {\n      if (!upperCanvasEl) {\n        upperCanvasEl = this.upperCanvasEl;\n      }\n      var pointer = getPointer(e),\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n      if (!boundsWidth || !boundsHeight ) {\n        if ('top' in bounds && 'bottom' in bounds) {\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\n        }\n        if ('right' in bounds && 'left' in bounds) {\n          boundsWidth = Math.abs( bounds.right - bounds.left );\n        }\n      }\n\n      this.calcOffset();\n\n      pointer.x = pointer.x - this._offset.left;\n      pointer.y = pointer.y - this._offset.top;\n      if (!ignoreZoom) {\n        pointer = this.restorePointerVpt(pointer);\n      }\n\n      if (boundsWidth === 0 || boundsHeight === 0) {\n        // If bounds are not available (i.e. not visible), do not apply scale.\n        cssScale = { width: 1, height: 1 };\n      }\n      else {\n        cssScale = {\n          width: upperCanvasEl.width / boundsWidth,\n          height: upperCanvasEl.height / boundsHeight\n        };\n      }\n\n      return {\n        x: pointer.x * cssScale.width,\n        y: pointer.y * cssScale.height\n      };\n    },\n\n    /**\n     * @private\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, '');\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.className = '';\n      }\n      else {\n        this.upperCanvasEl = this._createCanvasElement();\n      }\n      fabric.util.addClass(this.upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\n\n      this.wrapperEl.appendChild(this.upperCanvasEl);\n\n      this._copyCanvasStyle(this.lowerCanvasEl, this.upperCanvasEl);\n      this._applyCanvasStyle(this.upperCanvasEl);\n      this.contextTop = this.upperCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.getWidth() + 'px',\n        height: this.getHeight() + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @param {HTMLElement} element canvas element to apply styles on\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.getWidth() || element.width,\n          height = this.getHeight() || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0,\n        'touch-action': 'none'\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Copys the the entire inline style from one element (fromEl) to another (toEl)\n     * @private\n     * @param {Element} fromEl Element style is copied from\n     * @param {Element} toEl Element copied style is applied to\n     */\n    _copyCanvasStyle: function (fromEl, toEl) {\n      toEl.style.cssText = fromEl.style.cssText;\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _setActiveObject: function(object) {\n      var obj = this._activeObject;\n      if (obj) {\n        obj.set('active', false);\n        if (object !== obj && obj.onDeselect && typeof obj.onDeselect === 'function') {\n          obj.onDeselect();\n        }\n      }\n      this._activeObject = object;\n      object.set('active', true);\n    },\n\n    /**\n     * Sets given object as the only active object on canvas\n     * @param {fabric.Object} object Object to set as an active one\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      var currentActiveObject = this.getActiveObject();\n      if (currentActiveObject && currentActiveObject !== object) {\n        currentActiveObject.fire('deselected', { e: e });\n      }\n      this._setActiveObject(object);\n      this.fire('object:selected', { target: object, e: e });\n      object.fire('selected', { e: e });\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Returns currently active object\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      // removing active object should fire \"selection:cleared\" events\n      if (this.getActiveObject() === obj) {\n        this.fire('before:selection:cleared', { target: obj });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { target: obj });\n        obj.fire('deselected');\n      }\n      if (this._hoveredTarget === obj) {\n        this._hoveredTarget = null;\n      }\n      this.callSuper('_onObjectRemoved', obj);\n    },\n\n    /**\n     * @private\n     */\n    _discardActiveObject: function() {\n      var obj = this._activeObject;\n      if (obj) {\n        obj.set('active', false);\n        if (obj.onDeselect && typeof obj.onDeselect === 'function') {\n          obj.onDeselect();\n        }\n      }\n      this._activeObject = null;\n    },\n\n    /**\n     * Discards currently active object and fire events. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {event} e\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function (e) {\n      var activeObject = this._activeObject;\n      if (activeObject) {\n        this.fire('before:selection:cleared', { target: activeObject, e: e });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { e: e });\n        activeObject.fire('deselected', { e: e });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Group} group\n     */\n    _setActiveGroup: function(group) {\n      this._activeGroup = group;\n      if (group) {\n        group.set('active', true);\n      }\n    },\n\n    /**\n     * Sets active group to a specified one. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {fabric.Group} group Group to set as a current one\n     * @param {Event} e Event object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveGroup: function (group, e) {\n      this._setActiveGroup(group);\n      if (group) {\n        this.fire('object:selected', { target: group, e: e });\n        group.fire('selected', { e: e });\n      }\n      return this;\n    },\n\n    /**\n     * Returns currently active group\n     * @return {fabric.Group} Current group\n     */\n    getActiveGroup: function () {\n      return this._activeGroup;\n    },\n\n    /**\n     * @private\n     */\n    _discardActiveGroup: function() {\n      var g = this.getActiveGroup();\n      if (g) {\n        g.destroy();\n      }\n      this.setActiveGroup(null);\n    },\n\n    /**\n     * Discards currently active group and fire events If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveGroup: function (e) {\n      var g = this.getActiveGroup();\n      if (g) {\n        this.fire('before:selection:cleared', { e: e, target: g });\n        this._discardActiveGroup();\n        this.fire('selection:cleared', { e: e });\n      }\n      return this;\n    },\n\n    /**\n     * Deactivates all objects on canvas, removing any active group or object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    deactivateAll: function () {\n      var allObjects = this.getObjects(),\n          i = 0,\n          len = allObjects.length,\n          obj;\n      for ( ; i < len; i++) {\n        obj = allObjects[i];\n        obj && obj.set('active', false);\n      }\n      this._discardActiveGroup();\n      this._discardActiveObject();\n      return this;\n    },\n\n    /**\n     * Deactivates all objects and dispatches appropriate events If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    deactivateAllWithDispatch: function (e) {\n      var allObjects = this.getObjects(),\n          i = 0,\n          len = allObjects.length,\n          obj;\n      for ( ; i < len; i++) {\n        obj = allObjects[i];\n        obj && obj.set('active', false);\n      }\n      this.discardActiveGroup(e);\n      this.discardActiveObject(e);\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      this.callSuper('dispose');\n      var wrapper = this.wrapperEl;\n      this.removeListeners();\n      wrapper.removeChild(this.upperCanvasEl);\n      wrapper.removeChild(this.lowerCanvasEl);\n      delete this.upperCanvasEl;\n      if (wrapper.parentNode) {\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n      }\n      delete this.wrapperEl;\n      return this;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this.discardActiveGroup();\n      this.discardActiveObject();\n      this.clearContext(this.contextTop);\n      return this.callSuper('clear');\n    },\n\n    /**\n     * Draws objects' controls (borders/controls)\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeGroup = this.getActiveGroup();\n\n      if (activeGroup) {\n        activeGroup._renderControls(ctx);\n      }\n      else {\n        this._drawObjectsControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _drawObjectsControls: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; ++i) {\n        if (!this._objects[i] || !this._objects[i].active) {\n          continue;\n        }\n        this._objects[i]._renderControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      //If the object is part of the current selection group, it should\n      //be transformed appropriately\n      //i.e. it should be serialised as it would appear if the selection group\n      //were to be destroyed.\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\n      //Undo the damage we did by changing all of its properties\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n      return object;\n    },\n\n    /**\n     * Realises an object's group transformation on it\n     * @private\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\n     * @returns the original values of instance which were changed\n     */\n    _realizeGroupTransformOnObject: function(instance) {\n      if (instance.group && instance.group === this.getActiveGroup()) {\n        //Copy all the positionally relevant properties across now\n        var originalValues = {},\n            layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\n        layoutProps.forEach(function(prop) {\n          originalValues[prop] = instance[prop];\n        });\n        this.getActiveGroup().realizeTransform(instance);\n        return originalValues;\n      }\n      else {\n        return null;\n      }\n    },\n\n    /**\n     * Restores the changed properties of instance\n     * @private\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n     */\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\n      if (originalValues) {\n        instance.set(originalValues);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      var originalProperties;\n      //If the object is in a selection group, simulate what would happen to that\n      //object when the group is deselected\n      originalProperties = this._realizeGroupTransformOnObject(instance);\n      this.callSuper('_setSVGObject', markup, instance, reviver);\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n    },\n  });\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n\n  if (fabric.isTouchSupported) {\n    /** @ignore */\n    fabric.Canvas.prototype._setCursorFromEvent = function() { };\n  }\n\n  /**\n   * @ignore\n   * @class fabric.Element\n   * @alias fabric.Canvas\n   * @deprecated Use {@link fabric.Canvas} instead.\n   * @constructor\n   */\n  fabric.Element = fabric.Canvas;\n})();\n\n\n(function() {\n\n  var cursorOffset = {\n        mt: 0, // n\n        tr: 1, // ne\n        mr: 2, // e\n        br: 3, // se\n        mb: 4, // s\n        bl: 5, // sw\n        ml: 6, // w\n        tl: 7 // nw\n      },\n      addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1;\n\n  function checkClick(e, value) {\n    return 'which' in e ? e.which === value : e.button === value - 1;\n  }\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Map of cursor style values for each of the object controls\n     * @private\n     */\n    cursorMap: [\n      'n-resize',\n      'ne-resize',\n      'e-resize',\n      'se-resize',\n      's-resize',\n      'sw-resize',\n      'w-resize',\n      'nw-resize'\n    ],\n\n    /**\n     * Adds mouse listeners to canvas\n     * @private\n     */\n    _initEventListeners: function () {\n      // in case we initialized the class twice. This should not happen normally\n      // but in some kind of applications where the canvas element may be changed\n      // this is a workaround to having double listeners.\n      this.removeListeners();\n      this._bindEvents();\n\n      addListener(fabric.window, 'resize', this._onResize);\n\n      // mouse events\n      addListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      addListener(this.upperCanvasEl, 'mouseout', this._onMouseOut);\n      addListener(this.upperCanvasEl, 'mouseenter', this._onMouseEnter);\n      addListener(this.upperCanvasEl, 'wheel', this._onMouseWheel);\n      addListener(this.upperCanvasEl, 'contextmenu', this._onContextMenu);\n\n      // touch events\n      addListener(this.upperCanvasEl, 'touchstart', this._onMouseDown, { passive: false });\n      addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove, { passive: false });\n\n      if (typeof eventjs !== 'undefined' && 'add' in eventjs) {\n        eventjs.add(this.upperCanvasEl, 'gesture', this._onGesture);\n        eventjs.add(this.upperCanvasEl, 'drag', this._onDrag);\n        eventjs.add(this.upperCanvasEl, 'orientation', this._onOrientationChange);\n        eventjs.add(this.upperCanvasEl, 'shake', this._onShake);\n        eventjs.add(this.upperCanvasEl, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _bindEvents: function() {\n      if (this.eventsBinded) {\n        // for any reason we pass here twice we do not want to bind events twice.\n        return;\n      }\n      this._onMouseDown = this._onMouseDown.bind(this);\n      this._onMouseMove = this._onMouseMove.bind(this);\n      this._onMouseUp = this._onMouseUp.bind(this);\n      this._onResize = this._onResize.bind(this);\n      this._onGesture = this._onGesture.bind(this);\n      this._onDrag = this._onDrag.bind(this);\n      this._onShake = this._onShake.bind(this);\n      this._onLongPress = this._onLongPress.bind(this);\n      this._onOrientationChange = this._onOrientationChange.bind(this);\n      this._onMouseWheel = this._onMouseWheel.bind(this);\n      this._onMouseOut = this._onMouseOut.bind(this);\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onContextMenu = this._onContextMenu.bind(this);\n      this.eventsBinded = true;\n    },\n\n    /**\n     * Removes all event listeners\n     */\n    removeListeners: function() {\n      removeListener(fabric.window, 'resize', this._onResize);\n\n      removeListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      removeListener(this.upperCanvasEl, 'mouseout', this._onMouseOut);\n      removeListener(this.upperCanvasEl, 'mouseenter', this._onMouseEnter);\n      removeListener(this.upperCanvasEl, 'wheel', this._onMouseWheel);\n      removeListener(this.upperCanvasEl, 'contextmenu', this._onContextMenu);\n\n      removeListener(this.upperCanvasEl, 'touchstart', this._onMouseDown);\n      removeListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);\n\n      if (typeof eventjs !== 'undefined' && 'remove' in eventjs) {\n        eventjs.remove(this.upperCanvasEl, 'gesture', this._onGesture);\n        eventjs.remove(this.upperCanvasEl, 'drag', this._onDrag);\n        eventjs.remove(this.upperCanvasEl, 'orientation', this._onOrientationChange);\n        eventjs.remove(this.upperCanvasEl, 'shake', this._onShake);\n        eventjs.remove(this.upperCanvasEl, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js gesture\n     * @param {Event} [self] Inner Event object\n     */\n    _onGesture: function(e, self) {\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js drag\n     * @param {Event} [self] Inner Event object\n     */\n    _onDrag: function(e, self) {\n      this.__onDrag && this.__onDrag(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on wheel event\n     */\n    _onMouseWheel: function(e) {\n      this.__onMouseWheel(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseOut: function(e) {\n      var target = this._hoveredTarget;\n      this.fire('mouse:out', { target: target, e: e });\n      this._hoveredTarget = null;\n      target && target.fire('mouseout', { e: e });\n      if (this._iTextInstances) {\n        this._iTextInstances.forEach(function(obj) {\n          if (obj.isEditing) {\n            obj.hiddenTextarea.focus();\n          }\n        });\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseenter\n     */\n    _onMouseEnter: function(e) {\n      if (!this.findTarget(e)) {\n        this.fire('mouse:over', { target: null, e: e });\n        this._hoveredTarget = null;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js orientation change\n     * @param {Event} [self] Inner Event object\n     */\n    _onOrientationChange: function(e, self) {\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onShake: function(e, self) {\n      this.__onShake && this.__onShake(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onLongPress: function(e, self) {\n      this.__onLongPress && this.__onLongPress(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onContextMenu: function (e) {\n      if (this.stopContextMenu) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDown: function (e) {\n      this.__onMouseDown(e);\n\n      addListener(fabric.document, 'touchend', this._onMouseUp, { passive: false });\n      addListener(fabric.document, 'touchmove', this._onMouseMove, { passive: false });\n\n      removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      removeListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);\n\n      if (e.type === 'touchstart') {\n        // Unbind mousedown to prevent double triggers from touch devices\n        removeListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      }\n      else {\n        addListener(fabric.document, 'mouseup', this._onMouseUp);\n        addListener(fabric.document, 'mousemove', this._onMouseMove);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUp: function (e) {\n      this.__onMouseUp(e);\n\n      removeListener(fabric.document, 'mouseup', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onMouseUp);\n\n      removeListener(fabric.document, 'mousemove', this._onMouseMove);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove);\n\n      addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove, { passive: false });\n\n      if (e.type === 'touchend') {\n        // Wait 400ms before rebinding mousedown to prevent double triggers\n        // from touch devices\n        var _this = this;\n        setTimeout(function() {\n          addListener(_this.upperCanvasEl, 'mousedown', _this._onMouseDown);\n        }, 400);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMove: function (e) {\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n      this.__onMouseMove(e);\n    },\n\n    /**\n     * @private\n     */\n    _onResize: function () {\n      this.calcOffset();\n    },\n\n    /**\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n     * @private\n     * @param {Object} target\n     * @param {Object} pointer\n     */\n    _shouldRender: function(target, pointer) {\n      var activeObject = this.getActiveGroup() || this.getActiveObject();\n\n      if (activeObject && activeObject.isEditing && target === activeObject) {\n        // if we mouse up/down over a editing textbox a cursor change,\n        // there is no need to re render\n        return false;\n      }\n      return !!(\n        (target && (\n          target.isMoving ||\n          target !== activeObject))\n        ||\n        (!target && !!activeObject)\n        ||\n        (!target && !activeObject && !this._groupSelector)\n        ||\n        (pointer &&\n          this._previousPointer &&\n          this.selection && (\n          pointer.x !== this._previousPointer.x ||\n          pointer.y !== this._previousPointer.y))\n      );\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseUp: function (e) {\n\n      var target;\n      // if right/middle click just fire events and return\n      // target undefined will make the _handleEvent search the target\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'up', target, RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'up', target, MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._onMouseUpInDrawingMode(e);\n        return;\n      }\n\n      var searchTarget = true, transform = this._currentTransform,\n          groupSelector = this._groupSelector,\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\n\n      if (transform) {\n        this._finalizeCurrentTransform(e);\n        searchTarget = !transform.actionPerformed;\n      }\n\n      target = searchTarget ? this.findTarget(e, true) : transform.target;\n\n      var shouldRender = this._shouldRender(target, this.getPointer(e));\n\n      if (target || !isClick) {\n        this._maybeGroupObjects(e);\n      }\n      else {\n        // those are done by default on mouse up\n        // by _maybeGroupObjects, we are skipping it in case of no target find\n        this._groupSelector = null;\n        this._currentTransform = null;\n      }\n\n      if (target) {\n        target.isMoving = false;\n      }\n      this._setCursorFromEvent(e, target);\n      this._handleEvent(e, 'up', target ? target : null, LEFT_CLICK, isClick);\n      target && (target.__corner = 0);\n      shouldRender && this.renderAll();\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @param {fabric.Object} targetObj receiving event\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n     */\n    _handleEvent: function(e, eventType, targetObj, button, isClick) {\n      var target = typeof targetObj === 'undefined' ? this.findTarget(e) : targetObj,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false\n          };\n      this.fire('mouse:' + eventType, options);\n      target && target.fire('mouse' + eventType, options);\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire('mouse' + eventType, options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n     */\n    _finalizeCurrentTransform: function(e) {\n\n      var transform = this._currentTransform,\n          target = transform.target;\n\n      if (target._scaling) {\n        target._scaling = false;\n      }\n\n      target.setCoords();\n      this._restoreOriginXY(target);\n\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\n        this.fire('object:modified', { target: target, e: e });\n        target.fire('modified', { e: e });\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} target Object to restore\n     */\n    _restoreOriginXY: function(target) {\n      if (this._previousOriginX && this._previousOriginY) {\n\n        var originPoint = target.translateToOriginPoint(\n          target.getCenterPoint(),\n          this._previousOriginX,\n          this._previousOriginY);\n\n        target.originX = this._previousOriginX;\n        target.originY = this._previousOriginY;\n\n        target.left = originPoint.x;\n        target.top = originPoint.y;\n\n        this._previousOriginX = null;\n        this._previousOriginY = null;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDownInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = true;\n      this.discardActiveObject(e).renderAll();\n      if (this.clipTo) {\n        fabric.util.clipContext(this, this.contextTop);\n      }\n      var pointer = this.getPointer(e);\n      this.freeDrawingBrush.onMouseDown(pointer);\n      this._handleEvent(e, 'down');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMoveInDrawingMode: function(e) {\n      if (this._isCurrentlyDrawing) {\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseMove(pointer);\n      }\n      this.setCursor(this.freeDrawingCursor);\n      this._handleEvent(e, 'move');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUpInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = false;\n      if (this.clipTo) {\n        this.contextTop.restore();\n      }\n      this.freeDrawingBrush.onMouseUp();\n      this._handleEvent(e, 'up');\n    },\n\n    /**\n     * Method that defines the actions when mouse is clicked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    __onMouseDown: function (e) {\n\n      var target = this.findTarget(e);\n\n      // if right click just fire events\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'down', target ? target : null, RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'down', target ? target : null, MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode) {\n        this._onMouseDownInDrawingMode(e);\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) {\n        return;\n      }\n\n      // save pointer for check in __onMouseUp event\n      var pointer = this.getPointer(e, true);\n      this._previousPointer = pointer;\n\n      var shouldRender = this._shouldRender(target, pointer),\n          shouldGroup = this._shouldGroup(e, target);\n\n      if (this._shouldClearSelection(e, target)) {\n        this.deactivateAllWithDispatch(e);\n      }\n      else if (shouldGroup) {\n        this._handleGrouping(e, target);\n        target = this.getActiveGroup();\n      }\n\n      if (this.selection && (!target || (!target.selectable && !target.isEditing))) {\n        this._groupSelector = {\n          ex: pointer.x,\n          ey: pointer.y,\n          top: 0,\n          left: 0\n        };\n      }\n\n      if (target) {\n        if (target.selectable && (target.__corner || !shouldGroup)) {\n          this._beforeTransform(e, target);\n          this._setupCurrentTransform(e, target);\n        }\n        var activeObject = this.getActiveObject();\n        if (target !== this.getActiveGroup() && target !== activeObject) {\n          this.deactivateAll();\n          if (target.selectable) {\n            activeObject && activeObject.fire('deselected', { e: e });\n            this.setActiveObject(target, e);\n          }\n        }\n      }\n      this._handleEvent(e, 'down', target ? target : null);\n      // we must renderAll so that we update the visuals\n      shouldRender && this.renderAll();\n    },\n\n    /**\n     * @private\n     */\n    _beforeTransform: function(e, target) {\n      this.stateful && target.saveState();\n\n      // determine if it's a drag or rotate case\n      if (target._findTargetCorner(this.getPointer(e))) {\n        this.onBeforeScaleRotate(target);\n      }\n\n    },\n\n    /**\n     * @private\n     * @param {Object} target Object for that origin is set to center\n     */\n    _setOriginToCenter: function(target) {\n      this._previousOriginX = this._currentTransform.target.originX;\n      this._previousOriginY = this._currentTransform.target.originY;\n\n      var center = target.getCenterPoint();\n\n      target.originX = 'center';\n      target.originY = 'center';\n\n      target.left = center.x;\n      target.top = center.y;\n\n      this._currentTransform.left = target.left;\n      this._currentTransform.top = target.top;\n    },\n\n    /**\n     * @private\n     * @param {Object} target Object for that center is set to origin\n     */\n    _setCenterToOrigin: function(target) {\n      var originPoint = target.translateToOriginPoint(\n        target.getCenterPoint(),\n        this._previousOriginX,\n        this._previousOriginY);\n\n      target.originX = this._previousOriginX;\n      target.originY = this._previousOriginY;\n\n      target.left = originPoint.x;\n      target.top = originPoint.y;\n\n      this._previousOriginX = null;\n      this._previousOriginY = null;\n    },\n\n    /**\n     * Method that defines the actions when mouse is hovering the canvas.\n     * The currentTransform parameter will definde whether the user is rotating/scaling/translating\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\n     * all any other type of action.\n     * In case of an image transformation only the top canvas will be rendered.\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    __onMouseMove: function (e) {\n\n      var target, pointer;\n\n      if (this.isDrawingMode) {\n        this._onMouseMoveInDrawingMode(e);\n        return;\n      }\n      if (typeof e.touches !== 'undefined' && e.touches.length > 1) {\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection\n      if (groupSelector) {\n        pointer = this.getPointer(e, true);\n\n        groupSelector.left = pointer.x - groupSelector.ex;\n        groupSelector.top = pointer.y - groupSelector.ey;\n\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n        target = this.findTarget(e);\n        this._setCursorFromEvent(e, target);\n      }\n      else {\n        this._transformObject(e);\n      }\n      this._handleEvent(e, 'move', target ? target : null);\n    },\n\n    /**\n     * Method that defines actions when an Event Mouse Wheel\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseWheel: function(e) {\n      this._handleEvent(e, 'wheel');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event fired on mousemove\n     */\n    _transformObject: function(e) {\n      var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n\n      transform.reset = false;\n      transform.target.isMoving = true;\n      transform.shiftKey = e.shiftKey;\n      transform.altKey = e[this.centeredKey];\n\n      this._beforeScaleTransform(e, transform);\n      this._performTransformAction(e, transform, pointer);\n\n      transform.actionPerformed && this.renderAll();\n    },\n\n    /**\n     * @private\n     */\n    _performTransformAction: function(e, transform, pointer) {\n      var x = pointer.x,\n          y = pointer.y,\n          target = transform.target,\n          action = transform.action,\n          actionPerformed = false;\n\n      if (action === 'rotate') {\n        (actionPerformed = this._rotateObject(x, y)) && this._fire('rotating', target, e);\n      }\n      else if (action === 'scale') {\n        (actionPerformed = this._onScale(e, transform, x, y)) && this._fire('scaling', target, e);\n      }\n      else if (action === 'scaleX') {\n        (actionPerformed = this._scaleObject(x, y, 'x')) && this._fire('scaling', target, e);\n      }\n      else if (action === 'scaleY') {\n        (actionPerformed = this._scaleObject(x, y, 'y')) && this._fire('scaling', target, e);\n      }\n      else if (action === 'skewX') {\n        (actionPerformed = this._skewObject(x, y, 'x')) && this._fire('skewing', target, e);\n      }\n      else if (action === 'skewY') {\n        (actionPerformed = this._skewObject(x, y, 'y')) && this._fire('skewing', target, e);\n      }\n      else {\n        actionPerformed = this._translateObject(x, y);\n        if (actionPerformed) {\n          this._fire('moving', target, e);\n          this.setCursor(target.moveCursor || this.moveCursor);\n        }\n      }\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\n    },\n\n    /**\n     * @private\n     */\n    _fire: function(eventName, target, e) {\n      this.fire('object:' + eventName, { target: target, e: e });\n      target.fire(eventName, { e: e });\n    },\n\n    /**\n     * @private\n     */\n    _beforeScaleTransform: function(e, transform) {\n      if (transform.action === 'scale' || transform.action === 'scaleX' || transform.action === 'scaleY') {\n        var centerTransform = this._shouldCenterTransform(transform.target);\n\n        // Switch from a normal resize to center-based\n        if ((centerTransform && (transform.originX !== 'center' || transform.originY !== 'center')) ||\n           // Switch from center-based resize to normal one\n           (!centerTransform && transform.originX === 'center' && transform.originY === 'center')\n        ) {\n          this._resetCurrentTransform();\n          transform.reset = true;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {Object} transform current tranform\n     * @param {Number} x mouse position x from origin\n     * @param {Number} y mouse poistion y from origin\n     * @return {Boolean} true if the scaling occurred\n     */\n    _onScale: function(e, transform, x, y) {\n      if ((e[this.uniScaleKey] || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {\n        transform.currentAction = 'scale';\n        return this._scaleObject(x, y);\n      }\n      else {\n        // Switch from a normal resize to proportional\n        if (!transform.reset && transform.currentAction === 'scale') {\n          this._resetCurrentTransform();\n        }\n\n        transform.currentAction = 'scaleEqually';\n        return this._scaleObject(x, y, 'equally');\n      }\n    },\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @param {Event} e Event object\n     * @param {Object} target Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      if (!target) {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeGroup = this.getActiveGroup(),\n          // only show proper corner when group selection is not active\n          corner = target._findTargetCorner\n                    && (!activeGroup || !activeGroup.contains(target))\n                    && target._findTargetCorner(this.getPointer(e, true));\n\n      if (!corner) {\n        this.setCursor(hoverCursor);\n      }\n      else {\n        this._setCornerCursor(corner, target, e);\n      }\n      //actually unclear why it should return something\n      //is never evaluated\n      return true;\n    },\n\n    /**\n     * @private\n     */\n    _setCornerCursor: function(corner, target, e) {\n      if (corner in cursorOffset) {\n        this.setCursor(this._getRotatedCornerCursor(corner, target, e));\n      }\n      else if (corner === 'mtr' && target.hasRotatingPoint) {\n        this.setCursor(this.rotationCursor);\n      }\n      else {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _getRotatedCornerCursor: function(corner, target, e) {\n      var n = Math.round((target.getAngle() % 360) / 45);\n\n      if (n < 0) {\n        n += 8; // full circle ahead\n      }\n      n += cursorOffset[corner];\n      if (e[this.altActionKey] && cursorOffset[corner] % 2 === 0) {\n        //if we are holding shift and we are on a mx corner...\n        n += 2;\n      }\n      // normalize n to be from 0 to 7\n      n %= 8;\n\n      return this.cursorMap[n];\n    }\n  });\n})();\n\n\n(function() {\n\n  var min = Math.min,\n      max = Math.max;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     * @return {Boolean}\n     */\n    _shouldGroup: function(e, target) {\n      var activeObject = this.getActiveObject();\n      return e[this.selectionKey] && target && target.selectable &&\n            (this.getActiveGroup() || (activeObject && activeObject !== target))\n            && this.selection;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _handleGrouping: function (e, target) {\n      var activeGroup = this.getActiveGroup();\n\n      if (target === activeGroup) {\n        // if it's a group, find target again, using activeGroup objects\n        target = this.findTarget(e, true);\n        // if even object is not found, bail out\n        if (!target) {\n          return;\n        }\n      }\n      if (activeGroup) {\n        this._updateActiveGroup(target, e);\n      }\n      else {\n        this._createActiveGroup(target, e);\n      }\n\n      if (this._activeGroup) {\n        this._activeGroup.saveCoords();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _updateActiveGroup: function(target, e) {\n      var activeGroup = this.getActiveGroup();\n\n      if (activeGroup.contains(target)) {\n\n        activeGroup.removeWithUpdate(target);\n        target.set('active', false);\n\n        if (activeGroup.size() === 1) {\n          // remove group alltogether if after removal it only contains 1 object\n          this.discardActiveGroup(e);\n          // activate last remaining object\n          this.setActiveObject(activeGroup.item(0), e);\n          return;\n        }\n      }\n      else {\n        activeGroup.addWithUpdate(target);\n      }\n      this.fire('selection:created', { target: activeGroup, e: e });\n      activeGroup.set('active', true);\n    },\n\n    /**\n     * @private\n     */\n    _createActiveGroup: function(target, e) {\n\n      if (this._activeObject && target !== this._activeObject) {\n\n        var group = this._createGroup(target);\n        group.addWithUpdate();\n\n        this.setActiveGroup(group, e);\n        this._activeObject = null;\n\n        this.fire('selection:created', { target: group, e: e });\n      }\n\n      target.set('active', true);\n    },\n\n    /**\n     * @private\n     * @param {Object} target\n     */\n    _createGroup: function(target) {\n\n      var objects = this.getObjects(),\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n      this._activeObject.isEditing && this._activeObject.exitEditing();\n      return new fabric.Group(groupObjects, {\n        canvas: this\n      });\n    },\n\n    /**\n     * @private\n     * @param {Event} e mouse event\n     */\n    _groupSelectedObjects: function (e) {\n\n      var group = this._collectObjects();\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        group = new fabric.Group(group.reverse(), {\n          canvas: this\n        });\n        group.addWithUpdate();\n        this.setActiveGroup(group, e);\n        group.saveCoords();\n        this.fire('selection:created', { target: group, e: e });\n        this.renderAll();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _collectObjects: function() {\n      var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          isClick = x1 === x2 && y1 === y2;\n\n      for (var i = this._objects.length; i--; ) {\n        currentObject = this._objects[i];\n\n        if (!currentObject || !currentObject.selectable || !currentObject.visible) {\n          continue;\n        }\n\n        if (currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2) ||\n            currentObject.containsPoint(selectionX1Y1) ||\n            currentObject.containsPoint(selectionX2Y2)\n        ) {\n          currentObject.set('active', true);\n          group.push(currentObject);\n\n          // only add one object if it's a click\n          if (isClick) {\n            break;\n          }\n        }\n      }\n\n      return group;\n    },\n\n    /**\n     * @private\n     */\n    _maybeGroupObjects: function(e) {\n      if (this.selection && this._groupSelector) {\n        this._groupSelectedObjects(e);\n      }\n\n      var activeGroup = this.getActiveGroup();\n      if (activeGroup) {\n        activeGroup.setObjectsCoords().setCoords();\n        activeGroup.isMoving = false;\n        this.setCursor(this.defaultCursor);\n      }\n\n      // clear selection and current transformation\n      this._groupSelector = null;\n      this._currentTransform = null;\n    }\n  });\n\n})();\n\n\n(function () {\n\n  var supportQuality = fabric.StaticCanvas.supports('toDataURLWithQuality');\n\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n     * @param {Object} [options] Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'jpeg',\n     *   quality: 0.8\n     * });\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   left: 100,\n     *   top: 100,\n     *   width: 200,\n     *   height: 200\n     * });\n     * @example <caption>Generate double scaled png dataURL</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   multiplier: 2\n     * });\n     */\n    toDataURL: function (options) {\n      options || (options = { });\n\n      var format = options.format || 'png',\n          quality = options.quality || 1,\n          multiplier = options.multiplier || 1,\n          cropping = {\n            left: options.left || 0,\n            top: options.top || 0,\n            width: options.width || 0,\n            height: options.height || 0,\n          };\n      return this.__toDataURLWithMultiplier(format, quality, cropping, multiplier);\n    },\n\n    /**\n     * @private\n     */\n    __toDataURLWithMultiplier: function(format, quality, cropping, multiplier) {\n\n      var origWidth = this.getWidth(),\n          origHeight = this.getHeight(),\n          scaledWidth = (cropping.width || this.getWidth()) * multiplier,\n          scaledHeight = (cropping.height || this.getHeight()) * multiplier,\n          zoom = this.getZoom(),\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - cropping.left) * multiplier,\n          translateY = (vp[5] - cropping.top) * multiplier,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalInteractive = this.interactive;\n\n      this.viewportTransform = newVp;\n      // setting interactive to false avoid exporting controls\n      this.interactive && (this.interactive = false);\n      if (origWidth !== scaledWidth || origHeight !== scaledHeight) {\n        // this.setDimensions is going to renderAll also;\n        this.setDimensions({ width: scaledWidth, height: scaledHeight });\n      }\n      else {\n        this.renderAll();\n      }\n      var data = this.__toDataURL(format, quality, cropping);\n      originalInteractive && (this.interactive = originalInteractive);\n      this.viewportTransform = vp;\n      //setDimensions with no option object is taking care of:\n      //this.width, this.height, this.renderAll()\n      this.setDimensions({ width: origWidth, height: origHeight });\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    __toDataURL: function(format, quality) {\n\n      var canvasEl = this.contextContainer.canvas;\n      // to avoid common confusion https://github.com/kangax/fabric.js/issues/806\n      if (format === 'jpg') {\n        format = 'jpeg';\n      }\n\n      var data = supportQuality\n                ? canvasEl.toDataURL('image/' + format, quality)\n                : canvasEl.toDataURL('image/' + format);\n\n      return data;\n    },\n\n    /**\n     * Exports canvas element to a dataurl image (allowing to change image size via multiplier).\n     * @deprecated since 1.0.13\n     * @param {String} format (png|jpeg)\n     * @param {Number} multiplier\n     * @param {Number} quality (0..1)\n     * @return {String}\n     */\n    toDataURLWithMultiplier: function (format, multiplier, quality) {\n      return this.toDataURL({\n        format: format,\n        multiplier: multiplier,\n        quality: quality\n      });\n    },\n  });\n\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Populates canvas with data from the specified dataless JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toDatalessJSON}\n   * @deprecated since 1.2.2\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   */\n  loadFromDatalessJSON: function (json, callback, reviver) {\n    return this.loadFromJSON(json, callback, reviver);\n  },\n\n  /**\n   * Populates canvas with data from the specified JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n   * @example <caption>loadFromJSON</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n   * @example <caption>loadFromJSON with reviver</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n   *   // `o` = json object\n   *   // `object` = fabric.Object instance\n   *   // ... do some stuff ...\n   * });\n   */\n  loadFromJSON: function (json, callback, reviver) {\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : fabric.util.object.clone(json);\n\n    var _this = this,\n        renderOnAddRemove = this.renderOnAddRemove;\n    this.renderOnAddRemove = false;\n\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\n      _this.clear();\n      _this._setBgOverlay(serialized, function () {\n        enlivenedObjects.forEach(function(obj, index) {\n          // we splice the array just in case some custom classes restored from JSON\n          // will add more object to canvas at canvas init.\n          _this.insertAt(obj, index);\n        });\n        _this.renderOnAddRemove = renderOnAddRemove;\n        // remove parts i cannot set as options\n        delete serialized.objects;\n        delete serialized.backgroundImage;\n        delete serialized.overlayImage;\n        delete serialized.background;\n        delete serialized.overlay;\n        // this._initOptions does too many things to just\n        // call it. Normally loading an Object from JSON\n        // create the Object instance. Here the Canvas is\n        // already an instance and we are just loading things over it\n        _this._setOptions(serialized);\n        _this.renderAll();\n        callback && callback();\n      });\n    }, reviver);\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  _setBgOverlay: function(serialized, callback) {\n    var loaded = {\n      backgroundColor: false,\n      overlayColor: false,\n      backgroundImage: false,\n      overlayImage: false\n    };\n\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\n      callback && callback();\n      return;\n    }\n\n    var cbIfLoaded = function () {\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\n        callback && callback();\n      }\n    };\n\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n   * @param {(Object|String)} value Value to set\n   * @param {Object} loaded Set loaded property to true if property is set\n   * @param {Object} callback Callback function to invoke after property is set\n   */\n  __setBgOverlay: function(property, value, loaded, callback) {\n    var _this = this;\n\n    if (!value) {\n      loaded[property] = true;\n      callback && callback();\n      return;\n    }\n\n    if (property === 'backgroundImage' || property === 'overlayImage') {\n      fabric.util.enlivenObjects([value], function(enlivedObject){\n        _this[property] = enlivedObject[0];\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n    else {\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n  },\n\n  /**\n   * @private\n   * @param {Array} objects\n   * @param {Function} callback\n   * @param {Function} [reviver]\n   */\n  _enlivenObjects: function (objects, callback, reviver) {\n    if (!objects || objects.length === 0) {\n      callback && callback([]);\n      return;\n    }\n\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      callback && callback(enlivenedObjects);\n    }, null, reviver);\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n   */\n  clone: function (callback, properties) {\n    var data = JSON.stringify(this.toJSON(properties));\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.document.createElement('canvas');\n\n    el.width = this.getWidth();\n    el.height = this.getHeight();\n\n    var clone = new fabric.Canvas(el);\n    clone.clipTo = this.clipTo;\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      degreesToRadians = fabric.util.degreesToRadians,\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash'),\n      objectCaching = !fabric.isLikelyNode,\n      ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   */\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Retrieves object's {@link fabric.Object#clipTo|clipping function}\n     * @method getClipTo\n     * @memberOf fabric.Object.prototype\n     * @return {Function}\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#clipTo|clipping function}\n     * @method setClipTo\n     * @memberOf fabric.Object.prototype\n     * @param {Function} clipTo Clipping function\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#transformMatrix|transformMatrix}\n     * @method getTransformMatrix\n     * @memberOf fabric.Object.prototype\n     * @return {Array} transformMatrix\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#transformMatrix|transformMatrix}\n     * @method setTransformMatrix\n     * @memberOf fabric.Object.prototype\n     * @param {Array} transformMatrix\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#visible|visible} state\n     * @method getVisible\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean} True if visible\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#visible|visible} state\n     * @method setVisible\n     * @memberOf fabric.Object.prototype\n     * @param {Boolean} value visible value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#shadow|shadow}\n     * @method getShadow\n     * @memberOf fabric.Object.prototype\n     * @return {Object} Shadow instance\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#stroke|stroke}\n     * @method getStroke\n     * @memberOf fabric.Object.prototype\n     * @return {String} stroke value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#stroke|stroke}\n     * @method setStroke\n     * @memberOf fabric.Object.prototype\n     * @param {String} value stroke value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#strokeWidth|strokeWidth}\n     * @method getStrokeWidth\n     * @memberOf fabric.Object.prototype\n     * @return {Number} strokeWidth value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#strokeWidth|strokeWidth}\n     * @method setStrokeWidth\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value strokeWidth value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#originX|originX}\n     * @method getOriginX\n     * @memberOf fabric.Object.prototype\n     * @return {String} originX value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#originX|originX}\n     * @method setOriginX\n     * @memberOf fabric.Object.prototype\n     * @param {String} value originX value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#originY|originY}\n     * @method getOriginY\n     * @memberOf fabric.Object.prototype\n     * @return {String} originY value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#originY|originY}\n     * @method setOriginY\n     * @memberOf fabric.Object.prototype\n     * @param {String} value originY value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#fill|fill}\n     * @method getFill\n     * @memberOf fabric.Object.prototype\n     * @return {String} Fill value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#fill|fill}\n     * @method setFill\n     * @memberOf fabric.Object.prototype\n     * @param {String} value Fill value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#opacity|opacity}\n     * @method getOpacity\n     * @memberOf fabric.Object.prototype\n     * @return {Number} Opacity value (0-1)\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#opacity|opacity}\n     * @method setOpacity\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value Opacity value (0-1)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#angle|angle} (in degrees)\n     * @method getAngle\n     * @memberOf fabric.Object.prototype\n     * @return {Number}\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#top|top position}\n     * @method getTop\n     * @memberOf fabric.Object.prototype\n     * @return {Number} Top value (in pixels)\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#top|top position}\n     * @method setTop\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value Top value (in pixels)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#left|left position}\n     * @method getLeft\n     * @memberOf fabric.Object.prototype\n     * @return {Number} Left value (in pixels)\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#left|left position}\n     * @method setLeft\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value Left value (in pixels)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#scaleX|scaleX} value\n     * @method getScaleX\n     * @memberOf fabric.Object.prototype\n     * @return {Number} scaleX value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#scaleX|scaleX} value\n     * @method setScaleX\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value scaleX value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#scaleY|scaleY} value\n     * @method getScaleY\n     * @memberOf fabric.Object.prototype\n     * @return {Number} scaleY value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#scaleY|scaleY} value\n     * @method setScaleY\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value scaleY value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#flipX|flipX} value\n     * @method getFlipX\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean} flipX value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#flipX|flipX} value\n     * @method setFlipX\n     * @memberOf fabric.Object.prototype\n     * @param {Boolean} value flipX value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#flipY|flipY} value\n     * @method getFlipY\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean} flipY value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#flipY|flipY} value\n     * @method setFlipY\n     * @memberOf fabric.Object.prototype\n     * @param {Boolean} value flipY value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Type of an object (rect, circle, path, etc.).\n     * Note that this property is meant to be read-only and not meant to be modified.\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n     * @type String\n     * @default\n     */\n    type:                     'object',\n\n    /**\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/40/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originX:                  'left',\n\n    /**\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/40/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originY:                  'top',\n\n    /**\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n     * @type Number\n     * @default\n     */\n    top:                      0,\n\n    /**\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n     * @type Number\n     * @default\n     */\n    left:                     0,\n\n    /**\n     * Object width\n     * @type Number\n     * @default\n     */\n    width:                    0,\n\n    /**\n     * Object height\n     * @type Number\n     * @default\n     */\n    height:                   0,\n\n    /**\n     * Object scale factor (horizontal)\n     * @type Number\n     * @default\n     */\n    scaleX:                   1,\n\n    /**\n     * Object scale factor (vertical)\n     * @type Number\n     * @default\n     */\n    scaleY:                   1,\n\n    /**\n     * When true, an object is rendered as flipped horizontally\n     * @type Boolean\n     * @default\n     */\n    flipX:                    false,\n\n    /**\n     * When true, an object is rendered as flipped vertically\n     * @type Boolean\n     * @default\n     */\n    flipY:                    false,\n\n    /**\n     * Opacity of an object\n     * @type Number\n     * @default\n     */\n    opacity:                  1,\n\n    /**\n     * Angle of rotation of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    angle:                    0,\n\n    /**\n     * Angle of skew on x axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewX:                    0,\n\n    /**\n     * Angle of skew on y axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewY:                    0,\n\n    /**\n     * Size of object's controlling corners (in pixels)\n     * @type Number\n     * @default\n     */\n    cornerSize:               13,\n\n    /**\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n     * @type Boolean\n     * @default\n     */\n    transparentCorners:       true,\n\n    /**\n     * Default cursor value used when hovering over this object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:              null,\n\n    /**\n     * Default cursor value used when moving this object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:               null,\n\n    /**\n     * Padding between object and its controlling borders (in pixels)\n     * @type Number\n     * @default\n     */\n    padding:                  0,\n\n    /**\n     * Color of controlling borders of an object (when it's active)\n     * @type String\n     * @default\n     */\n    borderColor:              'rgba(102,153,255,0.75)',\n\n    /**\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    borderDashArray:          null,\n\n    /**\n     * Color of controlling corners of an object (when it's active)\n     * @type String\n     * @default\n     */\n    cornerColor:              'rgba(102,153,255,0.5)',\n\n    /**\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    cornerStrokeColor:        null,\n\n    /**\n     * Specify style of control, 'rect' or 'circle'\n     * @since 1.6.2\n     * @type String\n     */\n    cornerStyle:          'rect',\n\n    /**\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    cornerDashArray:          null,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being scaled via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:          false,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being rotated via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:         true,\n\n    /**\n     * Color of object's fill\n     * @type String\n     * @default\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * Fill rule used to fill an object\n     * accepted values are nonzero, evenodd\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n     * @type String\n     * @default\n     */\n    fillRule:                 'nonzero',\n\n    /**\n     * Composite rule used for canvas globalCompositeOperation\n     * @type String\n     * @default\n     */\n    globalCompositeOperation: 'source-over',\n\n    /**\n     * Background color of an object.\n     * @type String\n     * @default\n     */\n    backgroundColor:          '',\n\n    /**\n     * Selection Background color of an object. colored layer behind the object when it is active.\n     * does not mix good with globalCompositeOperation methods.\n     * @type String\n     * @default\n     */\n    selectionBackgroundColor:          '',\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color\n     * @type String\n     * @default\n     */\n    stroke:                   null,\n\n    /**\n     * Width of a stroke used to render this object\n     * @type Number\n     * @default\n     */\n    strokeWidth:              1,\n\n    /**\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap:            'butt',\n\n    /**\n     * Corner style of an object's stroke (one of \"bevil\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin:           'miter',\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit:         10,\n\n    /**\n     * Shadow object representing shadow of this shape\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:                   null,\n\n    /**\n     * Opacity of object's controlling borders when object is active and moving\n     * @type Number\n     * @default\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * Scale factor of object's controlling borders\n     * @type Number\n     * @default\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Transform matrix (similar to SVG's transform matrix)\n     * @type Array\n     */\n    transformMatrix:          null,\n\n    /**\n     * Minimum allowed scale value of an object\n     * @type Number\n     * @default\n     */\n    minScaleLimit:            0.01,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n     * But events still fire on it.\n     * @type Boolean\n     * @default\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n     * @type Boolean\n     * @default\n     */\n    evented:                  true,\n\n    /**\n     * When set to `false`, an object is not rendered on canvas\n     * @type Boolean\n     * @default\n     */\n    visible:                  true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @type Boolean\n     * @default\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's controlling borders are not rendered\n     * @type Boolean\n     * @default\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `false`, object's controlling rotating point will not be visible or selectable\n     * @type Boolean\n     * @default\n     */\n    hasRotatingPoint:         true,\n\n    /**\n     * Offset for object's controlling rotating point (when enabled via `hasRotatingPoint`)\n     * @type Number\n     * @default\n     */\n    rotatingPointOffset:      40,\n\n    /**\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:       false,\n\n    /**\n     * When `false`, default object's values are not included in its serialization\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues:     true,\n\n    /**\n     * Function that determines clipping of an object (context is passed as a first argument)\n     * Note that context origin is at the object's center point (not left/top corner)\n     * @type Function\n     */\n    clipTo:                   null,\n\n    /**\n     * When `true`, object horizontal movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementX:            false,\n\n    /**\n     * When `true`, object vertical movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementY:            false,\n\n    /**\n     * When `true`, object rotation is locked\n     * @type Boolean\n     * @default\n     */\n    lockRotation:             false,\n\n    /**\n     * When `true`, object horizontal scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingX:             false,\n\n    /**\n     * When `true`, object vertical scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingY:             false,\n\n    /**\n     * When `true`, object non-uniform scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockUniScaling:           false,\n\n    /**\n     * When `true`, object horizontal skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingX:             false,\n\n    /**\n     * When `true`, object vertical skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingY:             false,\n\n    /**\n     * When `true`, object cannot be flipped by scaling into negative values\n     * @type Boolean\n     * @default\n     */\n    lockScalingFlip:          false,\n\n    /**\n     * When `true`, object is not exported in SVG or OBJECT/JSON\n     * since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    excludeFromExport:        false,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    objectCaching:            objectCaching,\n\n    /**\n     * When `true`, object properties are checked for cache invalidation. In some particular\n     * situation you may want this to be disabled ( spray brush, very big pathgroups, groups)\n     * or if your application does not allow you to modify properties for groups child you want\n     * to disable it for groups.\n     * default to false\n     * since 1.7.0\n     * @type Boolean\n     * @default false\n     */\n    statefullCache:            false,\n\n    /**\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n     * too much and will be redrawn with correct details at the end of scaling.\n     * this setting is performance and application dependant.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    noScaleCache:              true,\n\n    /**\n     * When set to `true`, object's cache will be rerendered next render call.\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    dirty:                true,\n\n    /**\n     * List of properties to consider when checking if state\n     * of an object is changed (fabric.Object#hasStateChanged)\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: (\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit ' +\n      'angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor ' +\n      'skewX skewY fillRule'\n    ).split(' '),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties: (\n      'fill stroke strokeWidth strokeDashArray width height' +\n      ' strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor'\n    ).split(' '),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      options = options || { };\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Create a the canvas used to keep the cached copy of the object\n     * @private\n     */\n    _createCacheCanvas: function() {\n      this._cacheProperties = {};\n      this._cacheCanvas = fabric.document.createElement('canvas');\n      this._cacheContext = this._cacheCanvas.getContext('2d');\n      this._updateCacheCanvas();\n    },\n\n    /**\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n     * and each side do not cross fabric.cacheSideLimit\n     * those numbers are configurable so that you can get as much detail as you want\n     * making bargain with performances.\n     * @param {Object} dims\n     * @param {Object} dims.width width of canvas\n     * @param {Object} dims.height height of canvas\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _limitCacheSize: function(dims) {\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          maximumSide = fabric.cacheSideLimit,\n          width = dims.width, height = dims.height,\n          ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal, maximumSide),\n          capValue = fabric.util.capValue, max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n      if (width > x) {\n        dims.zoomX /= width / x;\n        dims.width = x;\n      }\n      else if (width < min) {\n        dims.width = min;\n      }\n      if (height > y) {\n        dims.zoomY /= height / y;\n        dims.height = y;\n      }\n      else if (height < min) {\n        dims.height = min;\n      }\n      return dims;\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var zoom = this.canvas && this.canvas.getZoom() || 1,\n          objectScale = this.getObjectScaling(),\n          dim = this._getNonTransformedDimensions(),\n          retina = this.canvas && this.canvas._isRetinaScaling() ? fabric.devicePixelRatio : 1,\n          zoomX = objectScale.scaleX * zoom * retina,\n          zoomY = objectScale.scaleY * zoom * retina,\n          width = dim.x * zoomX,\n          height = dim.y * zoomY;\n      return {\n        width: width + ALIASING_LIMIT,\n        height: height + ALIASING_LIMIT,\n        zoomX: zoomX,\n        zoomY: zoomY\n      };\n    },\n\n    /**\n     * Update width and height of the canvas for cache\n     * returns true or false if canvas needed resize.\n     * @private\n     * @return {Boolean} true if the canvas has been resized\n     */\n    _updateCacheCanvas: function() {\n      if (this.noScaleCache && this.canvas && this.canvas._currentTransform) {\n        var action = this.canvas._currentTransform.action;\n        if (action.slice && action.slice(0, 5) === 'scale') {\n          return false;\n        }\n      }\n      var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width, height = dims.height,\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\n      if (dimensionsChanged) {\n        var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\n        if (sizeGrowing) {\n          additionalWidth = (width * 0.1) & ~1;\n          additionalHeight = (height * 0.1) & ~1;\n        }\n      }\n      if (shouldRedraw) {\n        if (shouldResizeCanvas) {\n          this._cacheCanvas.width = Math.max(Math.ceil(width) + additionalWidth, minCacheSize);\n          this._cacheCanvas.height = Math.max(Math.ceil(height) + additionalHeight, minCacheSize);\n          this.cacheTranslationX = (width + additionalWidth) / 2;\n          this.cacheTranslationY = (height + additionalHeight) / 2;\n        }\n        else {\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n          this._cacheContext.clearRect(0, 0, this._cacheCanvas.width, this._cacheCanvas.height);\n        }\n        this.cacheWidth = width;\n        this.cacheHeight = height;\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\n        this._cacheContext.scale(zoomX, zoomY);\n        this.zoomX = zoomX;\n        this.zoomY = zoomY;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Sets object's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function(options) {\n      this._setOptions(options);\n      this._initGradient(options.fill, 'fill');\n      this._initGradient(options.stroke, 'stroke');\n      this._initClipping(options);\n      this._initPattern(options.fill, 'fill');\n      this._initPattern(options.stroke, 'stroke');\n    },\n\n    /**\n     * Transforms context when rendering an object\n     * @param {CanvasRenderingContext2D} ctx Context\n     * @param {Boolean} fromLeft When true, context is transformed to object's top/left corner. This is used when rendering text on Node\n     */\n    transform: function(ctx, fromLeft) {\n      if (this.group && !this.group._transformDone && this.group === this.canvas._activeGroup) {\n        this.group.transform(ctx);\n      }\n      var center = fromLeft ? this._getLeftTopCoords() : this.getCenterPoint();\n      ctx.translate(center.x, center.y);\n      this.angle && ctx.rotate(degreesToRadians(this.angle));\n      ctx.scale(\n        this.scaleX * (this.flipX ? -1 : 1),\n        this.scaleY * (this.flipY ? -1 : 1)\n      );\n      this.skewX && ctx.transform(1, 0, Math.tan(degreesToRadians(this.skewX)), 1, 0, 0);\n      this.skewY && ctx.transform(1, Math.tan(degreesToRadians(this.skewY)), 0, 1, 0, 0);\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          object = {\n            type:                     this.type,\n            originX:                  this.originX,\n            originY:                  this.originY,\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\n            strokeLineCap:            this.strokeLineCap,\n            strokeLineJoin:           this.strokeLineJoin,\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle:                    toFixed(this.getAngle(), NUM_FRACTION_DIGITS),\n            flipX:                    this.flipX,\n            flipY:                    this.flipY,\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\n            visible:                  this.visible,\n            clipTo:                   this.clipTo && String(this.clipTo),\n            backgroundColor:          this.backgroundColor,\n            fillRule:                 this.fillRule,\n            globalCompositeOperation: this.globalCompositeOperation,\n            transformMatrix:          this.transformMatrix ? this.transformMatrix.concat() : null,\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS)\n          };\n\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      // will be overwritten by subclasses\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _removeDefaultValues: function(object) {\n      var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n      stateProperties.forEach(function(prop) {\n        if (object[prop] === prototype[prop]) {\n          delete object[prop];\n        }\n        var isArray = Object.prototype.toString.call(object[prop]) === '[object Array]' &&\n                      Object.prototype.toString.call(prototype[prop]) === '[object Array]';\n\n        // basically a check for [] === []\n        if (isArray && object[prop].length === 0 && prototype[prop].length === 0) {\n          delete object[prop];\n        }\n      });\n\n      return object;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.' + capitalize(this.type) + '>';\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getObjectScaling: function() {\n      var scaleX = this.scaleX, scaleY = this.scaleY;\n      if (this.group) {\n        var scaling = this.group.getObjectScaling();\n        scaleX *= scaling.scaleX;\n        scaleY *= scaling.scaleY;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Object} thisArg\n     */\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY');\n\n      if (shouldConstrainValue) {\n        value = this._constrainScale(value);\n      }\n      if (key === 'scaleX' && value < 0) {\n        this.flipX = !this.flipX;\n        value *= -1;\n      }\n      else if (key === 'scaleY' && value < 0) {\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\n        value = new fabric.Shadow(value);\n      }\n      else if (key === 'dirty' && this.group) {\n        this.group.set('dirty', value);\n      }\n\n      this[key] = value;\n\n      if (this.cacheProperties.indexOf(key) > -1) {\n        if (this.group) {\n          this.group.set('dirty', true);\n        }\n        this.dirty = true;\n      }\n\n      if (this.group && this.stateProperties.indexOf(key) > -1) {\n        this.group.set('dirty', true);\n      }\n\n      if (key === 'width' || key === 'height') {\n        this.minScaleLimit = Math.min(0.1, 1 / Math.max(this.width, this.height));\n      }\n\n      return this;\n    },\n\n    /**\n     * This callback function is called by the parent group of an object every\n     * time a non-delegated property changes on the group. It is passed the key\n     * and value as parameters. Not adding in this function's signature to avoid\n     * Travis build error about unused variables.\n     */\n    setOnGroup: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n    /**\n     * Sets sourcePath of an object\n     * @param {String} value Value to set sourcePath to\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setSourcePath: function(value) {\n      this.sourcePath = value;\n      return this;\n    },\n\n    /**\n     * Retrieves viewportTransform from Object's canvas if possible\n     * @method getViewportTransform\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    getViewportTransform: function() {\n      if (this.canvas && this.canvas.viewportTransform) {\n        return this.canvas.viewportTransform;\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /*\n     * @private\n     * return if the object would be visible in rendering\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    isNotVisible: function() {\n      return this.opacity === 0 || (this.width === 0 && this.height === 0) || !this.visible;\n    },\n\n    /**\n     * Renders an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    render: function(ctx, noTransform) {\n      // do not render if width/height are zeros or object is not visible\n      if (this.isNotVisible()) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      ctx.save();\n      //setup fill rule for current object\n      this._setupCompositeOperation(ctx);\n      this.drawSelectionBackground(ctx);\n      if (!noTransform) {\n        this.transform(ctx);\n      }\n      this._setOpacity(ctx);\n      this._setShadow(ctx);\n      if (this.transformMatrix) {\n        ctx.transform.apply(ctx, this.transformMatrix);\n      }\n      this.clipTo && fabric.util.clipContext(this, ctx);\n      if (this.shouldCache(noTransform)) {\n        if (!this._cacheCanvas) {\n          this._createCacheCanvas();\n        }\n        if (this.isCacheDirty(noTransform)) {\n          this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\n          this.drawObject(this._cacheContext, noTransform);\n          this.dirty = false;\n        }\n        this.drawCacheOnCanvas(ctx);\n      }\n      else {\n        this.dirty = false;\n        this.drawObject(ctx, noTransform);\n        if (noTransform && this.objectCaching && this.statefullCache) {\n          this.saveState({ propertySet: 'cacheProperties' });\n        }\n      }\n      this.clipTo && ctx.restore();\n      ctx.restore();\n    },\n\n    /**\n     * When returns `true`, force the object to have its own cache, even if it is inside a group\n     * it may be needed when your object behave in a particular way on the cache and always needs\n     * its own isolated canvas to render correctly.\n     * This function is created to be subclassed by custom classes.\n     * since 1.7.12\n     * @type function\n     * @return false\n     */\n    needsItsOwnCache: function() {\n      return false;\n    },\n\n    /**\n     * Decide if the object should cache or not.\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @param {Boolean} noTransform if rendereing in pathGroup, caching is not supported at object level\n     * @return {Boolean}\n     */\n    shouldCache: function(noTransform) {\n      return !noTransform && this.objectCaching &&\n      (!this.group || this.needsItsOwnCache() || !this.group.isCaching());\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * used by Group.shouldCache to know if child has a shadow recursively\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    drawObject: function(ctx, noTransform) {\n      this._renderBackground(ctx);\n      this._setStrokeStyles(ctx);\n      this._setFillStyles(ctx);\n      this._render(ctx, noTransform);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\n    },\n\n    /**\n     * Check if cache is dirty\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n     * on parent canvas.\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.isNotVisible()) {\n        return false;\n      }\n      if (this._cacheCanvas && !skipCanvas && this._updateCacheCanvas()) {\n        // in this case the context is already cleared.\n        return true;\n      }\n      else {\n        if (this.dirty || (this.statefullCache && this.hasStateChanged('cacheProperties'))) {\n          if (this._cacheCanvas && !skipCanvas) {\n            var width = this.cacheWidth / this.zoomX;\n            var height = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Draws a background for the object big as its untrasformed dimensions\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      if (!this.backgroundColor) {\n        return;\n      }\n      var dim = this._getNonTransformedDimensions();\n      ctx.fillStyle = this.backgroundColor;\n\n      ctx.fillRect(\n        -dim.x / 2,\n        -dim.y / 2,\n        dim.x,\n        dim.y\n      );\n      // if there is background color no other shadows\n      // should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setOpacity: function(ctx) {\n      ctx.globalAlpha *= this.opacity;\n    },\n\n    _setStrokeStyles: function(ctx) {\n      if (this.stroke) {\n        ctx.lineWidth = this.strokeWidth;\n        ctx.lineCap = this.strokeLineCap;\n        ctx.lineJoin = this.strokeLineJoin;\n        ctx.miterLimit = this.strokeMiterLimit;\n        ctx.strokeStyle = this.stroke.toLive\n          ? this.stroke.toLive(ctx, this)\n          : this.stroke;\n      }\n    },\n\n    _setFillStyles: function(ctx) {\n      if (this.fill) {\n        ctx.fillStyle = this.fill.toLive\n          ? this.fill.toLive(ctx, this)\n          : this.fill;\n      }\n    },\n\n    /**\n     * @private\n     * Sets line dash\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n     * @param {Array} dashArray array representing dashes\n     * @param {Function} alternative function to call if browaser does not support lineDash\n     */\n    _setLineDash: function(ctx, dashArray, alternative) {\n      if (!dashArray) {\n        return;\n      }\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n      if (1 & dashArray.length) {\n        dashArray.push.apply(dashArray, dashArray);\n      }\n      if (supportsLineDash) {\n        ctx.setLineDash(dashArray);\n      }\n      else {\n        alternative && alternative(ctx);\n      }\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderControls: function(ctx) {\n      if (!this.active || (this.group && this.group !== this.canvas.getActiveGroup())) {\n        return;\n      }\n\n      var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options;\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n      options = fabric.util.qrDecompose(matrix);\n\n      ctx.save();\n      ctx.translate(options.translateX, options.translateY);\n      ctx.lineWidth = 1 * this.borderScaleFactor;\n      if (!this.group) {\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      }\n      if (this.group && this.group === this.canvas.getActiveGroup()) {\n        ctx.rotate(degreesToRadians(options.angle));\n        this.drawBordersInGroup(ctx, options);\n      }\n      else {\n        ctx.rotate(degreesToRadians(this.angle));\n        this.drawBorders(ctx);\n      }\n      this.drawControls(ctx);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      var multX = (this.canvas && this.canvas.viewportTransform[0]) || 1,\n          multY = (this.canvas && this.canvas.viewportTransform[3]) || 1,\n          scaling = this.getObjectScaling();\n      if (this.canvas && this.canvas._isRetinaScaling()) {\n        multX *= fabric.devicePixelRatio;\n        multY *= fabric.devicePixelRatio;\n      }\n      ctx.shadowColor = this.shadow.color;\n      ctx.shadowBlur = this.shadow.blur * (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\n      ctx.shadowOffsetX = this.shadow.offsetX * multX * scaling.scaleX;\n      ctx.shadowOffsetY = this.shadow.offsetY * multY * scaling.scaleY;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _removeShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      ctx.shadowColor = '';\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\n     */\n    _applyPatternGradientTransform: function(ctx, filler) {\n      if (!filler.toLive) {\n        return;\n      }\n      var transform = filler.gradientTransform || filler.patternTransform;\n      if (transform) {\n        ctx.transform.apply(ctx, transform);\n      }\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n      ctx.translate(offsetX, offsetY);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderFill: function(ctx) {\n      if (!this.fill) {\n        return;\n      }\n\n      ctx.save();\n      this._applyPatternGradientTransform(ctx, this.fill);\n      if (this.fillRule === 'evenodd') {\n        ctx.fill('evenodd');\n      }\n      else {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderStroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray, this._renderDashedStroke);\n      this._applyPatternGradientTransform(ctx, this.stroke);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Clones an instance, some objects are async, so using callback method will work for every object.\n     * Using the direct return does not work for images and groups.\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {fabric.Object} clone of an instance\n     */\n    clone: function(callback, propertiesToInclude) {\n      if (this.constructor.fromObject) {\n        return this.constructor.fromObject(this.toObject(propertiesToInclude), callback);\n      }\n      return new fabric.Object(this.toObject(propertiesToInclude));\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * @param {Function} callback callback, invoked with an instance as a first argument\n     * @param {Object} [options] for clone as image, passed to toDataURL\n     * @param {Boolean} [options.enableRetinaScaling] enable retina scaling for the cloned image\n     * @return {fabric.Object} thisArg\n     */\n    cloneAsImage: function(callback, options) {\n      var dataUrl = this.toDataURL(options);\n      fabric.util.loadImage(dataUrl, function(img) {\n        if (callback) {\n          callback(new fabric.Image(img));\n        }\n      });\n      return this;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @param {Object} options Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetina] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     */\n    toDataURL: function(options) {\n      options || (options = { });\n\n      var el = fabric.util.createCanvasElement(),\n          boundingRect = this.getBoundingRect();\n\n      el.width = boundingRect.width;\n      el.height = boundingRect.height;\n      fabric.util.wrapElement(el, 'div');\n      var canvas = new fabric.StaticCanvas(el, { enableRetinaScaling: options.enableRetinaScaling });\n      // to avoid common confusion https://github.com/kangax/fabric.js/issues/806\n      if (options.format === 'jpg') {\n        options.format = 'jpeg';\n      }\n\n      if (options.format === 'jpeg') {\n        canvas.backgroundColor = '#fff';\n      }\n\n      var origParams = {\n        active: this.get('active'),\n        left: this.getLeft(),\n        top: this.getTop()\n      };\n\n      this.set('active', false);\n      this.setPositionByOrigin(new fabric.Point(canvas.getWidth() / 2, canvas.getHeight() / 2), 'center', 'center');\n\n      var originalCanvas = this.canvas;\n      canvas.add(this);\n      var data = canvas.toDataURL(options);\n\n      this.set(origParams).setCoords();\n      this.canvas = originalCanvas;\n\n      canvas.dispose();\n      canvas = null;\n\n      return data;\n    },\n\n    /**\n     * Returns true if specified type is identical to the type of an instance\n     * @param {String} type Type to check against\n     * @return {Boolean}\n     */\n    isType: function(type) {\n      return this.type === type;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} JSON\n     */\n    toJSON: function(propertiesToInclude) {\n      // delegate, not alias\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * Sets gradient (fill or stroke) of an object\n     * <b>Backwards incompatibility note:</b> This method was named \"setGradientFill\" until v1.1.0\n     * @param {String} property Property name 'stroke' or 'fill'\n     * @param {Object} [options] Options object\n     * @param {String} [options.type] Type of gradient 'radial' or 'linear'\n     * @param {Number} [options.x1=0] x-coordinate of start point\n     * @param {Number} [options.y1=0] y-coordinate of start point\n     * @param {Number} [options.x2=0] x-coordinate of end point\n     * @param {Number} [options.y2=0] y-coordinate of end point\n     * @param {Number} [options.r1=0] Radius of start point (only for radial gradients)\n     * @param {Number} [options.r2=0] Radius of end point (only for radial gradients)\n     * @param {Object} [options.colorStops] Color stops object eg. {0: 'ff0000', 1: '000000'}\n     * @param {Object} [options.gradientTransform] transforMatrix for gradient\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/58y8b/|jsFiddle demo}\n     * @example <caption>Set linear gradient</caption>\n     * object.setGradient('fill', {\n     *   type: 'linear',\n     *   x1: -object.width / 2,\n     *   y1: 0,\n     *   x2: object.width / 2,\n     *   y2: 0,\n     *   colorStops: {\n     *     0: 'red',\n     *     0.5: '#005555',\n     *     1: 'rgba(0,0,255,0.5)'\n     *   }\n     * });\n     * canvas.renderAll();\n     * @example <caption>Set radial gradient</caption>\n     * object.setGradient('fill', {\n     *   type: 'radial',\n     *   x1: 0,\n     *   y1: 0,\n     *   x2: 0,\n     *   y2: 0,\n     *   r1: object.width / 2,\n     *   r2: 10,\n     *   colorStops: {\n     *     0: 'red',\n     *     0.5: '#005555',\n     *     1: 'rgba(0,0,255,0.5)'\n     *   }\n     * });\n     * canvas.renderAll();\n     */\n    setGradient: function(property, options) {\n      options || (options = { });\n\n      var gradient = { colorStops: [] };\n\n      gradient.type = options.type || (options.r1 || options.r2 ? 'radial' : 'linear');\n      gradient.coords = {\n        x1: options.x1,\n        y1: options.y1,\n        x2: options.x2,\n        y2: options.y2\n      };\n\n      if (options.r1 || options.r2) {\n        gradient.coords.r1 = options.r1;\n        gradient.coords.r2 = options.r2;\n      }\n\n      gradient.gradientTransform = options.gradientTransform;\n      fabric.Gradient.prototype.addColorStop.call(gradient, options.colorStops);\n\n      return this.set(property, fabric.Gradient.forObject(this, gradient));\n    },\n\n    /**\n     * Sets pattern fill of an object\n     * @param {Object} options Options object\n     * @param {(String|HTMLImageElement)} options.source Pattern source\n     * @param {String} [options.repeat=repeat] Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @param {Number} [options.offsetX=0] Pattern horizontal offset from object's left/top corner\n     * @param {Number} [options.offsetY=0] Pattern vertical offset from object's left/top corner\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/QT3pa/|jsFiddle demo}\n     * @example <caption>Set pattern</caption>\n     * fabric.util.loadImage('http://fabricjs.com/assets/escheresque_ste.png', function(img) {\n     *   object.setPatternFill({\n     *     source: img,\n     *     repeat: 'repeat'\n     *   });\n     *   canvas.renderAll();\n     * });\n     */\n    setPatternFill: function(options) {\n      return this.set('fill', new fabric.Pattern(options));\n    },\n\n    /**\n     * Sets {@link fabric.Object#shadow|shadow} of an object\n     * @param {Object|String} [options] Options object or string (e.g. \"2px 2px 10px rgba(0,0,0,0.2)\")\n     * @param {String} [options.color=rgb(0,0,0)] Shadow color\n     * @param {Number} [options.blur=0] Shadow blur\n     * @param {Number} [options.offsetX=0] Shadow horizontal offset\n     * @param {Number} [options.offsetY=0] Shadow vertical offset\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/7gvJG/|jsFiddle demo}\n     * @example <caption>Set shadow with string notation</caption>\n     * object.setShadow('2px 2px 10px rgba(0,0,0,0.2)');\n     * canvas.renderAll();\n     * @example <caption>Set shadow with object notation</caption>\n     * object.setShadow({\n     *   color: 'red',\n     *   blur: 10,\n     *   offsetX: 20,\n     *   offsetY: 20\n     * });\n     * canvas.renderAll();\n     */\n    setShadow: function(options) {\n      return this.set('shadow', options ? new fabric.Shadow(options) : null);\n    },\n\n    /**\n     * Sets \"color\" of an instance (alias of `set('fill', &hellip;)`)\n     * @param {String} color Color value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setColor: function(color) {\n      this.set('fill', color);\n      return this;\n    },\n\n    /**\n     * Sets \"angle\" of an instance\n     * @param {Number} angle Angle value (in degrees)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setAngle: function(angle) {\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\n\n      if (shouldCenterOrigin) {\n        this._setOriginToCenter();\n      }\n\n      this.set('angle', angle);\n\n      if (shouldCenterOrigin) {\n        this._resetOrigin();\n      }\n\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerH: function () {\n      this.canvas && this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterH: function () {\n      this.canvas && this.canvas.viewportCenterObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas && this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterV: function () {\n      this.canvas && this.canvas.viewportCenterObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      this.canvas && this.canvas.centerObject(this);\n      return this;\n    },\n\n    /**\n     * Centers object on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenter: function () {\n      this.canvas && this.canvas.viewportCenterObject(this);\n      return this;\n    },\n\n    /**\n     * Removes object from canvas to which it was added last\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    remove: function() {\n      this.canvas && this.canvas.remove(this);\n      return this;\n    },\n\n    /**\n     * Returns coordinates of a pointer relative to an object\n     * @param {Event} e Event to operate upon\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\n     * @return {Object} Coordinates of a pointer (x, y)\n     */\n    getLocalPointer: function(e, pointer) {\n      pointer = pointer || this.canvas.getPointer(e);\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n      if (this.angle) {\n        pClicked = fabric.util.rotatePoint(\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\n      }\n      return {\n        x: pClicked.x - objectLeftTop.x,\n        y: pClicked.y - objectLeftTop.y\n      };\n    },\n\n    /**\n     * Sets canvas globalCompositeOperation for specific object\n     * custom composition operation for the particular object can be specifed using globalCompositeOperation property\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n     */\n    _setupCompositeOperation: function (ctx) {\n      if (this.globalCompositeOperation) {\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\n      }\n    }\n  });\n\n  fabric.util.createAccessors(fabric.Object);\n\n  /**\n   * Alias for {@link fabric.Object.prototype.setAngle}\n   * @alias rotate -> setAngle\n   * @memberOf fabric.Object\n   */\n  fabric.Object.prototype.rotate = fabric.Object.prototype.setAngle;\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  fabric.Object._fromObject = function(className, object, callback, forceAsync, extraParam) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    if (forceAsync) {\n      fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\n        if (typeof patterns[0] !== 'undefined') {\n          object.fill = patterns[0];\n        }\n        if (typeof patterns[1] !== 'undefined') {\n          object.stroke = patterns[1];\n        }\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n        callback && callback(instance);\n      });\n    }\n    else {\n      var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n      callback && callback(instance);\n      return instance;\n    }\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      originXOffset = {\n        left: -0.5,\n        center: 0,\n        right: 0.5\n      },\n      originYOffset = {\n        top: -0.5,\n        center: 0,\n        bottom: 0.5\n      };\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\n      var x = point.x,\n          y = point.y,\n          offsetX, offsetY, dim;\n\n      if (typeof fromOriginX === 'string') {\n        fromOriginX = originXOffset[fromOriginX];\n      }\n      else {\n        fromOriginX -= 0.5;\n      }\n\n      if (typeof toOriginX === 'string') {\n        toOriginX = originXOffset[toOriginX];\n      }\n      else {\n        toOriginX -= 0.5;\n      }\n\n      offsetX = toOriginX - fromOriginX;\n\n      if (typeof fromOriginY === 'string') {\n        fromOriginY = originYOffset[fromOriginY];\n      }\n      else {\n        fromOriginY -= 0.5;\n      }\n\n      if (typeof toOriginY === 'string') {\n        toOriginY = originYOffset[toOriginY];\n      }\n      else {\n        toOriginY -= 0.5;\n      }\n\n      offsetY = toOriginY - fromOriginY;\n\n      if (offsetX || offsetY) {\n        dim = this._getTransformedDimensions();\n        x = point.x + offsetX * dim.x;\n        y = point.y + offsetY * dim.y;\n      }\n\n      return new fabric.Point(x, y);\n    },\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToCenterPoint: function(point, originX, originY) {\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n     * @param {fabric.Point} center The point which corresponds to center of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToOriginPoint: function(center, originX, originY) {\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Returns the real center coordinates of the object\n     * @return {fabric.Point}\n     */\n    getCenterPoint: function() {\n      var leftTop = new fabric.Point(this.left, this.top);\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n    },\n\n    /**\n     * Returns the coordinates of the object based on center coordinates\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @return {fabric.Point}\n     */\n    // getOriginPoint: function(center) {\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\n    // },\n\n    /**\n     * Returns the coordinates of the object as if it has a different origin\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    getPointByOrigin: function(originX, originY) {\n      var center = this.getCenterPoint();\n      return this.translateToOriginPoint(center, originX, originY);\n    },\n\n    /**\n     * Returns the point in local coordinates\n     * @param {fabric.Point} point The point relative to the global coordinate system\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    toLocalPoint: function(point, originX, originY) {\n      var center = this.getCenterPoint(),\n          p, p2;\n\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      }\n      else {\n        p = new fabric.Point(this.left, this.top);\n      }\n\n      p2 = new fabric.Point(point.x, point.y);\n      if (this.angle) {\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\n      }\n      return p2.subtractEquals(p);\n    },\n\n    /**\n     * Returns the point in global coordinates\n     * @param {fabric.Point} The point relative to the local coordinate system\n     * @return {fabric.Point}\n     */\n    // toGlobalPoint: function(point) {\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n    // },\n\n    /**\n     * Sets the position of the object taking into consideration the object's origin\n     * @param {fabric.Point} pos The new position of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {void}\n     */\n    setPositionByOrigin: function(pos, originX, originY) {\n      var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\n\n      this.set('left', position.x);\n      this.set('top', position.y);\n    },\n\n    /**\n     * @param {String} to One of 'left', 'center', 'right'\n     */\n    adjustPosition: function(to) {\n      var angle = degreesToRadians(this.angle),\n          hypotFull = this.getWidth(),\n          xFull = Math.cos(angle) * hypotFull,\n          yFull = Math.sin(angle) * hypotFull,\n          offsetFrom, offsetTo;\n\n      //TODO: this function does not consider mixed situation like top, center.\n      if (typeof this.originX === 'string') {\n        offsetFrom = originXOffset[this.originX];\n      }\n      else {\n        offsetFrom = this.originX - 0.5;\n      }\n      if (typeof to === 'string') {\n        offsetTo = originXOffset[to];\n      }\n      else {\n        offsetTo = to - 0.5;\n      }\n      this.left += xFull * (offsetTo - offsetFrom);\n      this.top += yFull * (offsetTo - offsetFrom);\n      this.setCoords();\n      this.originX = to;\n    },\n\n    /**\n     * Sets the origin/position of the object to it's center point\n     * @private\n     * @return {void}\n     */\n    _setOriginToCenter: function() {\n      this._originalOriginX = this.originX;\n      this._originalOriginY = this.originY;\n\n      var center = this.getCenterPoint();\n\n      this.originX = 'center';\n      this.originY = 'center';\n\n      this.left = center.x;\n      this.top = center.y;\n    },\n\n    /**\n     * Resets the origin/position of the object to it's original origin\n     * @private\n     * @return {void}\n     */\n    _resetOrigin: function() {\n      var originPoint = this.translateToOriginPoint(\n        this.getCenterPoint(),\n        this._originalOriginX,\n        this._originalOriginY);\n\n      this.originX = this._originalOriginX;\n      this.originY = this._originalOriginY;\n\n      this.left = originPoint.x;\n      this.top = originPoint.y;\n\n      this._originalOriginX = null;\n      this._originalOriginY = null;\n    },\n\n    /**\n     * @private\n     */\n    _getLeftTopCoords: function() {\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\n    },\n\n    /**\n    * Callback; invoked right before object is about to go from active to inactive\n    */\n    onDeselect: function() {\n      /* NOOP */\n    }\n  });\n\n})();\n\n\n(function() {\n\n  function getCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y)\n    ];\n  }\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      multiplyMatrices = fabric.util.multiplyTransformMatrices;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * properties are tl,mt,tr,ml,mr,bl,mb,br,mtr for the main controls.\n     * each property is an object with x, y and corner.\n     * The `corner` property contains in a similar manner the 4 points of the\n     * interactive area of the corner.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, viewportTransform, top, left, padding.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcCoords;\n     * @memberOf fabric.Object.prototype\n     */\n    oCoords: null,\n\n    /**\n     * Describe object's corner position in canvas object absolute coordinates\n     * properties are tl,tr,bl,br and describe the four main corner.\n     * each property is an object with x, y, instance of Fabric.Point.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, top, left.\n     * Those coordinates are usefull to understand where an object is. They get updated\n     * with oCoords but they do not need to be updated when zoom or panning change.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcCoords(true);\n     * @memberOf fabric.Object.prototype\n     */\n    aCoords: null,\n\n    /**\n     * return correct set of coordinates for intersection\n     */\n    getCoords: function(absolute, calculate) {\n      if (!this.oCoords) {\n        this.setCoords();\n      }\n      var coords = absolute ? this.aCoords : this.oCoords;\n      return getCoords(calculate ? this.calcCoords(absolute) : coords);\n    },\n\n    /**\n     * Checks if object intersects with an area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with an area formed by 2 points\n     */\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n      return intersection.status === 'Intersection';\n    },\n\n    /**\n     * Checks if object intersects with another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with another object\n     */\n    intersectsWithObject: function(other, absolute, calculate) {\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n            this.getCoords(absolute, calculate),\n            other.getCoords(absolute, calculate)\n          );\n\n      return intersection.status === 'Intersection'\n        || other.isContainedWithinObject(this, absolute, calculate)\n        || this.isContainedWithinObject(other, absolute, calculate);\n    },\n\n    /**\n     * Checks if object is fully contained within area of another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area of another object\n     */\n    isContainedWithinObject: function(other, absolute, calculate) {\n      var points = this.getCoords(absolute, calculate),\n          i = 0, lines = other._getImageLines(\n            calculate ? other.calcCoords(absolute) : absolute ? other.aCoords : other.oCoords\n          );\n      for (; i < 4; i++) {\n        if (!other.containsPoint(points[i], lines)) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Checks if object is fully contained within area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\n     */\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\n      var boundingRect = this.getBoundingRect(absolute, calculate);\n\n      return (\n        boundingRect.left >= pointTL.x &&\n        boundingRect.left + boundingRect.width <= pointBR.x &&\n        boundingRect.top >= pointTL.y &&\n        boundingRect.top + boundingRect.height <= pointBR.y\n      );\n    },\n\n    /**\n     * Checks if point is inside the object\n     * @param {fabric.Point} point Point to check against\n     * @param {Object} [lines] object returned from @method _getImageLines\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if point is inside the object\n     */\n    containsPoint: function(point, lines, absolute, calculate) {\n      var lines = lines || this._getImageLines(\n        calculate ? this.calcCoords(absolute) : absolute ? this.aCoords : this.oCoords\n      ),\n          xPoints = this._findCrossPoints(point, lines);\n\n      // if xPoints is odd then point is inside the object\n      return (xPoints !== 0 && xPoints % 2 === 1);\n    },\n\n    /**\n     * Checks if object is contained within the canvas with current viewportTransform\n     * the check is done stopping at first point that appear on screen\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within canvas\n     */\n    isOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      var points = this.getCoords(true, calculate), point;\n      for (var i = 0; i < 4; i++) {\n        point = points[i];\n        if (point.x <= pointBR.x && point.x >= pointTL.x && point.y <= pointBR.y && point.y >= pointTL.y) {\n          return true;\n        }\n      }\n      // no points on screen, check intersection with absolute coordinates\n      if (this.intersectsWithRect(pointTL, pointBR, true)) {\n        return true;\n      }\n      // worst case scenario the object is so big that contanins the screen\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\n      if (this.containsPoint(centerPoint, null, true)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\n     * @private\n     * @param {Object} oCoords Coordinates of the object corners\n     */\n    _getImageLines: function(oCoords) {\n      return {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      };\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 object edges\n     * and the horizontal line determined by a point on canvas\n     * @private\n     * @param {fabric.Point} point Point to check\n     * @param {Object} lines Coordinates of the object being evaluated\n     */\n     // remove yi, not used but left code here just in case.\n    _findCrossPoints: function(point, lines) {\n      var b1, b2, a1, a2, xi, // yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in lines) {\n        iLine = lines[lineKey];\n        // optimisation 1: line below point. no cross\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\n          continue;\n        }\n        // optimisation 2: line above point. no cross\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\n          xi = iLine.o.x;\n          // yi = point.y;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n          a1 = point.y - b1 * point.x;\n          a2 = iLine.o.y - b2 * iLine.o.x;\n\n          xi = -(a1 - a2) / (b1 - b2);\n          // yi = a1 + b1 * xi;\n        }\n        // dont count xi < point.x cases\n        if (xi >= point.x) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount === 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Returns width of an object's bounding rectangle\n     * @deprecated since 1.0.4\n     * @return {Number} width value\n     */\n    getBoundingRectWidth: function() {\n      return this.getBoundingRect().width;\n    },\n\n    /**\n     * Returns height of an object's bounding rectangle\n     * @deprecated since 1.0.4\n     * @return {Number} height value\n     */\n    getBoundingRectHeight: function() {\n      return this.getBoundingRect().height;\n    },\n\n    /**\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\n     * the box is intented as aligned to axis of canvas.\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Object} Object with left, top, width, height properties\n     */\n    getBoundingRect: function(absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate);\n      return fabric.util.makeBoundingBoxFromPoints(coords);\n    },\n\n    /**\n     * Returns width of an object bounding box counting transformations\n     * @return {Number} width value\n     */\n    getWidth: function() {\n      return this._getTransformedDimensions().x;\n    },\n\n    /**\n     * Returns height of an object bounding box counting transformations\n     * to be renamed in 2.0\n     * @return {Number} height value\n     */\n    getHeight: function() {\n      return this._getTransformedDimensions().y;\n    },\n\n    /**\n     * Makes sure the scale is valid and modifies it if necessary\n     * @private\n     * @param {Number} value\n     * @return {Number}\n     */\n    _constrainScale: function(value) {\n      if (Math.abs(value) < this.minScaleLimit) {\n        if (value < 0) {\n          return -this.minScaleLimit;\n        }\n        else {\n          return this.minScaleLimit;\n        }\n      }\n      return value;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @param {Number} value Scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      value = this._constrainScale(value);\n\n      if (value < 0) {\n        this.flipX = !this.flipX;\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n\n      this.scaleX = value;\n      this.scaleY = value;\n      return this.setCoords();\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New width value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect().width / this.getWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New height value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect().height / this.getHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    /**\n     * Calculate and returns the .coords of an object.\n     * @return {Object} Object with tl, tr, br, bl ....\n     * @chainable\n     */\n    calcCoords: function(absolute) {\n      var theta = degreesToRadians(this.angle),\n          vpt = this.getViewportTransform(),\n          dim = absolute ? this._getTransformedDimensions() : this._calculateCurrentDimensions(),\n          currentWidth = dim.x, currentHeight = dim.y,\n          sinTh = Math.sin(theta),\n          cosTh = Math.cos(theta),\n          _angle = currentWidth > 0 ? Math.atan(currentHeight / currentWidth) : 0,\n          _hypotenuse = (currentWidth / Math.cos(_angle)) / 2,\n          offsetX = Math.cos(_angle + theta) * _hypotenuse,\n          offsetY = Math.sin(_angle + theta) * _hypotenuse,\n          center = this.getCenterPoint(),\n          // offset added for rotate and scale actions\n          coords = absolute ? center : fabric.util.transformPoint(center, vpt),\n          tl  = new fabric.Point(coords.x - offsetX, coords.y - offsetY),\n          tr  = new fabric.Point(tl.x + (currentWidth * cosTh), tl.y + (currentWidth * sinTh)),\n          bl  = new fabric.Point(tl.x - (currentHeight * sinTh), tl.y + (currentHeight * cosTh)),\n          br  = new fabric.Point(coords.x + offsetX, coords.y + offsetY);\n      if (!absolute) {\n        var ml  = new fabric.Point((tl.x + bl.x) / 2, (tl.y + bl.y) / 2),\n            mt  = new fabric.Point((tr.x + tl.x) / 2, (tr.y + tl.y) / 2),\n            mr  = new fabric.Point((br.x + tr.x) / 2, (br.y + tr.y) / 2),\n            mb  = new fabric.Point((br.x + bl.x) / 2, (br.y + bl.y) / 2),\n            mtr = new fabric.Point(mt.x + sinTh * this.rotatingPointOffset, mt.y - cosTh * this.rotatingPointOffset);\n      }\n\n      // debugging\n\n      /* setTimeout(function() {\n         canvas.contextTop.fillStyle = 'green';\n         canvas.contextTop.fillRect(mb.x, mb.y, 3, 3);\n         canvas.contextTop.fillRect(bl.x, bl.y, 3, 3);\n         canvas.contextTop.fillRect(br.x, br.y, 3, 3);\n         canvas.contextTop.fillRect(tl.x, tl.y, 3, 3);\n         canvas.contextTop.fillRect(tr.x, tr.y, 3, 3);\n         canvas.contextTop.fillRect(ml.x, ml.y, 3, 3);\n         canvas.contextTop.fillRect(mr.x, mr.y, 3, 3);\n         canvas.contextTop.fillRect(mt.x, mt.y, 3, 3);\n         canvas.contextTop.fillRect(mtr.x, mtr.y, 3, 3);\n       }, 50); */\n\n      var coords = {\n        // corners\n        tl: tl, tr: tr, br: br, bl: bl,\n      };\n      if (!absolute) {\n        // middle\n        coords.ml = ml;\n        coords.mt = mt;\n        coords.mr = mr;\n        coords.mb = mb;\n        // rotating point\n        coords.mtr = mtr;\n      }\n      return coords;\n    },\n\n    /**\n     * Sets corner position coordinates based on current angle, width and height\n     * See https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords\n     * @param {Boolean} [ignoreZoom] set oCoords with or without the viewport transform.\n     * @param {Boolean} [skipAbsolute] skip calculation of aCoords, usefull in setViewportTransform\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function(ignoreZoom, skipAbsolute) {\n      this.oCoords = this.calcCoords(ignoreZoom);\n      if (!skipAbsolute) {\n        this.aCoords = this.calcCoords(true);\n      }\n\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      ignoreZoom || (this._setCornerCoords && this._setCornerCoords());\n\n      return this;\n    },\n\n    /**\n     * calculate rotation matrix of an object\n     * @return {Array} rotation matrix for the object\n     */\n    _calcRotateMatrix: function() {\n      if (this.angle) {\n        var theta = degreesToRadians(this.angle), cos = Math.cos(theta), sin = Math.sin(theta);\n        // trying to keep rounding error small, ugly but it works.\n        if (cos === 6.123233995736766e-17 || cos === -1.8369701987210297e-16) {\n          cos = 0;\n        }\n        return [cos, sin, -sin, cos, 0, 0];\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /**\n     * calculate trasform Matrix that represent current transformation from\n     * object properties.\n     * @param {Boolean} [skipGroup] return transformMatrix for object and not go upward with parents\n     * @return {Array} matrix Transform Matrix for the object\n     */\n    calcTransformMatrix: function(skipGroup) {\n      var center = this.getCenterPoint(),\n          translateMatrix = [1, 0, 0, 1, center.x, center.y],\n          rotateMatrix,\n          dimensionMatrix = this._calcDimensionsTransformMatrix(this.skewX, this.skewY, true),\n          matrix;\n      if (this.group && !skipGroup) {\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(), translateMatrix);\n      }\n      else {\n        matrix = translateMatrix;\n      }\n      if (this.angle) {\n        rotateMatrix = this._calcRotateMatrix();\n        matrix = multiplyMatrices(matrix, rotateMatrix);\n      }\n      matrix = multiplyMatrices(matrix, dimensionMatrix);\n      return matrix;\n    },\n\n    _calcDimensionsTransformMatrix: function(skewX, skewY, flipping) {\n      var skewMatrix,\n          scaleX = this.scaleX * (flipping && this.flipX ? -1 : 1),\n          scaleY = this.scaleY * (flipping && this.flipY ? -1 : 1),\n          scaleMatrix = [scaleX, 0, 0, scaleY, 0, 0];\n      if (skewX) {\n        skewMatrix = [1, 0, Math.tan(degreesToRadians(skewX)), 1];\n        scaleMatrix = multiplyMatrices(scaleMatrix, skewMatrix, true);\n      }\n      if (skewY) {\n        skewMatrix = [1, Math.tan(degreesToRadians(skewY)), 0, 1];\n        scaleMatrix = multiplyMatrices(scaleMatrix, skewMatrix, true);\n      }\n      return scaleMatrix;\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getNonTransformedDimensions: function() {\n      var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n      return { x: w, y: h };\n    },\n\n    /*\n     * Calculate object bounding boxdimensions from its properties scale, skew.\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getTransformedDimensions: function(skewX, skewY) {\n      if (typeof skewX === 'undefined') {\n        skewX = this.skewX;\n      }\n      if (typeof skewY === 'undefined') {\n        skewY = this.skewY;\n      }\n      var dimensions = this._getNonTransformedDimensions(),\n          dimX = dimensions.x / 2, dimY = dimensions.y / 2,\n          points = [\n            {\n              x: -dimX,\n              y: -dimY\n            },\n            {\n              x: dimX,\n              y: -dimY\n            },\n            {\n              x: -dimX,\n              y: dimY\n            },\n            {\n              x: dimX,\n              y: dimY\n            }],\n          i, transformMatrix = this._calcDimensionsTransformMatrix(skewX, skewY, false),\n          bbox;\n      for (i = 0; i < points.length; i++) {\n        points[i] = fabric.util.transformPoint(points[i], transformMatrix);\n      }\n      bbox = fabric.util.makeBoundingBoxFromPoints(points);\n      return { x: bbox.width, y: bbox.height };\n    },\n\n    /*\n     * Calculate object dimensions for controls. include padding and canvas zoom\n     * private\n     */\n    _calculateCurrentDimensions: function()  {\n      var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = fabric.util.transformPoint(dim, vpt, true);\n\n      return p.scalarAdd(2 * this.padding);\n    },\n  });\n})();\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * Moves an object to the bottom of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendToBack: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n    }\n    else {\n      this.canvas.sendToBack(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to the top of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringToFront: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n    }\n    else {\n      this.canvas.bringToFront(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object down in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendBackwards: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\n    }\n    else {\n      this.canvas.sendBackwards(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object up in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringForward: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\n    }\n    else {\n      this.canvas.bringForward(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to specified level in stack of drawn objects\n   * @param {Number} index New position of object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  moveTo: function(index) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n    }\n    else {\n      this.canvas.moveTo(this, index);\n    }\n    return this;\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + ': none; ';\n    }\n    else if (value.toLive) {\n      return prop + ': url(#SVGID_' + value.id + '); ';\n    }\n    else {\n      var color = new fabric.Color(value),\n          str = prop + ': ' + color.toRgb() + '; ',\n          opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\n      }\n      return str;\n    }\n  }\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n\n      var fillRule = this.fillRule,\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\n          visibility = this.visible ? '' : ' visibility: hidden;',\n          filter = skipShadow ? '' : this.getSvgFilter(),\n          fill = getSvgColorString('fill', this.fill),\n          stroke = getSvgColorString('stroke', this.stroke);\n\n      return [\n        stroke,\n        'stroke-width: ', strokeWidth, '; ',\n        'stroke-dasharray: ', strokeDashArray, '; ',\n        'stroke-linecap: ', strokeLineCap, '; ',\n        'stroke-linejoin: ', strokeLineJoin, '; ',\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\n        fill,\n        'fill-rule: ', fillRule, '; ',\n        'opacity: ', opacity, ';',\n        filter,\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns filter for svg shadow\n     * @return {String}\n     */\n    getSvgFilter: function() {\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\n    },\n\n    /**\n     * Returns id attribute for svg output\n     * @return {String}\n     */\n    getSvgId: function() {\n      return this.id ? 'id=\"' + this.id + '\" ' : '';\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @return {String}\n     */\n    getSvgTransform: function() {\n      if (this.group && this.group.type === 'path-group') {\n        return '';\n      }\n      var toFixed = fabric.util.toFixed,\n          angle = this.getAngle(),\n          skewX = (this.getSkewX() % 360),\n          skewY = (this.getSkewY() % 360),\n          center = this.getCenterPoint(),\n\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          translatePart = this.type === 'path-group' ? '' : 'translate(' +\n                            toFixed(center.x, NUM_FRACTION_DIGITS) +\n                            ' ' +\n                            toFixed(center.y, NUM_FRACTION_DIGITS) +\n                          ')',\n\n          anglePart = angle !== 0\n            ? (' rotate(' + toFixed(angle, NUM_FRACTION_DIGITS) + ')')\n            : '',\n\n          scalePart = (this.scaleX === 1 && this.scaleY === 1)\n            ? '' :\n            (' scale(' +\n              toFixed(this.scaleX, NUM_FRACTION_DIGITS) +\n              ' ' +\n              toFixed(this.scaleY, NUM_FRACTION_DIGITS) +\n            ')'),\n\n          skewXPart = skewX !== 0 ? ' skewX(' + toFixed(skewX, NUM_FRACTION_DIGITS) + ')' : '',\n\n          skewYPart = skewY !== 0 ? ' skewY(' + toFixed(skewY, NUM_FRACTION_DIGITS) + ')' : '',\n\n          addTranslateX = this.type === 'path-group' ? this.width : 0,\n\n          flipXPart = this.flipX ? ' matrix(-1 0 0 1 ' + addTranslateX + ' 0) ' : '',\n\n          addTranslateY = this.type === 'path-group' ? this.height : 0,\n\n          flipYPart = this.flipY ? ' matrix(1 0 0 -1 0 ' + addTranslateY + ')' : '';\n\n      return [\n        translatePart, anglePart, scalePart, flipXPart, flipYPart, skewXPart, skewYPart\n      ].join('');\n    },\n\n    /**\n     * Returns transform-string for svg-export from the transform matrix of single elements\n     * @return {String}\n     */\n    getSvgTransformMatrix: function() {\n      return this.transformMatrix ? ' matrix(' + this.transformMatrix.join(' ') + ') ' : '';\n    },\n\n    /**\n     * @private\n     */\n    _createBaseSVGMarkup: function() {\n      var markup = [];\n\n      if (this.fill && this.fill.toLive) {\n        markup.push(this.fill.toSVG(this, false));\n      }\n      if (this.stroke && this.stroke.toLive) {\n        markup.push(this.stroke.toSVG(this, false));\n      }\n      if (this.shadow) {\n        markup.push(this.shadow.toSVG(this));\n      }\n      return markup;\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function() {\n\n  var extend = fabric.util.object.extend,\n      originalSet = 'stateProperties';\n\n  /*\n    Depends on `stateProperties`\n  */\n  function saveProps(origin, destination, props) {\n    var tmpObj = { }, deep = true;\n    props.forEach(function(prop) {\n      tmpObj[prop] = origin[prop];\n    });\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    }\n    else if (Array.isArray(origValue)) {\n      if (origValue.length !== currentValue.length) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    else if (origValue && typeof origValue === 'object') {\n      var keys = Object.keys(origValue), key;\n      if (!firstPass && keys.length !== Object.keys(currentValue).length) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Returns true if object state (one of its state properties) was changed\n     * @param {String} [propertySet] optional name for the set of property we want to save\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n     */\n    hasStateChanged: function(propertySet) {\n      propertySet = propertySet || originalSet;\n      var dashedPropertySet = '_' + propertySet;\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\n        return true;\n      }\n      return !_isEqual(this[dashedPropertySet], this, true);\n    },\n\n    /**\n     * Saves state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    saveState: function(options) {\n      var propertySet = options && options.propertySet || originalSet,\n          destination = '_' + propertySet;\n      if (!this[destination]) {\n        return this.setupState(options);\n      }\n      saveProps(this, destination, this[propertySet]);\n      if (options && options.stateProperties) {\n        saveProps(this, destination, options.stateProperties);\n      }\n      return this;\n    },\n\n    /**\n     * Setups state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    setupState: function(options) {\n      options = options || { };\n      var propertySet = options.propertySet || originalSet;\n      options.propertySet = propertySet;\n      this['_' + propertySet] = { };\n      this.saveState(options);\n      return this;\n    }\n  });\n})();\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      /* eslint-disable camelcase */\n      isVML = function() { return typeof G_vmlCanvasManager !== 'undefined'; };\n      /* eslint-enable camelcase */\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * The object interactivity controls.\n     * @private\n     */\n    _controlsVisibility: null,\n\n    /**\n     * Determines which corner has been clicked\n     * @private\n     * @param {Object} pointer The pointer indicating the mouse position\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(pointer) {\n      if (!this.hasControls || !this.active) {\n        return false;\n      }\n\n      var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines;\n      this.__corner = 0;\n      for (var i in this.oCoords) {\n\n        if (!this.isControlVisible(i)) {\n          continue;\n        }\n\n        if (i === 'mtr' && !this.hasRotatingPoint) {\n          continue;\n        }\n\n        if (this.get('lockUniScaling') &&\n           (i === 'mt' || i === 'mr' || i === 'mb' || i === 'ml')) {\n          continue;\n        }\n\n        lines = this._getImageLines(this.oCoords[i].corner);\n\n        // debugging\n\n        // canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n        if (xPoints !== 0 && xPoints % 2 === 1) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords,\n          newTheta = degreesToRadians(45 - this.angle),\n          /* Math.sqrt(2 * Math.pow(this.cornerSize, 2)) / 2, */\n          /* 0.707106 stands for sqrt(2)/2 */\n          cornerHypotenuse = this.cornerSize * 0.707106,\n          cosHalfOffset = cornerHypotenuse * Math.cos(newTheta),\n          sinHalfOffset = cornerHypotenuse * Math.sin(newTheta),\n          x, y;\n\n      for (var point in coords) {\n        x = coords[point].x;\n        y = coords[point].y;\n        coords[point].corner = {\n          tl: {\n            x: x - sinHalfOffset,\n            y: y - cosHalfOffset\n          },\n          tr: {\n            x: x + cosHalfOffset,\n            y: y - sinHalfOffset\n          },\n          bl: {\n            x: x - cosHalfOffset,\n            y: y + sinHalfOffset\n          },\n          br: {\n            x: x + sinHalfOffset,\n            y: y + cosHalfOffset\n          }\n        };\n      }\n    },\n\n    /**\n     * Draws a colored layer behind the object, inside its selection borders.\n     * Requires public options: padding, selectionBackgroundColor\n     * this function is called when the context is transformed\n     * has checks to be skipped when the object is on a staticCanvas\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawSelectionBackground: function(ctx) {\n      if (!this.selectionBackgroundColor || this.group || !this.active ||\n        (this.canvas && !this.canvas.interactive)) {\n        return this;\n      }\n      ctx.save();\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n      ctx.translate(center.x, center.y);\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\n      ctx.rotate(degreesToRadians(this.angle));\n      ctx.fillStyle = this.selectionBackgroundColor;\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx) {\n      if (!this.hasBorders) {\n        return this;\n      }\n\n      var wh = this._calculateCurrentDimensions(),\n          strokeWidth = 1 / this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth;\n\n      ctx.save();\n      ctx.strokeStyle = this.borderColor;\n      this._setLineDash(ctx, this.borderDashArray, null);\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      if (this.hasRotatingPoint && this.isControlVisible('mtr') && !this.get('lockRotation') && this.hasControls) {\n\n        var rotateHeight = -height / 2;\n\n        ctx.beginPath();\n        ctx.moveTo(0, rotateHeight);\n        ctx.lineTo(0, rotateHeight - this.rotatingPointOffset);\n        ctx.closePath();\n        ctx.stroke();\n      }\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box when it is inside a group.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {object} options object representing current object parameters\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBordersInGroup: function(ctx, options) {\n      if (!this.hasBorders) {\n        return this;\n      }\n\n      var p = this._getNonTransformedDimensions(),\n          matrix = fabric.util.customTransformMatrix(options.scaleX, options.scaleY, options.skewX),\n          wh = fabric.util.transformPoint(p, matrix),\n          strokeWidth = 1 / this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth;\n\n      ctx.save();\n      this._setLineDash(ctx, this.borderDashArray, null);\n      ctx.strokeStyle = this.borderColor;\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: cornerSize, padding\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawControls: function(ctx) {\n      if (!this.hasControls) {\n        return this;\n      }\n\n      var wh = this._calculateCurrentDimensions(),\n          width = wh.x,\n          height = wh.y,\n          scaleOffset = this.cornerSize,\n          left = -(width + scaleOffset) / 2,\n          top = -(height + scaleOffset) / 2,\n          methodName = this.transparentCorners ? 'stroke' : 'fill';\n\n      ctx.save();\n      ctx.strokeStyle = ctx.fillStyle = this.cornerColor;\n      if (!this.transparentCorners) {\n        ctx.strokeStyle = this.cornerStrokeColor;\n      }\n      this._setLineDash(ctx, this.cornerDashArray, null);\n\n      // top-left\n      this._drawControl('tl', ctx, methodName,\n        left,\n        top);\n\n      // top-right\n      this._drawControl('tr', ctx, methodName,\n        left + width,\n        top);\n\n      // bottom-left\n      this._drawControl('bl', ctx, methodName,\n        left,\n        top + height);\n\n      // bottom-right\n      this._drawControl('br', ctx, methodName,\n        left + width,\n        top + height);\n\n      if (!this.get('lockUniScaling')) {\n\n        // middle-top\n        this._drawControl('mt', ctx, methodName,\n          left + width / 2,\n          top);\n\n        // middle-bottom\n        this._drawControl('mb', ctx, methodName,\n          left + width / 2,\n          top + height);\n\n        // middle-right\n        this._drawControl('mr', ctx, methodName,\n          left + width,\n          top + height / 2);\n\n        // middle-left\n        this._drawControl('ml', ctx, methodName,\n          left,\n          top + height / 2);\n      }\n\n      // middle-top-rotate\n      if (this.hasRotatingPoint) {\n        this._drawControl('mtr', ctx, methodName,\n          left + width / 2,\n          top - this.rotatingPointOffset);\n      }\n\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _drawControl: function(control, ctx, methodName, left, top) {\n      if (!this.isControlVisible(control)) {\n        return;\n      }\n      var size = this.cornerSize, stroke = !this.transparentCorners && this.cornerStrokeColor;\n      switch (this.cornerStyle) {\n        case 'circle':\n          ctx.beginPath();\n          ctx.arc(left + size / 2, top + size / 2, size / 2, 0, 2 * Math.PI, false);\n          ctx[methodName]();\n          if (stroke) {\n            ctx.stroke();\n          }\n          break;\n        default:\n          isVML() || this.transparentCorners || ctx.clearRect(left, top, size, size);\n          ctx[methodName + 'Rect'](left, top, size, size);\n          if (stroke) {\n            ctx.strokeRect(left, top, size, size);\n          }\n      }\n    },\n\n    /**\n     * Returns true if the specified control is visible, false otherwise.\n     * @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @returns {Boolean} true if the specified control is visible, false otherwise\n     */\n    isControlVisible: function(controlName) {\n      return this._getControlsVisibility()[controlName];\n    },\n\n    /**\n     * Sets the visibility of the specified control.\n     * @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlVisible: function(controlName, visible) {\n      this._getControlsVisibility()[controlName] = visible;\n      return this;\n    },\n\n    /**\n     * Sets the visibility state of object controls.\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlsVisibility: function(options) {\n      options || (options = { });\n\n      for (var p in options) {\n        this.setControlVisible(p, options[p]);\n      }\n      return this;\n    },\n\n    /**\n     * Returns the instance of the control visibility set for this object.\n     * @private\n     * @returns {Object}\n     */\n    _getControlsVisibility: function() {\n      if (!this._controlsVisibility) {\n        this._controlsVisibility = {\n          tl: true,\n          tr: true,\n          br: true,\n          bl: true,\n          ml: true,\n          mt: true,\n          mr: true,\n          mb: true,\n          mtr: true\n        };\n      }\n      return this._controlsVisibility;\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Animation duration (in ms) for fx* methods\n   * @type Number\n   * @default\n   */\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('left'),\n      endValue: this.getCenter().left,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('top'),\n      endValue: this.getCenter().top,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @param {fabric.Object} object Object to remove\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('opacity'),\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onStart: function() {\n        object.set('active', false);\n      },\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n  /**\n   * Animates object's properties\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n   * @return {fabric.Object} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n   * @chainable\n   *\n   * As object — multiple properties\n   *\n   * object.animate({ left: ..., top: ... });\n   * object.animate({ left: ..., top: ... }, { duration: ... });\n   *\n   * As string — one property\n   *\n   * object.animate('left', ...);\n   * object.animate('left', { duration: ... });\n   *\n   */\n  animate: function() {\n    if (arguments[0] && typeof arguments[0] === 'object') {\n      var propsToAnimate = [], prop, skipCallbacks;\n      for (prop in arguments[0]) {\n        propsToAnimate.push(prop);\n      }\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n        prop = propsToAnimate[i];\n        skipCallbacks = i !== len - 1;\n        this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks);\n      }\n    }\n    else {\n      this._animate.apply(this, arguments);\n    }\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to animate\n   * @param {String} to Value to animate to\n   * @param {Object} [options] Options object\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n   */\n  _animate: function(property, to, options, skipCallbacks) {\n    var _this = this, propPair;\n\n    to = to.toString();\n\n    if (!options) {\n      options = { };\n    }\n    else {\n      options = fabric.util.object.clone(options);\n    }\n\n    if (~property.indexOf('.')) {\n      propPair = property.split('.');\n    }\n\n    var currentValue = propPair\n      ? this.get(propPair[0])[propPair[1]]\n      : this.get(property);\n\n    if (!('from' in options)) {\n      options.from = currentValue;\n    }\n\n    if (~to.indexOf('=')) {\n      to = currentValue + parseFloat(to.replace('=', ''));\n    }\n    else {\n      to = parseFloat(to);\n    }\n\n    fabric.util.animate({\n      startValue: options.from,\n      endValue: to,\n      byValue: options.by,\n      easing: options.easing,\n      duration: options.duration,\n      abort: options.abort && function() {\n        return options.abort.call(_this);\n      },\n      onChange: function(value, valueProgress, timeProgress) {\n        if (propPair) {\n          _this[propPair[0]][propPair[1]] = value;\n        }\n        else {\n          _this.set(property, value);\n        }\n        if (skipCallbacks) {\n          return;\n        }\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\n      },\n      onComplete: function(value, valueProgress, timeProgress) {\n        if (skipCallbacks) {\n          return;\n        }\n\n        _this.setCoords();\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\n      }\n    });\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 },\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash');\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'x1',\n    'x2',\n    'y1',\n    'y2'\n  );\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'line',\n\n    /**\n     * x value or first line edge\n     * @type Number\n     * @default\n     */\n    x1: 0,\n\n    /**\n     * y value or first line edge\n     * @type Number\n     * @default\n     */\n    y1: 0,\n\n    /**\n     * x value or second line edge\n     * @type Number\n     * @default\n     */\n    x2: 0,\n\n    /**\n     * y value or second line edge\n     * @type Number\n     * @default\n     */\n    y2: 0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Array} [points] Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.width = Math.abs(this.x2 - this.x1);\n      this.height = Math.abs(this.y2 - this.y1);\n\n      this.left = 'left' in options\n        ? options.left\n        : this._getLeftToOriginX();\n\n      this.top = 'top' in options\n        ? options.top\n        : this._getTopToOriginY();\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      if (typeof coordProps[key] !== 'undefined') {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n     */\n    _getLeftToOriginX: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originX',\n        axis1: 'x1',\n        axis2: 'x2',\n        dimension: 'width'\n      },\n      { // possible values of origin\n        nearest: 'left',\n        center: 'center',\n        farthest: 'right'\n      }\n    ),\n\n    /**\n     * @private\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n     */\n    _getTopToOriginY: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originY',\n        axis1: 'y1',\n        axis2: 'y2',\n        dimension: 'height'\n      },\n      { // possible values of origin\n        nearest: 'top',\n        center: 'center',\n        farthest: 'bottom'\n      }\n    ),\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n\n      if (noTransform) {\n        //  Line coords are distances from left-top of canvas to origin of line.\n        //  To render line in a path-group, we need to translate them to\n        //  distances from center of path-group to center of line.\n        var cp = this.getCenterPoint(),\n            offset = this.strokeWidth / 2;\n        ctx.translate(\n          cp.x - (this.strokeLineCap === 'butt' && this.height === 0 ? 0 : offset),\n          cp.y - (this.strokeLineCap === 'butt' && this.width === 0 ? 0 : offset)\n        );\n      }\n\n      if (!this.strokeDashArray || this.strokeDashArray && supportsLineDash) {\n        // move from center (of virtual box) to its left/top corner\n        // we can't assume x1, y1 is top left and x2, y2 is bottom right\n        var p = this.calcLinePoints();\n        ctx.moveTo(p.x1, p.y1);\n        ctx.lineTo(p.x2, p.y2);\n      }\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\n      this.stroke && this._renderStroke(ctx);\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p = this.calcLinePoints();\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, p.x1, p.y1, p.x2, p.y2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @methd toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     */\n    _getNonTransformedDimensions: function() {\n      var dim = this.callSuper('_getNonTransformedDimensions');\n      if (this.strokeLineCap === 'butt') {\n        if (this.width === 0) {\n          dim.y -= this.strokeWidth;\n        }\n        if (this.height === 0) {\n          dim.x -= this.strokeWidth;\n        }\n      }\n      return dim;\n    },\n\n    /**\n     * Recalculates line points given width and height\n     * @private\n     */\n    calcLinePoints: function() {\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = (xMult * this.width * 0.5),\n          y1 = (yMult * this.height * 0.5),\n          x2 = (xMult * this.width * -0.5),\n          y2 = (yMult * this.height * -0.5);\n\n      return {\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      };\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(),\n          p = { x1: this.x1, x2: this.x2, y1: this.y1, y2: this.y2 };\n\n      if (!(this.group && this.group.type === 'path-group')) {\n        p = this.calcLinePoints();\n      }\n      markup.push(\n        '<line ', this.getSvgId(),\n          'x1=\"', p.x1,\n          '\" y1=\"', p.y1,\n          '\" x2=\"', p.x2,\n          '\" y2=\"', p.y2,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          this.getSvgTransformMatrix(),\n        '\"/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Line} instance of fabric.Line\n   */\n  fabric.Line.fromElement = function(element, options) {\n    options = options || { };\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\n        points = [\n          parsedAttributes.x1 || 0,\n          parsedAttributes.y1 || 0,\n          parsedAttributes.x2 || 0,\n          parsedAttributes.y2 || 0\n        ];\n    options.originX = 'left';\n    options.originY = 'top';\n    return new fabric.Line(points, extend(parsedAttributes, options));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Line} instance of fabric.Line\n   */\n  fabric.Line.fromObject = function(object, callback, forceAsync) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    };\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    var line = fabric.Object._fromObject('Line', options, _callback, forceAsync, 'points');\n    if (line) {\n      delete line.points;\n    }\n    return line;\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n        axis1 = propertyNames.axis1,\n        axis2 = propertyNames.axis2,\n        dimension = propertyNames.dimension,\n        nearest = originValues.nearest,\n        center = originValues.center,\n        farthest = originValues.farthest;\n\n    return function() {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n\n  }\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      pi = Math.PI,\n      extend = fabric.util.object.extend;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'radius'\n  );\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'circle',\n\n    /**\n     * Radius of this circle\n     * @type Number\n     * @default\n     */\n    radius: 0,\n\n    /**\n     * Start angle of the circle, moving clockwise\n     * @type Number\n     * @default 0\n     */\n    startAngle: 0,\n\n    /**\n     * End angle of the circle\n     * @type Number\n     * @default 2Pi\n     */\n    endAngle: pi * 2,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Circle} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('radius', options && options.radius || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Circle} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (key === 'radius') {\n        this.setRadius(value);\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = 0, y = 0,\n          angle = (this.endAngle - this.startAngle) % ( 2 * pi);\n\n      if (angle === 0) {\n        if (this.group && this.group.type === 'path-group') {\n          x = this.left + this.radius;\n          y = this.top + this.radius;\n        }\n        markup.push(\n          '<circle ', this.getSvgId(),\n            'cx=\"' + x + '\" cy=\"' + y + '\" ',\n            'r=\"', this.radius,\n            '\" style=\"', this.getSvgStyles(),\n            '\" transform=\"', this.getSvgTransform(),\n            ' ', this.getSvgTransformMatrix(),\n          '\"/>\\n'\n        );\n      }\n      else {\n        var startX = Math.cos(this.startAngle) * this.radius,\n            startY = Math.sin(this.startAngle) * this.radius,\n            endX = Math.cos(this.endAngle) * this.radius,\n            endY = Math.sin(this.endAngle) * this.radius,\n            largeFlag = angle > pi ? '1' : '0';\n\n        markup.push(\n          '<path d=\"M ' + startX + ' ' + startY,\n          ' A ' + this.radius + ' ' + this.radius,\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          ' ', this.getSvgTransformMatrix(),\n          '\"/>\\n'\n        );\n      }\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n      ctx.arc(noTransform ? this.left + this.radius : 0,\n              noTransform ? this.top + this.radius : 0,\n              this.radius,\n              this.startAngle,\n              this.endAngle, false);\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @return {fabric.Circle} thisArg\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      return this.set('width', value * 2).set('height', value * 2);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   * @return {fabric.Circle} Instance of fabric.Circle\n   */\n  fabric.Circle.fromElement = function(element, options) {\n    options || (options = { });\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error('value of `r` attribute is required and can not be negative');\n    }\n\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top = parsedAttributes.top || 0;\n\n    var obj = new fabric.Circle(extend(parsedAttributes, options));\n\n    obj.left -= obj.radius;\n    obj.top -= obj.radius;\n    return obj;\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius >= 0));\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {Object} Instance of fabric.Circle\n   */\n  fabric.Circle.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Circle', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'triangle',\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('width', options && options.width || 100)\n          .set('height', options && options.height || 100);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, -widthBy2, heightBy2, 0, -heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, 0, -heightBy2, widthBy2, heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, widthBy2, heightBy2, -widthBy2, heightBy2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(),\n          widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + ' ' + heightBy2,\n            '0 ' + -heightBy2,\n            widthBy2 + ' ' + heightBy2\n          ]\n          .join(',');\n\n      markup.push(\n        '<polygon ', this.getSvgId(),\n          'points=\"', points,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n        '\"/>'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Triangle}\n   */\n  fabric.Triangle.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Triangle', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2,\n      extend = fabric.util.object.extend;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'rx',\n    'ry'\n  );\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'ellipse',\n\n    /**\n     * Horizontal radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Ellipse} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('rx', options && options.rx || 0);\n      this.set('ry', options && options.ry || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Ellipse} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      switch (key) {\n\n        case 'rx':\n          this.rx = value;\n          this.set('width', value * 2);\n          break;\n\n        case 'ry':\n          this.ry = value;\n          this.set('height', value * 2);\n          break;\n\n      }\n      return this;\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRx: function() {\n      return this.get('rx') * this.get('scaleX');\n    },\n\n    /**\n     * Returns Vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRy: function() {\n      return this.get('ry') * this.get('scaleY');\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = 0, y = 0;\n      if (this.group && this.group.type === 'path-group') {\n        x = this.left + this.rx;\n        y = this.top + this.ry;\n      }\n      markup.push(\n        '<ellipse ', this.getSvgId(),\n          'cx=\"', x, '\" cy=\"', y, '\" ',\n          'rx=\"', this.rx,\n          '\" ry=\"', this.ry,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          this.getSvgTransformMatrix(),\n        '\"/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n      ctx.arc(\n        noTransform ? this.left + this.rx : 0,\n        noTransform ? (this.top + this.ry) * this.rx / this.ry : 0,\n        this.rx,\n        0,\n        piBy2,\n        false);\n      ctx.restore();\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, options) {\n    options || (options = { });\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top = parsedAttributes.top || 0;\n\n    var ellipse = new fabric.Ellipse(extend(parsedAttributes, options));\n\n    ellipse.top -= ellipse.ry;\n    ellipse.left -= ellipse.rx;\n    return ellipse;\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Ellipse', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push('rx', 'ry');\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push('rx', 'ry');\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\n\n    /**\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: stateProperties,\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'rect',\n\n    /**\n     * Horizontal border radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical border radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Initializes rx/ry attributes\n     * @private\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n\n      // optimize 1x1 case (used in spray brush)\n      if (this.width === 1 && this.height === 1) {\n        ctx.fillRect(-0.5, -0.5, 1, 1);\n        return;\n      }\n\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = noTransform ? this.left : -this.width / 2,\n          y = noTransform ? this.top : -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n      ctx.beginPath();\n\n      ctx.moveTo(x + rx, y);\n\n      ctx.lineTo(x + w - rx, y);\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\n\n      ctx.lineTo(x + w, y + h - ry);\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\n\n      ctx.lineTo(x + rx, y + h);\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\n\n      ctx.lineTo(x, y + ry);\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n      ctx.closePath();\n\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = this.left, y = this.top;\n      if (!(this.group && this.group.type === 'path-group')) {\n        x = -this.width / 2;\n        y = -this.height / 2;\n      }\n      markup.push(\n        '<rect ', this.getSvgId(),\n          'x=\"', x, '\" y=\"', y,\n          '\" rx=\"', this.get('rx'), '\" ry=\"', this.get('ry'),\n          '\" width=\"', this.width, '\" height=\"', this.height,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          this.getSvgTransformMatrix(),\n        '\"/>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Rect} Instance of fabric.Rect\n   */\n  fabric.Rect.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n    options = options || { };\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top  = parsedAttributes.top  || 0;\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    return rect;\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {Object} instance of fabric.Rect\n   */\n  fabric.Rect.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Rect', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed,\n      NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push('points');\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polyline',\n\n    /**\n     * Points array\n     * @type Array\n     * @default\n     */\n    points: null,\n\n    /**\n     * Minimum X from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minX: 0,\n\n    /**\n     * Minimum Y from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minY: 0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Array} points Array of points (where each point is an object with x and y)\n     * @param {Object} [options] Options object\n     * @return {fabric.Polyline} thisArg\n     * @example\n     * var poly = new fabric.Polyline([\n     *     { x: 10, y: 10 },\n     *     { x: 50, y: 30 },\n     *     { x: 40, y: 70 },\n     *     { x: 60, y: 50 },\n     *     { x: 100, y: 150 },\n     *     { x: 40, y: 100 }\n     *   ], {\n     *   stroke: 'red',\n     *   left: 100,\n     *   top: 100\n     * });\n     */\n    initialize: function(points, options) {\n      options = options || {};\n      this.points = points || [];\n      this.callSuper('initialize', options);\n      this._calcDimensions();\n      if (!('top' in options)) {\n        this.top = this.minY;\n      }\n      if (!('left' in options)) {\n        this.left = this.minX;\n      }\n      this.pathOffset = {\n        x: this.minX + this.width / 2,\n        y: this.minY + this.height / 2\n      };\n    },\n\n    /**\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var points = this.points,\n          minX = min(points, 'x'),\n          minY = min(points, 'y'),\n          maxX = max(points, 'x'),\n          maxY = max(points, 'y');\n\n      this.width = (maxX - minX) || 0;\n      this.height = (maxY - minY) || 0;\n      this.minX = minX || 0;\n      this.minY = minY || 0;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        points: this.points.concat()\n      });\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var points = [],\n          diffX = 0,\n          diffY = 0,\n          markup = this._createBaseSVGMarkup();\n\n      if (!(this.group && this.group.type === 'path-group')) {\n        diffX = this.pathOffset.x;\n        diffY = this.pathOffset.y;\n      }\n\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\n        );\n      }\n      markup.push(\n        '<', this.type, ' ', this.getSvgId(),\n          'points=\"', points.join(''),\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          ' ', this.getSvgTransformMatrix(),\n        '\"/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    commonRender: function(ctx, noTransform) {\n      var point, len = this.points.length,\n          x = noTransform ? 0 : this.pathOffset.x,\n          y = noTransform ? 0 : this.pathOffset.y;\n\n      if (!len || isNaN(this.points[len - 1].y)) {\n        // do not draw if no points or odd points\n        // NaN comes from parseFloat of a empty string in parser\n        return false;\n      }\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n      for (var i = 0; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x - x, point.y - y);\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      if (!this.commonRender(ctx, noTransform)) {\n        return;\n      }\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p1, p2;\n\n      ctx.beginPath();\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        p1 = this.points[i];\n        p2 = this.points[i + 1] || p1;\n        fabric.util.drawDashedLine(ctx, p1.x, p1.y, p2.x, p2.y, this.strokeDashArray);\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Polyline} Instance of fabric.Polyline\n   */\n  fabric.Polyline.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polyline.ATTRIBUTE_NAMES);\n\n    return new fabric.Polyline(points, fabric.util.object.extend(parsedAttributes, options));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Polyline} Instance of fabric.Polyline\n   */\n  fabric.Polyline.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Polyline', object, callback, forceAsync, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polygon',\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      if (!this.commonRender(ctx, noTransform)) {\n        return;\n      }\n      ctx.closePath();\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      this.callSuper('_renderDashedStroke', ctx);\n      ctx.closePath();\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Polygon} Instance of fabric.Polygon\n   */\n  fabric.Polygon.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polygon.ATTRIBUTE_NAMES);\n\n    return new fabric.Polygon(points, extend(parsedAttributes, options));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Polygon} Instance of fabric.Polygon\n   */\n  fabric.Polygon.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Polygon', object, callback, forceAsync, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      _toString = Object.prototype.toString,\n      drawArc = fabric.util.drawArc,\n      commandLengths = {\n        m: 2,\n        l: 2,\n        h: 1,\n        v: 1,\n        c: 6,\n        s: 4,\n        q: 4,\n        t: 2,\n        a: 7\n      },\n      repeatedCommands = {\n        m: 'l',\n        M: 'L'\n      };\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push('path');\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push('path', 'fillRule');\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path',\n\n    /**\n     * Array of path points\n     * @type Array\n     * @default\n     */\n    path: null,\n\n    /**\n     * Minimum X from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minX: 0,\n\n    /**\n     * Minimum Y from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minY: 0,\n\n    cacheProperties: cacheProperties,\n\n    stateProperties: stateProperties,\n\n    /**\n     * Constructor\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     * @return {fabric.Path} thisArg\n     */\n    initialize: function(path, options) {\n      options = options || { };\n      this.callSuper('initialize', options);\n\n      if (!path) {\n        path = [];\n      }\n\n      var fromArray = _toString.call(path) === '[object Array]';\n\n      this.path = fromArray\n        ? path\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        : path.match && path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n      if (!this.path) {\n        return;\n      }\n\n      if (!fromArray) {\n        this.path = this._parsePath();\n      }\n\n      this._setPositionDimensions(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} options Options object\n     */\n    _setPositionDimensions: function(options) {\n      var calcDim = this._parseDimensions();\n\n      this.minX = calcDim.left;\n      this.minY = calcDim.top;\n      this.width = calcDim.width;\n      this.height = calcDim.height;\n\n      if (typeof options.left === 'undefined') {\n        this.left = calcDim.left + (this.originX === 'center'\n          ? this.width / 2\n          : this.originX === 'right'\n            ? this.width\n            : 0);\n      }\n\n      if (typeof options.top === 'undefined') {\n        this.top = calcDim.top + (this.originY === 'center'\n          ? this.height / 2\n          : this.originY === 'bottom'\n            ? this.height\n            : 0);\n      }\n\n      this.pathOffset = this.pathOffset || {\n        x: this.minX + this.width / 2,\n        y: this.minY + this.height / 2\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _renderPathCommands: function(ctx) {\n      var current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n      if (this.group && this.group.type === 'path-group') {\n        l = 0;\n        t = 0;\n      }\n\n      ctx.beginPath();\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'l': // lineto, relative\n            x += current[1];\n            y += current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'h': // horizontal lineto, relative\n            x += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'H': // horizontal lineto, absolute\n            x = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'v': // vertical lineto, relative\n            y += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'V': // verical lineto, absolute\n            y = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'm': // moveTo, relative\n            x += current[1];\n            y += current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'c': // bezierCurveTo, relative\n            tempX = x + current[5];\n            tempY = y + current[6];\n            controlX = x + current[3];\n            controlY = y + current[4];\n            ctx.bezierCurveTo(\n              x + current[1] + l, // x1\n              y + current[2] + t, // y1\n              controlX + l, // x2\n              controlY + t, // y2\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 's': // shorthand cubic bezierCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              x + current[1] + l,\n              y + current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'S': // shorthand cubic bezierCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = current[1];\n            controlY = current[2];\n\n            break;\n\n          case 'q': // quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 't': // shorthand quadraticCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[1];\n            tempY = y + current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n\n            break;\n\n          case 'T':\n            tempX = current[1];\n            tempY = current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'a':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + x + l,\n              current[7] + y + t\n            ]);\n            x += current[6];\n            y += current[7];\n            break;\n\n          case 'A':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + l,\n              current[7] + t\n            ]);\n            x = current[6];\n            y = current[7];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            ctx.closePath();\n            break;\n        }\n        previous = current;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _render: function(ctx) {\n      this._renderPathCommands(ctx);\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var o = extend(this.callSuper('toObject', ['sourcePath', 'pathOffset'].concat(propertiesToInclude)), {\n        path: this.path.map(function(item) { return item.slice(); }),\n        top: this.top,\n        left: this.left,\n      });\n      return o;\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(propertiesToInclude);\n      if (this.sourcePath) {\n        o.path = this.sourcePath;\n      }\n      delete o.sourcePath;\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var chunks = [],\n          markup = this._createBaseSVGMarkup(), addTransform = '';\n\n      for (var i = 0, len = this.path.length; i < len; i++) {\n        chunks.push(this.path[i].join(' '));\n      }\n      var path = chunks.join(' ');\n      if (!(this.group && this.group.type === 'path-group')) {\n        addTransform = ' translate(' + (-this.pathOffset.x) + ', ' + (-this.pathOffset.y) + ') ';\n      }\n      markup.push(\n        '<path ', this.getSvgId(),\n          'd=\"', path,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(), addTransform,\n          this.getSvgTransformMatrix(), '\" stroke-linecap=\"round\" ',\n        '/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns number representation of an instance complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     */\n    _parsePath: function() {\n      var result = [],\n          coords = [],\n          currentPath,\n          parsed,\n          re = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:e[-+]?\\d+)?)/ig,\n          match,\n          coordsStr;\n\n      for (var i = 0, coordsParsed, len = this.path.length; i < len; i++) {\n        currentPath = this.path[i];\n\n        coordsStr = currentPath.slice(1).trim();\n        coords.length = 0;\n\n        while ((match = re.exec(coordsStr))) {\n          coords.push(match[0]);\n        }\n\n        coordsParsed = [currentPath.charAt(0)];\n\n        for (var j = 0, jlen = coords.length; j < jlen; j++) {\n          parsed = parseFloat(coords[j]);\n          if (!isNaN(parsed)) {\n            coordsParsed.push(parsed);\n          }\n        }\n\n        var command = coordsParsed[0],\n            commandLength = commandLengths[command.toLowerCase()],\n            repeatedCommand = repeatedCommands[command] || command;\n\n        if (coordsParsed.length - 1 > commandLength) {\n          for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\n            result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\n            command = repeatedCommand;\n          }\n        }\n        else {\n          result.push(coordsParsed);\n        }\n      }\n\n      return result;\n    },\n\n    /**\n     * @private\n     */\n    _parseDimensions: function() {\n\n      var aX = [],\n          aY = [],\n          current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          bounds;\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'l': // lineto, relative\n            x += current[1];\n            y += current[2];\n            bounds = [];\n            break;\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            bounds = [];\n            break;\n\n          case 'h': // horizontal lineto, relative\n            x += current[1];\n            bounds = [];\n            break;\n\n          case 'H': // horizontal lineto, absolute\n            x = current[1];\n            bounds = [];\n            break;\n\n          case 'v': // vertical lineto, relative\n            y += current[1];\n            bounds = [];\n            break;\n\n          case 'V': // verical lineto, absolute\n            y = current[1];\n            bounds = [];\n            break;\n\n          case 'm': // moveTo, relative\n            x += current[1];\n            y += current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'c': // bezierCurveTo, relative\n            tempX = x + current[5];\n            tempY = y + current[6];\n            controlX = x + current[3];\n            controlY = y + current[4];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              x + current[1], // x1\n              y + current[2], // y1\n              controlX, // x2\n              controlY, // y2\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            controlX = current[3];\n            controlY = current[4];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              controlX,\n              controlY,\n              current[5],\n              current[6]\n            );\n            x = current[5];\n            y = current[6];\n            break;\n\n          case 's': // shorthand cubic bezierCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              x + current[1],\n              y + current[2],\n              tempX,\n              tempY\n            );\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = x + current[1];\n            controlY = y + current[2];\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'S': // shorthand cubic bezierCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              current[1],\n              current[2],\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 'q': // quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n            controlX = x + current[1];\n            controlY = y + current[2];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            controlX = current[1];\n            controlY = current[2];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              current[3],\n              current[4]\n            );\n            x = current[3];\n            y = current[4];\n            break;\n\n          case 't': // shorthand quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[1];\n            tempY = y + current[2];\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n\n            break;\n\n          case 'T':\n            tempX = current[1];\n            tempY = current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'a':\n            // TODO: optimize this\n            bounds = fabric.util.getBoundsOfArc(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + x,\n              current[7] + y\n            );\n            x += current[6];\n            y += current[7];\n            break;\n\n          case 'A':\n            // TODO: optimize this\n            bounds = fabric.util.getBoundsOfArc(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6],\n              current[7]\n            );\n            x = current[6];\n            y = current[7];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            break;\n        }\n        previous = current;\n        bounds.forEach(function (point) {\n          aX.push(point.x);\n          aY.push(point.y);\n        });\n        aX.push(x);\n        aY.push(y);\n      }\n\n      var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY,\n\n          o = {\n            left: minX,\n            top: minY,\n            width: deltaX,\n            height: deltaY\n          };\n\n      return o;\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   */\n  fabric.Path.fromObject = function(object, callback, forceAsync) {\n    // remove this pattern rom 2.0, accept just object.\n    var path;\n    if (typeof object.path === 'string') {\n      fabric.loadSVGFromURL(object.path, function (elements) {\n        var pathUrl = object.path;\n        path = elements[0];\n        delete object.path;\n\n        path.setOptions(object);\n        path.setSourcePath(pathUrl);\n\n        callback && callback(path);\n      });\n    }\n    else {\n      return fabric.Object._fromObject('Path', object, callback, forceAsync, 'path');\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   */\n  fabric.Path.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    callback && callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @memberOf fabric.Path\n   * @type Boolean\n   * @default\n   */\n  fabric.Path.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.PathGroup) {\n    fabric.warn('fabric.PathGroup is already defined');\n    return;\n  }\n\n  /**\n   * Path group class\n   * @class fabric.PathGroup\n   * @extends fabric.Path\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.PathGroup#initialize} for constructor definition\n   */\n  fabric.PathGroup = fabric.util.createClass(fabric.Object, /** @lends fabric.PathGroup.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path-group',\n\n    /**\n     * Fill value\n     * @type String\n     * @default\n     */\n    fill: '',\n\n    /**\n     * Pathgroups are container, do not render anything on theyr own, ence no cache properties\n     * @type Boolean\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * Constructor\n     * @param {Array} paths\n     * @param {Object} [options] Options object\n     * @return {fabric.PathGroup} thisArg\n     */\n    initialize: function(paths, options) {\n\n      options = options || { };\n      this.paths = paths || [];\n\n      for (var i = this.paths.length; i--;) {\n        this.paths[i].group = this;\n      }\n\n      if (options.toBeParsed) {\n        this.parseDimensionsFromPaths(options);\n        delete options.toBeParsed;\n      }\n      this.setOptions(options);\n      this.setCoords();\n    },\n\n    /**\n     * Calculate width and height based on paths contained\n     */\n    parseDimensionsFromPaths: function(options) {\n      var points, p, xC = [], yC = [], path, height, width,\n          m;\n      for (var j = this.paths.length; j--;) {\n        path = this.paths[j];\n        height = path.height + path.strokeWidth;\n        width = path.width + path.strokeWidth;\n        points = [\n          { x: path.left, y: path.top },\n          { x: path.left + width, y: path.top },\n          { x: path.left, y: path.top + height },\n          { x: path.left + width, y: path.top + height }\n        ];\n        m = this.paths[j].transformMatrix;\n        for (var i = 0; i < points.length; i++) {\n          p = points[i];\n          if (m) {\n            p = fabric.util.transformPoint(p, m, false);\n          }\n          xC.push(p.x);\n          yC.push(p.y);\n        }\n      }\n      options.width = Math.max.apply(null, xC);\n      options.height = Math.max.apply(null, yC);\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    drawObject: function(ctx) {\n      ctx.save();\n      ctx.translate(-this.width / 2, -this.height / 2);\n      for (var i = 0, l = this.paths.length; i < l; ++i) {\n        this.paths[i].render(ctx, true);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Decide if the object should cache or not.\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var parentCache = this.objectCaching && (!this.group || this.needsItsOwnCache() || !this.group.isCaching());\n      this.caching = parentCache;\n      if (parentCache) {\n        for (var i = 0, len = this.paths.length; i < len; i++) {\n          if (this.paths[i].willDrawShadow()) {\n            this.caching = false;\n            return false;\n          }\n        }\n      }\n      return parentCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (this.shadow) {\n        return true;\n      }\n      for (var i = 0, len = this.paths.length; i < len; i++) {\n        if (this.paths[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isCaching: function() {\n      return this.caching || this.group && this.group.isCaching();\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function() {\n      if (this.callSuper('isCacheDirty')) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this.paths.length; i < len; i++) {\n        if (this.paths[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Sets certain property to a certain value\n     * @param {String} prop\n     * @param {*} value\n     * @return {fabric.PathGroup} thisArg\n     */\n    _set: function(prop, value) {\n\n      if (prop === 'fill' && value && this.isSameColor()) {\n        var i = this.paths.length;\n        while (i--) {\n          this.paths[i]._set(prop, value);\n        }\n      }\n\n      return this.callSuper('_set', prop, value);\n    },\n\n    /**\n     * Returns object representation of this path group\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var pathsToObject = this.paths.map(function(path) {\n        var originalDefaults = path.includeDefaultValues;\n        path.includeDefaultValues = path.group.includeDefaultValues;\n        var obj = path.toObject(propertiesToInclude);\n        path.includeDefaultValues = originalDefaults;\n        return obj;\n      });\n      var o = extend(this.callSuper('toObject', ['sourcePath'].concat(propertiesToInclude)), {\n        paths: pathsToObject\n      });\n      return o;\n    },\n\n    /**\n     * Returns dataless object representation of this path group\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} dataless object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(propertiesToInclude);\n      if (this.sourcePath) {\n        o.paths = this.sourcePath;\n      }\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var objects = this.getObjects(),\n          p = this.getPointByOrigin('left', 'top'),\n          translatePart = 'translate(' + p.x + ' ' + p.y + ')',\n          markup = this._createBaseSVGMarkup();\n      markup.push(\n        '<g ', this.getSvgId(),\n        'style=\"', this.getSvgStyles(), '\" ',\n        'transform=\"', this.getSvgTransformMatrix(), translatePart, this.getSvgTransform(), '\" ',\n        '>\\n'\n      );\n\n      for (var i = 0, len = objects.length; i < len; i++) {\n        markup.push('\\t', objects[i].toSVG(reviver));\n      }\n      markup.push('</g>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns a string representation of this path group\n     * @return {String} string representation of an object\n     */\n    toString: function() {\n      return '#<fabric.PathGroup (' + this.complexity() +\n        '): { top: ' + this.top + ', left: ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns true if all paths in this group are of same color\n     * @return {Boolean} true if all paths are of the same color (`fill`)\n     */\n    isSameColor: function() {\n      var firstPathFill = this.getObjects()[0].get('fill') || '';\n      if (typeof firstPathFill !== 'string') {\n        return false;\n      }\n      firstPathFill = firstPathFill.toLowerCase();\n      return this.getObjects().every(function(path) {\n        var pathFill = path.get('fill') || '';\n        return typeof pathFill === 'string' && (pathFill).toLowerCase() === firstPathFill;\n      });\n    },\n\n    /**\n     * Returns number representation of object's complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return this.paths.reduce(function(total, path) {\n        return total + ((path && path.complexity) ? path.complexity() : 0);\n      }, 0);\n    },\n\n    /**\n     * Returns all paths in this path group\n     * @return {Array} array of path objects included in this path group\n     */\n    getObjects: function() {\n      return this.paths;\n    }\n  });\n\n  /**\n   * Creates fabric.PathGroup instance from an object representation\n   * @static\n   * @memberOf fabric.PathGroup\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.PathGroup instance is created\n   */\n  fabric.PathGroup.fromObject = function(object, callback) {\n    var originalPaths = object.paths;\n    delete object.paths;\n    if (typeof originalPaths === 'string') {\n      fabric.loadSVGFromURL(originalPaths, function (elements) {\n        var pathUrl = originalPaths;\n        var pathGroup = fabric.util.groupSVGElements(elements, object, pathUrl);\n        object.paths = originalPaths;\n        callback(pathGroup);\n      });\n    }\n    else {\n      fabric.util.enlivenObjects(originalPaths, function(enlivenedObjects) {\n        var pathGroup = new fabric.PathGroup(enlivenedObjects, object);\n        object.paths = originalPaths;\n        callback(pathGroup);\n      });\n    }\n  };\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @memberOf fabric.PathGroup\n   * @type Boolean\n   * @default\n   */\n  fabric.PathGroup.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  // lock-related properties, for use in fabric.Group#get\n  // to enable locking behavior on group\n  // when one of its objects has lock-related properties set\n  var _lockProperties = {\n    lockMovementX:  true,\n    lockMovementY:  true,\n    lockRotation:   true,\n    lockScalingX:   true,\n    lockScalingY:   true,\n    lockUniScaling: true\n  };\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'group',\n\n    /**\n     * Width of stroke\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * Indicates if click events should also check for subtargets\n     * @type Boolean\n     * @default\n     */\n    subTargetCheck: false,\n\n    /**\n     * Groups are container, do not render anything on theyr own, ence no cache properties\n     * @type Boolean\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * Constructor\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options, isAlreadyGrouped) {\n      options = options || { };\n\n      this._objects = [];\n      // if objects enclosed in a group have been grouped already,\n      // we cannot change properties of objects.\n      // Thus we need to set options to group without objects,\n      // because delegatedProperties propagate to objects.\n      isAlreadyGrouped && this.callSuper('initialize', options);\n\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (options.originX) {\n        this.originX = options.originX;\n      }\n      if (options.originY) {\n        this.originY = options.originY;\n      }\n\n      if (isAlreadyGrouped) {\n        // do not change coordinate of objects enclosed in a group,\n        // because objects coordinate system have been group coodinate system already.\n        this._updateObjectsCoords(true);\n      }\n      else {\n        this._calcBounds();\n        this._updateObjectsCoords();\n        this.callSuper('initialize', options);\n      }\n\n      this.setCoords();\n      this.saveCoords();\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsCoords: function(skipCoordsChange) {\n      var center = this.getCenterPoint();\n      for (var i = this._objects.length; i--; ){\n        this._updateObjectCoords(this._objects[i], center, skipCoordsChange);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     * @param {fabric.Point} center, current center of group.\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of object dose not change\n     */\n    _updateObjectCoords: function(object, center, skipCoordsChange) {\n      // do not display corners of objects enclosed in a group\n      object.__origHasControls = object.hasControls;\n      object.hasControls = false;\n\n      if (skipCoordsChange) {\n        return;\n      }\n\n      var objectLeft = object.getLeft(),\n          objectTop = object.getTop(),\n          ignoreZoom = true, skipAbsolute = true;\n\n      object.set({\n        left: objectLeft - center.x,\n        top: objectTop - center.y\n      });\n      object.setCoords(ignoreZoom, skipAbsolute);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      if (object) {\n        this._objects.push(object);\n        object.group = this;\n        object._set('canvas', this.canvas);\n      }\n      // since _restoreObjectsState set objects inactive\n      this.forEachObject(this._setObjectActive, this);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _setObjectActive: function(object) {\n      object.set('active', true);\n      object.group = this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      // since _restoreObjectsState set objects inactive\n      this.forEachObject(this._setObjectActive, this);\n\n      this.remove(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _onObjectAdded: function(object) {\n      this.dirty = true;\n      object.group = this;\n      object._set('canvas', this.canvas);\n    },\n\n    /**\n     * @private\n     */\n    _onObjectRemoved: function(object) {\n      this.dirty = true;\n      delete object.group;\n      object.set('active', false);\n    },\n\n    /**\n     * Properties that are delegated to group objects when reading/writing\n     * @param {Object} delegatedProperties\n     */\n    delegatedProperties: {\n      fill:             true,\n      stroke:           true,\n      strokeWidth:      true,\n      fontFamily:       true,\n      fontWeight:       true,\n      fontSize:         true,\n      fontStyle:        true,\n      lineHeight:       true,\n      textDecoration:   true,\n      textAlign:        true,\n      backgroundColor:  true\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      var i = this._objects.length;\n\n      if (this.delegatedProperties[key] || key === 'canvas') {\n        while (i--) {\n          this._objects[i].set(key, value);\n        }\n      }\n      else {\n        while (i--) {\n          this._objects[i].setOnGroup(key, value);\n        }\n      }\n\n      this.callSuper('_set', key, value);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var objsToObject = this.getObjects().map(function(obj) {\n        var originalDefaults = obj.includeDefaultValues;\n        obj.includeDefaultValues = obj.group.includeDefaultValues;\n        var _obj = obj.toObject(propertiesToInclude);\n        obj.includeDefaultValues = originalDefaults;\n        return _obj;\n      });\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        objects: objsToObject\n      });\n    },\n\n    /**\n     * Returns object representation of an instance, in dataless mode.\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var objsToObject = this.getObjects().map(function(obj) {\n        var originalDefaults = obj.includeDefaultValues;\n        obj.includeDefaultValues = obj.group.includeDefaultValues;\n        var _obj = obj.toDatalessObject(propertiesToInclude);\n        obj.includeDefaultValues = originalDefaults;\n        return _obj;\n      });\n      return extend(this.callSuper('toDatalessObject', propertiesToInclude), {\n        objects: objsToObject\n      });\n    },\n\n    /**\n     * Renders instance on a given context\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx) {\n      this._transformDone = true;\n      this.callSuper('render', ctx);\n      this._transformDone = false;\n    },\n\n    /**\n     * Decide if the object should cache or not.\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var parentCache = this.objectCaching && (!this.group || this.needsItsOwnCache() || !this.group.isCaching());\n      this.caching = parentCache;\n      if (parentCache) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            this.caching = false;\n            return false;\n          }\n        }\n      }\n      return parentCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (this.callSuper('willDrawShadow')) {\n        return true;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isCaching: function() {\n      return this.caching || this.group && this.group.isCaching();\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    drawObject: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._renderObject(this._objects[i], ctx);\n      }\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function() {\n      if (this.callSuper('isCacheDirty')) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            // if this group has not a cache canvas there is nothing to clean\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    _renderControls: function(ctx, noTransform) {\n      ctx.save();\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      this.callSuper('_renderControls', ctx, noTransform);\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i]._renderControls(ctx);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     */\n    _renderObject: function(object, ctx) {\n      // do not render if object is not visible\n      if (!object.visible) {\n        return;\n      }\n\n      var originalHasRotatingPoint = object.hasRotatingPoint;\n      object.hasRotatingPoint = false;\n      object.render(ctx);\n      object.hasRotatingPoint = originalHasRotatingPoint;\n    },\n\n    /**\n     * Retores original state of each of group objects (original state is that which was before group was created).\n     * @private\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      this._objects.forEach(this._restoreObjectState, this);\n      return this;\n    },\n\n    /**\n     * Realises the transform from this group onto the supplied object\n     * i.e. it tells you what would happen if the supplied object was in\n     * the group, and then the group was destroyed. It mutates the supplied\n     * object.\n     * @param {fabric.Object} object\n     * @return {fabric.Object} transformedObject\n     */\n    realizeTransform: function(object) {\n      var matrix = object.calcTransformMatrix(),\n          options = fabric.util.qrDecompose(matrix),\n          center = new fabric.Point(options.translateX, options.translateY);\n      object.flipX = false;\n      object.flipY = false;\n      object.set('scaleX', options.scaleX);\n      object.set('scaleY', options.scaleY);\n      object.skewX = options.skewX;\n      object.skewY = options.skewY;\n      object.angle = options.angle;\n      object.setPositionByOrigin(center, 'center', 'center');\n      return object;\n    },\n\n    /**\n     * Restores original state of a specified object in group\n     * @private\n     * @param {fabric.Object} object\n     * @return {fabric.Group} thisArg\n     */\n    _restoreObjectState: function(object) {\n      this.realizeTransform(object);\n      object.setCoords();\n      object.hasControls = object.__origHasControls;\n      delete object.__origHasControls;\n      object.set('active', false);\n      delete object.group;\n\n      return this;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Saves coordinates of this instance (to be used together with `hasMoved`)\n     * @saveCoords\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    saveCoords: function() {\n      this._originalLeft = this.get('left');\n      this._originalTop = this.get('top');\n      return this;\n    },\n\n    /**\n     * Checks whether this group was moved (since `saveCoords` was called last)\n     * @return {Boolean} true if an object was moved (since fabric.Group#saveCoords was called)\n     */\n    hasMoved: function() {\n      return this._originalLeft !== this.get('left') ||\n             this._originalTop !== this.get('top');\n    },\n\n    /**\n     * Sets coordinates of all objects inside group\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      var ignoreZoom = true, skipAbsolute = true;\n      this.forEachObject(function(object) {\n        object.setCoords(ignoreZoom, skipAbsolute);\n      });\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _calcBounds: function(onlyWidthHeight) {\n      var aX = [],\n          aY = [],\n          o, prop,\n          props = ['tr', 'br', 'bl', 'tl'],\n          i = 0, iLen = this._objects.length,\n          j, jLen = props.length,\n          ignoreZoom = true;\n\n      for ( ; i < iLen; ++i) {\n        o = this._objects[i];\n        o.setCoords(ignoreZoom);\n        for (j = 0; j < jLen; j++) {\n          prop = props[j];\n          aX.push(o.oCoords[prop].x);\n          aY.push(o.oCoords[prop].y);\n        }\n      }\n\n      this.set(this._getBounds(aX, aY, onlyWidthHeight));\n    },\n\n    /**\n     * @private\n     */\n    _getBounds: function(aX, aY, onlyWidthHeight) {\n      var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          obj = {\n            width: (maxXY.x - minXY.x) || 0,\n            height: (maxXY.y - minXY.y) || 0\n          };\n\n      if (!onlyWidthHeight) {\n        obj.left = minXY.x || 0;\n        obj.top = minXY.y || 0;\n        if (this.originX === 'center') {\n          obj.left += obj.width / 2;\n        }\n        if (this.originX === 'right') {\n          obj.left += obj.width;\n        }\n        if (this.originY === 'center') {\n          obj.top += obj.height / 2;\n        }\n        if (this.originY === 'bottom') {\n          obj.top += obj.height;\n        }\n      }\n      return obj;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup();\n      markup.push(\n        '<g ', this.getSvgId(), 'transform=\"',\n        /* avoiding styles intentionally */\n        this.getSvgTransform(),\n        this.getSvgTransformMatrix(),\n        '\" style=\"',\n        this.getSvgFilter(),\n        '\">\\n'\n      );\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        markup.push('\\t', this._objects[i].toSVG(reviver));\n      }\n\n      markup.push('</g>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns requested property\n     * @param {String} prop Property to get\n     * @return {*}\n     */\n    get: function(prop) {\n      if (prop in _lockProperties) {\n        if (this[prop]) {\n          return this[prop];\n        }\n        else {\n          for (var i = 0, len = this._objects.length; i < len; i++) {\n            if (this._objects[i][prop]) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }\n      else {\n        if (prop in this.delegatedProperties) {\n          return this._objects[0] && this._objects[0].get(prop);\n        }\n        return this[prop];\n      }\n    }\n  });\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      delete object.objects;\n      callback && callback(new fabric.Group(enlivenedObjects, object, true));\n    });\n  };\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @memberOf fabric.Group\n   * @type Boolean\n   * @default\n   */\n  fabric.Group.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push(\n    'alignX',\n    'alignY',\n    'meetOrSlice'\n  );\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'image',\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * AlignX value, part of preserveAspectRatio (one of \"none\", \"mid\", \"min\", \"max\")\n     * @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\n     * This parameter defines how the picture is aligned to its viewport when image element width differs from image width.\n     * @type String\n     * @default\n     */\n    alignX: 'none',\n\n    /**\n     * AlignY value, part of preserveAspectRatio (one of \"none\", \"mid\", \"min\", \"max\")\n     * @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\n     * This parameter defines how the picture is aligned to its viewport when image element height differs from image height.\n     * @type String\n     * @default\n     */\n    alignY: 'none',\n\n    /**\n     * meetOrSlice value, part of preserveAspectRatio  (one of \"meet\", \"slice\").\n     * if meet the image is always fully visibile, if slice the viewport is always filled with image.\n     * @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\n     * @type String\n     * @default\n     */\n    meetOrSlice: 'meet',\n\n    /**\n     * Width of a stroke.\n     * For image quality a stroke multiple of 2 gives better results.\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * private\n     * contains last value of scaleX to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleX: 1,\n\n    /**\n     * private\n     * contains last value of scaleY to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleY: 1,\n\n    /**\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\n     * number bigger than 1 can be used in case we want to scale with some filter above\n     * the natural image dimensions\n     * @type Number\n     */\n    minimumScaleTrigger: 0.5,\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: stateProperties,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * default to false for images\n     * since 1.7.0\n     * @type Boolean\n     * @default\n     */\n    objectCaching: false,\n\n    /**\n     * Constructor\n     * @param {HTMLImageElement | String} element Image element\n     * @param {Object} [options] Options object\n     * @param {function} [callback] callback function to call after eventual filters applied.\n     * @return {fabric.Image} thisArg\n     */\n    initialize: function(element, options, callback) {\n      options || (options = { });\n      this.filters = [];\n      this.resizeFilters = [];\n      this.callSuper('initialize', options);\n      this._initElement(element, options, callback);\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @return {HTMLImageElement} Image element\n     */\n    getElement: function() {\n      return this._element;\n    },\n\n    /**\n     * Sets image element for this instance to a specified one.\n     * If filters defined they are applied to new image.\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n     * @param {HTMLImageElement} element\n     * @param {Function} [callback] Callback is invoked when all filters have been applied and new image is generated\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element, callback, options) {\n\n      var _callback, _this;\n\n      this._element = element;\n      this._originalElement = element;\n      this._initConfig(options);\n\n      if (this.resizeFilters.length === 0) {\n        _callback = callback;\n      }\n      else {\n        _this = this;\n        _callback = function() {\n          _this.applyFilters(callback, _this.resizeFilters, _this._filteredEl || _this._originalElement, true);\n        };\n      }\n\n      if (this.filters.length !== 0) {\n        this.applyFilters(_callback);\n      }\n      else if (_callback) {\n        _callback(this);\n      }\n\n      return this;\n    },\n\n    /**\n     * Sets crossOrigin value (on an instance and corresponding image element)\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setCrossOrigin: function(value) {\n      this.crossOrigin = value;\n      this._element.crossOrigin = value;\n\n      return this;\n    },\n\n    /**\n     * Returns original size of an image\n     * @return {Object} Object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.width,\n        height: element.height\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _stroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n      var w = this.width / 2, h = this.height / 2;\n      ctx.beginPath();\n      ctx.moveTo(-w, -h);\n      ctx.lineTo(w, -h);\n      ctx.lineTo(w, h);\n      ctx.lineTo(-w, h);\n      ctx.lineTo(-w, -h);\n      ctx.closePath();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.save();\n      this._setStrokeStyles(ctx);\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var filters = [], resizeFilters = [],\n          scaleX = 1, scaleY = 1;\n\n      this.filters.forEach(function(filterObj) {\n        if (filterObj) {\n          if (filterObj.type === 'Resize') {\n            scaleX *= filterObj.scaleX;\n            scaleY *= filterObj.scaleY;\n          }\n          filters.push(filterObj.toObject());\n        }\n      });\n\n      this.resizeFilters.forEach(function(filterObj) {\n        filterObj && resizeFilters.push(filterObj.toObject());\n      });\n      var object = extend(\n        this.callSuper(\n          'toObject',\n          ['crossOrigin', 'alignX', 'alignY', 'meetOrSlice'].concat(propertiesToInclude)\n        ), {\n          src: this.getSrc(),\n          filters: filters,\n          resizeFilters: resizeFilters,\n        });\n\n      object.width /= scaleX;\n      object.height /= scaleY;\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = -this.width / 2, y = -this.height / 2,\n          preserveAspectRatio = 'none', filtered = true;\n      if (this.group && this.group.type === 'path-group') {\n        x = this.left;\n        y = this.top;\n      }\n      if (this.alignX !== 'none' && this.alignY !== 'none') {\n        preserveAspectRatio = 'x' + this.alignX + 'Y' + this.alignY + ' ' + this.meetOrSlice;\n      }\n      markup.push(\n        '<g transform=\"', this.getSvgTransform(), this.getSvgTransformMatrix(), '\">\\n',\n          '<image ', this.getSvgId(), 'xlink:href=\"', this.getSvgSrc(filtered),\n            '\" x=\"', x, '\" y=\"', y,\n            '\" style=\"', this.getSvgStyles(),\n            // we're essentially moving origin of transformation from top/left corner to the center of the shape\n            // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n            // so that object's center aligns with container's left/top\n            '\" width=\"', this.width,\n            '\" height=\"', this.height,\n            '\" preserveAspectRatio=\"', preserveAspectRatio, '\"',\n          '></image>\\n'\n      );\n\n      if (this.stroke || this.strokeDashArray) {\n        var origFill = this.fill;\n        this.fill = null;\n        markup.push(\n          '<rect ',\n            'x=\"', x, '\" y=\"', y,\n            '\" width=\"', this.width, '\" height=\"', this.height,\n            '\" style=\"', this.getSvgStyles(),\n          '\"/>\\n'\n        );\n        this.fill = origFill;\n      }\n\n      markup.push('</g>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns source of an image\n     * @param {Boolean} filtered indicates if the src is needed for svg\n     * @return {String} Source of an image\n     */\n    getSrc: function(filtered) {\n      var element = filtered ? this._element : this._originalElement;\n      if (element) {\n        return fabric.isLikelyNode ? element._src : element.src;\n      }\n      else {\n        return this.src || '';\n      }\n    },\n\n    /**\n     * Sets source of an image\n     * @param {String} src Source string (URL)\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setSrc: function(src, callback, options) {\n      fabric.util.loadImage(src, function(img) {\n        return this.setElement(img, callback, options);\n      }, this, options && options.crossOrigin);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array)\n     * @method applyFilters\n     * @param {Function} callback Callback is invoked when all filters have been applied and new image is generated\n     * @param {Array} filters to be applied\n     * @param {fabric.Image} imgElement image to filter ( default to this._element )\n     * @param {Boolean} forResizing\n     * @return {CanvasElement} canvasEl to be drawn immediately\n     * @chainable\n     */\n    applyFilters: function(callback, filters, imgElement, forResizing) {\n\n      filters = filters || this.filters;\n      imgElement = imgElement || this._originalElement;\n\n      if (!imgElement) {\n        return;\n      }\n\n      var replacement = fabric.util.createImage(),\n          retinaScaling = this.canvas ? this.canvas.getRetinaScaling() : fabric.devicePixelRatio,\n          minimumScale = this.minimumScaleTrigger / retinaScaling,\n          _this = this, scaleX, scaleY;\n\n      if (filters.length === 0) {\n        this._element = imgElement;\n        callback && callback(this);\n        return imgElement;\n      }\n\n      var canvasEl = fabric.util.createCanvasElement();\n      canvasEl.width = imgElement.width;\n      canvasEl.height = imgElement.height;\n      canvasEl.getContext('2d').drawImage(imgElement, 0, 0, imgElement.width, imgElement.height);\n\n      filters.forEach(function(filter) {\n        if (!filter) {\n          return;\n        }\n        if (forResizing) {\n          scaleX = _this.scaleX < minimumScale ? _this.scaleX : 1;\n          scaleY = _this.scaleY < minimumScale ? _this.scaleY : 1;\n          if (scaleX * retinaScaling < 1) {\n            scaleX *= retinaScaling;\n          }\n          if (scaleY * retinaScaling < 1) {\n            scaleY *= retinaScaling;\n          }\n        }\n        else {\n          scaleX = filter.scaleX;\n          scaleY = filter.scaleY;\n        }\n        filter.applyTo(canvasEl, scaleX, scaleY);\n        if (!forResizing && filter.type === 'Resize') {\n          _this.width *= filter.scaleX;\n          _this.height *= filter.scaleY;\n        }\n      });\n\n      /** @ignore */\n      replacement.width = canvasEl.width;\n      replacement.height = canvasEl.height;\n      if (fabric.isLikelyNode) {\n        replacement.src = canvasEl.toBuffer(undefined, fabric.Image.pngCompression);\n        // onload doesn't fire in some node versions, so we invoke callback manually\n        _this._element = replacement;\n        !forResizing && (_this._filteredEl = replacement);\n        callback && callback(_this);\n      }\n      else {\n        replacement.onload = function() {\n          _this._element = replacement;\n          !forResizing && (_this._filteredEl = replacement);\n          callback && callback(_this);\n          replacement.onload = canvasEl = null;\n        };\n        replacement.src = canvasEl.toDataURL('image/png');\n      }\n      return canvasEl;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      var x, y, imageMargins = this._findMargins(), elementToDraw;\n\n      x = (noTransform ? this.left : -this.width / 2);\n      y = (noTransform ? this.top : -this.height / 2);\n\n      if (this.meetOrSlice === 'slice') {\n        ctx.beginPath();\n        ctx.rect(x, y, this.width, this.height);\n        ctx.clip();\n      }\n\n      if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {\n        this._lastScaleX = this.scaleX;\n        this._lastScaleY = this.scaleY;\n        elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);\n      }\n      else {\n        elementToDraw = this._element;\n      }\n      elementToDraw && ctx.drawImage(elementToDraw,\n                                     x + imageMargins.marginX,\n                                     y + imageMargins.marginY,\n                                     imageMargins.width,\n                                     imageMargins.height\n                                    );\n\n      this._stroke(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private, needed to check if image needs resize\n     */\n    _needsResize: function() {\n      return (this.scaleX !== this._lastScaleX || this.scaleY !== this._lastScaleY);\n    },\n\n    /**\n     * @private\n     */\n    _findMargins: function() {\n      var width = this.width, height = this.height, scales,\n          scale, marginX = 0, marginY = 0;\n\n      if (this.alignX !== 'none' || this.alignY !== 'none') {\n        scales = [this.width / this._element.width, this.height / this._element.height];\n        scale = this.meetOrSlice === 'meet'\n                ? Math.min.apply(null, scales) : Math.max.apply(null, scales);\n        width = this._element.width * scale;\n        height = this._element.height * scale;\n        if (this.alignX === 'Mid') {\n          marginX = (this.width - width) / 2;\n        }\n        if (this.alignX === 'Max') {\n          marginX = this.width - width;\n        }\n        if (this.alignY === 'Mid') {\n          marginY = (this.height - height) / 2;\n        }\n        if (this.alignY === 'Max') {\n          marginY = this.height - height;\n        }\n      }\n      return {\n        width:  width,\n        height: height,\n        marginX: marginX,\n        marginY: marginY\n      };\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      var element = this.getElement();\n\n      this.set('width', element.width);\n      this.set('height', element.height);\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @private\n     * @param {HTMLImageElement|String} element The element representing the image\n     * @param {Object} [options] Options object\n     */\n    _initElement: function(element, options, callback) {\n      this.setElement(fabric.util.getById(element), callback, options);\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setWidthHeight(options);\n      if (this._element && this.crossOrigin) {\n        this._element.crossOrigin = this.crossOrigin;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Array} filters to be initialized\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n     */\n    _initFilters: function(filters, callback) {\n      if (filters && filters.length) {\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        }, 'fabric.Image.filters');\n      }\n      else {\n        callback && callback();\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Object with width/height properties\n     */\n    _setWidthHeight: function(options) {\n      this.width = 'width' in options\n        ? options.width\n        : (this.getElement()\n            ? this.getElement().width || 0\n            : 0);\n\n      this.height = 'height' in options\n        ? options.height\n        : (this.getElement()\n            ? this.getElement().height || 0\n            : 0);\n    },\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = 'canvas-img';\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function(object, callback) {\n    fabric.util.loadImage(object.src, function(img, error) {\n      if (error) {\n        callback && callback(null, error);\n        return;\n      }\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\n        object.filters = filters || [];\n        fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function(resizeFilters) {\n          object.resizeFilters = resizeFilters || [];\n          return new fabric.Image(img, object, callback);\n        });\n      });\n    }, null, object.crossOrigin);\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument)\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    fabric.util.loadImage(url, function(img) {\n      callback && callback(new fabric.Image(img, imgOptions));\n    }, null, imgOptions && imgOptions.crossOrigin);\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES =\n    fabric.SHARED_ATTRIBUTES.concat('x y width height preserveAspectRatio xlink:href crossOrigin'.split(' '));\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @param {Object} [options] Options object\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES),\n        preserveAR;\n\n    if (parsedAttributes.preserveAspectRatio) {\n      preserveAR = fabric.util.parsePreserveAspectRatioAttribute(parsedAttributes.preserveAspectRatio);\n      extend(parsedAttributes, preserveAR);\n    }\n\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @type Boolean\n   * @default\n   */\n  fabric.Image.async = true;\n\n  /**\n   * Indicates compression level used when generating PNG under Node (in applyFilters). Any of 0-9\n   * @static\n   * @type Number\n   * @default\n   */\n  fabric.Image.pngCompression = 1;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * @private\n   * @return {Number} angle value\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.getAngle() % 360;\n    if (angle > 0) {\n      return Math.round((angle - 1) / 90) * 90;\n    }\n    return Math.round(angle / 90) * 90;\n  },\n\n  /**\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    this.setAngle(this._getAngleValueForStraighten());\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\n   * @param {Object} callbacks Object with callback functions\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.setAngle(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n      onStart: function() {\n        _this.set('active', false);\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.renderAll();\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxStraightenObject: function (object) {\n    object.fxStraighten({\n      onChange: this.renderAll.bind(this)\n    });\n    return this;\n  }\n});\n\n\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image.filters = fabric.Image.filters || { };\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\n\n  /**\n   * Filter type\n   * @param {String} type\n   * @default\n   */\n  type: 'BaseFilter',\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    if (options) {\n      this.setOptions(options);\n    }\n  },\n\n  /**\n   * Sets filter's properties from options\n   * @param {Object} [options] Options object\n   */\n  setOptions: function(options) {\n    for (var prop in options) {\n      this[prop] = options[prop];\n    }\n  },\n\n  /**\n   * Returns object representation of an instance\n   * @return {Object} Object representation of an instance\n   */\n  toObject: function() {\n    return { type: this.type };\n  },\n\n  /**\n   * Returns a JSON representation of an instance\n   * @return {Object} JSON\n   */\n  toJSON: function() {\n    // delegate, not alias\n    return this.toObject();\n  }\n});\n\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 200\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Brightness',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Brightness.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.brightness=0] Value to brighten the image up (-255..255)\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.brightness = options.brightness || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          brightness = this.brightness;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        data[i] += brightness;\n        data[i + 1] += brightness;\n        data[i + 2] += brightness;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        brightness: this.brightness\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Convolute',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Convolute.prototype\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n     * @param {Array} [options.matrix] Filter matrix\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.opaque = options.opaque;\n      this.matrix = options.matrix || [\n        0, 0, 0,\n        0, 1, 0,\n        0, 0, 0\n      ];\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n\n      var weights = this.matrix,\n          context = canvasEl.getContext('2d'),\n          pixels = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          src = pixels.data,\n          sw = pixels.width,\n          sh = pixels.height,\n          output = context.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r, g, b, a, dstOff,\n          scx, scy, srcOff, wt;\n\n      for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n          dstOff = (y * sw + x) * 4;\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          r = 0; g = 0; b = 0; a = 0;\n\n          for (var cy = 0; cy < side; cy++) {\n            for (var cx = 0; cx < side; cx++) {\n              scy = y + cy - halfSide;\n              scx = x + cx - halfSide;\n\n              // eslint-disable-next-line max-depth\n              if (scy < 0 || scy > sh || scx < 0 || scx > sw) {\n                continue;\n              }\n\n              srcOff = (scy * sw + scx) * 4;\n              wt = weights[cy * side + cx];\n\n              r += src[srcOff] * wt;\n              g += src[srcOff + 1] * wt;\n              b += src[srcOff + 2] * wt;\n              a += src[srcOff + 3] * wt;\n            }\n          }\n          dst[dstOff] = r;\n          dst[dstOff + 1] = g;\n          dst[dstOff + 2] = b;\n          dst[dstOff + 3] = a + alphaFac * (255 - a);\n        }\n      }\n\n      context.putImageData(output, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        opaque: this.opaque,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * GradientTransparency filter class\n   * @class fabric.Image.filters.GradientTransparency\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.GradientTransparency#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.GradientTransparency({\n   *   threshold: 200\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n   // eslint-disable-next-line max-len\n  filters.GradientTransparency = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.GradientTransparency.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'GradientTransparency',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.GradientTransparency.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.threshold=100] Threshold value\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.threshold = options.threshold || 100;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          threshold = this.threshold,\n          total = data.length;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        data[i + 3] = threshold + 255 * (total - i) / total;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        threshold: this.threshold\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.GradientTransparency} Instance of fabric.Image.filters.GradientTransparency\n   */\n  fabric.Image.filters.GradientTransparency.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Grayscale',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Grayscale.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          len = imageData.width * imageData.height * 4,\n          index = 0,\n          average;\n\n      while (index < len) {\n        average = (data[index] + data[index + 1] + data[index + 2]) / 3;\n        data[index]     = average;\n        data[index + 1] = average;\n        data[index + 2] = average;\n        index += 4;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Grayscale';\n    return fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Invert',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Invert.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i;\n\n      for (i = 0; i < iLen; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Invert';\n    return fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Mask filter class\n   * See http://resources.aleph-1.com/mask/\n   * @class fabric.Image.filters.Mask\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Mask#initialize} for constructor definition\n   */\n  filters.Mask = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Mask.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Mask',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Mask.prototype\n     * @param {Object} [options] Options object\n     * @param {fabric.Image} [options.mask] Mask image object\n     * @param {Number} [options.channel=0] Rgb channel (0, 1, 2 or 3)\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.mask = options.mask;\n      this.channel = [0, 1, 2, 3].indexOf(options.channel) > -1 ? options.channel : 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      if (!this.mask) {\n        return;\n      }\n\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          maskEl = this.mask.getElement(),\n          maskCanvasEl = fabric.util.createCanvasElement(),\n          channel = this.channel,\n          i,\n          iLen = imageData.width * imageData.height * 4;\n\n      maskCanvasEl.width = canvasEl.width;\n      maskCanvasEl.height = canvasEl.height;\n\n      maskCanvasEl.getContext('2d').drawImage(maskEl, 0, 0, canvasEl.width, canvasEl.height);\n\n      var maskImageData = maskCanvasEl.getContext('2d').getImageData(0, 0, canvasEl.width, canvasEl.height),\n          maskData = maskImageData.data;\n\n      for (i = 0; i < iLen; i += 4) {\n        data[i + 3] = maskData[i + channel];\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        mask: this.mask.toObject(),\n        channel: this.channel\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when a mask filter instance is created\n   */\n  fabric.Image.filters.Mask.fromObject = function(object, callback) {\n    fabric.util.loadImage(object.mask.src, function(img) {\n      object.mask = new fabric.Image(img, object.mask);\n      return fabric.Image.filters.BaseFilter.fromObject(object, callback);\n    });\n  };\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @type Boolean\n   * @default\n   */\n  fabric.Image.filters.Mask.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Noise',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Noise.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.noise=0] Noise value\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.noise = options.noise || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          noise = this.noise, rand;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n\n        rand = (0.5 - Math.random()) * noise;\n\n        data[i] += rand;\n        data[i + 1] += rand;\n        data[i + 2] += rand;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        noise: this.noise\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Pixelate',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Pixelate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.blocksize=4] Blocksize for pixelate\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.blocksize = options.blocksize || 4;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index, i, j, r, g, b, a;\n\n      for (i = 0; i < iLen; i += this.blocksize) {\n        for (j = 0; j < jLen; j += this.blocksize) {\n\n          index = (i * 4) * jLen + (j * 4);\n\n          r = data[index];\n          g = data[index + 1];\n          b = data[index + 2];\n          a = data[index + 3];\n\n          /*\n           blocksize: 4\n\n           [1,x,x,x,1]\n           [x,x,x,x,1]\n           [x,x,x,x,1]\n           [x,x,x,x,1]\n           [1,1,1,1,1]\n           */\n\n          for (var _i = i, _ilen = i + this.blocksize; _i < _ilen; _i++) {\n            for (var _j = j, _jlen = j + this.blocksize; _j < _jlen; _j++) {\n              index = (_i * 4) * jLen + (_j * 4);\n              data[index] = r;\n              data[index + 1] = g;\n              data[index + 2] = b;\n              data[index + 3] = a;\n            }\n          }\n        }\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        blocksize: this.blocksize\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveWhite\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveWhite#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveWhite({\n   *   threshold: 40,\n   *   distance: 140\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.RemoveWhite = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveWhite.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'RemoveWhite',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.threshold=30] Threshold value\n     * @param {Number} [options.distance=20] Distance value\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.threshold = options.threshold || 30;\n      this.distance = options.distance || 20;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          threshold = this.threshold,\n          distance = this.distance,\n          limit = 255 - threshold,\n          abs = Math.abs,\n          r, g, b;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (r > limit &&\n            g > limit &&\n            b > limit &&\n            abs(r - g) < distance &&\n            abs(r - b) < distance &&\n            abs(g - b) < distance\n        ) {\n          data[i + 3] = 0;\n        }\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        threshold: this.threshold,\n        distance: this.distance\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveWhite} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveWhite.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Sepia filter class\n   * @class fabric.Image.filters.Sepia\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Sepia();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Sepia = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Sepia.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Sepia',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Sepia.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i, avg;\n\n      for (i = 0; i < iLen; i += 4) {\n        avg = 0.3  * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];\n        data[i] = avg + 100;\n        data[i + 1] = avg + 50;\n        data[i + 2] = avg + 255;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Sepia} Instance of fabric.Image.filters.Sepia\n   */\n  fabric.Image.filters.Sepia.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Sepia';\n    return new fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Sepia2 filter class\n   * @class fabric.Image.filters.Sepia2\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Sepia2();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Sepia2 = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Sepia2.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Sepia2',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Sepia.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i, r, g, b;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        data[i] = (r * 0.393 + g * 0.769 + b * 0.189 ) / 1.351;\n        data[i + 1] = (r * 0.349 + g * 0.686 + b * 0.168 ) / 1.203;\n        data[i + 2] = (r * 0.272 + g * 0.534 + b * 0.131 ) / 2.140;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Sepia2} Instance of fabric.Image.filters.Sepia2\n   */\n  fabric.Image.filters.Sepia2.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Sepia2';\n    return new fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Tint filter class\n   * Adapted from <a href=\"https://github.com/mezzoblue/PaintbrushJS\">https://github.com/mezzoblue/PaintbrushJS</a>\n   * @class fabric.Image.filters.Tint\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Tint#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Tint filter with hex color and opacity</caption>\n   * var filter = new fabric.Image.filters.Tint({\n   *   color: '#3513B0',\n   *   opacity: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Tint filter with rgba color</caption>\n   * var filter = new fabric.Image.filters.Tint({\n   *   color: 'rgba(53, 21, 176, 0.5)'\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Tint = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Tint.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Tint',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Tint.prototype\n     * @param {Object} [options] Options object\n     * @param {String} [options.color=#000000] Color to tint the image with\n     * @param {Number} [options.opacity] Opacity value that controls the tint effect's transparency (0..1)\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.color = options.color || '#000000';\n      this.opacity = typeof options.opacity !== 'undefined'\n                      ? options.opacity\n                      : new fabric.Color(this.color).getAlpha();\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i,\n          tintR, tintG, tintB,\n          r, g, b, alpha1,\n          source;\n\n      source = new fabric.Color(this.color).getSource();\n\n      tintR = source[0] * this.opacity;\n      tintG = source[1] * this.opacity;\n      tintB = source[2] * this.opacity;\n\n      alpha1 = 1 - this.opacity;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        // alpha compositing\n        data[i] = tintR + r * alpha1;\n        data[i + 1] = tintG + g * alpha1;\n        data[i + 2] = tintB + b * alpha1;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color,\n        opacity: this.opacity\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Tint} Instance of fabric.Image.filters.Tint\n   */\n  fabric.Image.filters.Tint.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Multiply filter class\n   * Adapted from <a href=\"http://www.laurenscorijn.com/articles/colormath-basics\">http://www.laurenscorijn.com/articles/colormath-basics</a>\n   * @class fabric.Image.filters.Multiply\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example <caption>Multiply filter with hex color</caption>\n   * var filter = new fabric.Image.filters.Multiply({\n   *   color: '#F0F'\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Multiply filter with rgb color</caption>\n   * var filter = new fabric.Image.filters.Multiply({\n   *   color: 'rgb(53, 21, 176)'\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Multiply = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Multiply.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Multiply',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Multiply.prototype\n     * @param {Object} [options] Options object\n     * @param {String} [options.color=#000000] Color to multiply the image pixels with\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.color = options.color || '#000000';\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i,\n          source;\n\n      source = new fabric.Color(this.color).getSource();\n\n      for (i = 0; i < iLen; i += 4) {\n        data[i] *= source[0] / 255;\n        data[i + 1] *= source[1] / 255;\n        data[i + 2] *= source[2] / 255;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Multiply} Instance of fabric.Image.filters.Multiply\n   */\n  fabric.Image.filters.Multiply.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.Blend\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.Blend({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.Blend({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n\n  filters.Blend = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\n    type: 'Blend',\n\n    initialize: function(options) {\n      options = options || {};\n      this.color = options.color || '#000';\n      this.image = options.image || false;\n      this.mode = options.mode || 'multiply';\n      this.alpha = options.alpha || 1;\n    },\n\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          tr, tg, tb,\n          r, g, b,\n          _r, _g, _b,\n          source,\n          isImage = false;\n\n      if (this.image) {\n        // Blend images\n        isImage = true;\n\n        var _el = fabric.util.createCanvasElement();\n        _el.width = this.image.width;\n        _el.height = this.image.height;\n\n        var tmpCanvas = new fabric.StaticCanvas(_el);\n        tmpCanvas.add(this.image);\n        var context2 =  tmpCanvas.getContext('2d');\n        source = context2.getImageData(0, 0, tmpCanvas.width, tmpCanvas.height).data;\n      }\n      else {\n        // Blend color\n        source = new fabric.Color(this.color).getSource();\n\n        tr = source[0] * this.alpha;\n        tg = source[1] * this.alpha;\n        tb = source[2] * this.alpha;\n      }\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (isImage) {\n          tr = source[i] * this.alpha;\n          tg = source[i + 1] * this.alpha;\n          tb = source[i + 2] * this.alpha;\n        }\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            break;\n          case 'screen':\n            data[i] = 1 - (1 - r) * (1 - tr);\n            data[i + 1] = 1 - (1 - g) * (1 - tg);\n            data[i + 2] = 1 - (1 - b) * (1 - tb);\n            break;\n          case 'add':\n            data[i] = Math.min(255, r + tr);\n            data[i + 1] = Math.min(255, g + tg);\n            data[i + 2] = Math.min(255, b + tb);\n            break;\n          case 'diff':\n          case 'difference':\n            data[i] = Math.abs(r - tr);\n            data[i + 1] = Math.abs(g - tg);\n            data[i + 2] = Math.abs(b - tb);\n            break;\n          case 'subtract':\n            _r = r - tr;\n            _g = g - tg;\n            _b = b - tb;\n\n            data[i] = (_r < 0) ? 0 : _r;\n            data[i + 1] = (_g < 0) ? 0 : _g;\n            data[i + 2] = (_b < 0) ? 0 : _b;\n            break;\n          case 'darken':\n            data[i] = Math.min(r, tr);\n            data[i + 1] = Math.min(g, tg);\n            data[i + 2] = Math.min(b, tb);\n            break;\n          case 'lighten':\n            data[i] = Math.max(r, tr);\n            data[i + 1] = Math.max(g, tg);\n            data[i + 2] = Math.max(b, tb);\n            break;\n        }\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        color: this.color,\n        image: this.image,\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Blend} Instance of fabric.Image.filters.Blend\n   */\n  fabric.Image.filters.Blend.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\n      sqrt = Math.sqrt, abs = Math.abs, max = Math.max, round = Math.round, sin = Math.sin,\n      ceil = Math.ceil,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Resize',\n\n    /**\n     * Resize type\n     * @param {String} resizeType\n     * @default\n     */\n    resizeType: 'hermite',\n\n    /**\n     * Scale factor for resizing, x axis\n     * @param {Number} scaleX\n     * @default\n     */\n    scaleX: 0,\n\n    /**\n     * Scale factor for resizing, y axis\n     * @param {Number} scaleY\n     * @default\n     */\n    scaleY: 0,\n\n    /**\n     * LanczosLobes parameter for lanczos filter\n     * @param {Number} lanczosLobes\n     * @default\n     */\n    lanczosLobes: 3,\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Resize.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} scaleX\n     * @param {Number} scaleY\n     */\n    applyTo: function(canvasEl, scaleX, scaleY) {\n      if (scaleX === 1 && scaleY === 1) {\n        return;\n      }\n\n      this.rcpScaleX = 1 / scaleX;\n      this.rcpScaleY = 1 / scaleY;\n\n      var oW = canvasEl.width, oH = canvasEl.height,\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\n          imageData;\n\n      if (this.resizeType === 'sliceHack') {\n        imageData = this.sliceByTwo(canvasEl, oW, oH, dW, dH);\n      }\n      if (this.resizeType === 'hermite') {\n        imageData = this.hermiteFastResize(canvasEl, oW, oH, dW, dH);\n      }\n      if (this.resizeType === 'bilinear') {\n        imageData = this.bilinearFiltering(canvasEl, oW, oH, dW, dH);\n      }\n      if (this.resizeType === 'lanczos') {\n        imageData = this.lanczosResize(canvasEl, oW, oH, dW, dH);\n      }\n      canvasEl.width = dW;\n      canvasEl.height = dH;\n      canvasEl.getContext('2d').putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Filter sliceByTwo\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    sliceByTwo: function(canvasEl, oW, oH, dW, dH) {\n      var context = canvasEl.getContext('2d'), imageData,\n          multW = 0.5, multH = 0.5, signW = 1, signH = 1,\n          doneW = false, doneH = false, stepW = oW, stepH = oH,\n          tmpCanvas = fabric.util.createCanvasElement(),\n          tmpCtx = tmpCanvas.getContext('2d');\n      dW = floor(dW);\n      dH = floor(dH);\n      tmpCanvas.width = max(dW, oW);\n      tmpCanvas.height = max(dH, oH);\n\n      if (dW > oW) {\n        multW = 2;\n        signW = -1;\n      }\n      if (dH > oH) {\n        multH = 2;\n        signH = -1;\n      }\n      imageData = context.getImageData(0, 0, oW, oH);\n      canvasEl.width = max(dW, oW);\n      canvasEl.height = max(dH, oH);\n      context.putImageData(imageData, 0, 0);\n\n      while (!doneW || !doneH) {\n        oW = stepW;\n        oH = stepH;\n        if (dW * signW < floor(stepW * multW * signW)) {\n          stepW = floor(stepW * multW);\n        }\n        else {\n          stepW = dW;\n          doneW = true;\n        }\n        if (dH * signH < floor(stepH * multH * signH)) {\n          stepH = floor(stepH * multH);\n        }\n        else {\n          stepH = dH;\n          doneH = true;\n        }\n        imageData = context.getImageData(0, 0, oW, oH);\n        tmpCtx.putImageData(imageData, 0, 0);\n        context.clearRect(0, 0, stepW, stepH);\n        context.drawImage(tmpCanvas, 0, 0, oW, oH, 0, 0, stepW, stepH);\n      }\n      return context.getImageData(0, 0, dW, dH);\n    },\n\n    /**\n     * Filter lanczosResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    lanczosResize: function(canvasEl, oW, oH, dW, dH) {\n\n      function lanczosCreate(lobes) {\n        return function(x) {\n          if (x > lobes) {\n            return 0;\n          }\n          x *= Math.PI;\n          if (abs(x) < 1e-16) {\n            return 1;\n          }\n          var xx = x / lobes;\n          return sin(x) * sin(xx) / x / xx;\n        };\n      }\n\n      function process(u) {\n        var v, i, weight, idx, a, red, green,\n            blue, alpha, fX, fY;\n        center.x = (u + 0.5) * ratioX;\n        icenter.x = floor(center.x);\n        for (v = 0; v < dH; v++) {\n          center.y = (v + 0.5) * ratioY;\n          icenter.y = floor(center.y);\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n            if (i < 0 || i >= oW) {\n              continue;\n            }\n            fX = floor(1000 * abs(i - center.x));\n            if (!cacheLanc[fX]) {\n              cacheLanc[fX] = { };\n            }\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n              if (j < 0 || j >= oH) {\n                continue;\n              }\n              fY = floor(1000 * abs(j - center.y));\n              if (!cacheLanc[fX][fY]) {\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\n              }\n              weight = cacheLanc[fX][fY];\n              if (weight > 0) {\n                idx = (j * oW + i) * 4;\n                a += weight;\n                red += weight * srcData[idx];\n                green += weight * srcData[idx + 1];\n                blue += weight * srcData[idx + 2];\n                alpha += weight * srcData[idx + 3];\n              }\n            }\n          }\n          idx = (v * dW + u) * 4;\n          destData[idx] = red / a;\n          destData[idx + 1] = green / a;\n          destData[idx + 2] = blue / a;\n          destData[idx + 3] = alpha / a;\n        }\n\n        if (++u < dW) {\n          return process(u);\n        }\n        else {\n          return destImg;\n        }\n      }\n\n      var context = canvasEl.getContext('2d'),\n          srcImg = context.getImageData(0, 0, oW, oH),\n          destImg = context.getImageData(0, 0, dW, dH),\n          srcData = srcImg.data, destData = destImg.data,\n          lanczos = lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\n          cacheLanc = { }, center = { }, icenter = { };\n\n      return process(0);\n    },\n\n    /**\n     * bilinearFiltering\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    bilinearFiltering: function(canvasEl, oW, oH, dW, dH) {\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY, context = canvasEl.getContext('2d'),\n          w4 = 4 * (oW - 1), img = context.getImageData(0, 0, oW, oH),\n          pixels = img.data, destImage = context.getImageData(0, 0, dW, dH),\n          destPixels = destImage.data;\n      for (i = 0; i < dH; i++) {\n        for (j = 0; j < dW; j++) {\n          x = floor(ratioX * j);\n          y = floor(ratioY * i);\n          xDiff = ratioX * j - x;\n          yDiff = ratioY * i - y;\n          origPix = 4 * (y * oW + x);\n\n          for (chnl = 0; chnl < 4; chnl++) {\n            a = pixels[origPix + chnl];\n            b = pixels[origPix + 4 + chnl];\n            c = pixels[origPix + w4 + chnl];\n            d = pixels[origPix + w4 + 4 + chnl];\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\n            destPixels[offset++] = color;\n          }\n        }\n      }\n      return destImage;\n    },\n\n    /**\n     * hermiteFastResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    hermiteFastResize: function(canvasEl, oW, oH, dW, dH) {\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          context = canvasEl.getContext('2d'),\n          img = context.getImageData(0, 0, oW, oH), data = img.data,\n          img2 = context.getImageData(0, 0, dW, dH), data2 = img2.data;\n      for (var j = 0; j < dH; j++) {\n        for (var i = 0; i < dW; i++) {\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n              /* eslint-disable max-depth */\n              if (w > 1 && w < -1) {\n                continue;\n              }\n              //hermite filter\n              weight = 2 * w * w * w - 3 * w * w + 1;\n              if (weight > 0) {\n                dx = 4 * (xx + yy * oW);\n                //alpha\n                gxA += weight * data[dx + 3];\n                weightsAlpha += weight;\n                //colors\n                if (data[dx + 3] < 255) {\n                  weight = weight * data[dx + 3] / 250;\n                }\n                gxR += weight * data[dx];\n                gxG += weight * data[dx + 1];\n                gxB += weight * data[dx + 2];\n                weights += weight;\n              }\n              /* eslint-enable max-depth */\n            }\n          }\n          data2[x2] = gxR / weights;\n          data2[x2 + 1] = gxG / weights;\n          data2[x2 + 2] = gxB / weights;\n          data2[x2 + 3] = gxA / weightsAlpha;\n        }\n      }\n      return img2;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        resizeType: this.resizeType,\n        lanczosLobes: this.lanczosLobes\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Matrix filter class\n   * @class fabric.Image.filters.ColorMatrix\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n   * @example <caption>Kodachrome filter</caption>\n   * var filter = new fabric.Image.filters.ColorMatrix({\n   *  matrix: [\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n       0, 0, 0, 1, 0\n      ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'ColorMatrix',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.ColorMatrix.prototype\n     * @param {Object} [options] Options object\n     * @param {Array} [options.matrix] Color Matrix to modify the image data with\n     */\n    initialize: function( options ) {\n      options || ( options = {} );\n      this.matrix = options.matrix || [\n        1, 0, 0, 0, 0,\n        0, 1, 0, 0, 0,\n        0, 0, 1, 0, 0,\n        0, 0, 0, 1, 0\n      ];\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function( canvasEl ) {\n      var context = canvasEl.getContext( '2d' ),\n          imageData = context.getImageData( 0, 0, canvasEl.width, canvasEl.height ),\n          data = imageData.data,\n          iLen = data.length,\n          i,\n          r,\n          g,\n          b,\n          a,\n          m = this.matrix;\n\n      for ( i = 0; i < iLen; i += 4 ) {\n        r = data[ i ];\n        g = data[ i + 1 ];\n        b = data[ i + 2 ];\n        a = data[ i + 3 ];\n\n        data[ i ] = r * m[ 0 ] + g * m[ 1 ] + b * m[ 2 ] + a * m[ 3 ] + m[ 4 ];\n        data[ i + 1 ] = r * m[ 5 ] + g * m[ 6 ] + b * m[ 7 ] + a * m[ 8 ] + m[ 9 ];\n        data[ i + 2 ] = r * m[ 10 ] + g * m[ 11 ] + b * m[ 12 ] + a * m[ 13 ] + m[ 14 ];\n        data[ i + 3 ] = r * m[ 15 ] + g * m[ 16 ] + b * m[ 17 ] + a * m[ 18 ] + m[ 19 ];\n      }\n\n      context.putImageData( imageData, 0, 0 );\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        type: this.type,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 40\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Contrast',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Contrast.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-255...255)\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.contrast = options.contrast || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          contrastF = 259 * (this.contrast + 255) / (255 * (259 - this.contrast));\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        data[i] = contrastF * (data[i] - 128) + 128;\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        contrast: this.contrast\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturate({\n   *   saturate: 100\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Saturate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Saturate',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Saturate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.saturate=0] Value to saturate the image (-100...100)\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.saturate = options.saturate || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          max, adjust = -this.saturate * 0.01;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        saturate: this.saturate\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturate} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed,\n      NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n      MIN_TEXT_WIDTH = 2;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push(\n    'fontFamily',\n    'fontWeight',\n    'fontSize',\n    'text',\n    'textDecoration',\n    'textAlign',\n    'fontStyle',\n    'lineHeight',\n    'textBackgroundColor',\n    'charSpacing'\n  );\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'fontFamily',\n    'fontWeight',\n    'fontSize',\n    'text',\n    'textDecoration',\n    'textAlign',\n    'fontStyle',\n    'lineHeight',\n    'textBackgroundColor',\n    'charSpacing',\n    'styles'\n  );\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: [\n      'fontSize',\n      'fontWeight',\n      'fontFamily',\n      'fontStyle',\n      'lineHeight',\n      'text',\n      'charSpacing',\n      'textAlign'\n    ],\n\n    /**\n     * @private\n     */\n    _reNewline: /\\r?\\n/,\n\n    /**\n     * Use this regular expression to filter for whitespace that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpacesAndTabs: /[ \\t\\r]+/g,\n\n    /**\n     * Retrieves object's fontSize\n     * @method getFontSize\n     * @memberOf fabric.Text.prototype\n     * @return {String} Font size (in pixels)\n     */\n\n    /**\n     * Sets object's fontSize\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontSize\n     * @memberOf fabric.Text.prototype\n     * @param {Number} fontSize Font size (in pixels)\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's fontWeight\n     * @method getFontWeight\n     * @memberOf fabric.Text.prototype\n     * @return {(String|Number)} Font weight\n     */\n\n    /**\n     * Sets object's fontWeight\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontWeight\n     * @memberOf fabric.Text.prototype\n     * @param {(Number|String)} fontWeight Font weight\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's fontFamily\n     * @method getFontFamily\n     * @memberOf fabric.Text.prototype\n     * @return {String} Font family\n     */\n\n    /**\n     * Sets object's fontFamily\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontFamily\n     * @memberOf fabric.Text.prototype\n     * @param {String} fontFamily Font family\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's text\n     * @method getText\n     * @memberOf fabric.Text.prototype\n     * @return {String} text\n     */\n\n    /**\n     * Sets object's text\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setText\n     * @memberOf fabric.Text.prototype\n     * @param {String} text Text\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's textDecoration\n     * @method getTextDecoration\n     * @memberOf fabric.Text.prototype\n     * @return {String} Text decoration\n     */\n\n    /**\n     * Sets object's textDecoration\n     * @method setTextDecoration\n     * @memberOf fabric.Text.prototype\n     * @param {String} textDecoration Text decoration\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's fontStyle\n     * @method getFontStyle\n     * @memberOf fabric.Text.prototype\n     * @return {String} Font style\n     */\n\n    /**\n     * Sets object's fontStyle\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontStyle\n     * @memberOf fabric.Text.prototype\n     * @param {String} fontStyle Font style\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's lineHeight\n     * @method getLineHeight\n     * @memberOf fabric.Text.prototype\n     * @return {Number} Line height\n     */\n\n    /**\n     * Sets object's lineHeight\n     * @method setLineHeight\n     * @memberOf fabric.Text.prototype\n     * @param {Number} lineHeight Line height\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's textAlign\n     * @method getTextAlign\n     * @memberOf fabric.Text.prototype\n     * @return {String} Text alignment\n     */\n\n    /**\n     * Sets object's textAlign\n     * @method setTextAlign\n     * @memberOf fabric.Text.prototype\n     * @param {String} textAlign Text alignment\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's textBackgroundColor\n     * @method getTextBackgroundColor\n     * @memberOf fabric.Text.prototype\n     * @return {String} Text background color\n     */\n\n    /**\n     * Sets object's textBackgroundColor\n     * @method setTextBackgroundColor\n     * @memberOf fabric.Text.prototype\n     * @param {String} textBackgroundColor Text background color\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type:                 'text',\n\n    /**\n     * Font size (in pixels)\n     * @type Number\n     * @default\n     */\n    fontSize:             40,\n\n    /**\n     * Font weight (e.g. bold, normal, 400, 600, 800)\n     * @type {(Number|String)}\n     * @default\n     */\n    fontWeight:           'normal',\n\n    /**\n     * Font family\n     * @type String\n     * @default\n     */\n    fontFamily:           'Times New Roman',\n\n    /**\n     * Text decoration Possible values: \"\", \"underline\", \"overline\" or \"line-through\".\n     * @type String\n     * @default\n     */\n    textDecoration:       '',\n\n    /**\n     * Text alignment. Possible values: \"left\", \"center\", \"right\" or \"justify\".\n     * @type String\n     * @default\n     */\n    textAlign:            'left',\n\n    /**\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n     * @type String\n     * @default\n     */\n    fontStyle:            '',\n\n    /**\n     * Line height\n     * @type Number\n     * @default\n     */\n    lineHeight:           1.16,\n\n    /**\n     * Background color of text lines\n     * @type String\n     * @default\n     */\n    textBackgroundColor:  '',\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties:      stateProperties,\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties:      cacheProperties,\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color.\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n     * @type String\n     * @default\n     */\n    stroke:               null,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:               null,\n\n    /**\n     * @private\n     */\n    _fontSizeFraction: 0.25,\n\n    /**\n     * Text Line proportion to font Size (in pixels)\n     * @type Number\n     * @default\n     */\n    _fontSizeMult:             1.13,\n\n    /**\n     * additional space between characters\n     * expressed in thousands of em unit\n     * @type Number\n     * @default\n     */\n    charSpacing:             0,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      options = options || { };\n      this.text = text;\n      this.__skipDimension = true;\n      this.callSuper('initialize', options);\n      this.__skipDimension = false;\n      this._initDimensions();\n      this.setCoords();\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @param {CanvasRenderingContext2D} [ctx] Context to render on\n     * @private\n     */\n    _initDimensions: function(ctx) {\n      if (this.__skipDimension) {\n        return;\n      }\n      if (!ctx) {\n        ctx = fabric.util.createCanvasElement().getContext('2d');\n        this._setTextStyles(ctx);\n      }\n      this._textLines = this._splitTextIntoLines();\n      this._clearCache();\n      this.width = this._getTextWidth(ctx) || this.cursorWidth || MIN_TEXT_WIDTH;\n      this.height = this._getTextHeight(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var dim = this.callSuper('_getCacheCanvasDimensions');\n      var fontSize = this.fontSize;\n      dim.width += fontSize * dim.zoomX;\n      dim.height += fontSize * dim.zoomY;\n      return dim;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this._setTextStyles(ctx);\n      if (this.group && this.group.type === 'path-group') {\n        ctx.translate(this.left, this.top);\n      }\n      this._renderTextLinesBackground(ctx);\n      this._renderText(ctx);\n      this._renderTextDecoration(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderText: function(ctx) {\n      this._renderTextFill(ctx);\n      this._renderTextStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setTextStyles: function(ctx) {\n      ctx.textBaseline = 'alphabetic';\n      ctx.font = this._getFontDeclaration();\n    },\n\n    /**\n     * @private\n     * @return {Number} Height of fabric.Text object\n     */\n    _getTextHeight: function() {\n      return this._getHeightOfSingleLine() + (this._textLines.length - 1) * this._getHeightOfLine();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {Number} Maximum width of fabric.Text object\n     */\n    _getTextWidth: function(ctx) {\n      var maxWidth = this._getLineWidth(ctx, 0);\n\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\n        var currentLineWidth = this._getLineWidth(ctx, i);\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} chars Chars to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     */\n    _renderChars: function(method, ctx, chars, left, top) {\n      // remove Text word from method var\n      var shortM = method.slice(0, -4), _char, width;\n      if (this[shortM].toLive) {\n        var offsetX = -this.width / 2 + this[shortM].offsetX || 0,\n            offsetY = -this.height / 2 + this[shortM].offsetY || 0;\n        ctx.save();\n        ctx.translate(offsetX, offsetY);\n        left -= offsetX;\n        top -= offsetY;\n      }\n      if (this.charSpacing !== 0) {\n        var additionalSpace = this._getWidthOfCharSpacing();\n        chars = chars.split('');\n        for (var i = 0, len = chars.length; i < len; i++) {\n          _char = chars[i];\n          width = ctx.measureText(_char).width + additionalSpace;\n          ctx[method](_char, left, top);\n          left += width > 0 ? width : 0;\n        }\n      }\n      else {\n        ctx[method](chars, left, top);\n      }\n      this[shortM].toLive && ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Text to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     * @param {Number} lineIndex Index of a line in a text\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      // lift the line by quarter of fontSize\n      top -= this.fontSize * this._fontSizeFraction;\n\n      // short-circuit\n      var lineWidth = this._getLineWidth(ctx, lineIndex);\n      if (this.textAlign !== 'justify' || this.width < lineWidth) {\n        this._renderChars(method, ctx, line, left, top, lineIndex);\n        return;\n      }\n\n      // stretch the line\n      var words = line.split(/\\s+/),\n          charOffset = 0,\n          wordsWidth = this._getWidthOfWords(ctx, words.join(' '), lineIndex, 0),\n          widthDiff = this.width - wordsWidth,\n          numSpaces = words.length - 1,\n          spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,\n          leftOffset = 0, word;\n\n      for (var i = 0, len = words.length; i < len; i++) {\n        while (line[charOffset] === ' ' && charOffset < line.length) {\n          charOffset++;\n        }\n        word = words[i];\n        this._renderChars(method, ctx, word, left + leftOffset, top, lineIndex, charOffset);\n        leftOffset += this._getWidthOfWords(ctx, word, lineIndex, charOffset) + spaceWidth;\n        charOffset += word.length;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} word\n     */\n    _getWidthOfWords: function (ctx, word) {\n      var width = ctx.measureText(word).width, charCount, additionalSpace;\n      if (this.charSpacing !== 0) {\n        charCount = word.split('').length;\n        additionalSpace = charCount * this._getWidthOfCharSpacing();\n        width += additionalSpace;\n      }\n      return width > 0 ? width : 0;\n    },\n\n    /**\n     * @private\n     * @return {Number} Left offset\n     */\n    _getLeftOffset: function() {\n      return -this.width / 2;\n    },\n\n    /**\n     * @private\n     * @return {Number} Top offset\n     */\n    _getTopOffset: function() {\n      return -this.height / 2;\n    },\n\n    /**\n     * Returns true because text has no style\n     */\n    isEmptyStyles: function() {\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     */\n    _renderTextCommon: function(ctx, method) {\n\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset();\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        var heightOfLine = this._getHeightOfLine(ctx, i),\n            maxHeight = heightOfLine / this.lineHeight,\n            lineWidth = this._getLineWidth(ctx, i),\n            leftOffset = this._getLineLeftOffset(lineWidth);\n        this._renderTextLine(\n          method,\n          ctx,\n          this._textLines[i],\n          left + leftOffset,\n          top + lineHeights + maxHeight,\n          i\n        );\n        lineHeights += heightOfLine;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextFill: function(ctx) {\n      if (!this.fill && this.isEmptyStyles()) {\n        return;\n      }\n\n      this._renderTextCommon(ctx, 'fillText');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextStroke: function(ctx) {\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray);\n      ctx.beginPath();\n      this._renderTextCommon(ctx, 'strokeText');\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @return {Number} height of line\n     */\n    _getHeightOfLine: function() {\n      return this._getHeightOfSingleLine() * this.lineHeight;\n    },\n\n    /**\n     * @private\n     * @return {Number} height of line without lineHeight\n     */\n    _getHeightOfSingleLine: function() {\n      return this.fontSize * this._fontSizeMult;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      if (!this.textBackgroundColor) {\n        return;\n      }\n      var lineTopOffset = 0, heightOfLine,\n          lineWidth, lineLeftOffset, originalFill = ctx.fillStyle;\n\n      ctx.fillStyle = this.textBackgroundColor;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this._getHeightOfLine(ctx, i);\n        lineWidth = this._getLineWidth(ctx, i);\n        if (lineWidth > 0) {\n          lineLeftOffset = this._getLineLeftOffset(lineWidth);\n          ctx.fillRect(\n            this._getLeftOffset() + lineLeftOffset,\n            this._getTopOffset() + lineTopOffset,\n            lineWidth,\n            heightOfLine / this.lineHeight\n          );\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.fillStyle = originalFill;\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {Number} lineWidth Width of text line\n     * @return {Number} Line left offset\n     */\n    _getLineLeftOffset: function(lineWidth) {\n      if (this.textAlign === 'center') {\n        return (this.width - lineWidth) / 2;\n      }\n      if (this.textAlign === 'right') {\n        return this.width - lineWidth;\n      }\n      return 0;\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.__lineWidths = [];\n      this.__lineHeights = [];\n    },\n\n    /**\n     * @private\n     */\n    _shouldClearDimensionCache: function() {\n      var shouldClear = this._forceClearCache;\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\n      if (shouldClear) {\n        this.saveState({ propertySet: '_dimensionAffectingProps' });\n        this.dirty = true;\n      }\n      return shouldClear;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    _getLineWidth: function(ctx, lineIndex) {\n      if (this.__lineWidths[lineIndex]) {\n        return this.__lineWidths[lineIndex] === -1 ? this.width : this.__lineWidths[lineIndex];\n      }\n\n      var width, wordCount, line = this._textLines[lineIndex];\n\n      if (line === '') {\n        width = 0;\n      }\n      else {\n        width = this._measureLine(ctx, lineIndex);\n      }\n      this.__lineWidths[lineIndex] = width;\n\n      if (width && this.textAlign === 'justify') {\n        wordCount = line.split(/\\s+/);\n        if (wordCount.length > 1) {\n          this.__lineWidths[lineIndex] = -1;\n        }\n      }\n      return width;\n    },\n\n    _getWidthOfCharSpacing: function() {\n      if (this.charSpacing !== 0) {\n        return this.fontSize * this.charSpacing / 1000;\n      }\n      return 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    _measureLine: function(ctx, lineIndex) {\n      var line = this._textLines[lineIndex],\n          width = ctx.measureText(line).width,\n          additionalSpace = 0, charCount, finalWidth;\n      if (this.charSpacing !== 0) {\n        charCount = line.split('').length;\n        additionalSpace = (charCount - 1) * this._getWidthOfCharSpacing();\n      }\n      finalWidth = width + additionalSpace;\n      return finalWidth > 0 ? finalWidth : 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx) {\n      if (!this.textDecoration) {\n        return;\n      }\n      var halfOfVerticalBox = this.height / 2,\n          _this = this, offsets = [];\n\n      /** @ignore */\n      function renderLinesAtOffset(offsets) {\n        var i, lineHeight = 0, len, j, oLen, lineWidth,\n            lineLeftOffset, heightOfLine;\n\n        for (i = 0, len = _this._textLines.length; i < len; i++) {\n\n          lineWidth = _this._getLineWidth(ctx, i);\n          lineLeftOffset = _this._getLineLeftOffset(lineWidth);\n          heightOfLine = _this._getHeightOfLine(ctx, i);\n\n          for (j = 0, oLen = offsets.length; j < oLen; j++) {\n            ctx.fillRect(\n              _this._getLeftOffset() + lineLeftOffset,\n              lineHeight + (_this._fontSizeMult - 1 + offsets[j] ) * _this.fontSize - halfOfVerticalBox,\n              lineWidth,\n              _this.fontSize / 15);\n          }\n          lineHeight += heightOfLine;\n        }\n      }\n\n      if (this.textDecoration.indexOf('underline') > -1) {\n        offsets.push(0.85); // 1 - 3/16\n      }\n      if (this.textDecoration.indexOf('line-through') > -1) {\n        offsets.push(0.43);\n      }\n      if (this.textDecoration.indexOf('overline') > -1) {\n        offsets.push(-0.12);\n      }\n      if (offsets.length > 0) {\n        renderLinesAtOffset(offsets);\n      }\n    },\n\n    /**\n     * return font declaration string for canvas context\n     * @returns {String} font declaration formatted for canvas context.\n     */\n    _getFontDeclaration: function() {\n      return [\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\n        (fabric.isLikelyNode ? this.fontWeight : this.fontStyle),\n        (fabric.isLikelyNode ? this.fontStyle : this.fontWeight),\n        this.fontSize + 'px',\n        (fabric.isLikelyNode ? ('\"' + this.fontFamily + '\"') : this.fontFamily)\n      ].join(' ');\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    render: function(ctx, noTransform) {\n      // do not render if object is not visible\n      if (!this.visible) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      if (this._shouldClearDimensionCache()) {\n        this._setTextStyles(ctx);\n        this._initDimensions(ctx);\n      }\n      this.callSuper('render', ctx, noTransform);\n    },\n\n    /**\n     * Returns the text as an array of lines.\n     * @returns {Array} Lines in the text\n     */\n    _splitTextIntoLines: function() {\n      return this.text.split(this._reNewline);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var additionalProperties = [\n        'text',\n        'fontSize',\n        'fontWeight',\n        'fontFamily',\n        'fontStyle',\n        'lineHeight',\n        'textDecoration',\n        'textAlign',\n        'textBackgroundColor',\n        'charSpacing'\n      ].concat(propertiesToInclude);\n      return this.callSuper('toObject', additionalProperties);\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      if (!this.ctx) {\n        this.ctx = fabric.util.createCanvasElement().getContext('2d');\n      }\n      var markup = this._createBaseSVGMarkup(),\n          offsets = this._getSVGLeftTopOffsets(this.ctx),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\n      this._wrapSVGTextAndBg(markup, textAndBg);\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLeftTopOffsets: function(ctx) {\n      var lineTop = this._getHeightOfLine(ctx, 0),\n          textLeft = -this.width / 2,\n          textTop = 0;\n\n      return {\n        textLeft: textLeft + (this.group && this.group.type === 'path-group' ? this.left : 0),\n        textTop: textTop + (this.group && this.group.type === 'path-group' ? -this.top : 0),\n        lineTop: lineTop\n      };\n    },\n\n    /**\n     * @private\n     */\n    _wrapSVGTextAndBg: function(markup, textAndBg) {\n      var noShadow = true, filter = this.getSvgFilter(),\n          style = filter === '' ? '' : ' style=\"' + filter + '\"';\n\n      markup.push(\n        '\\t<g ', this.getSvgId(), 'transform=\"', this.getSvgTransform(), this.getSvgTransformMatrix(), '\"',\n          style, '>\\n',\n          textAndBg.textBgRects.join(''),\n          '\\t\\t<text ',\n            (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n            (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\n            (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\n            (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\n            (this.textDecoration ? 'text-decoration=\"' + this.textDecoration + '\" ' : ''),\n            'style=\"', this.getSvgStyles(noShadow), '\" >\\n',\n            textAndBg.textSpans.join(''),\n          '\\t\\t</text>\\n',\n        '\\t</g>\\n'\n      );\n    },\n\n    /**\n     * @private\n     * @param {Number} textTopOffset Text top offset\n     * @param {Number} textLeftOffset Text left offset\n     * @return {Object}\n     */\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\n      var textSpans = [],\n          textBgRects = [],\n          height = 0;\n      // bounding-box background\n      this._setSVGBg(textBgRects);\n\n      // text and text-background\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (this.textBackgroundColor) {\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset, textTopOffset, height);\n        }\n        this._setSVGTextLineText(i, textSpans, height, textLeftOffset, textTopOffset, textBgRects);\n        height += this._getHeightOfLine(this.ctx, i);\n      }\n\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    _setSVGTextLineText: function(i, textSpans, height, textLeftOffset, textTopOffset) {\n      var yPos = this.fontSize * (this._fontSizeMult - this._fontSizeFraction)\n        - textTopOffset + height - this.height / 2;\n      if (this.textAlign === 'justify') {\n        // i call from here to do not intefere with IText\n        this._setSVGTextLineJustifed(i, textSpans, yPos, textLeftOffset);\n        return;\n      }\n      textSpans.push(\n        '\\t\\t\\t<tspan x=\"',\n          toFixed(textLeftOffset + this._getLineLeftOffset(this._getLineWidth(this.ctx, i)), NUM_FRACTION_DIGITS), '\" ',\n          'y=\"',\n          toFixed(yPos, NUM_FRACTION_DIGITS),\n          '\" ',\n          // doing this on <tspan> elements since setting opacity\n          // on containing <text> one doesn't work in Illustrator\n          this._getFillAttributes(this.fill), '>',\n          fabric.util.string.escapeXml(this._textLines[i]),\n        '</tspan>\\n'\n      );\n    },\n\n    _setSVGTextLineJustifed: function(i, textSpans, yPos, textLeftOffset) {\n      var ctx = fabric.util.createCanvasElement().getContext('2d');\n\n      this._setTextStyles(ctx);\n\n      var line = this._textLines[i],\n          words = line.split(/\\s+/),\n          wordsWidth = this._getWidthOfWords(ctx, words.join('')),\n          widthDiff = this.width - wordsWidth,\n          numSpaces = words.length - 1,\n          spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,\n          word, attributes = this._getFillAttributes(this.fill),\n          len;\n\n      textLeftOffset += this._getLineLeftOffset(this._getLineWidth(ctx, i));\n\n      for (i = 0, len = words.length; i < len; i++) {\n        word = words[i];\n        textSpans.push(\n          '\\t\\t\\t<tspan x=\"',\n            toFixed(textLeftOffset, NUM_FRACTION_DIGITS), '\" ',\n            'y=\"',\n            toFixed(yPos, NUM_FRACTION_DIGITS),\n            '\" ',\n            // doing this on <tspan> elements since setting opacity\n            // on containing <text> one doesn't work in Illustrator\n            attributes, '>',\n            fabric.util.string.escapeXml(word),\n          '</tspan>\\n'\n        );\n        textLeftOffset += this._getWidthOfWords(ctx, word) + spaceWidth;\n      }\n    },\n\n    _setSVGTextLineBg: function(textBgRects, i, textLeftOffset, textTopOffset, height) {\n      textBgRects.push(\n        '\\t\\t<rect ',\n          this._getFillAttributes(this.textBackgroundColor),\n          ' x=\"',\n          toFixed(textLeftOffset + this._getLineLeftOffset(this._getLineWidth(this.ctx, i)), NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(height - this.height / 2, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(this._getLineWidth(this.ctx, i), NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(this._getHeightOfLine(this.ctx, i) / this.lineHeight, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n');\n    },\n\n    _setSVGBg: function(textBgRects) {\n      if (this.backgroundColor) {\n        textBgRects.push(\n          '\\t\\t<rect ',\n            this._getFillAttributes(this.backgroundColor),\n            ' x=\"',\n            toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n            '\" y=\"',\n            toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n            '\" width=\"',\n            toFixed(this.width, NUM_FRACTION_DIGITS),\n            '\" height=\"',\n            toFixed(this.height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n');\n      }\n    },\n\n    /**\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n     *\n     * @private\n     * @param {*} value\n     * @return {String}\n     */\n    _getFillAttributes: function(value) {\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Sets specified property to a specified value\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Text} thisArg\n     * @chainable\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (this._dimensionAffectingProps.indexOf(key) > -1) {\n        this._initDimensions();\n        this.setCoords();\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    'x y dx dy font-family font-style font-weight font-size text-decoration text-anchor'.split(' '));\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Text} Instance of fabric.Text\n   */\n  fabric.Text.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES);\n    options = fabric.util.object.extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes);\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if ('dx' in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if ('dy' in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!('fontSize' in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    if (!options.originX) {\n      options.originX = 'left';\n    }\n\n    var textContent = '';\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!('textContent' in element)) {\n      if ('firstChild' in element && element.firstChild !== null) {\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    }\n    else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\n\n    var text = new fabric.Text(textContent, options),\n        textHeightScaleFactor = text.getHeight() / text.height,\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\n        textHeight = text.getHeight() + scaledDiff,\n        offX = 0;\n    /*\n      Adjust positioning:\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n        top/left properties in Fabric correspond to center point of text bounding box\n    */\n    if (text.originX === 'left') {\n      offX = text.getWidth() / 2;\n    }\n    if (text.originX === 'right') {\n      offX = -text.getWidth() / 2;\n    }\n    text.set({\n      left: text.getLeft() + offX,\n      top: text.getTop() - textHeight / 2 + text.fontSize * (0.18 + text._fontSizeFraction) / text.lineHeight /* 0.3 is the old lineHeight */\n    });\n\n    return text;\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Text} Instance of fabric.Text\n   */\n  fabric.Text.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Text', object, callback, forceAsync, 'text');\n  };\n\n  fabric.util.createAccessors(fabric.Text);\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'i-text',\n\n    /**\n     * Index where text selection starts (or where cursor is when there is no selection)\n     * @type Number\n     * @default\n     */\n    selectionStart: 0,\n\n    /**\n     * Index where text selection ends\n     * @type Number\n     * @default\n     */\n    selectionEnd: 0,\n\n    /**\n     * Color of text selection\n     * @type String\n     * @default\n     */\n    selectionColor: 'rgba(17,119,255,0.3)',\n\n    /**\n     * Indicates whether text is in editing mode\n     * @type Boolean\n     * @default\n     */\n    isEditing: false,\n\n    /**\n     * Indicates whether a text can be edited\n     * @type Boolean\n     * @default\n     */\n    editable: true,\n\n    /**\n     * Border color of text object while it's in editing mode\n     * @type String\n     * @default\n     */\n    editingBorderColor: 'rgba(102,153,255,0.25)',\n\n    /**\n     * Width of cursor (in px)\n     * @type Number\n     * @default\n     */\n    cursorWidth: 2,\n\n    /**\n     * Color of default cursor (when not overwritten by character style)\n     * @type String\n     * @default\n     */\n    cursorColor: '#333',\n\n    /**\n     * Delay between cursor blink (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDelay: 1000,\n\n    /**\n     * Duration of cursor fadein (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDuration: 600,\n\n    /**\n     * Object containing character styles\n     * (where top-level properties corresponds to line number and 2nd-level properties -- to char number in a line)\n     * @type Object\n     * @default\n     */\n    styles: null,\n\n    /**\n     * Indicates whether internal text char widths can be cached\n     * @type Boolean\n     * @default\n     */\n    caching: true,\n\n    /**\n     * @private\n     */\n    _reSpace: /\\s|\\n/,\n\n    /**\n     * @private\n     */\n    _currentCursorOpacity: 0,\n\n    /**\n     * @private\n     */\n    _selectionDirection: null,\n\n    /**\n     * @private\n     */\n    _abortCursorAnimation: false,\n\n    /**\n     * @private\n     */\n    __widthOfSpace: [],\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.IText} thisArg\n     */\n    initialize: function(text, options) {\n      this.styles = options ? (options.styles || { }) : { };\n      this.callSuper('initialize', text, options);\n      this.initBehavior();\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.callSuper('_clearCache');\n      this.__widthOfSpace = [];\n    },\n\n    /**\n     * Returns true if object has no styling\n     */\n    isEmptyStyles: function() {\n      if (!this.styles) {\n        return true;\n      }\n      var obj = this.styles;\n\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          // eslint-disable-next-line no-unused-vars\n          for (var p3 in obj[p1][p2]) {\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Sets selection start (left boundary of a selection)\n     * @param {Number} index Index to set selection start to\n     */\n    setSelectionStart: function(index) {\n      index = Math.max(index, 0);\n      this._updateAndFire('selectionStart', index);\n    },\n\n    /**\n     * Sets selection end (right boundary of a selection)\n     * @param {Number} index Index to set selection end to\n     */\n    setSelectionEnd: function(index) {\n      index = Math.min(index, this.text.length);\n      this._updateAndFire('selectionEnd', index);\n    },\n\n    /**\n     * @private\n     * @param {String} property 'selectionStart' or 'selectionEnd'\n     * @param {Number} index new position of property\n     */\n    _updateAndFire: function(property, index) {\n      if (this[property] !== index) {\n        this._fireSelectionChanged();\n        this[property] = index;\n      }\n      this._updateTextarea();\n    },\n\n    /**\n     * Fires the even of selection changed\n     * @private\n     */\n    _fireSelectionChanged: function() {\n      this.fire('selection:changed');\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\n    },\n\n    /**\n     * Gets style of a current selection/cursor (at the start position)\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at\n     * @return {Object} styles Style object at a specified (or current) index\n     */\n    getSelectionStyles: function(startIndex, endIndex) {\n\n      if (arguments.length === 2) {\n        var styles = [];\n        for (var i = startIndex; i < endIndex; i++) {\n          styles.push(this.getSelectionStyles(i));\n        }\n        return styles;\n      }\n\n      var loc = this.get2DCursorLocation(startIndex),\n          style = this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n\n      return style || {};\n    },\n\n    /**\n     * Sets style of a current selection\n     * @param {Object} [styles] Styles object\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    setSelectionStyles: function(styles) {\n      if (this.selectionStart === this.selectionEnd) {\n        this._extendStyles(this.selectionStart, styles);\n      }\n      else {\n        for (var i = this.selectionStart; i < this.selectionEnd; i++) {\n          this._extendStyles(i, styles);\n        }\n      }\n      /* not included in _extendStyles to avoid clearing cache more than once */\n      this._forceClearCache = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _extendStyles: function(index, styles) {\n      var loc = this.get2DCursorLocation(index);\n\n      if (!this._getLineStyle(loc.lineIndex)) {\n        this._setLineStyle(loc.lineIndex, {});\n      }\n\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n      }\n\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @param {CanvasRenderingContext2D} [ctx] Context to render on\n     * @private\n     */\n    _initDimensions: function(ctx) {\n      if (!ctx) {\n        this.clearContextTop();\n      }\n      this.callSuper('_initDimensions', ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    render: function(ctx, noTransform) {\n      this.clearContextTop();\n      this.callSuper('render', ctx, noTransform);\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n      // the correct position but not at every cursor animation.\n      this.cursorOffsetCache = { };\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this.callSuper('_render', ctx);\n      this.ctx = ctx;\n    },\n\n    /**\n     * Prepare and clean the contextTop\n     */\n    clearContextTop: function() {\n      if (!this.active || !this.isEditing) {\n        return;\n      }\n      if (this.canvas && this.canvas.contextTop) {\n        var ctx = this.canvas.contextTop;\n        ctx.save();\n        ctx.transform.apply(ctx, this.canvas.viewportTransform);\n        this.transform(ctx);\n        this.transformMatrix && ctx.transform.apply(ctx, this.transformMatrix);\n        this._clearTextArea(ctx);\n        ctx.restore();\n      }\n    },\n\n    /**\n     * Renders cursor or selection (depending on what exists)\n     */\n    renderCursorOrSelection: function() {\n      if (!this.active || !this.isEditing) {\n        return;\n      }\n      var chars = this.text.split(''),\n          boundaries, ctx;\n      if (this.canvas && this.canvas.contextTop) {\n        ctx = this.canvas.contextTop;\n        ctx.save();\n        ctx.transform.apply(ctx, this.canvas.viewportTransform);\n        this.transform(ctx);\n        this.transformMatrix && ctx.transform.apply(ctx, this.transformMatrix);\n        this._clearTextArea(ctx);\n      }\n      else {\n        ctx = this.ctx;\n        ctx.save();\n      }\n      if (this.selectionStart === this.selectionEnd) {\n        boundaries = this._getCursorBoundaries(chars, 'cursor');\n        this.renderCursor(boundaries, ctx);\n      }\n      else {\n        boundaries = this._getCursorBoundaries(chars, 'selection');\n        this.renderSelection(chars, boundaries, ctx);\n      }\n      ctx.restore();\n    },\n\n    _clearTextArea: function(ctx) {\n      // we add 4 pixel, to be sure to do not leave any pixel out\n      var width = this.width + 4, height = this.height + 4;\n      ctx.clearRect(-width / 2, -height / 2, width, height);\n    },\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     */\n    get2DCursorLocation: function(selectionStart) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n      var len = this._textLines.length;\n      for (var i = 0; i < len; i++) {\n        if (selectionStart <= this._textLines[i].length) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart\n          };\n        }\n        selectionStart -= this._textLines[i].length + 1;\n      }\n      return {\n        lineIndex: i - 1,\n        charIndex: this._textLines[i - 1].length < selectionStart ? this._textLines[i - 1].length : selectionStart\n      };\n    },\n\n    /**\n     * Returns complete style of char at the current cursor\n     * @param {Number} lineIndex Line index\n     * @param {Number} charIndex Char index\n     * @return {Object} Character style\n     */\n    getCurrentCharStyle: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex === 0 ? 0 : charIndex - 1);\n\n      return {\n        fontSize: style && style.fontSize || this.fontSize,\n        fill: style && style.fill || this.fill,\n        textBackgroundColor: style && style.textBackgroundColor || this.textBackgroundColor,\n        textDecoration: style && style.textDecoration || this.textDecoration,\n        fontFamily: style && style.fontFamily || this.fontFamily,\n        fontWeight: style && style.fontWeight || this.fontWeight,\n        fontStyle: style && style.fontStyle || this.fontStyle,\n        stroke: style && style.stroke || this.stroke,\n        strokeWidth: style && style.strokeWidth || this.strokeWidth\n      };\n    },\n\n    /**\n     * Returns fontSize of char at the current cursor\n     * @param {Number} lineIndex Line index\n     * @param {Number} charIndex Char index\n     * @return {Number} Character font size\n     */\n    getCurrentCharFontSize: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex === 0 ? 0 : charIndex - 1);\n      return style && style.fontSize ? style.fontSize : this.fontSize;\n    },\n\n    /**\n     * Returns color (fill) of char at the current cursor\n     * @param {Number} lineIndex Line index\n     * @param {Number} charIndex Char index\n     * @return {String} Character color (fill)\n     */\n    getCurrentCharColor: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex === 0 ? 0 : charIndex - 1);\n      return style && style.fill ? style.fill : this.cursorColor;\n    },\n\n    /**\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\n     * @private\n     * @param {Array} chars Array of characters\n     * @param {String} typeOfBoundaries\n     */\n    _getCursorBoundaries: function(chars, typeOfBoundaries) {\n\n      // left/top are left/top of entire text box\n      // leftOffset/topOffset are offset from that left/top point of a text box\n\n      var left = Math.round(this._getLeftOffset()),\n          top = this._getTopOffset(),\n\n          offsets = this._getCursorBoundariesOffsets(\n                      chars, typeOfBoundaries);\n\n      return {\n        left: left,\n        top: top,\n        leftOffset: offsets.left + offsets.lineLeft,\n        topOffset: offsets.top\n      };\n    },\n\n    /**\n     * @private\n     */\n    _getCursorBoundariesOffsets: function(chars, typeOfBoundaries) {\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\n        return this.cursorOffsetCache;\n      }\n      var lineLeftOffset = 0,\n          lineIndex = 0,\n          charIndex = 0,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries;\n\n      for (var i = 0; i < this.selectionStart; i++) {\n        if (chars[i] === '\\n') {\n          leftOffset = 0;\n          topOffset += this._getHeightOfLine(this.ctx, lineIndex);\n\n          lineIndex++;\n          charIndex = 0;\n        }\n        else {\n          leftOffset += this._getWidthOfChar(this.ctx, chars[i], lineIndex, charIndex);\n          charIndex++;\n        }\n\n        lineLeftOffset = this._getLineLeftOffset(this._getLineWidth(this.ctx, lineIndex));\n      }\n      if (typeOfBoundaries === 'cursor') {\n        topOffset += (1 - this._fontSizeFraction) * this._getHeightOfLine(this.ctx, lineIndex) / this.lineHeight\n          - this.getCurrentCharFontSize(lineIndex, charIndex) * (1 - this._fontSizeFraction);\n      }\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\n        leftOffset -= this._getWidthOfCharSpacing();\n      }\n      boundaries = {\n        top: topOffset,\n        left: leftOffset > 0 ? leftOffset : 0,\n        lineLeft: lineLeftOffset\n      };\n      this.cursorOffsetCache = boundaries;\n      return this.cursorOffsetCache;\n    },\n\n    /**\n     * Renders cursor\n     * @param {Object} boundaries\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderCursor: function(boundaries, ctx) {\n\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getCurrentCharFontSize(lineIndex, charIndex),\n          leftOffset = boundaries.leftOffset,\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier;\n\n      ctx.fillStyle = this.getCurrentCharColor(lineIndex, charIndex);\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n\n      ctx.fillRect(\n        boundaries.left + leftOffset - cursorWidth / 2,\n        boundaries.top + boundaries.topOffset,\n        cursorWidth,\n        charHeight);\n    },\n\n    /**\n     * Renders text selection\n     * @param {Array} chars Array of characters\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderSelection: function(chars, boundaries, ctx) {\n\n      ctx.fillStyle = this.selectionColor;\n\n      var start = this.get2DCursorLocation(this.selectionStart),\n          end = this.get2DCursorLocation(this.selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex;\n      for (var i = startLine; i <= endLine; i++) {\n        var lineOffset = this._getLineLeftOffset(this._getLineWidth(ctx, i)) || 0,\n            lineHeight = this._getHeightOfLine(this.ctx, i),\n            realLineHeight = 0, boxWidth = 0, line = this._textLines[i];\n\n        if (i === startLine) {\n          for (var j = 0, len = line.length; j < len; j++) {\n            if (j >= start.charIndex && (i !== endLine || j < end.charIndex)) {\n              boxWidth += this._getWidthOfChar(ctx, line[j], i, j);\n            }\n            if (j < start.charIndex) {\n              lineOffset += this._getWidthOfChar(ctx, line[j], i, j);\n            }\n          }\n          if (j === line.length) {\n            boxWidth -= this._getWidthOfCharSpacing();\n          }\n        }\n        else if (i > startLine && i < endLine) {\n          boxWidth += this._getLineWidth(ctx, i) || 5;\n        }\n        else if (i === endLine) {\n          for (var j2 = 0, j2len = end.charIndex; j2 < j2len; j2++) {\n            boxWidth += this._getWidthOfChar(ctx, line[j2], i, j2);\n          }\n          if (end.charIndex === line.length) {\n            boxWidth -= this._getWidthOfCharSpacing();\n          }\n        }\n        realLineHeight = lineHeight;\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n          lineHeight /= this.lineHeight;\n        }\n        ctx.fillRect(\n          boundaries.left + lineOffset,\n          boundaries.top + boundaries.topOffset,\n          boxWidth > 0 ? boxWidth : 0,\n          lineHeight);\n\n        boundaries.topOffset += realLineHeight;\n      }\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Content of the line\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     * @param {Number} charOffset\n     */\n    _renderChars: function(method, ctx, line, left, top, lineIndex, charOffset) {\n\n      if (this.isEmptyStyles()) {\n        return this._renderCharsFast(method, ctx, line, left, top);\n      }\n\n      charOffset = charOffset || 0;\n\n      // set proper line offset\n      var lineHeight = this._getHeightOfLine(ctx, lineIndex),\n          prevStyle,\n          thisStyle,\n          charsToRender = '';\n\n      ctx.save();\n      top -= lineHeight / this.lineHeight * this._fontSizeFraction;\n      for (var i = charOffset, len = line.length + charOffset; i <= len; i++) {\n        prevStyle = prevStyle || this.getCurrentCharStyle(lineIndex, i);\n        thisStyle = this.getCurrentCharStyle(lineIndex, i + 1);\n\n        if (this._hasStyleChanged(prevStyle, thisStyle) || i === len) {\n          this._renderChar(method, ctx, lineIndex, i - 1, charsToRender, left, top, lineHeight);\n          charsToRender = '';\n          prevStyle = thisStyle;\n        }\n        charsToRender += line[i - charOffset];\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Content of the line\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     */\n    _renderCharsFast: function(method, ctx, line, left, top) {\n\n      if (method === 'fillText' && this.fill) {\n        this.callSuper('_renderChars', method, ctx, line, left, top);\n      }\n      if (method === 'strokeText' && ((this.stroke && this.strokeWidth > 0) || this.skipFillStrokeCheck)) {\n        this.callSuper('_renderChars', method, ctx, line, left, top);\n      }\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} i\n     * @param {String} _char\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     * @param {Number} lineHeight Height of the line\n     */\n    _renderChar: function(method, ctx, lineIndex, i, _char, left, top, lineHeight) {\n      var charWidth, charHeight, shouldFill, shouldStroke,\n          decl = this._getStyleDeclaration(lineIndex, i),\n          offset, textDecoration, chars, additionalSpace, _charWidth;\n\n      if (decl) {\n        charHeight = this._getHeightOfChar(ctx, _char, lineIndex, i);\n        shouldStroke = decl.stroke;\n        shouldFill = decl.fill;\n        textDecoration = decl.textDecoration;\n      }\n      else {\n        charHeight = this.fontSize;\n      }\n\n      shouldStroke = (shouldStroke || this.stroke) && method === 'strokeText';\n      shouldFill = (shouldFill || this.fill) && method === 'fillText';\n\n      decl && ctx.save();\n\n      charWidth = this._applyCharStylesGetWidth(ctx, _char, lineIndex, i, decl || null);\n      textDecoration = textDecoration || this.textDecoration;\n\n      if (decl && decl.textBackgroundColor) {\n        this._removeShadow(ctx);\n      }\n      if (this.charSpacing !== 0) {\n        additionalSpace = this._getWidthOfCharSpacing();\n        chars = _char.split('');\n        charWidth = 0;\n        for (var j = 0, len = chars.length, jChar; j < len; j++) {\n          jChar = chars[j];\n          shouldFill && ctx.fillText(jChar, left + charWidth, top);\n          shouldStroke && ctx.strokeText(jChar, left + charWidth, top);\n          _charWidth = ctx.measureText(jChar).width + additionalSpace;\n          charWidth += _charWidth > 0 ? _charWidth : 0;\n        }\n      }\n      else {\n        shouldFill && ctx.fillText(_char, left, top);\n        shouldStroke && ctx.strokeText(_char, left, top);\n      }\n\n      if (textDecoration || textDecoration !== '') {\n        offset = this._fontSizeFraction * lineHeight / this.lineHeight;\n        this._renderCharDecoration(ctx, textDecoration, left, top, offset, charWidth, charHeight);\n      }\n\n      decl && ctx.restore();\n      ctx.translate(charWidth, 0);\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChanged: function(prevStyle, thisStyle) {\n      return (prevStyle.fill !== thisStyle.fill ||\n              prevStyle.fontSize !== thisStyle.fontSize ||\n              prevStyle.textBackgroundColor !== thisStyle.textBackgroundColor ||\n              prevStyle.textDecoration !== thisStyle.textDecoration ||\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\n              prevStyle.stroke !== thisStyle.stroke ||\n              prevStyle.strokeWidth !== thisStyle.strokeWidth\n      );\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderCharDecoration: function(ctx, textDecoration, left, top, offset, charWidth, charHeight) {\n\n      if (!textDecoration) {\n        return;\n      }\n\n      var decorationWeight = charHeight / 15,\n          positions = {\n            underline: top + charHeight / 10,\n            'line-through': top - charHeight * (this._fontSizeFraction + this._fontSizeMult - 1) + decorationWeight,\n            overline: top - (this._fontSizeMult - this._fontSizeFraction) * charHeight\n          },\n          decorations = ['underline', 'line-through', 'overline'], i, decoration;\n\n      for (i = 0; i < decorations.length; i++) {\n        decoration = decorations[i];\n        if (textDecoration.indexOf(decoration) > -1) {\n          ctx.fillRect(left, positions[decoration], charWidth , decorationWeight);\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      // to \"cancel\" this.fontSize subtraction in fabric.Text#_renderTextLine\n      // the adding 0.03 is just to align text with itext by overlap test\n      if (!this.isEmptyStyles()) {\n        top += this.fontSize * (this._fontSizeFraction + 0.03);\n      }\n      this.callSuper('_renderTextLine', method, ctx, line, left, top, lineIndex);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx) {\n      if (this.isEmptyStyles()) {\n        return this.callSuper('_renderTextDecoration', ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      this.callSuper('_renderTextLinesBackground', ctx);\n\n      var lineTopOffset = 0, heightOfLine,\n          lineWidth, lineLeftOffset,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(),\n          colorCache = '',\n          line, _char, style, leftCache,\n          topCache, widthCache, heightCache;\n      ctx.save();\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this._getHeightOfLine(ctx, i);\n        line = this._textLines[i];\n\n        if (line === '' || !this.styles || !this._getLineStyle(i)) {\n          lineTopOffset += heightOfLine;\n          continue;\n        }\n\n        lineWidth = this._getLineWidth(ctx, i);\n        lineLeftOffset = this._getLineLeftOffset(lineWidth);\n        leftCache = topCache = widthCache = heightCache = 0;\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          style = this._getStyleDeclaration(i, j) || {};\n\n          if (colorCache !== style.textBackgroundColor) {\n            if (heightCache && widthCache) {\n              ctx.fillStyle = colorCache;\n              ctx.fillRect(leftCache, topCache, widthCache, heightCache);\n            }\n            leftCache = topCache = widthCache = heightCache = 0;\n            colorCache = style.textBackgroundColor || '';\n          }\n\n          if (!style.textBackgroundColor) {\n            colorCache = '';\n            continue;\n          }\n          _char = line[j];\n\n          if (colorCache === style.textBackgroundColor) {\n            colorCache = style.textBackgroundColor;\n            if (!leftCache) {\n              leftCache = leftOffset + lineLeftOffset + this._getWidthOfCharsAt(ctx, i, j);\n            }\n            topCache = topOffset + lineTopOffset;\n            widthCache += this._getWidthOfChar(ctx, _char, i, j);\n            heightCache = heightOfLine / this.lineHeight;\n          }\n        }\n        // if a textBackgroundColor ends on the last character of a line\n        if (heightCache && widthCache) {\n          ctx.fillStyle = colorCache;\n          ctx.fillRect(leftCache, topCache, widthCache, heightCache);\n          leftCache = topCache = widthCache = heightCache = 0;\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     */\n    _getCacheProp: function(_char, styleDeclaration) {\n      return _char +\n             styleDeclaration.fontSize +\n             styleDeclaration.fontWeight +\n             styleDeclaration.fontStyle;\n    },\n\n    /**\n     * @private\n     * @param {String} fontFamily name\n     * @return {Object} reference to cache\n     */\n    _getFontCache: function(fontFamily) {\n      if (!fabric.charWidthsCache[fontFamily]) {\n        fabric.charWidthsCache[fontFamily] = { };\n      }\n      return fabric.charWidthsCache[fontFamily];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} _char\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} [decl]\n     */\n    _applyCharStylesGetWidth: function(ctx, _char, lineIndex, charIndex, decl) {\n      var charDecl = decl || this._getStyleDeclaration(lineIndex, charIndex),\n          styleDeclaration = clone(charDecl),\n          width, cacheProp, charWidthsCache;\n\n      this._applyFontStyles(styleDeclaration);\n      charWidthsCache = this._getFontCache(styleDeclaration.fontFamily);\n      cacheProp = this._getCacheProp(_char, styleDeclaration);\n\n      // short-circuit if no styles for this char\n      // global style from object is always applyed and handled by save and restore\n      if (!charDecl && charWidthsCache[cacheProp] && this.caching) {\n        return charWidthsCache[cacheProp];\n      }\n\n      if (typeof styleDeclaration.shadow === 'string') {\n        styleDeclaration.shadow = new fabric.Shadow(styleDeclaration.shadow);\n      }\n\n      var fill = styleDeclaration.fill || this.fill;\n      ctx.fillStyle = fill.toLive\n        ? fill.toLive(ctx, this)\n        : fill;\n\n      if (styleDeclaration.stroke) {\n        ctx.strokeStyle = (styleDeclaration.stroke && styleDeclaration.stroke.toLive)\n          ? styleDeclaration.stroke.toLive(ctx, this)\n          : styleDeclaration.stroke;\n      }\n\n      ctx.lineWidth = styleDeclaration.strokeWidth || this.strokeWidth;\n      ctx.font = this._getFontDeclaration.call(styleDeclaration);\n\n      //if we want this._setShadow.call to work with styleDeclarion\n      //we have to add those references\n      if (styleDeclaration.shadow) {\n        styleDeclaration.scaleX = this.scaleX;\n        styleDeclaration.scaleY = this.scaleY;\n        styleDeclaration.canvas = this.canvas;\n        styleDeclaration.getObjectScaling = this.getObjectScaling;\n        this._setShadow.call(styleDeclaration, ctx);\n      }\n\n      if (!this.caching || !charWidthsCache[cacheProp]) {\n        width = ctx.measureText(_char).width;\n        this.caching && (charWidthsCache[cacheProp] = width);\n        return width;\n      }\n\n      return charWidthsCache[cacheProp];\n    },\n\n    /**\n     * @private\n     * @param {Object} styleDeclaration\n     */\n    _applyFontStyles: function(styleDeclaration) {\n      if (!styleDeclaration.fontFamily) {\n        styleDeclaration.fontFamily = this.fontFamily;\n      }\n      if (!styleDeclaration.fontSize) {\n        styleDeclaration.fontSize = this.fontSize;\n      }\n      if (!styleDeclaration.fontWeight) {\n        styleDeclaration.fontWeight = this.fontWeight;\n      }\n      if (!styleDeclaration.fontStyle) {\n        styleDeclaration.fontStyle = this.fontStyle;\n      }\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Boolean} [returnCloneOrEmpty=false]\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex, returnCloneOrEmpty) {\n      if (returnCloneOrEmpty) {\n        return (this.styles[lineIndex] && this.styles[lineIndex][charIndex])\n          ? clone(this.styles[lineIndex][charIndex])\n          : { };\n      }\n\n      return this.styles[lineIndex] && this.styles[lineIndex][charIndex] ? this.styles[lineIndex][charIndex] : null;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     *\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      return this.styles[lineIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex, style) {\n      this.styles[lineIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      delete this.styles[lineIndex];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _getWidthOfChar: function(ctx, _char, lineIndex, charIndex) {\n      if (!this._isMeasuring && this.textAlign === 'justify' && this._reSpacesAndTabs.test(_char)) {\n        return this._getWidthOfSpace(ctx, lineIndex);\n      }\n      ctx.save();\n      var width = this._applyCharStylesGetWidth(ctx, _char, lineIndex, charIndex);\n      if (this.charSpacing !== 0) {\n        width += this._getWidthOfCharSpacing();\n      }\n      ctx.restore();\n      return width > 0 ? width : 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     */\n    _getHeightOfChar: function(ctx, lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex);\n      return style && style.fontSize ? style.fontSize : this.fontSize;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     */\n    _getWidthOfCharsAt: function(ctx, lineIndex, charIndex) {\n      var width = 0, i, _char;\n      for (i = 0; i < charIndex; i++) {\n        _char = this._textLines[lineIndex][i];\n        width += this._getWidthOfChar(ctx, _char, lineIndex, i);\n      }\n      return width;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    _measureLine: function(ctx, lineIndex) {\n      this._isMeasuring = true;\n      var width = this._getWidthOfCharsAt(ctx, lineIndex, this._textLines[lineIndex].length);\n      if (this.charSpacing !== 0) {\n        width -= this._getWidthOfCharSpacing();\n      }\n      this._isMeasuring = false;\n      return width > 0 ? width : 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     */\n    _getWidthOfSpace: function (ctx, lineIndex) {\n      if (this.__widthOfSpace[lineIndex]) {\n        return this.__widthOfSpace[lineIndex];\n      }\n      var line = this._textLines[lineIndex],\n          wordsWidth = this._getWidthOfWords(ctx, line, lineIndex, 0),\n          widthDiff = this.width - wordsWidth,\n          numSpaces = line.length - line.replace(this._reSpacesAndTabs, '').length,\n          width = Math.max(widthDiff / numSpaces, ctx.measureText(' ').width);\n      this.__widthOfSpace[lineIndex] = width;\n      return width;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line\n     * @param {Number} lineIndex\n     * @param {Number} charOffset\n     */\n    _getWidthOfWords: function (ctx, line, lineIndex, charOffset) {\n      var width = 0;\n\n      for (var charIndex = 0; charIndex < line.length; charIndex++) {\n        var _char = line[charIndex];\n\n        if (!_char.match(/\\s/)) {\n          width += this._getWidthOfChar(ctx, _char, lineIndex, charIndex + charOffset);\n        }\n      }\n\n      return width;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _getHeightOfLine: function(ctx, lineIndex) {\n      if (this.__lineHeights[lineIndex]) {\n        return this.__lineHeights[lineIndex];\n      }\n\n      var line = this._textLines[lineIndex],\n          maxHeight = this._getHeightOfChar(ctx, lineIndex, 0);\n\n      for (var i = 1, len = line.length; i < len; i++) {\n        var currentCharHeight = this._getHeightOfChar(ctx, lineIndex, i);\n        if (currentCharHeight > maxHeight) {\n          maxHeight = currentCharHeight;\n        }\n      }\n      this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\n      return this.__lineHeights[lineIndex];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _getTextHeight: function(ctx) {\n      var lineHeight, height = 0;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineHeight = this._getHeightOfLine(ctx, i);\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\n      }\n      return height;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return fabric.util.object.extend(this.callSuper('toObject', propertiesToInclude), {\n        styles: clone(this.styles, true)\n      });\n    }\n  });\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.IText} instance of fabric.IText\n   */\n  fabric.IText.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('IText', object, callback, forceAsync, 'text');\n  };\n})();\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Initializes all the interactive behavior of IText\n     */\n    initBehavior: function() {\n      this.initAddedHandler();\n      this.initRemovedHandler();\n      this.initCursorSelectionHandlers();\n      this.initDoubleClickSimulation();\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    },\n\n    onDeselect: function() {\n      this.isEditing && this.exitEditing();\n      this.selected = false;\n      this.callSuper('onDeselect');\n    },\n\n    /**\n     * Initializes \"added\" event handler\n     */\n    initAddedHandler: function() {\n      var _this = this;\n      this.on('added', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          if (!canvas._hasITextHandlers) {\n            canvas._hasITextHandlers = true;\n            _this._initCanvasHandlers(canvas);\n          }\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          canvas._iTextInstances.push(_this);\n        }\n      });\n    },\n\n    initRemovedHandler: function() {\n      var _this = this;\n      this.on('removed', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\n          if (canvas._iTextInstances.length === 0) {\n            canvas._hasITextHandlers = false;\n            _this._removeCanvasHandlers(canvas);\n          }\n        }\n      });\n    },\n\n    /**\n     * register canvas event to manage exiting on other instances\n     * @private\n     */\n    _initCanvasHandlers: function(canvas) {\n      canvas._mouseUpITextHandler = (function() {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function(obj) {\n            obj.__isMousedown = false;\n          });\n        }\n      }).bind(this);\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * remove canvas event to manage exiting on other instances\n     * @private\n     */\n    _removeCanvasHandlers: function(canvas) {\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * @private\n     */\n    _tick: function() {\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\n    },\n\n    /**\n     * @private\n     */\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\n\n      var tickState;\n\n      tickState = {\n        isAborted: false,\n        abort: function() {\n          this.isAborted = true;\n        },\n      };\n\n      obj.animate('_currentCursorOpacity', targetOpacity, {\n        duration: duration,\n        onComplete: function() {\n          if (!tickState.isAborted) {\n            obj[completeMethod]();\n          }\n        },\n        onChange: function() {\n          // we do not want to animate a selection, only cursor\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n            obj.renderCursorOrSelection();\n          }\n        },\n        abort: function() {\n          return tickState.isAborted;\n        }\n      });\n      return tickState;\n    },\n\n    /**\n     * @private\n     */\n    _onTickComplete: function() {\n\n      var _this = this;\n\n      if (this._cursorTimeout1) {\n        clearTimeout(this._cursorTimeout1);\n      }\n      this._cursorTimeout1 = setTimeout(function() {\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\n      }, 100);\n    },\n\n    /**\n     * Initializes delayed cursor\n     */\n    initDelayedCursor: function(restart) {\n      var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this._cursorTimeout2 = setTimeout(function() {\n        _this._tick();\n      }, delay);\n    },\n\n    /**\n     * Aborts cursor animation and clears all timeouts\n     */\n    abortCursorAnimation: function() {\n      var shouldClear = this._currentTickState || this._currentTickCompleteState;\n      this._currentTickState && this._currentTickState.abort();\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\n\n      clearTimeout(this._cursorTimeout1);\n      clearTimeout(this._cursorTimeout2);\n\n      this._currentCursorOpacity = 0;\n      // to clear just itext area we need to transform the context\n      // it may not be worth it\n      if (shouldClear) {\n        this.canvas && this.canvas.clearContext(this.canvas.contextTop || this.ctx);\n      }\n\n    },\n\n    /**\n     * Selects entire text\n     */\n    selectAll: function() {\n      this.selectionStart = 0;\n      this.selectionEnd = this.text.length;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    },\n\n    /**\n     * Returns selected text\n     * @return {String}\n     */\n    getSelectedText: function() {\n      return this.text.slice(this.selectionStart, this.selectionEnd);\n    },\n\n    /**\n     * Find new selection index representing start of current word according to current selection index\n     * @param {Number} startFrom Surrent selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      // remove space before cursor first\n      if (this._reSpace.test(this.text.charAt(index))) {\n        while (this._reSpace.test(this.text.charAt(index))) {\n          offset++;\n          index--;\n        }\n      }\n      while (/\\S/.test(this.text.charAt(index)) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      // remove space after cursor first\n      if (this._reSpace.test(this.text.charAt(index))) {\n        while (this._reSpace.test(this.text.charAt(index))) {\n          offset++;\n          index++;\n        }\n      }\n      while (/\\S/.test(this.text.charAt(index)) && index < this.text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Find new selection index representing start of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      while (!/\\n/.test(this.text.charAt(index)) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      while (!/\\n/.test(this.text.charAt(index)) && index < this.text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Returns number of newlines in selected text\n     * @return {Number} Number of newlines in selected text\n     */\n    getNumNewLinesInSelectedText: function() {\n      var selectedText = this.getSelectedText(),\n          numNewLines  = 0;\n\n      for (var i = 0, len = selectedText.length; i < len; i++) {\n        if (selectedText[i] === '\\n') {\n          numNewLines++;\n        }\n      }\n      return numNewLines;\n    },\n\n    /**\n     * Finds index corresponding to beginning or end of a word\n     * @param {Number} selectionStart Index of a character\n     * @param {Number} direction 1 or -1\n     * @return {Number} Index of the beginning or end of a word\n     */\n    searchWordBoundary: function(selectionStart, direction) {\n      var index     = this._reSpace.test(this.text.charAt(selectionStart)) ? selectionStart - 1 : selectionStart,\n          _char     = this.text.charAt(index),\n          reNonWord = /[ \\n\\.,;!\\?\\-]/;\n\n      while (!reNonWord.test(_char) && index > 0 && index < this.text.length) {\n        index += direction;\n        _char = this.text.charAt(index);\n      }\n      if (reNonWord.test(_char) && _char !== '\\n') {\n        index += direction === 1 ? 0 : 1;\n      }\n      return index;\n    },\n\n    /**\n     * Selects a word based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectWord: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * Selects a line based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectLine: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    },\n\n    /**\n     * Enters editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    enterEditing: function(e) {\n      if (this.isEditing || !this.editable) {\n        return;\n      }\n\n      if (this.canvas) {\n        this.exitEditingOnOthers(this.canvas);\n      }\n\n      this.isEditing = true;\n      this.selected = true;\n      this.initHiddenTextarea(e);\n      this.hiddenTextarea.focus();\n      this._updateTextarea();\n      this._saveEditingProps();\n      this._setEditingProps();\n      this._textBeforeEdit = this.text;\n\n      this._tick();\n      this.fire('editing:entered');\n      this._fireSelectionChanged();\n      if (!this.canvas) {\n        return this;\n      }\n      this.canvas.fire('text:editing:entered', { target: this });\n      this.initMouseMoveHandler();\n      this.canvas.renderAll();\n      return this;\n    },\n\n    exitEditingOnOthers: function(canvas) {\n      if (canvas._iTextInstances) {\n        canvas._iTextInstances.forEach(function(obj) {\n          obj.selected = false;\n          if (obj.isEditing) {\n            obj.exitEditing();\n          }\n        });\n      }\n    },\n\n    /**\n     * Initializes \"mousemove\" event handler\n     */\n    initMouseMoveHandler: function() {\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\n    },\n\n    /**\n     * @private\n     */\n    mouseMoveHandler: function(options) {\n      if (!this.__isMousedown || !this.isEditing) {\n        return;\n      }\n\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n      if (\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\n        &&\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\n      ) {\n        return;\n      }\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\n        this.selectionStart = this.__selectionStartOnMouseDown;\n        this.selectionEnd = newSelectionStart;\n      }\n      else {\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = this.__selectionStartOnMouseDown;\n      }\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\n        this.restartCursorIfNeeded();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setEditingProps: function() {\n      this.hoverCursor = 'text';\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\n      }\n\n      this.borderColor = this.editingBorderColor;\n\n      this.hasControls = this.selectable = false;\n      this.lockMovementX = this.lockMovementY = true;\n    },\n\n    /**\n     * @private\n     */\n    _updateTextarea: function() {\n      if (!this.hiddenTextarea || this.inCompositionMode) {\n        return;\n      }\n      this.cursorOffsetCache = { };\n      this.hiddenTextarea.value = this.text;\n      this.hiddenTextarea.selectionStart = this.selectionStart;\n      this.hiddenTextarea.selectionEnd = this.selectionEnd;\n      if (this.selectionStart === this.selectionEnd) {\n        var style = this._calcTextareaPosition();\n        this.hiddenTextarea.style.left = style.left;\n        this.hiddenTextarea.style.top = style.top;\n        this.hiddenTextarea.style.fontSize = style.fontSize;\n      }\n    },\n\n    /**\n     * @private\n     * @return {Object} style contains style for hiddenTextarea\n     */\n    _calcTextareaPosition: function() {\n      if (!this.canvas) {\n        return { x: 1, y: 1 };\n      }\n      var chars = this.text.split(''),\n          boundaries = this._getCursorBoundaries(chars, 'cursor'),\n          cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getCurrentCharFontSize(lineIndex, charIndex),\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight\n          },\n          upperCanvas = this.canvas.upperCanvasEl,\n          maxWidth = upperCanvas.width - charHeight,\n          maxHeight = upperCanvas.height - charHeight;\n\n      p = fabric.util.transformPoint(p, m);\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n\n      if (p.x < 0) {\n        p.x = 0;\n      }\n      if (p.x > maxWidth) {\n        p.x = maxWidth;\n      }\n      if (p.y < 0) {\n        p.y = 0;\n      }\n      if (p.y > maxHeight) {\n        p.y = maxHeight;\n      }\n\n      // add canvas offset on document\n      p.x += this.canvas._offset.left;\n      p.y += this.canvas._offset.top;\n\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight };\n    },\n\n    /**\n     * @private\n     */\n    _saveEditingProps: function() {\n      this._savedProps = {\n        hasControls: this.hasControls,\n        borderColor: this.borderColor,\n        lockMovementX: this.lockMovementX,\n        lockMovementY: this.lockMovementY,\n        hoverCursor: this.hoverCursor,\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\n        moveCursor: this.canvas && this.canvas.moveCursor\n      };\n    },\n\n    /**\n     * @private\n     */\n    _restoreEditingProps: function() {\n      if (!this._savedProps) {\n        return;\n      }\n\n      this.hoverCursor = this._savedProps.overCursor;\n      this.hasControls = this._savedProps.hasControls;\n      this.borderColor = this._savedProps.borderColor;\n      this.lockMovementX = this._savedProps.lockMovementX;\n      this.lockMovementY = this._savedProps.lockMovementY;\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\n        this.canvas.moveCursor = this._savedProps.moveCursor;\n      }\n    },\n\n    /**\n     * Exits from editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    exitEditing: function() {\n      var isTextChanged = (this._textBeforeEdit !== this.text);\n      this.selected = false;\n      this.isEditing = false;\n      this.selectable = true;\n\n      this.selectionEnd = this.selectionStart;\n\n      if (this.hiddenTextarea) {\n        this.hiddenTextarea.blur && this.hiddenTextarea.blur();\n        this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);\n        this.hiddenTextarea = null;\n      }\n\n      this.abortCursorAnimation();\n      this._restoreEditingProps();\n      this._currentCursorOpacity = 0;\n\n      this.fire('editing:exited');\n      isTextChanged && this.fire('modified');\n      if (this.canvas) {\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\n        this.canvas.fire('text:editing:exited', { target: this });\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this.styles) {\n        if (!this._textLines[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _removeCharsFromTo: function(start, end) {\n      while (end !== start) {\n        this._removeSingleCharAndStyle(start + 1);\n        end--;\n      }\n      this.selectionStart = start;\n      this.selectionEnd = start;\n    },\n\n    _removeSingleCharAndStyle: function(index) {\n      var isBeginningOfLine = this.text[index - 1] === '\\n',\n          indexStyle        = isBeginningOfLine ? index : index - 1;\n      this.removeStyleObject(isBeginningOfLine, indexStyle);\n      this.text = this.text.slice(0, index - 1) +\n        this.text.slice(index);\n\n      this._textLines = this._splitTextIntoLines();\n    },\n\n    /**\n     * Inserts characters where cursor is (replacing selection if one exists)\n     * @param {String} _chars Characters to insert\n     * @param {Boolean} useCopiedStyle use fabric.copiedTextStyle\n     */\n    insertChars: function(_chars, useCopiedStyle) {\n      var style;\n\n      if (this.selectionEnd - this.selectionStart > 1) {\n        this._removeCharsFromTo(this.selectionStart, this.selectionEnd);\n      }\n      //short circuit for block paste\n      if (!useCopiedStyle && this.isEmptyStyles()) {\n        this.insertChar(_chars, false);\n        return;\n      }\n      for (var i = 0, len = _chars.length; i < len; i++) {\n        if (useCopiedStyle) {\n          style = fabric.util.object.clone(fabric.copiedTextStyle[i], true);\n        }\n        this.insertChar(_chars[i], i < len - 1, style);\n      }\n    },\n\n    /**\n     * Inserts a character where cursor is\n     * @param {String} _char Characters to insert\n     * @param {Boolean} skipUpdate trigger rendering and updates at the end of text insert\n     * @param {Object} styleObject Style to be inserted for the new char\n     */\n    insertChar: function(_char, skipUpdate, styleObject) {\n      var isEndOfLine = this.text[this.selectionStart] === '\\n';\n      this.text = this.text.slice(0, this.selectionStart) +\n        _char + this.text.slice(this.selectionEnd);\n      this._textLines = this._splitTextIntoLines();\n      this.insertStyleObjects(_char, isEndOfLine, styleObject);\n      this.selectionStart += _char.length;\n      this.selectionEnd = this.selectionStart;\n      if (skipUpdate) {\n        return;\n      }\n      this._updateTextarea();\n      this.setCoords();\n      this._fireSelectionChanged();\n      this.fire('changed');\n      this.restartCursorIfNeeded();\n      if (this.canvas) {\n        this.canvas.fire('text:changed', { target: this });\n        this.canvas.renderAll();\n      }\n    },\n\n    restartCursorIfNeeded: function() {\n      if (!this._currentTickState || this._currentTickState.isAborted\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\n      ) {\n        this.initDelayedCursor();\n      }\n    },\n\n    /**\n     * Inserts new style object\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Boolean} isEndOfLine True if it's end of line\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, isEndOfLine) {\n\n      this.shiftLineStyles(lineIndex, +1);\n\n      var currentCharStyle = {},\n          newLineStyles    = {};\n\n      if (this.styles[lineIndex] && this.styles[lineIndex][charIndex - 1]) {\n        currentCharStyle = this.styles[lineIndex][charIndex - 1];\n      }\n\n      // if there's nothing after cursor,\n      // we clone current char style onto the next (otherwise empty) line\n      if (isEndOfLine && currentCharStyle) {\n        newLineStyles[0] = clone(currentCharStyle);\n        this.styles[lineIndex + 1] = newLineStyles;\n      }\n      // otherwise we clone styles of all chars\n      // after cursor onto the next line, from the beginning\n      else {\n        var somethingAdded = false;\n        for (var index in this.styles[lineIndex]) {\n          var numIndex = parseInt(index, 10);\n          if (numIndex >= charIndex) {\n            somethingAdded = true;\n            newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n            // remove lines from the previous line since they're on a new line now\n            delete this.styles[lineIndex][index];\n          }\n        }\n        somethingAdded && (this.styles[lineIndex + 1] = newLineStyles);\n      }\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Object} [style] Style object to insert, if given\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, style) {\n\n      var currentLineStyles       = this.styles[lineIndex],\n          currentLineStylesCloned = clone(currentLineStyles);\n\n      if (charIndex === 0 && !style) {\n        charIndex = 1;\n      }\n\n      // shift all char styles by 1 forward\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n      for (var index in currentLineStylesCloned) {\n        var numericIndex = parseInt(index, 10);\n\n        if (numericIndex >= charIndex) {\n          currentLineStyles[numericIndex + 1] = currentLineStylesCloned[numericIndex];\n\n          // only delete the style if there was nothing moved there\n          if (!currentLineStylesCloned[numericIndex - 1]) {\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n      var newStyle = style || clone(currentLineStyles[charIndex - 1]);\n      newStyle && (this.styles[lineIndex][charIndex] = newStyle);\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object(s)\n     * @param {String} _chars Characters at the location where style is inserted\n     * @param {Boolean} isEndOfLine True if it's end of line\n     * @param {Object} [styleObject] Style to insert\n     */\n    insertStyleObjects: function(_chars, isEndOfLine, styleObject) {\n      // removed shortcircuit over isEmptyStyles\n\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex      = cursorLocation.lineIndex,\n          charIndex      = cursorLocation.charIndex;\n\n      if (!this._getLineStyle(lineIndex)) {\n        this._setLineStyle(lineIndex, {});\n      }\n\n      if (_chars === '\\n') {\n        this.insertNewlineStyleObject(lineIndex, charIndex, isEndOfLine);\n      }\n      else {\n        this.insertCharStyleObject(lineIndex, charIndex, styleObject);\n      }\n    },\n\n    /**\n     * Shifts line styles up or down\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can be -1 or +1\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by 1 upward or downward\n      var clonedStyles = clone(this.styles);\n      for (var line in clonedStyles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine <= lineIndex) {\n          delete clonedStyles[numericLine];\n        }\n      }\n      for (var line in this.styles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine > lineIndex) {\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\n          if (!clonedStyles[numericLine - offset]) {\n            delete this.styles[numericLine];\n          }\n        }\n      }\n      //TODO: evaluate if delete old style lines with offset -1\n    },\n\n    /**\n     * Removes style object\n     * @param {Boolean} isBeginningOfLine True if cursor is at the beginning of line\n     * @param {Number} [index] Optional index. When not given, current selectionStart is used.\n     */\n    removeStyleObject: function(isBeginningOfLine, index) {\n\n      var cursorLocation = this.get2DCursorLocation(index),\n          lineIndex      = cursorLocation.lineIndex,\n          charIndex      = cursorLocation.charIndex;\n\n      this._removeStyleObject(isBeginningOfLine, cursorLocation, lineIndex, charIndex);\n    },\n\n    _getTextOnPreviousLine: function(lIndex) {\n      return this._textLines[lIndex - 1];\n    },\n\n    _removeStyleObject: function(isBeginningOfLine, cursorLocation, lineIndex, charIndex) {\n\n      if (isBeginningOfLine) {\n        var textOnPreviousLine     = this._getTextOnPreviousLine(cursorLocation.lineIndex),\n            newCharIndexOnPrevLine = textOnPreviousLine ? textOnPreviousLine.length : 0;\n\n        if (!this.styles[lineIndex - 1]) {\n          this.styles[lineIndex - 1] = {};\n        }\n        for (charIndex in this.styles[lineIndex]) {\n          this.styles[lineIndex - 1][parseInt(charIndex, 10) + newCharIndexOnPrevLine]\n            = this.styles[lineIndex][charIndex];\n        }\n        this.shiftLineStyles(cursorLocation.lineIndex, -1);\n      }\n      else {\n        var currentLineStyles = this.styles[lineIndex];\n\n        if (currentLineStyles) {\n          delete currentLineStyles[charIndex];\n        }\n        var currentLineStylesCloned = clone(currentLineStyles);\n        // shift all styles by 1 backwards\n        for (var i in currentLineStylesCloned) {\n          var numericIndex = parseInt(i, 10);\n          if (numericIndex >= charIndex && numericIndex !== 0) {\n            currentLineStyles[numericIndex - 1] = currentLineStylesCloned[numericIndex];\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n    },\n\n    /**\n     * Inserts new line\n     */\n    insertNewline: function() {\n      this.insertChars('\\n');\n    },\n\n    /**\n     * Set the selectionStart and selectionEnd according to the ne postion of cursor\n     * mimic the key - mouse navigation when shift is pressed.\n     */\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\n      if (newSelection <= start) {\n        if (end === start) {\n          this._selectionDirection = 'left';\n        }\n        else if (this._selectionDirection === 'right') {\n          this._selectionDirection = 'left';\n          this.selectionEnd = start;\n        }\n        this.selectionStart = newSelection;\n      }\n      else if (newSelection > start && newSelection < end) {\n        if (this._selectionDirection === 'right') {\n          this.selectionEnd = newSelection;\n        }\n        else {\n          this.selectionStart = newSelection;\n        }\n      }\n      else {\n        // newSelection is > selection start and end\n        if (end === start) {\n          this._selectionDirection = 'right';\n        }\n        else if (this._selectionDirection === 'left') {\n          this._selectionDirection = 'right';\n          this.selectionStart = end;\n        }\n        this.selectionEnd = newSelection;\n      }\n    },\n\n    setSelectionInBoundaries: function() {\n      var length = this.text.length;\n      if (this.selectionStart > length) {\n        this.selectionStart = length;\n      }\n      else if (this.selectionStart < 0) {\n        this.selectionStart = 0;\n      }\n      if (this.selectionEnd > length) {\n        this.selectionEnd = length;\n      }\n      else if (this.selectionEnd < 0) {\n        this.selectionEnd = 0;\n      }\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n  /**\n   * Initializes \"dbclick\" event handler\n   */\n  initDoubleClickSimulation: function() {\n\n    // for double click\n    this.__lastClickTime = +new Date();\n\n    // for triple click\n    this.__lastLastClickTime = +new Date();\n\n    this.__lastPointer = { };\n\n    this.on('mousedown', this.onMouseDown.bind(this));\n  },\n\n  onMouseDown: function(options) {\n\n    this.__newClickTime = +new Date();\n    var newPointer = this.canvas.getPointer(options.e);\n\n    if (this.isTripleClick(newPointer, options.e)) {\n      this.fire('tripleclick', options);\n      this._stopEvent(options.e);\n    }\n    else if (this.isDoubleClick(newPointer)) {\n      this.fire('dblclick', options);\n      this._stopEvent(options.e);\n    }\n\n    this.__lastLastClickTime = this.__lastClickTime;\n    this.__lastClickTime = this.__newClickTime;\n    this.__lastPointer = newPointer;\n    this.__lastIsEditing = this.isEditing;\n    this.__lastSelected = this.selected;\n  },\n\n  isDoubleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y && this.__lastIsEditing;\n  },\n\n  isTripleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y;\n  },\n\n  /**\n   * @private\n   */\n  _stopEvent: function(e) {\n    e.preventDefault && e.preventDefault();\n    e.stopPropagation && e.stopPropagation();\n  },\n\n  /**\n   * Initializes event handlers related to cursor or selection\n   */\n  initCursorSelectionHandlers: function() {\n    this.initMousedownHandler();\n    this.initMouseupHandler();\n    this.initClicks();\n  },\n\n  /**\n   * Initializes double and triple click event handlers\n   */\n  initClicks: function() {\n    this.on('dblclick', function(options) {\n      this.selectWord(this.getSelectionStartFromPointer(options.e));\n    });\n    this.on('tripleclick', function(options) {\n      this.selectLine(this.getSelectionStartFromPointer(options.e));\n    });\n  },\n\n  /**\n   * Initializes \"mousedown\" event handler\n   */\n  initMousedownHandler: function() {\n    this.on('mousedown', function(options) {\n      if (!this.editable || (options.e.button && options.e.button !== 1)) {\n        return;\n      }\n      var pointer = this.canvas.getPointer(options.e);\n      this.__mousedownX = pointer.x;\n      this.__mousedownY = pointer.y;\n      this.__isMousedown = true;\n\n      if (this.selected) {\n        this.setCursorByClick(options.e);\n      }\n\n      if (this.isEditing) {\n        this.__selectionStartOnMouseDown = this.selectionStart;\n        if (this.selectionStart === this.selectionEnd) {\n          this.abortCursorAnimation();\n        }\n        this.renderCursorOrSelection();\n      }\n    });\n  },\n\n  /**\n   * @private\n   */\n  _isObjectMoved: function(e) {\n    var pointer = this.canvas.getPointer(e);\n\n    return this.__mousedownX !== pointer.x ||\n           this.__mousedownY !== pointer.y;\n  },\n\n  /**\n   * Initializes \"mouseup\" event handler\n   */\n  initMouseupHandler: function() {\n    this.on('mouseup', function(options) {\n      this.__isMousedown = false;\n      if (!this.editable || this._isObjectMoved(options.e) || (options.e.button && options.e.button !== 1)) {\n        return;\n      }\n\n      if (this.__lastSelected && !this.__corner) {\n        this.enterEditing(options.e);\n        if (this.selectionStart === this.selectionEnd) {\n          this.initDelayedCursor(true);\n        }\n        else {\n          this.renderCursorOrSelection();\n        }\n      }\n      this.selected = true;\n    });\n  },\n\n  /**\n   * Changes cursor location in a text depending on passed pointer (x/y) object\n   * @param {Event} e Event object\n   */\n  setCursorByClick: function(e) {\n    var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart, end = this.selectionEnd;\n    if (e.shiftKey) {\n      this.setSelectionStartEndWithShift(start, end, newSelection);\n    }\n    else {\n      this.selectionStart = newSelection;\n      this.selectionEnd = newSelection;\n    }\n    if (this.isEditing) {\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Returns index of a character corresponding to where an object was clicked\n   * @param {Event} e Event object\n   * @return {Number} Index of a character\n   */\n  getSelectionStartFromPointer: function(e) {\n    var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        newSelectionStart,\n        line;\n\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\n      line = this._textLines[i];\n      height += this._getHeightOfLine(this.ctx, i) * this.scaleY;\n\n      var widthOfLine = this._getLineWidth(this.ctx, i),\n          lineLeftOffset = this._getLineLeftOffset(widthOfLine);\n\n      width = lineLeftOffset * this.scaleX;\n\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n\n        prevWidth = width;\n\n        width += this._getWidthOfChar(this.ctx, line[j], i, this.flipX ? jlen - j : j) *\n                 this.scaleX;\n\n        if (height <= mouseOffset.y || width <= mouseOffset.x) {\n          charIndex++;\n          continue;\n        }\n\n        return this._getNewSelectionStartFromOffset(\n          mouseOffset, prevWidth, width, charIndex + i, jlen);\n      }\n\n      if (mouseOffset.y < height) {\n        //this happens just on end of lines.\n        return this._getNewSelectionStartFromOffset(\n          mouseOffset, prevWidth, width, charIndex + i - 1, jlen);\n      }\n    }\n\n    // clicked somewhere after all chars, so set at the end\n    if (typeof newSelectionStart === 'undefined') {\n      return this.text.length;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\n\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ? 0 : 1,\n        newSelectionStart = index + offset;\n\n    // if object is horizontally flipped, mirror cursor location from the end\n    if (this.flipX) {\n      newSelectionStart = jlen - newSelectionStart;\n    }\n\n    if (newSelectionStart > this.text.length) {\n      newSelectionStart = this.text.length;\n    }\n\n    return newSelectionStart;\n  }\n});\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n  /**\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\n   */\n  initHiddenTextarea: function() {\n    this.hiddenTextarea = fabric.document.createElement('textarea');\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\n    var style = this._calcTextareaPosition();\n    this.hiddenTextarea.style.cssText = 'white-space: nowrap; position: absolute; top: ' + style.top +\n      '; left: ' + style.left + '; opacity: 0; width: 1px; height: 1px; z-index: -999;';\n    fabric.document.body.appendChild(this.hiddenTextarea);\n\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.cut.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\n\n    if (!this._clickHandlerInitialized && this.canvas) {\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\n      this._clickHandlerInitialized = true;\n    }\n  },\n\n  /**\n   * For functionalities on keyDown\n   * Map a special key to a function of the instance/prototype\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\n   * this map setting the name of a function that you build on the fabric.Itext or\n   * your prototype.\n   * the map change will affect all Instances unless you need for only some text Instances\n   * in that case you have to clone this object and assign your Instance.\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n   */\n  keysMap: {\n    8:  'removeChars',\n    9:  'exitEditing',\n    27: 'exitEditing',\n    13: 'insertNewline',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorRight',\n    36: 'moveCursorLeft',\n    37: 'moveCursorLeft',\n    38: 'moveCursorUp',\n    39: 'moveCursorRight',\n    40: 'moveCursorDown',\n    46: 'forwardDelete'\n  },\n\n  /**\n   * For functionalities on keyUp + ctrl || cmd\n   */\n  ctrlKeysMapUp: {\n    67: 'copy',\n    88: 'cut'\n  },\n\n  /**\n   * For functionalities on keyDown + ctrl || cmd\n   */\n  ctrlKeysMapDown: {\n    65: 'selectAll'\n  },\n\n  onClick: function() {\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n    this.hiddenTextarea && this.hiddenTextarea.focus();\n  },\n\n  /**\n   * Handles keyup event\n   * @param {Event} e Event object\n   */\n  onKeyDown: function(e) {\n    if (!this.isEditing) {\n      return;\n    }\n    if (e.keyCode in this.keysMap) {\n      this[this.keysMap[e.keyCode]](e);\n    }\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\n      // if i press an arrow key just update selection\n      this.clearContextTop();\n      this.renderCursorOrSelection();\n    }\n    else {\n      this.canvas && this.canvas.renderAll();\n    }\n  },\n\n  /**\n   * Handles keyup event\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n   * if a copy/cut event fired, keyup is dismissed\n   * @param {Event} e Event object\n   */\n  onKeyUp: function(e) {\n    if (!this.isEditing || this._copyDone) {\n      this._copyDone = false;\n      return;\n    }\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this.canvas && this.canvas.renderAll();\n  },\n\n  /**\n   * Handles onInput event\n   * @param {Event} e Event object\n   */\n  onInput: function(e) {\n    if (!this.isEditing || this.inCompositionMode) {\n      return;\n    }\n    var offset = this.selectionStart || 0,\n        offsetEnd = this.selectionEnd || 0,\n        textLength = this.text.length,\n        newTextLength = this.hiddenTextarea.value.length,\n        diff, charsToInsert, start;\n    if (newTextLength > textLength) {\n      //we added some character\n      start = this._selectionDirection === 'left' ? offsetEnd : offset;\n      diff = newTextLength - textLength;\n      charsToInsert = this.hiddenTextarea.value.slice(start, start + diff);\n    }\n    else {\n      //we selected a portion of text and then input something else.\n      //Internet explorer does not trigger this else\n      diff = newTextLength - textLength + offsetEnd - offset;\n      charsToInsert = this.hiddenTextarea.value.slice(offset, offset + diff);\n    }\n    this.insertChars(charsToInsert);\n    e.stopPropagation();\n  },\n\n  /**\n   * Composition start\n   */\n  onCompositionStart: function() {\n    this.inCompositionMode = true;\n    this.prevCompositionLength = 0;\n    this.compositionStart = this.selectionStart;\n  },\n\n  /**\n   * Composition end\n   */\n  onCompositionEnd: function() {\n    this.inCompositionMode = false;\n  },\n\n  /**\n   * Composition update\n   */\n  onCompositionUpdate: function(e) {\n    var data = e.data;\n    this.selectionStart = this.compositionStart;\n    this.selectionEnd = this.selectionEnd === this.selectionStart ?\n      this.compositionStart + this.prevCompositionLength : this.selectionEnd;\n    this.insertChars(data, false);\n    this.prevCompositionLength = data.length;\n  },\n\n  /**\n   * Forward delete\n   */\n  forwardDelete: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      if (this.selectionStart === this.text.length) {\n        return;\n      }\n      this.moveCursorRight(e);\n    }\n    this.removeChars(e);\n  },\n\n  /**\n   * Copies selected text\n   * @param {Event} e Event object\n   */\n  copy: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      //do not cut-copy if no selection\n      return;\n    }\n    var selectedText = this.getSelectedText(),\n        clipboardData = this._getClipboardData(e);\n\n    // Check for backward compatibility with old browsers\n    if (clipboardData) {\n      clipboardData.setData('text', selectedText);\n    }\n\n    fabric.copiedText = selectedText;\n    fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd);\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this._copyDone = true;\n  },\n\n  /**\n   * Pastes text\n   * @param {Event} e Event object\n   */\n  paste: function(e) {\n    var copiedText = null,\n        clipboardData = this._getClipboardData(e),\n        useCopiedStyle = true;\n\n    // Check for backward compatibility with old browsers\n    if (clipboardData) {\n      copiedText = clipboardData.getData('text').replace(/\\r/g, '');\n      if (!fabric.copiedTextStyle || fabric.copiedText !== copiedText) {\n        useCopiedStyle = false;\n      }\n    }\n    else {\n      copiedText = fabric.copiedText;\n    }\n\n    if (copiedText) {\n      this.insertChars(copiedText, useCopiedStyle);\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n  },\n\n  /**\n   * Cuts text\n   * @param {Event} e Event object\n   */\n  cut: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      return;\n    }\n\n    this.copy(e);\n    this.removeChars(e);\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   * @return {Object} Clipboard data object\n   */\n  _getClipboardData: function(e) {\n    return (e && e.clipboardData) || fabric.window.clipboardData;\n  },\n\n  /**\n   * Finds the width in pixels before the cursor on the same line\n   * @private\n   * @param {Number} lineIndex\n   * @param {Number} charIndex\n   * @return {Number} widthBeforeCursor width before cursor\n   */\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\n    var textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\n        widthOfLine = this._getLineWidth(this.ctx, lineIndex),\n        widthBeforeCursor = this._getLineLeftOffset(widthOfLine), _char;\n\n    for (var i = 0, len = textBeforeCursor.length; i < len; i++) {\n      _char = textBeforeCursor[i];\n      widthBeforeCursor += this._getWidthOfChar(this.ctx, _char, lineIndex, i);\n    }\n    return widthBeforeCursor;\n  },\n\n  /**\n   * Gets start offset of a selection\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getDownCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    // if on last line, down cursor goes to end of line\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\n      // move to the end of a text\n      return this.text.length - selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n\n    return textAfterCursor.length + indexOnOtherLine + 2;\n  },\n\n  /**\n   * private\n   * Helps finding if the offset should be counted from Start or End\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  _getSelectionForOffset: function(e, isRight) {\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n      return this.selectionEnd;\n    }\n    else {\n      return this.selectionStart;\n    }\n  },\n\n  /**\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getUpCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n      // if on first line, up cursor goes to start of line\n      return -selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex);\n    // return a negative offset\n    return -this._textLines[lineIndex - 1].length + indexOnOtherLine - textBeforeCursor.length;\n  },\n\n  /**\n   * find for a given width it founds the matching character.\n   * @private\n   */\n  _getIndexOnLine: function(lineIndex, width) {\n\n    var widthOfLine = this._getLineWidth(this.ctx, lineIndex),\n        textOnLine = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(widthOfLine),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0,\n        foundMatch;\n\n    for (var j = 0, jlen = textOnLine.length; j < jlen; j++) {\n\n      var _char = textOnLine[j],\n          widthOfChar = this._getWidthOfChar(this.ctx, _char, lineIndex, j);\n\n      widthOfCharsOnLine += widthOfChar;\n\n      if (widthOfCharsOnLine > width) {\n\n        foundMatch = true;\n\n        var leftEdge = widthOfCharsOnLine - widthOfChar,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\n\n        break;\n      }\n    }\n\n    // reached end\n    if (!foundMatch) {\n      indexOnLine = textOnLine.length - 1;\n    }\n\n    return indexOnLine;\n  },\n\n\n  /**\n   * Moves cursor down\n   * @param {Event} e Event object\n   */\n  moveCursorDown: function(e) {\n    if (this.selectionStart >= this.text.length && this.selectionEnd >= this.text.length) {\n      return;\n    }\n    this._moveCursorUpOrDown('Down', e);\n  },\n\n  /**\n   * Moves cursor up\n   * @param {Event} e Event object\n   */\n  moveCursorUp: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorUpOrDown('Up', e);\n  },\n\n  /**\n   * Moves cursor up or down, fires the events\n   * @param {String} direction 'Up' or 'Down'\n   * @param {Event} e Event object\n   */\n  _moveCursorUpOrDown: function(direction, e) {\n    // getUpCursorOffset\n    // getDownCursorOffset\n    var action = 'get' + direction + 'CursorOffset',\n        offset = this[action](e, this._selectionDirection === 'right');\n    if (e.shiftKey) {\n      this.moveCursorWithShift(offset);\n    }\n    else {\n      this.moveCursorWithoutShift(offset);\n    }\n    if (offset !== 0) {\n      this.setSelectionInBoundaries();\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor with shift\n   * @param {Number} offset\n   */\n  moveCursorWithShift: function(offset) {\n    var newSelection = this._selectionDirection === 'left'\n    ? this.selectionStart + offset\n    : this.selectionEnd + offset;\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor up without shift\n   * @param {Number} offset\n   */\n  moveCursorWithoutShift: function(offset) {\n    if (offset < 0) {\n      this.selectionStart += offset;\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionEnd += offset;\n      this.selectionStart = this.selectionEnd;\n    }\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor left\n   * @param {Event} e Event object\n   */\n  moveCursorLeft: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Left', e);\n  },\n\n  /**\n   * @private\n   * @return {Boolean} true if a change happened\n   */\n  _move: function(e, prop, direction) {\n    var newValue;\n    if (e.altKey) {\n      newValue = this['findWordBoundary' + direction](this[prop]);\n    }\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\n      newValue = this['findLineBoundary' + direction](this[prop]);\n    }\n    else {\n      this[prop] += direction === 'Left' ? -1 : 1;\n      return true;\n    }\n    if (typeof newValue !== undefined && this[prop] !== newValue) {\n      this[prop] = newValue;\n      return true;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _moveLeft: function(e, prop) {\n    return this._move(e, prop, 'Left');\n  },\n\n  /**\n   * @private\n   */\n  _moveRight: function(e, prop) {\n    return this._move(e, prop, 'Right');\n  },\n\n  /**\n   * Moves cursor left without keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithoutShift: function(e) {\n    var change = true;\n    this._selectionDirection = 'left';\n\n    // only move cursor when there is no selection,\n    // otherwise we discard it, and leave cursor on same place\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\n      change = this._moveLeft(e, 'selectionStart');\n\n    }\n    this.selectionEnd = this.selectionStart;\n    return change;\n  },\n\n  /**\n   * Moves cursor left while keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithShift: function(e) {\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\n      return this._moveLeft(e, 'selectionEnd');\n    }\n    else if (this.selectionStart !== 0){\n      this._selectionDirection = 'left';\n      return this._moveLeft(e, 'selectionStart');\n    }\n  },\n\n  /**\n   * Moves cursor right\n   * @param {Event} e Event object\n   */\n  moveCursorRight: function(e) {\n    if (this.selectionStart >= this.text.length && this.selectionEnd >= this.text.length) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Right', e);\n  },\n\n  /**\n   * Moves cursor right or Left, fires event\n   * @param {String} direction 'Left', 'Right'\n   * @param {Event} e Event object\n   */\n  _moveCursorLeftOrRight: function(direction, e) {\n    var actionName = 'moveCursor' + direction + 'With';\n    this._currentCursorOpacity = 1;\n\n    if (e.shiftKey) {\n      actionName += 'Shift';\n    }\n    else {\n      actionName += 'outShift';\n    }\n    if (this[actionName](e)) {\n      this.abortCursorAnimation();\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor right while keeping selection\n   * @param {Event} e\n   */\n  moveCursorRightWithShift: function(e) {\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\n      return this._moveRight(e, 'selectionStart');\n    }\n    else if (this.selectionEnd !== this.text.length) {\n      this._selectionDirection = 'right';\n      return this._moveRight(e, 'selectionEnd');\n    }\n  },\n\n  /**\n   * Moves cursor right without keeping selection\n   * @param {Event} e Event object\n   */\n  moveCursorRightWithoutShift: function(e) {\n    var changed = true;\n    this._selectionDirection = 'right';\n\n    if (this.selectionStart === this.selectionEnd) {\n      changed = this._moveRight(e, 'selectionStart');\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionStart = this.selectionEnd;\n    }\n    return changed;\n  },\n\n  /**\n   * Removes characters selected by selection\n   * @param {Event} e Event object\n   */\n  removeChars: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      this._removeCharsNearCursor(e);\n    }\n    else {\n      this._removeCharsFromTo(this.selectionStart, this.selectionEnd);\n    }\n\n    this.set('dirty', true);\n    this.setSelectionEnd(this.selectionStart);\n\n    this._removeExtraneousStyles();\n\n    this.canvas && this.canvas.renderAll();\n\n    this.setCoords();\n    this.fire('changed');\n    this.canvas && this.canvas.fire('text:changed', { target: this });\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   */\n  _removeCharsNearCursor: function(e) {\n    if (this.selectionStart === 0) {\n      return;\n    }\n    if (e.metaKey) {\n      // remove all till the start of current line\n      var leftLineBoundary = this.findLineBoundaryLeft(this.selectionStart);\n\n      this._removeCharsFromTo(leftLineBoundary, this.selectionStart);\n      this.setSelectionStart(leftLineBoundary);\n    }\n    else if (e.altKey) {\n      // remove all till the start of current word\n      var leftWordBoundary = this.findWordBoundaryLeft(this.selectionStart);\n\n      this._removeCharsFromTo(leftWordBoundary, this.selectionStart);\n      this.setSelectionStart(leftWordBoundary);\n    }\n    else {\n      this._removeSingleCharAndStyle(this.selectionStart);\n      this.setSelectionStart(this.selectionStart - 1);\n    }\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  var toFixed = fabric.util.toFixed,\n      NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * @private\n     */\n    _setSVGTextLineText: function(lineIndex, textSpans, height, textLeftOffset, textTopOffset, textBgRects) {\n      if (!this._getLineStyle(lineIndex)) {\n        fabric.Text.prototype._setSVGTextLineText.call(this,\n          lineIndex, textSpans, height, textLeftOffset, textTopOffset);\n      }\n      else {\n        this._setSVGTextLineChars(\n          lineIndex, textSpans, height, textLeftOffset, textBgRects);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGTextLineChars: function(lineIndex, textSpans, height, textLeftOffset, textBgRects) {\n\n      var chars = this._textLines[lineIndex],\n          charOffset = 0,\n          lineLeftOffset = this._getLineLeftOffset(this._getLineWidth(this.ctx, lineIndex)) - this.width / 2,\n          lineOffset = this._getSVGLineTopOffset(lineIndex),\n          heightOfLine = this._getHeightOfLine(this.ctx, lineIndex);\n\n      for (var i = 0, len = chars.length; i < len; i++) {\n        var styleDecl = this._getStyleDeclaration(lineIndex, i) || { };\n\n        textSpans.push(\n          this._createTextCharSpan(\n            chars[i], styleDecl, lineLeftOffset, lineOffset.lineTop + lineOffset.offset, charOffset));\n\n        var charWidth = this._getWidthOfChar(this.ctx, chars[i], lineIndex, i);\n\n        if (styleDecl.textBackgroundColor) {\n          textBgRects.push(\n            this._createTextCharBg(\n              styleDecl, lineLeftOffset, lineOffset.lineTop, heightOfLine, charWidth, charOffset));\n        }\n\n        charOffset += charWidth;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLineTopOffset: function(lineIndex) {\n      var lineTopOffset = 0, lastHeight = 0;\n      for (var j = 0; j < lineIndex; j++) {\n        lineTopOffset += this._getHeightOfLine(this.ctx, j);\n      }\n      lastHeight = this._getHeightOfLine(this.ctx, j);\n      return {\n        lineTop: lineTopOffset,\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\n      };\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharBg: function(styleDecl, lineLeftOffset, lineTopOffset, heightOfLine, charWidth, charOffset) {\n      return [\n        '\\t\\t<rect fill=\"', styleDecl.textBackgroundColor,\n        '\" x=\"', toFixed(lineLeftOffset + charOffset, NUM_FRACTION_DIGITS),\n        '\" y=\"', toFixed(lineTopOffset - this.height / 2, NUM_FRACTION_DIGITS),\n        '\" width=\"', toFixed(charWidth, NUM_FRACTION_DIGITS),\n        '\" height=\"', toFixed(heightOfLine / this.lineHeight, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n'\n      ].join('');\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharSpan: function(_char, styleDecl, lineLeftOffset, lineTopOffset, charOffset) {\n\n      var fillStyles = this.getSvgStyles.call(fabric.util.object.extend({\n        visible: true,\n        fill: this.fill,\n        stroke: this.stroke,\n        type: 'text',\n        getSvgFilter: fabric.Object.prototype.getSvgFilter\n      }, styleDecl));\n\n      return [\n        '\\t\\t\\t<tspan x=\"', toFixed(lineLeftOffset + charOffset, NUM_FRACTION_DIGITS), '\" y=\"',\n        toFixed(lineTopOffset - this.height / 2, NUM_FRACTION_DIGITS), '\" ',\n          (styleDecl.fontFamily ? 'font-family=\"' + styleDecl.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n          (styleDecl.fontSize ? 'font-size=\"' + styleDecl.fontSize + '\" ' : ''),\n          (styleDecl.fontStyle ? 'font-style=\"' + styleDecl.fontStyle + '\" ' : ''),\n          (styleDecl.fontWeight ? 'font-weight=\"' + styleDecl.fontWeight + '\" ' : ''),\n          (styleDecl.textDecoration ? 'text-decoration=\"' + styleDecl.textDecoration + '\" ' : ''),\n        'style=\"', fillStyles, '\">',\n        fabric.util.string.escapeXml(_char),\n        '</tspan>\\n'\n      ].join('');\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'textbox',\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingY: true,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Constructor. Some scaling related property values are forced. Visibility\n     * of controls is also fixed; only the rotation and width controls are\n     * made available.\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Textbox} thisArg\n     */\n    initialize: function(text, options) {\n\n      this.callSuper('initialize', text, options);\n      this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());\n      this.ctx = this.objectCaching ? this._cacheContext : fabric.util.createCanvasElement().getContext('2d');\n      // add width to this list of props that effect line wrapping.\n      this._dimensionAffectingProps.push('width');\n    },\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @param {CanvasRenderingContext2D} ctx Context to use for measurements\n     * @private\n     * @override\n     */\n    _initDimensions: function(ctx) {\n      if (this.__skipDimension) {\n        return;\n      }\n\n      if (!ctx) {\n        ctx = fabric.util.createCanvasElement().getContext('2d');\n        this._setTextStyles(ctx);\n        this.clearContextTop();\n      }\n\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n\n      // wrap lines\n      this._textLines = this._splitTextIntoLines(ctx);\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set('width', this.dynamicMinWidth);\n      }\n\n      // clear cache and re-calculate height\n      this._clearCache();\n      this.height = this._getTextHeight(ctx);\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function() {\n      var realLineCount     = 0,\n          realLineCharCount = 0,\n          charCount         = 0,\n          map               = {};\n\n      for (var i = 0; i < this._textLines.length; i++) {\n        if (this.text[charCount] === '\\n' && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        }\n        else if (this.text[charCount] === ' ' && i > 0) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += this._textLines[i].length;\n        realLineCharCount += this._textLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Boolean} [returnCloneOrEmpty=false]\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex, returnCloneOrEmpty) {\n      if (this._styleMap) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return returnCloneOrEmpty ? { } : null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex, returnCloneOrEmpty);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return this.styles[map.line];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex, style) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      delete this.styles[map.line];\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {CanvasRenderingContext2D} ctx Context to use for measurements\n     * @param {String} text The string of text that is split into lines\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function(ctx, text) {\n      var lines = text.split(this._reNewline), wrapped = [], i;\n\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(ctx, lines[i], i));\n      }\n\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     *\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureText: function(ctx, text, lineIndex, charOffset) {\n      var width = 0;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = text.length; i < len; i++) {\n        width += this._getWidthOfChar(ctx, text[i], lineIndex, i + charOffset);\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {CanvasRenderingContext2D} ctx Context to use for measurements\n     * @param {String} text The string of text to split into lines\n     * @param {Number} lineIndex\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function(ctx, text, lineIndex) {\n      var lineWidth        = 0,\n          lines            = [],\n          line             = '',\n          words            = text.split(' '),\n          word             = '',\n          offset           = 0,\n          infix            = ' ',\n          wordWidth        = 0,\n          infixWidth       = 0,\n          largestWordWidth = 0,\n          lineJustStarted = true,\n          additionalSpace = this._getWidthOfCharSpacing();\n\n      for (var i = 0; i < words.length; i++) {\n        word = words[i];\n        wordWidth = this._measureText(ctx, word, lineIndex, offset);\n\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n\n        if (lineWidth >= this.width && !lineJustStarted) {\n          lines.push(line);\n          line = '';\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        }\n        else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted) {\n          line += infix;\n        }\n        line += word;\n\n        infixWidth = this._measureText(ctx, infix, lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && lines.push(line);\n\n      if (largestWordWidth > this.dynamicMinWidth) {\n        this.dynamicMinWidth = largestWordWidth - additionalSpace;\n      }\n\n      return lines;\n    },\n    /**\n     * Gets lines of text to render in the Textbox. This function calculates\n     * text wrapping on the fly everytime it is called.\n     * @returns {Array} Array of lines in the Textbox.\n     * @override\n     */\n    _splitTextIntoLines: function(ctx) {\n      ctx = ctx || this.ctx;\n      var originalAlign = this.textAlign;\n      this._styleMap = null;\n      ctx.save();\n      this._setTextStyles(ctx);\n      this.textAlign = 'left';\n      var lines = this._wrapText(ctx, this.text);\n      this.textAlign = originalAlign;\n      ctx.restore();\n      this._textLines = lines;\n      this._styleMap = this._generateStyleMap();\n      return lines;\n    },\n\n    /**\n     * When part of a group, we don't want the Textbox's scale to increase if\n     * the group's increases. That's why we reduce the scale of the Textbox by\n     * the amount that the group's increases. This is to maintain the effective\n     * scale of the Textbox at 1, so that font-size values make sense. Otherwise\n     * the same font-size value would result in different actual size depending\n     * on the value of the scale.\n     * @param {String} key\n     * @param {*} value\n     */\n    setOnGroup: function(key, value) {\n      if (key === 'scaleX') {\n        this.set('scaleX', Math.abs(1 / value));\n        this.set('width', (this.get('width') * value) /\n          (typeof this.__oldScaleX === 'undefined' ? 1 : this.__oldScaleX));\n        this.__oldScaleX = value;\n      }\n    },\n\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start).\n     * Overrides the superclass function to take into account text wrapping.\n     *\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     */\n    get2DCursorLocation: function(selectionStart) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n\n      var numLines = this._textLines.length,\n          removed  = 0;\n\n      for (var i = 0; i < numLines; i++) {\n        var line    = this._textLines[i],\n            lineLen = line.length;\n\n        if (selectionStart <= removed + lineLen) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart - removed\n          };\n        }\n\n        removed += lineLen;\n\n        if (this.text[removed] === '\\n' || this.text[removed] === ' ') {\n          removed++;\n        }\n      }\n\n      return {\n        lineIndex: numLines - 1,\n        charIndex: this._textLines[numLines - 1].length\n      };\n    },\n\n    /**\n     * Overrides superclass function and uses text wrapping data to get cursor\n     * boundary offsets instead of the array of chars.\n     * @param {Array} chars Unused\n     * @param {String} typeOfBoundaries Can be 'cursor' or 'selection'\n     * @returns {Object} Object with 'top', 'left', and 'lineLeft' properties set.\n     */\n    _getCursorBoundariesOffsets: function(chars, typeOfBoundaries) {\n      var topOffset      = 0,\n          leftOffset     = 0,\n          cursorLocation = this.get2DCursorLocation(),\n          lineChars      = this._textLines[cursorLocation.lineIndex].split(''),\n          lineLeftOffset = this._getLineLeftOffset(this._getLineWidth(this.ctx, cursorLocation.lineIndex));\n\n      for (var i = 0; i < cursorLocation.charIndex; i++) {\n        leftOffset += this._getWidthOfChar(this.ctx, lineChars[i], cursorLocation.lineIndex, i);\n      }\n\n      for (i = 0; i < cursorLocation.lineIndex; i++) {\n        topOffset += this._getHeightOfLine(this.ctx, i);\n      }\n\n      if (typeOfBoundaries === 'cursor') {\n        topOffset += (1 - this._fontSizeFraction) * this._getHeightOfLine(this.ctx, cursorLocation.lineIndex)\n          / this.lineHeight - this.getCurrentCharFontSize(cursorLocation.lineIndex, cursorLocation.charIndex)\n          * (1 - this._fontSizeFraction);\n      }\n\n      return {\n        top: topOffset,\n        left: leftOffset,\n        lineLeft: lineLeftOffset\n      };\n    },\n\n    getMinWidth: function() {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['minWidth'].concat(propertiesToInclude));\n    }\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Textbox} instance of fabric.Textbox\n   */\n  fabric.Textbox.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Textbox', object, callback, forceAsync, 'text');\n  };\n\n  /**\n   * Returns the default controls visibility required for Textboxes.\n   * @returns {Object}\n   */\n  fabric.Textbox.getTextboxControlVisibility = function() {\n    return {\n      tl: false,\n      tr: false,\n      br: false,\n      bl: false,\n      ml: true,\n      mt: false,\n      mr: true,\n      mb: false,\n      mtr: true\n    };\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /**\n   * Override _setObjectScale and add Textbox specific resizing behavior. Resizing\n   * a Textbox doesn't scale text, it only changes width and makes text wrap automatically.\n   */\n  var setObjectScaleOverridden = fabric.Canvas.prototype._setObjectScale;\n\n  fabric.Canvas.prototype._setObjectScale = function(localMouse, transform,\n                                                     lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {\n\n    var t = transform.target;\n    if (t instanceof fabric.Textbox) {\n      var w = t.width * ((localMouse.x / transform.scaleX) / (t.width + t.strokeWidth));\n      if (w >= t.getMinWidth()) {\n        t.set('width', w);\n        return true;\n      }\n    }\n    else {\n      return setObjectScaleOverridden.call(fabric.Canvas.prototype, localMouse, transform,\n        lockScalingX, lockScalingY, by, lockScalingFlip, _dim);\n    }\n  };\n\n  /**\n   * Sets controls of this group to the Textbox's special configuration if\n   * one is present in the group. Deletes _controlsVisibility otherwise, so that\n   * it gets initialized to default value at runtime.\n   */\n  fabric.Group.prototype._refreshControlsVisibility = function() {\n    if (typeof fabric.Textbox === 'undefined') {\n      return;\n    }\n    for (var i = this._objects.length; i--;) {\n      if (this._objects[i] instanceof fabric.Textbox) {\n        this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());\n        return;\n      }\n    }\n  };\n\n  fabric.util.object.extend(fabric.Textbox.prototype, /** @lends fabric.IText.prototype */ {\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this._styleMap) {\n        if (!this._textLines[prop]) {\n          delete this.styles[this._styleMap[prop].line];\n        }\n      }\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Object} [style] Style object to insert, if given\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, style) {\n      // adjust lineIndex and charIndex\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      fabric.IText.prototype.insertCharStyleObject.apply(this, [lineIndex, charIndex, style]);\n    },\n\n    /**\n     * Inserts new style object\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Boolean} isEndOfLine True if it's end of line\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, isEndOfLine) {\n      // adjust lineIndex and charIndex\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      fabric.IText.prototype.insertNewlineStyleObject.apply(this, [lineIndex, charIndex, isEndOfLine]);\n    },\n\n    /**\n     * Shifts line styles up or down. This function is slightly different than the one in\n     * itext_behaviour as it takes into account the styleMap.\n     *\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can be -1 or +1\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by 1 upward\n      var map = this._styleMap[lineIndex];\n      // adjust line index\n      lineIndex = map.line;\n      fabric.IText.prototype.shiftLineStyles.call(this, lineIndex, offset);\n    },\n\n    /**\n     * Figure out programatically the text on previous actual line (actual = separated by \\n);\n     *\n     * @param {Number} lIndex\n     * @returns {String}\n     * @private\n     */\n    _getTextOnPreviousLine: function(lIndex) {\n      var textOnPreviousLine = this._textLines[lIndex - 1];\n\n      while (this._styleMap[lIndex - 2] && this._styleMap[lIndex - 2].line === this._styleMap[lIndex - 1].line) {\n        textOnPreviousLine = this._textLines[lIndex - 2] + textOnPreviousLine;\n\n        lIndex--;\n      }\n\n      return textOnPreviousLine;\n    },\n\n    /**\n     * Removes style object\n     * @param {Boolean} isBeginningOfLine True if cursor is at the beginning of line\n     * @param {Number} [index] Optional index. When not given, current selectionStart is used.\n     */\n    removeStyleObject: function(isBeginningOfLine, index) {\n\n      var cursorLocation = this.get2DCursorLocation(index),\n          map            = this._styleMap[cursorLocation.lineIndex],\n          lineIndex      = map.line,\n          charIndex      = map.offset + cursorLocation.charIndex;\n      this._removeStyleObject(isBeginningOfLine, cursorLocation, lineIndex, charIndex);\n    }\n  });\n})();\n\n\n(function() {\n  var override = fabric.IText.prototype._getNewSelectionStartFromOffset;\n  /**\n   * Overrides the IText implementation and adjusts character index as there is not always a linebreak\n   *\n   * @param {Number} mouseOffset\n   * @param {Number} prevWidth\n   * @param {Number} width\n   * @param {Number} index\n   * @param {Number} jlen\n   * @returns {Number}\n   */\n  fabric.IText.prototype._getNewSelectionStartFromOffset = function(mouseOffset, prevWidth, width, index, jlen) {\n    index = override.call(this, mouseOffset, prevWidth, width, index, jlen);\n\n    // the index passed into the function is padded by the amount of lines from _textLines (to account for \\n)\n    // we need to remove this padding, and pad it by actual lines, and / or spaces that are meant to be there\n    var tmp     = 0,\n        removed = 0;\n\n    // account for removed characters\n    for (var i = 0; i < this._textLines.length; i++) {\n      tmp += this._textLines[i].length;\n\n      if (tmp + removed >= index) {\n        break;\n      }\n\n      if (this.text[tmp + removed] === '\\n' || this.text[tmp + removed] === ' ') {\n        removed++;\n      }\n    }\n\n    return index - i + removed;\n  };\n})();\n\n\n(function() {\n\n  if (typeof document !== 'undefined' && typeof window !== 'undefined') {\n    return;\n  }\n\n  var DOMParser = require('xmldom').DOMParser,\n      URL = require('url'),\n      HTTP = require('http'),\n      HTTPS = require('https'),\n\n      Canvas = require('canvas'),\n      Image = require('canvas').Image;\n\n  /** @private */\n  function request(url, encoding, callback) {\n    var oURL = URL.parse(url);\n\n    // detect if http or https is used\n    if ( !oURL.port ) {\n      oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;\n    }\n\n    // assign request handler based on protocol\n    var reqHandler = (oURL.protocol.indexOf('https:') === 0 ) ? HTTPS : HTTP,\n        req = reqHandler.request({\n          hostname: oURL.hostname,\n          port: oURL.port,\n          path: oURL.path,\n          method: 'GET'\n        }, function(response) {\n          var body = '';\n          if (encoding) {\n            response.setEncoding(encoding);\n          }\n          response.on('end', function () {\n            callback(body);\n          });\n          response.on('data', function (chunk) {\n            if (response.statusCode === 200) {\n              body += chunk;\n            }\n          });\n        });\n\n    req.on('error', function(err) {\n      if (err.errno === process.ECONNREFUSED) {\n        fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);\n      }\n      else {\n        fabric.log(err.message);\n      }\n      callback(null);\n    });\n\n    req.end();\n  }\n\n  /** @private */\n  function requestFs(path, callback) {\n    var fs = require('fs');\n    fs.readFile(path, function (err, data) {\n      if (err) {\n        fabric.log(err);\n        throw err;\n      }\n      else {\n        callback(data);\n      }\n    });\n  }\n\n  fabric.util.loadImage = function(url, callback, context) {\n    function createImageAndCallBack(data) {\n      if (data) {\n        img.src = new Buffer(data, 'binary');\n        // preserving original url, which seems to be lost in node-canvas\n        img._src = url;\n        callback && callback.call(context, img);\n      }\n      else {\n        img = null;\n        callback && callback.call(context, null, true);\n      }\n    }\n    var img = new Image();\n    if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {\n      img.src = img._src = url;\n      callback && callback.call(context, img);\n    }\n    else if (url && url.indexOf('http') !== 0) {\n      requestFs(url, createImageAndCallBack);\n    }\n    else if (url) {\n      request(url, 'binary', createImageAndCallBack);\n    }\n    else {\n      callback && callback.call(context, url);\n    }\n  };\n\n  fabric.loadSVGFromURL = function(url, callback, reviver) {\n    url = url.replace(/^\\n\\s*/, '').replace(/\\?.*$/, '').trim();\n    if (url.indexOf('http') !== 0) {\n      requestFs(url, function(body) {\n        fabric.loadSVGFromString(body.toString(), callback, reviver);\n      });\n    }\n    else {\n      request(url, '', function(body) {\n        fabric.loadSVGFromString(body, callback, reviver);\n      });\n    }\n  };\n\n  fabric.loadSVGFromString = function(string, callback, reviver) {\n    var doc = new DOMParser().parseFromString(string);\n    fabric.parseSVGDocument(doc.documentElement, function(results, options) {\n      callback && callback(results, options);\n    }, reviver);\n  };\n\n  fabric.util.getScript = function(url, callback) {\n    request(url, '', function(body) {\n      // eslint-disable-next-line no-eval\n      eval(body);\n      callback && callback();\n    });\n  };\n\n  // fabric.util.createCanvasElement = function(_, width, height) {\n  //   return new Canvas(width, height);\n  // }\n\n  /**\n   * Only available when running fabric on node.js\n   * @param {Number} width Canvas width\n   * @param {Number} height Canvas height\n   * @param {Object} [options] Options to pass to FabricCanvas.\n   * @param {Object} [nodeCanvasOptions] Options to pass to NodeCanvas.\n   * @return {Object} wrapped canvas instance\n   */\n  fabric.createCanvasForNode = function(width, height, options, nodeCanvasOptions) {\n    nodeCanvasOptions = nodeCanvasOptions || options;\n\n    var canvasEl = fabric.document.createElement('canvas'),\n        nodeCanvas = new Canvas(width || 600, height || 600, nodeCanvasOptions),\n        nodeCacheCanvas = new Canvas(width || 600, height || 600, nodeCanvasOptions);\n\n    // jsdom doesn't create style on canvas element, so here be temp. workaround\n    canvasEl.style = { };\n\n    canvasEl.width = nodeCanvas.width;\n    canvasEl.height = nodeCanvas.height;\n    options = options || { };\n    options.nodeCanvas = nodeCanvas;\n    options.nodeCacheCanvas = nodeCacheCanvas;\n    var FabricCanvas = fabric.Canvas || fabric.StaticCanvas,\n        fabricCanvas = new FabricCanvas(canvasEl, options);\n    fabricCanvas.nodeCanvas = nodeCanvas;\n    fabricCanvas.nodeCacheCanvas = nodeCacheCanvas;\n    fabricCanvas.contextContainer = nodeCanvas.getContext('2d');\n    fabricCanvas.contextCache = nodeCacheCanvas.getContext('2d');\n    fabricCanvas.Font = Canvas.Font;\n    return fabricCanvas;\n  };\n\n  var originaInitStatic = fabric.StaticCanvas.prototype._initStatic;\n  fabric.StaticCanvas.prototype._initStatic = function(el, options) {\n    el = el || fabric.document.createElement('canvas');\n    this.nodeCanvas = new Canvas(el.width, el.height);\n    this.nodeCacheCanvas = new Canvas(el.width, el.height);\n    originaInitStatic.call(this, el, options);\n    this.contextContainer = this.nodeCanvas.getContext('2d');\n    this.contextCache = this.nodeCacheCanvas.getContext('2d');\n    this.Font = Canvas.Font;\n  };\n\n  /** @ignore */\n  fabric.StaticCanvas.prototype.createPNGStream = function() {\n    return this.nodeCanvas.createPNGStream();\n  };\n\n  fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\n    return this.nodeCanvas.createJPEGStream(opts);\n  };\n\n  fabric.StaticCanvas.prototype._initRetinaScaling = function() {\n    if (!this._isRetinaScaling()) {\n      return;\n    }\n\n    this.lowerCanvasEl.setAttribute('width', this.width * fabric.devicePixelRatio);\n    this.lowerCanvasEl.setAttribute('height', this.height * fabric.devicePixelRatio);\n    this.nodeCanvas.width = this.width * fabric.devicePixelRatio;\n    this.nodeCanvas.height = this.height * fabric.devicePixelRatio;\n    this.contextContainer.scale(fabric.devicePixelRatio, fabric.devicePixelRatio);\n    return this;\n  };\n  if (fabric.Canvas) {\n    fabric.Canvas.prototype._initRetinaScaling = fabric.StaticCanvas.prototype._initRetinaScaling;\n  }\n\n  var origSetBackstoreDimension = fabric.StaticCanvas.prototype._setBackstoreDimension;\n  fabric.StaticCanvas.prototype._setBackstoreDimension = function(prop, value) {\n    origSetBackstoreDimension.call(this, prop, value);\n    this.nodeCanvas[prop] = value;\n    return this;\n  };\n  if (fabric.Canvas) {\n    fabric.Canvas.prototype._setBackstoreDimension = fabric.StaticCanvas.prototype._setBackstoreDimension;\n  }\n\n})();\n\n"]}