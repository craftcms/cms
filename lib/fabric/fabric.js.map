{"version":3,"sources":["fabric.js"],"names":["fabric","version","exports","document","window","require","jsdom","decodeURIComponent","createWindow","parentWindow","isTouchSupported","isLikelyNode","Buffer","SHARED_ATTRIBUTES","DPI","reNum","fontPaths","iMatrix","canvasModule","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","_removeEventListener","eventName","handler","this","__eventListeners","eventListener","indexOf","util","array","fill","observe","arguments","length","prop","on","push","stopObserving","call","fire","options","listenersForEvent","i","len","filter","value","Observable","off","trigger","Collection","_objects","add","apply","_onObjectAdded","renderOnAddRemove","renderAll","insertAt","object","index","nonSplicing","objects","getObjects","splice","remove","somethingRemoved","_onObjectRemoved","forEachObject","callback","context","type","o","item","isEmpty","size","contains","complexity","reduce","memo","current","CommonMethods","_setOptions","set","_initGradient","filler","property","colorStops","Gradient","_initPattern","source","Pattern","_initClipping","clipTo","functionBody","getFunctionBody","Function","_setObject","obj","_set","key","get","toggle","global","sqrt","Math","atan2","pow","abs","PiBy180","PI","removeFromArray","idx","getRandomInt","min","max","floor","random","degreesToRadians","degrees","radiansToDegrees","radians","rotatePoint","point","origin","subtractEquals","v","rotateVector","Point","x","y","addEquals","vector","sin","cos","transformPoint","p","t","ignoreOffset","makeBoundingBoxFromPoints","points","xPoints","minX","maxX","width","yPoints","minY","maxY","left","top","height","invertTransform","a","r","toFixed","number","fractionDigits","parseFloat","Number","parseUnit","fontSize","unit","exec","Text","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","namespace","string","camelize","charAt","toUpperCase","slice","resolveNamespace","parts","split","loadImage","url","crossOrigin","img","createImage","onload","onerror","log","src","enlivenObjects","reviver","onLoaded","numLoadedObjects","numTotalObjects","enlivenedObjects","forEach","fromObject","error","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","path","PathGroup","sourcePath","populateWithProperties","destination","properties","Object","prototype","toString","drawDashedLine","ctx","x2","y2","da","dx","dy","rot","dc","di","draw","save","translate","moveTo","rotate","restore","createCanvasElement","canvasEl","createElement","getContext","G_vmlCanvasManager","initElement","createAccessors","klass","propName","capitalizedPropName","setterName","getterName","proto","stateProperties","clipContext","receiver","beginPath","clip","multiplyTransformMatrices","b","is2x2","qrDecompose","angle","denom","scaleX","scaleY","skewX","skewY","translateX","translateY","customTransformMatrix","skewMatrixX","tan","scaleMatrix","resetObjectTransform","target","flipX","flipY","setAngle","fn","String","match","isTransparent","tolerance","temp","_isTransparent","imageData","getImageData","l","data","parsePreserveAspectRatioAttribute","attribute","align","meetOrSlice","alignX","alignY","aspectRatioAttrs","pop","clearFabricFontCache","fontFamily","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","arcToSegments","toX","toY","rx","ry","large","sweep","rotateX","argsString","_join","arcToSegmentsCache","th","sinTh","cosTh","fromX","fromY","px","py","rx2","ry2","py2","px2","pl","root","s","cx","cy","cx1","cy1","mTheta","calcVectorAngle","dtheta","segments","ceil","result","mDelta","mT","th3","segmentToBezier","th2","argsString2","segmentToBezierCache","costh2","sinth2","costh3","sinth3","cp1X","cp1Y","cp2X","cp2Y","ux","uy","vx","vy","ta","tb","getBoundsOfCurve","x0","y0","x1","y1","x3","y3","boundsOfCurveCache","c","t1","t2","b2ac","sqrtb2ac","tvalues","bounds","mt","j","jlen","Array","join","drawArc","fx","fy","coords","segs","segsNorm","bezierCurveTo","getBoundsOfArc","tx","ty","bound","find","byProperty","condition","searchElement","TypeError","n","POSITIVE_INFINITY","NEGATIVE_INFINITY","k","map","every","some","val","rv","invoke","method","args","value1","value2","extend","deep","Element","hasOwnProperty","clone","trim","replace","character","capitalize","firstLetterOnly","toLowerCase","escapeXml","Dummy","bind","thisArg","_this","concat","Subclass","callSuper","methodName","parentMethod","constructor","superclass","superClassMethod","console","emptyFunction","IS_DONTENUM_BUGGY","addMethods","parent","returnValue","valueOf","createClass","initialize","shift","subclasses","areHostMethods","methodNames","test","createListener","uid","wrappedHandler","createWrappedHandler","e","getElement","event","createDispatcher","handlers","handlersForEvent","_getPointer","pageProp","clientProp","touchProp","setElement","unknown","getUniqueId","element","__uniqueID","addListener","removeListener","shouldUseAddListenerRemoveListener","documentElement","shouldUseAttachEventDetachEvent","listeners","addEventListener","removeEventListener","listener","attachEvent","detachEvent","existingHandler","pointerX","clientX","pointerY","clientY","getPointer","srcElement","scroll","getScrollLeftTop","parseEl","supportsOpacity","style","opacity","supportsFilters","reOpacity","setOpacity","es","currentStyle","hasLayout","zoom","setStyle","styles","elementStyle","cssText","styleFloat","makeElement","tagName","attributes","el","className","htmlFor","setAttribute","docElement","body","scrollLeft","scrollTop","parentNode","host","nodeType","getElementStyle","sliceCanConvertNodelists","_slice","toArray","arrayLike","childNodes","err","arr","defaultView","getComputedStyle","attr","undefined","selectProp","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","getScript","headEl","getElementsByTagName","scriptEl","loading","onreadystatechange","readyState","appendChild","getById","id","getElementById","addClass","wrapElement","wrapper","replaceChild","getElementOffset","docElem","scrollLeftTop","doc","ownerDocument","box","offset","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","parseInt","getBoundingClientRect","clientLeft","clientTop","addParamToUrl","param","emptyFn","makeXHR","factories","ActiveXObject","XMLHttpRequest","request","onComplete","xhr","parameters","open","setRequestHeader","send","warn","noop","requestAnimFrame","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","animate","timestamp","time","start","Date","duration","finish","onChange","abort","easing","d","startValue","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","valuePerc","calculateColor","begin","end","pos","color","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","colorEasing","normalize","asin","elastic","opts","easeInBounce","easeOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInOutBounce","normalizeAttr","attributesMap","normalizeValue","parentAttributes","parsed","isArray","transformMatrix","parseTransformAttribute","visible","isNaN","_setStrokeFillOpacity","colorAttributes","setAlpha","getAlpha","toRgba","_getMultipleNodes","nodeNames","nodeName","nodeList","nodeArray","parseStyleString","oStyle","chunk","pair","parseStyleObject","getGlobalStylesForElement","svgUid","rule","cssRules","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","doesSomeParentMatch","selector","matcher","classNames","getAttribute","RegExp","elementById","node","nodelist","parseUseDirectives","attrs","xlink","substr","el2","cloneNode","currentTrans","oldLength","applyViewboxTransform","el3","nodeValue","firstChild","removeAttribute","viewBoxWidth","viewBoxHeight","matrix","viewBoxAttr","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","reViewBoxTagNames","reViewBoxAttrValue","missingDimAttr","toBeParsed","parsedDim","translateMatrix","hasAncestorWithNodeName","reAllowedSVGTagNames","reNotAllowedAncestors","reAllowedParents","display","visibility","transform","fill-opacity","fill-rule","font-family","font-size","font-style","font-weight","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-decoration","text-anchor","stroke","gradientDefs","rotateMatrix","multiplierX","multiplierY","skewMatrix","commaWsp","transformList","reTransformList","reTransform","attributeValue","matrices","m","operation","combinedMatrix","parseSVGDocument","parsingOptions","__uid","descendants","selectNodes","getGradientDefs","getCSSRules","parseElements","instances","reFontDeclaration","parseFontDeclaration","fontStyle","fontWeight","lineHeight","elList","idsToXlinkMap","parseAttributes","ownAttributes","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","font","mergedAttrs","ElementsParser","parse","parsePointsAttribute","parsedPoints","allRules","styleContents","textContent","text","ruleObj","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","responseText","async","loadXML","results","_options","loadSVGFromString","DOMParser","parser","parseFromString","numElements","createObjects","_obj","createObject","fromElement","_createObject","checkIfDone","createCallback","resolveGradient","instanceFillValue","gradientId","that","scalarAdd","scalar","scalarAddEquals","subtract","scalarSubtract","scalarSubtractEquals","multiply","multiplyEquals","divide","divideEquals","eq","lt","lte","gt","gte","lerp","distanceFrom","midPointFrom","setXY","setX","setY","setFromPoint","swap","Intersection","status","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","_tryParsingColor","setSource","hue2rgb","q","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","h","round","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","alpha","toGrayscale","average","currentAlpha","toBlackWhite","threshold","overlayWith","otherColor","otherSource","reRGBa","reHSLa","reHex","aqua","black","blue","fuchsia","gray","grey","green","lime","maroon","navy","olive","orange","purple","red","silver","teal","white","yellow","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","substring","oColor","getColorStop","colorAlpha","keyValuePairs","getLinearCoords","getRadialCoords","_convertPercentUnitsToValues","gradientUnits","propValue","addFactor","multFactor","ellipseMatrix","scaleFactor","offsetX","offsetY","gradientTransform","addColorStop","position","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","sort","group","reverse","minRadius","percentageShift","colorStop","toLive","gradient","createLinearGradient","createRadialGradient","instance","colorStopEls","forObject","repeat","setOptions","NUM_FRACTION_DIGITS","toDataURL","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","complete","naturalWidth","naturalHeight","createPattern","Shadow","blur","affectStroke","includeDefaultValues","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","StaticCanvas","CANVAS_INIT_ERROR","Error","_initStatic","backgroundColor","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","imageSmoothingEnabled","viewportTransform","backgroundVpt","overlayVpt","onBeforeScaleRotate","enableRetinaScaling","vptCoords","skipOffscreen","cb","_createLowerCanvas","_initOptions","_setImageSmoothing","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","lowerCanvasEl","contextContainer","scale","_offset","image","__setBgOverlayImage","__setBgOverlayColor","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","Image","_createCanvasElement","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","backstoreOnly","_setCssDimension","upperCanvasEl","cacheCanvasEl","wrapperEl","getZoom","setViewportTransform","vpt","activeGroup","_activeGroup","setCoords","calcViewportBoundaries","zoomToPoint","before","after","setZoom","absolutePan","relativePan","setupState","canvas","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","canvasToDrawOn","renderCanvas","iVpt","tl","br","tr","bl","_renderBackground","_renderObjects","drawControls","_renderOverlay","render","_renderBackgroundOrOverlay","fillStyle","fillRect","getCenter","centerObjectH","_centerObject","getCenterPoint","centerObjectV","centerObject","center","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","setPositionByOrigin","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","__serializeBgOverlay","excludeFromExport","_toObject","originalValue","bgImage","overlay","background","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","encoding","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","row","rowIndex","charIndex","fontList","_setSVGObject","sendToBack","objs","unshift","bringToFront","sendBackwards","intersecting","newIdx","objsMoved","_findNewLowerIndex","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","DataURLExporter","EMPTY_JSON","supports","setLineDash","toJSON","BaseBrush","strokeLineCap","strokeLineJoin","strokeDashArray","setShadow","_setBrushStyles","contextTop","strokeStyle","lineWidth","lineCap","lineJoin","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","_resetShadow","PencilBrush","_points","onMouseDown","pointer","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","p1","p2","midPoint","quadraticCurveTo","lineTo","convertPointsToSVGPath","createPath","pathData","Path","strokeWidth","translateToGivenOrigin","originX","originY","closePath","CircleBrush","drawDot","addPoint","arc","radius","originalRenderOnAddRemove","circles","circle","Circle","Group","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","sprayChunkPoints","globalAlpha","PatternBrush","getPatternSrc","patternCanvas","patternCtx","getPatternSrcFunction","getPattern","topLeft","_getLeftTopCoords","supportLineDash","Canvas","_initInteractive","_createCacheCanvas","uniScaleTransform","uniScaleKey","centeredScaling","centeredRotation","centeredKey","altActionKey","selection","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","rotationCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","snapAngle","snapThreshold","stopContextMenu","fireRightClick","fireMiddleClick","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","freeDrawingBrush","_chooseObjectsToRender","getActiveGroup","activeObject","getActiveObject","objsToRender","activeGroupObjects","contextTopDirty","renderTop","_drawSelection","_resetCurrentTransform","original","_shouldCenterTransform","action","_setOriginToCenter","mouseXSign","mouseYSign","containsPoint","xy","_normalizePointer","_findTargetCorner","calcTransformMatrix","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","hasBorders","transparentCorners","contextCache","originalColor","selectionBackgroundColor","active","_renderControls","_shouldClearSelection","evented","selectable","centerTransform","altKey","_getOriginFromCorner","corner","_getActionFromCorner","_setupCurrentTransform","ex","ey","lastX","lastY","theta","shiftKey","_translateObject","newLeft","newTop","moveX","moveY","_changeSkewTransformOrigin","mouseMove","by","origins","0","skew","originA","originB","flipSign","skewSign","_skewObject","skewed","lockSkewingX","lockSkewingY","actualMouseByOrigin","constraintPosition","actualMouseByCenter","toLocalPoint","lastMouseByCenter","dim","_getTransformedDimensions","translateToOriginPoint","_setObjectSkew","localMouse","_dim","newValue","newDim","dimNoSkew","otherBy","_otherBy","_by","newDimMouse","atan","_scaleObject","lockScalingX","lockScalingY","lockScalingFlip","scaled","_setLocalMouse","_setObjectScale","changeX","changeY","forbidScalingX","forbidScalingY","_scaleObjectEqually","newScaleX","newScaleY","_flipObject","dist","lastDist","signX","signY","padding","_rotateObject","lastAngle","curAngle","hasRoated","rightAngleLocked","leftAngleLocked","setCursor","cursor","_resetObjectTransform","groupSelector","aleft","atop","_setLineDash","strokeRect","findTarget","skipGroup","activeTarget","activeTargetSubs","targets","_searchPossibleTargets","_fireOverOutEvents","overOpt","outOpt","hoveredTarget","_hoveredTarget","previousTarget","nextTarget","_checkTarget","isEditing","normalizedPointer","subTarget","subTargetCheck","ignoreZoom","cssScale","boundsWidth","boundsHeight","bottom","right","lowerCanvasClass","_copyCanvasStyle","class","touch-action","fromEl","toEl","getSelectionContext","getSelectionElement","_setActiveObject","_activeObject","onDeselect","setActiveObject","currentActiveObject","_discardActiveObject","discardActiveObject","_setActiveGroup","setActiveGroup","_discardActiveGroup","destroy","discardActiveGroup","deactivateAll","allObjects","deactivateAllWithDispatch","removeListeners","removeChild","_drawObjectsControls","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","originalValues","realizeTransform","_setCursorFromEvent","checkClick","which","button","cursorOffset","mr","mb","ml","cursorMap","_bindEvents","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","passive","eventjs","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","eventsBinded","_onMouseUp","self","__onTransformGesture","__onDrag","__onMouseWheel","hiddenTextarea","focus","__onOrientationChange","__onShake","__onLongPress","stopPropagation","preventDefault","__onMouseDown","__onMouseUp","__onMouseMove","_shouldRender","isMoving","_previousPointer","_handleEvent","_isCurrentlyDrawing","_onMouseUpInDrawingMode","searchTarget","isClick","_finalizeCurrentTransform","actionPerformed","shouldRender","_maybeGroupObjects","__corner","eventType","targetObj","subTargets","_scaling","_restoreOriginXY","hasStateChanged","_previousOriginX","_previousOriginY","originPoint","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","shouldGroup","_shouldGroup","_handleGrouping","_beforeTransform","saveState","_setCenterToOrigin","touches","_transformObject","reset","_beforeScaleTransform","_performTransformAction","_fire","_onScale","currentAction","_setCornerCursor","_getRotatedCornerCursor","hasRotatingPoint","getAngle","_updateActiveGroup","_createActiveGroup","saveCoords","removeWithUpdate","addWithUpdate","_createGroup","groupObjects","exitEditing","_groupSelectedObjects","_collectObjects","currentObject","selectionX1Y1","selectionX2Y2","intersectsWithRect","isContainedWithinRect","setObjectsCoords","supportQuality","format","quality","multiplier","cropping","__toDataURLWithMultiplier","origWidth","origHeight","scaledWidth","scaledHeight","newZoom","vp","newVp","originalInteractive","__toDataURL","toDataURLWithMultiplier","loadFromDatalessJSON","json","loadFromJSON","serialized","JSON","_enlivenObjects","_setBgOverlay","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","stringify","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","supportsLineDash","objectCaching","cornerSize","borderColor","borderDashArray","cornerColor","cornerStrokeColor","cornerStyle","cornerDashArray","fillRule","globalCompositeOperation","strokeMiterLimit","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","rotatingPointOffset","lockMovementX","lockMovementY","lockRotation","lockUniScaling","statefullCache","noScaleCache","dirty","cacheProperties","_cacheProperties","_cacheCanvas","_cacheContext","_updateCacheCanvas","_limitCacheSize","dims","maximumSide","cacheSideLimit","limitedDims","zoomX","zoomY","_getCacheCanvasDimensions","objectScale","getObjectScaling","_getNonTransformedDimensions","retina","minCacheSize","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","sizeShrinking","cacheTranslationX","cacheTranslationY","setTransform","fromLeft","_transformDone","_removeDefaultValues","scaling","_constrainScale","setOnGroup","setSourcePath","getViewportTransform","isNotVisible","noTransform","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","shouldCache","isCacheDirty","propertySet","drawObject","drawCacheOnCanvas","needsItsOwnCache","isCaching","willDrawShadow","_setStrokeStyles","_setFillStyles","drawImage","skipCanvas","_removeShadow","miterLimit","dashArray","alternative","drawBordersInGroup","drawBorders","multX","multY","_applyPatternGradientTransform","patternTransform","_renderFill","_renderStroke","_renderDashedStroke","cloneAsImage","dataUrl","boundingRect","getBoundingRect","origParams","getLeft","getTop","originalCanvas","isType","setGradient","setPatternFill","setColor","shouldCenterOrigin","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","_fromObject","forceAsync","extraParam","originXOffset","originYOffset","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","to","offsetFrom","offsetTo","hypotFull","xFull","yFull","_originalOriginX","_originalOriginY","getCoords","multiplyMatrices","oCoords","aCoords","absolute","calculate","calcCoords","pointTL","pointBR","other","lines","_getImageLines","_findCrossPoints","centerPoint","topline","rightline","bottomline","leftline","xi","iLine","xcount","lineKey","getBoundingRectWidth","getBoundingRectHeight","scaleToWidth","boundingRectFactor","scaleToHeight","_calculateCurrentDimensions","currentWidth","currentHeight","_angle","_hypotenuse","mtr","skipAbsolute","_setCornerCoords","_calcRotateMatrix","dimensionMatrix","_calcDimensionsTransformMatrix","flipping","bbox","dimX","dimY","getSvgColorString","str","getSvgStyles","skipShadow","getSvgFilter","getSvgId","getSvgTransform","getSkewX","getSkewY","translatePart","anglePart","scalePart","skewXPart","skewYPart","addTranslateX","flipXPart","addTranslateY","getSvgTransformMatrix","_createBaseSVGMarkup","saveProps","props","tmpObj","_isEqual","origValue","currentValue","firstPass","keys","dashedPropertySet","isVML","_controlsVisibility","isControlVisible","newTheta","cornerHypotenuse","cosHalfOffset","sinHalfOffset","wh","rotateHeight","scaleOffset","_drawControl","control","controlName","_getControlsVisibility","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","skipCallbacks","propsToAnimate","_animate","propPair","from","valueProgress","timeProgress","makeEdgeToOriginGetter","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","coordProps","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","cp","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","line","isValidRadius","pi","startAngle","endAngle","setRadius","startX","startY","endX","endY","largeFlag","getRadiusX","getRadiusY","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","ellipse","_initRxRy","w","isRounded","Polyline","_calcDimensions","pathOffset","diffX","diffY","commonRender","Polygon","_toString","commandLengths","repeatedCommands","M","fromArray","_parsePath","_setPositionDimensions","calcDim","_parseDimensions","_renderPathCommands","tempX","tempY","previous","subpathStartX","subpathStartY","controlX","controlY","chunks","addTransform","currentPath","coordsStr","coordsParsed","re","command","commandLength","repeatedCommand","klen","aX","aY","pathUrl","paths","parseDimensionsFromPaths","xC","yC","parentCache","caching","isSameColor","pathsToObject","originalDefaults","firstPathFill","pathFill","total","originalPaths","pathGroup","_lockProperties","isAlreadyGrouped","_updateObjectsCoords","_calcBounds","skipCoordsChange","_updateObjectCoords","__origHasControls","objectLeft","objectTop","_restoreObjectsState","_setObjectActive","delegatedProperties","textDecoration","textAlign","objsToObject","_renderObject","originalHasRotatingPoint","_restoreObjectState","_originalLeft","_originalTop","hasMoved","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","_lastScaleX","_lastScaleY","minimumScaleTrigger","filters","resizeFilters","_initElement","_element","_callback","_originalElement","_initConfig","applyFilters","_filteredEl","setCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","getSvgSrc","origFill","filtered","_src","setSrc","imgElement","forResizing","replacement","retinaScaling","minimumScale","applyTo","toBuffer","pngCompression","elementToDraw","imageMargins","_findMargins","_needsResize","marginX","marginY","scales","_resetWidthHeight","CSS_CANVAS","_initFilters","fromURL","imgOptions","preserveAR","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","BaseFilter","Brightness","brightness","putImageData","Convolute","opaque","dstOff","scx","scy","srcOff","wt","weights","pixels","side","halfSide","sw","sh","output","createImageData","dst","alphaFac","GradientTransparency","Grayscale","Invert","Mask","mask","channel","maskEl","maskCanvasEl","maskData","Noise","noise","rand","Pixelate","blocksize","_i","_ilen","_j","_jlen","RemoveWhite","distance","limit","Sepia","avg","Sepia2","Tint","tintR","tintG","tintB","alpha1","Multiply","Blend","mode","tg","_r","_g","_b","isImage","_el","tmpCanvas","Resize","resizeType","lanczosLobes","rcpScaleX","rcpScaleY","oW","oH","dW","dH","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","multW","multH","signW","signH","doneW","doneH","stepW","stepH","tmpCtx","process","u","weight","fX","fY","ratioX","icenter","ratioY","range2X","cacheLanc","range2Y","lanczos","rcpRatioX","rcpRatioY","srcData","destData","destImg","srcImg","lobes","xx","lanczosCreate","xDiff","yDiff","chnl","origPix","w4","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","centerY","yy","centerX","w0","ColorMatrix","Contrast","contrast","contrastF","Saturate","saturate","adjust","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","textBackgroundColor","_fontSizeFraction","_fontSizeMult","charSpacing","__skipDimension","_initDimensions","_setTextStyles","_textLines","_splitTextIntoLines","_clearCache","_getTextWidth","cursorWidth","_getTextHeight","_renderTextLinesBackground","_renderText","_renderTextDecoration","_renderTextFill","_renderTextStroke","textBaseline","_getFontDeclaration","_getHeightOfSingleLine","_getHeightOfLine","maxWidth","_getLineWidth","currentLineWidth","_renderChars","chars","_char","shortM","additionalSpace","_getWidthOfCharSpacing","measureText","_renderTextLine","lineIndex","word","words","charOffset","wordsWidth","_getWidthOfWords","widthDiff","numSpaces","spaceWidth","leftOffset","_getLeftOffset","_getTopOffset","isEmptyStyles","_renderTextCommon","lineHeights","heightOfLine","maxHeight","_getLineLeftOffset","lineLeftOffset","lineTopOffset","originalFill","__lineWidths","__lineHeights","_shouldClearDimensionCache","shouldClear","_forceClearCache","_measureLine","finalWidth","halfOfVerticalBox","offsets","oLen","renderLinesAtOffset","additionalProperties","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","_wrapSVGTextAndBg","lineTop","textBgRects","textSpans","textTopOffset","textLeftOffset","_setSVGBg","_setSVGTextLineBg","_setSVGTextLineText","yPos","_getFillAttributes","_setSVGTextLineJustifed","fillColor","textHeightScaleFactor","scaledDiff","textHeight","offX","IText","selectionStart","selectionEnd","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","initBehavior","p3","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","getSelectionStyles","startIndex","endIndex","loc","get2DCursorLocation","_getStyleDeclaration","setSelectionStyles","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","clearContextTop","cursorOffsetCache","renderCursorOrSelection","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","getCurrentCharStyle","getCurrentCharFontSize","getCurrentCharColor","typeOfBoundaries","_getCursorBoundariesOffsets","lineLeft","topOffset","_getWidthOfChar","cursorLocation","charHeight","__isMousedown","startLine","endLine","lineOffset","realLineHeight","boxWidth","j2","j2len","_renderCharsFast","prevStyle","thisStyle","charsToRender","_hasStyleChanged","_renderChar","skipFillStrokeCheck","charWidth","shouldFill","shouldStroke","_charWidth","decl","_getHeightOfChar","_applyCharStylesGetWidth","jChar","fillText","strokeText","_renderCharDecoration","decoration","decorationWeight","positions","underline","line-through","overline","decorations","leftCache","topCache","widthCache","heightCache","colorCache","_getWidthOfCharsAt","_getCacheProp","styleDeclaration","_getFontCache","cacheProp","charDecl","_applyFontStyles","returnCloneOrEmpty","_deleteStyleDeclaration","_deleteLineStyle","_isMeasuring","_getWidthOfSpace","currentCharHeight","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","selected","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","clearTimeout","_currentTickCompleteState","initDelayedCursor","restart","delay","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","getNumNewLinesInSelectedText","selectedText","numNewLines","searchWordBoundary","direction","reNonWord","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","inCompositionMode","_calcTextareaPosition","upperCanvas","_savedProps","_restoreEditingProps","overCursor","isTextChanged","_removeExtraneousStyles","_removeCharsFromTo","_removeSingleCharAndStyle","isBeginningOfLine","indexStyle","removeStyleObject","insertChars","_chars","useCopiedStyle","copiedTextStyle","insertChar","skipUpdate","styleObject","isEndOfLine","insertStyleObjects","insertNewlineStyleObject","shiftLineStyles","currentCharStyle","newLineStyles","somethingAdded","numIndex","insertCharStyleObject","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","clonedStyles","numericLine","_removeStyleObject","_getTextOnPreviousLine","lIndex","textOnPreviousLine","newCharIndexOnPrevLine","insertNewline","setSelectionStartEndWithShift","newSelection","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","isDoubleClick","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","__mousedownX","__mousedownY","setCursorByClick","_isObjectMoved","mouseOffset","prevWidth","widthOfLine","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","onKeyDown","onKeyUp","onInput","copy","cut","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","onClick","keysMap","8","9","27","13","33","34","35","36","37","38","39","40","46","ctrlKeysMapUp","67","88","ctrlKeysMapDown","65","keyCode","ctrlKey","metaKey","stopImmediatePropagation","_copyDone","diff","charsToInsert","offsetEnd","textLength","newTextLength","prevCompositionLength","compositionStart","forwardDelete","moveCursorRight","removeChars","clipboardData","_getClipboardData","setData","copiedText","getData","_getWidthBeforeCursor","textBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","getUpCursorOffset","foundMatch","textOnLine","widthOfCharsOnLine","indexOnLine","widthOfChar","leftEdge","rightEdge","offsetFromLeftEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","actionName","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","_removeCharsNearCursor","leftLineBoundary","leftWordBoundary","_setSVGTextLineChars","_getSVGLineTopOffset","styleDecl","_createTextCharSpan","_createTextCharBg","lastHeight","fillStyles","Textbox","minWidth","dynamicMinWidth","__cachedLines","getTextboxControlVisibility","_generateStyleMap","realLineCount","realLineCharCount","charCount","_styleMap","_wrapText","wrapped","_wrapLine","_measureText","wordWidth","infixWidth","largestWordWidth","lineJustStarted","originalAlign","__oldScaleX","numLines","removed","lineLen","lineChars","getMinWidth","setObjectScaleOverridden","_refreshControlsVisibility","override","tmp","oURL","URL","port","protocol","req","HTTPS","HTTP","hostname","response","setEncoding","statusCode","errno","ECONNREFUSED","message","requestFs","readFile","createImageAndCallBack","eval","createCanvasForNode","nodeCanvasOptions","nodeCanvas","nodeCacheCanvas","fabricCanvas","Font","originaInitStatic","createPNGStream","createJPEGStream","origSetBackstoreDimension"],"mappings":"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","file":"fabric.js","sourcesContent":["/* build: `node build.js modules=ALL exclude=json,gestures minifier=uglifyjs` */\n /*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: \"1.7.19\" };\nif (typeof exports !== 'undefined') {\n  exports.fabric = fabric;\n}\n\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  fabric.document = document;\n  fabric.window = window;\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  fabric.document = require(\"jsdom\")\n    .jsdom(\n      decodeURIComponent(\"%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E\")\n    );\n\n  if (fabric.document.createWindow) {\n    fabric.window = fabric.document.createWindow();\n  } else {\n    fabric.window = fabric.document.parentWindow;\n  }\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\n\nfabric.isTouchSupported = 'ontouchstart' in fabric.window;\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\n                      typeof window === 'undefined';\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  \"display\",\n  \"transform\",\n  \"fill\", \"fill-opacity\", \"fill-rule\",\n  \"opacity\",\n  \"stroke\", \"stroke-dasharray\", \"stroke-linecap\",\n  \"stroke-linejoin\", \"stroke-miterlimit\",\n  \"stroke-opacity\", \"stroke-width\",\n  \"id\"\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:e[-+]?\\\\d+)?)';\nfabric.fontPaths = { };\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.canvasModule = 'canvas';\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = { };\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\n                          fabric.window.webkitDevicePixelRatio ||\n                          fabric.window.mozDevicePixelRatio ||\n                          1;\n\n\n(function() {\n\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    }\n    else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @deprecated `observe` deprecated since 0.8.34 (use `on` instead)\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function observe(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @deprecated `stopObserving` deprecated since 0.8.34 (use `off` instead)\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function stopObserving(eventName, handler) {\n    if (!this.__eventListeners) {\n      return;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @deprecated `fire` deprecated since 1.0.7 (use `trigger` instead)\n   * @memberOf fabric.Observable\n   * @alias trigger\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    observe: observe,\n    stopObserving: stopObserving,\n    fire: fire,\n\n    on: observe,\n    off: stopObserving,\n    trigger: fire\n  };\n})();\n\n\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.renderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this.getObjects();\n    if (nonSplicing) {\n      objects[index] = object;\n    }\n    else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.renderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function() {\n    var objects = this.getObjects(),\n        index, somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.renderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function(callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function(type) {\n    if (typeof type === 'undefined') {\n      return this._objects;\n    }\n    return this._objects.filter(function(o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this.getObjects()[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this.getObjects().length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function() {\n    return this.getObjects().length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function(object) {\n    return this.getObjects().indexOf(object) > -1;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this.getObjects().reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  }\n};\n\n\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function(options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function(filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function(filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    }\n    else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [options] Options object\n   */\n  _initClipping: function(options) {\n    if (!options.clipTo || typeof options.clipTo !== 'string') {\n      return;\n    }\n\n    var functionBody = fabric.util.getFunctionBody(options.clipTo);\n    if (typeof functionBody !== 'undefined') {\n      this.clipTo = new Function('ctx', functionBody);\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function(obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function(key, value) {\n    if (typeof key === 'object') {\n      this._setObject(key);\n    }\n    else {\n      if (typeof value === 'function' && key !== 'clipTo') {\n        this._set(key, value(this.get(key)));\n      }\n      else {\n        this._set(key, value);\n      }\n    }\n    return this;\n  },\n\n  _set: function(key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function(property) {\n    var value = this.get(property);\n    if (typeof value === 'boolean') {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function(property) {\n    return this[property];\n  }\n};\n\n\n(function(global) {\n\n  var sqrt = Math.sqrt,\n      atan2 = Math.atan2,\n      pow = Math.pow,\n      abs = Math.abs,\n      PiBy180 = Math.PI / 180;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function(array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function(min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function(degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function(radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function(point, origin, radians) {\n      point.subtractEquals(origin);\n      var v = fabric.util.rotateVector(point, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function(vector, radians) {\n      var sin = Math.sin(radians),\n          cos = Math.cos(radians),\n          rx = vector.x * cos - vector.y * sin,\n          ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry\n      };\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function(p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function(points) {\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n          minX = fabric.util.array.min(xPoints),\n          maxX = fabric.util.array.max(xPoints),\n          width = Math.abs(minX - maxX),\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n          minY = fabric.util.array.min(yPoints),\n          maxY = fabric.util.array.max(yPoints),\n          height = Math.abs(minY - maxY);\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function(t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function(number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function(value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n          number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case 'mm':\n          return number * fabric.DPI / 25.4;\n\n        case 'cm':\n          return number * fabric.DPI / 2.54;\n\n        case 'in':\n          return number * fabric.DPI;\n\n        case 'pt':\n          return number * fabric.DPI / 72; // or * 4 / 3\n\n        case 'pc':\n          return number * fabric.DPI / 72 * 12; // or * 16\n\n        case 'em':\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function() {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function(type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function(namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split('.'),\n          len = parts.length, i,\n          obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function(url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      img.onload = function () {\n        callback && callback.call(context, img);\n        img = img.onload = img.onerror = null;\n      };\n\n      /** @ignore */\n      img.onerror = function() {\n        fabric.log('Error loading ' + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      if (url.indexOf('data') !== 0 && crossOrigin) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function(objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback && callback(enlivenedObjects);\n        }\n      }\n\n      var enlivenedObjects = [],\n          numLoadedObjects = 0,\n          numTotalObjects = objects.length,\n          forceAsync = true;\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        }, forceAsync);\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function(patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n          numLoadedPatterns = 0,\n          numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function(pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        }\n        else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.PathGroup}\n     */\n    groupSVGElements: function(elements, options, path) {\n      var object;\n\n      object = new fabric.PathGroup(elements, options);\n\n      if (typeof path !== 'undefined') {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Propertie names to include\n     */\n    populateWithProperties: function(source, destination, properties) {\n      if (properties && Object.prototype.toString.call(properties) === '[object Array]') {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Draws a dashed line between two points\n     *\n     * This method is used to draw dashed line around selection area.\n     * See <a href=\"http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas\">dotted stroke in canvas</a>\n     *\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x  start x coordinate\n     * @param {Number} y start y coordinate\n     * @param {Number} x2 end x coordinate\n     * @param {Number} y2 end y coordinate\n     * @param {Array} da dash array pattern\n     */\n    drawDashedLine: function(ctx, x, y, x2, y2, da) {\n      var dx = x2 - x,\n          dy = y2 - y,\n          len = sqrt(dx * dx + dy * dy),\n          rot = atan2(dy, dx),\n          dc = da.length,\n          di = 0,\n          draw = true;\n\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.moveTo(0, 0);\n      ctx.rotate(rot);\n\n      x = 0;\n      while (len > x) {\n        x += da[di++ % dc];\n        if (x > len) {\n          x = len;\n        }\n        ctx[draw ? 'lineTo' : 'moveTo'](x, 0);\n        draw = !draw;\n      }\n\n      ctx.restore();\n    },\n\n    /**\n     * Creates canvas element and initializes it via excanvas if necessary\n     * @static\n     * @memberOf fabric.util\n     * @param {CanvasElement} [canvasEl] optional canvas element to initialize;\n     * when not given, element is created implicitly\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function(canvasEl) {\n      canvasEl || (canvasEl = fabric.document.createElement('canvas'));\n      /* eslint-disable camelcase */\n      if (!canvasEl.getContext && typeof G_vmlCanvasManager !== 'undefined') {\n        G_vmlCanvasManager.initElement(canvasEl);\n      }\n      /* eslint-enable camelcase */\n      return canvasEl;\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function() {\n      return fabric.isLikelyNode\n        ? new (require('canvas').Image)()\n        : fabric.document.createElement('img');\n    },\n\n    /**\n     * Creates accessors (getXXX, setXXX) for a \"class\", based on \"stateProperties\" array\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} klass \"Class\" to create accessors for\n     */\n    createAccessors: function(klass) {\n      var proto = klass.prototype, i, propName,\n          capitalizedPropName, setterName, getterName;\n\n      for (i = proto.stateProperties.length; i--; ) {\n\n        propName = proto.stateProperties[i];\n        capitalizedPropName = propName.charAt(0).toUpperCase() + propName.slice(1);\n        setterName = 'set' + capitalizedPropName;\n        getterName = 'get' + capitalizedPropName;\n\n        // using `new Function` for better introspection\n        if (!proto[getterName]) {\n          proto[getterName] = (function(property) {\n            return new Function('return this.get(\"' + property + '\")');\n          })(propName);\n        }\n        if (!proto[setterName]) {\n          proto[setterName] = (function(property) {\n            return new Function('value', 'return this.set(\"' + property + '\", value)');\n          })(propName);\n        }\n      }\n    },\n\n    /**\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Object} receiver Object implementing `clipTo` method\n     * @param {CanvasRenderingContext2D} ctx Context to clip\n     */\n    clipContext: function(receiver, ctx) {\n      ctx.save();\n      ctx.beginPath();\n      receiver.clipTo(ctx);\n      ctx.clip();\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function(a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x2 matrix into transform componentes\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function(a) {\n      var angle = atan2(a[1], a[0]),\n          denom = pow(a[0], 2) + pow(a[1], 2),\n          scaleX = sqrt(denom),\n          scaleY = (a[0] * a[3] - a[2] * a [1]) / scaleX,\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\n      return {\n        angle: angle  / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5]\n      };\n    },\n\n    customTransformMatrix: function(scaleX, scaleY, skewX) {\n      var skewMatrixX = [1, 0, abs(Math.tan(skewX * PiBy180)), 1],\n          scaleMatrix = [abs(scaleX), 0, 0, abs(scaleY)];\n      return fabric.util.multiplyTransformMatrices(scaleMatrix, skewMatrixX, true);\n    },\n\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.setAngle(0);\n    },\n\n    /**\n     * Returns string representation of function body\n     * @param {Function} fn Function to get body of\n     * @return {String} Function body\n     */\n    getFunctionBody: function(fn) {\n      return (String(fn).match(/function[^{]*\\{([\\s\\S]*)\\}/) || {})[1];\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function(ctx, x, y, tolerance) {\n\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        }\n        else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        }\n        else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true, i, temp,\n          imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1),\n          l = imageData.data.length;\n\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if colour found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function(attribute) {\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\n          aspectRatioAttrs = attribute.split(' '), align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\n          align = meetOrSlice;\n          meetOrSlice = 'meet';\n        }\n        else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY\n      };\n    },\n\n    /**\n     * Clear char widths cache for a font family.\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function(fontFamily) {\n      if (!fontFamily) {\n        fabric.charWidthsCache = { };\n      }\n      else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Clear char widths cache for a font family.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @param {Number} maximumSide biggest side allowed\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function(ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function(min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var arcToSegmentsCache = { },\n      segmentToBezierCache = { },\n      boundsOfCurveCache = { },\n      _join = Array.prototype.join;\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var argsString = _join.call(arguments);\n    if (arcToSegmentsCache[argsString]) {\n      return arcToSegmentsCache[argsString];\n    }\n\n    var PI = Math.PI, th = rotateX * PI / 180,\n        sinTh = Math.sin(th),\n        cosTh = Math.cos(th),\n        fromX = 0, fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n        root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    }\n    else {\n      root = (large === sweep ? -1.0 : 1.0) *\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = root * rx * py / ry,\n        cy = -root * ry * px / rx,\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    }\n    else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\n        result = [], mDelta = dtheta / segments,\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\n        th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\n      fromX = result[i][4];\n      fromY = result[i][5];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    arcToSegmentsCache[argsString] = result;\n    return result;\n  }\n\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\n    var argsString2 = _join.call(arguments);\n    if (segmentToBezierCache[argsString2]) {\n      return segmentToBezierCache[argsString2];\n    }\n\n    var costh2 = Math.cos(th2),\n        sinth2 = Math.sin(th2),\n        costh3 = Math.cos(th3),\n        sinth3 = Math.sin(th3),\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    segmentToBezierCache[argsString2] = [\n      cp1X, cp1Y,\n      cp2X, cp2Y,\n      toX, toY\n    ];\n    return segmentToBezierCache[argsString2];\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n        tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    }\n    else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Draws arc\n   * @param {CanvasRenderingContext2D} ctx\n   * @param {Number} fx\n   * @param {Number} fy\n   * @param {Array} coords\n   */\n  fabric.util.drawArc = function(ctx, fx, fy, coords) {\n    var rx = coords[0],\n        ry = coords[1],\n        rot = coords[2],\n        large = coords[3],\n        sweep = coords[4],\n        tx = coords[5],\n        ty = coords[6],\n        segs = [[], [], [], []],\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segs[i][0] = segsNorm[i][0] + fx;\n      segs[i][1] = segsNorm[i][1] + fy;\n      segs[i][2] = segsNorm[i][2] + fx;\n      segs[i][3] = segsNorm[i][3] + fy;\n      segs[i][4] = segsNorm[i][4] + fx;\n      segs[i][5] = segsNorm[i][5] + fy;\n      ctx.bezierCurveTo.apply(ctx, segs[i]);\n    }\n  };\n\n  /**\n   * Calculate bounding box of a elliptic-arc\n   * @param {Number} fx start point of arc\n   * @param {Number} fy\n   * @param {Number} rx horizontal radius\n   * @param {Number} ry vertical radius\n   * @param {Number} rot angle of horizontal axe\n   * @param {Number} large 1 or 0, whatever the arc is the big or the small on the 2 points\n   * @param {Number} sweep 1 or 0, 1 clockwise or counterclockwise direction\n   * @param {Number} tx end point of arc\n   * @param {Number} ty\n   */\n  fabric.util.getBoundsOfArc = function(fx, fy, rx, ry, rot, large, sweep, tx, ty) {\n\n    var fromX = 0, fromY = 0, bound, bounds = [],\n        segs = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segs.length; i < len; i++) {\n      bound = getBoundsOfCurve(fromX, fromY, segs[i][0], segs[i][1], segs[i][2], segs[i][3], segs[i][4], segs[i][5]);\n      bounds.push({ x: bound[0].x + fx, y: bound[0].y + fy });\n      bounds.push({ x: bound[1].x + fx, y: bound[1].y + fy });\n      fromX = segs[i][4];\n      fromY = segs[i][5];\n    }\n    return bounds;\n  };\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of beizer\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString = _join.call(arguments);\n    if (boundsOfCurveCache[argsString]) {\n      return boundsOfCurveCache[argsString];\n    }\n\n    var sqrt = Math.sqrt,\n        min = Math.min, max = Math.max,\n        abs = Math.abs, tvalues = [],\n        bounds = [[], []],\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x, y, j = tvalues.length, jlen = j, mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n      bounds[0][j] = x;\n\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1])\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1])\n      }\n    ];\n    boundsOfCurveCache[argsString] = result;\n    return result;\n  }\n\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice;\n\n  /* _ES5_COMPAT_START_ */\n\n  if (!Array.prototype.indexOf) {\n    /**\n     * Finds index of an element in an array\n     * @param {*} searchElement\n     * @return {Number}\n     */\n    Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {\n      if (this === void 0 || this === null) {\n        throw new TypeError();\n      }\n      var t = Object(this), len = t.length >>> 0;\n      if (len === 0) {\n        return -1;\n      }\n      var n = 0;\n      if (arguments.length > 0) {\n        n = Number(arguments[1]);\n        if (n !== n) { // shortcut for verifying if it's NaN\n          n = 0;\n        }\n        else if (n !== 0 && n !== Number.POSITIVE_INFINITY && n !== Number.NEGATIVE_INFINITY) {\n          n = (n > 0 || -1) * Math.floor(Math.abs(n));\n        }\n      }\n      if (n >= len) {\n        return -1;\n      }\n      var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\n      for (; k < len; k++) {\n        if (k in t && t[k] === searchElement) {\n          return k;\n        }\n      }\n      return -1;\n    };\n  }\n\n  if (!Array.prototype.forEach) {\n    /**\n     * Iterates an array, invoking callback for each element\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Array}\n     */\n    Array.prototype.forEach = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          fn.call(context, this[i], i, this);\n        }\n      }\n    };\n  }\n\n  if (!Array.prototype.map) {\n    /**\n     * Returns a result of iterating over an array, invoking callback for each element\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Array}\n     */\n    Array.prototype.map = function(fn, context) {\n      var result = [];\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          result[i] = fn.call(context, this[i], i, this);\n        }\n      }\n      return result;\n    };\n  }\n\n  if (!Array.prototype.every) {\n    /**\n     * Returns true if a callback returns truthy value for all elements in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Boolean}\n     */\n    Array.prototype.every = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this && !fn.call(context, this[i], i, this)) {\n          return false;\n        }\n      }\n      return true;\n    };\n  }\n\n  if (!Array.prototype.some) {\n    /**\n     * Returns true if a callback returns truthy value for at least one element in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Boolean}\n     */\n    Array.prototype.some = function(fn, context) {\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this && fn.call(context, this[i], i, this)) {\n          return true;\n        }\n      }\n      return false;\n    };\n  }\n\n  if (!Array.prototype.filter) {\n    /**\n     * Returns the result of iterating over elements in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @param {Object} [context] Context to invoke callback in\n     * @return {Array}\n     */\n    Array.prototype.filter = function(fn, context) {\n      var result = [], val;\n      for (var i = 0, len = this.length >>> 0; i < len; i++) {\n        if (i in this) {\n          val = this[i]; // in case fn mutates this\n          if (fn.call(context, val, i, this)) {\n            result.push(val);\n          }\n        }\n      }\n      return result;\n    };\n  }\n\n  if (!Array.prototype.reduce) {\n    /**\n     * Returns \"folded\" (reduced) result of iterating over elements in an array\n     * @param {Function} fn Callback to invoke for each element\n     * @return {*}\n     */\n    Array.prototype.reduce = function(fn /*, initial*/) {\n      var len = this.length >>> 0,\n          i = 0,\n          rv;\n\n      if (arguments.length > 1) {\n        rv = arguments[1];\n      }\n      else {\n        do {\n          if (i in this) {\n            rv = this[i++];\n            break;\n          }\n          // if array contains no values, no initial value to return\n          if (++i >= len) {\n            throw new TypeError();\n          }\n        }\n        while (true);\n      }\n      for (; i < len; i++) {\n        if (i in this) {\n          rv = fn.call(null, rv, this[i], i, this);\n        }\n      }\n      return rv;\n    };\n  }\n\n  /* _ES5_COMPAT_END_ */\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n\n})();\n\n\n(function() {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * Does not clone or extend fabric.Object subclasses.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      }\n      else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({ }, source[i], deep);\n        }\n      }\n      else if (source && typeof source === 'object') {\n        for (var property in source) {\n          if (source.hasOwnProperty(property)) {\n            destination[property] = extend({ }, source[property], deep);\n          }\n        }\n      }\n      else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    }\n    else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @memberOf fabric.util.object\n   * @param {Object} object Object to clone\n   * @return {Object}\n   */\n  function clone(object, deep) {\n    return extend({ }, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n\n})();\n\n\n(function() {\n\n  /* _ES5_COMPAT_START_ */\n  if (!String.prototype.trim) {\n    /**\n     * Trims a string (removing whitespace from the beginning and the end)\n     * @function external:String#trim\n     * @see <a href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/String/Trim\">String#trim on MDN</a>\n     */\n    String.prototype.trim = function () {\n      // this trim is not fully ES3 or ES5 compliant, but it should cover most cases for now\n      return this.replace(/^[\\s\\xA0]+/, '').replace(/[\\s\\xA0]+$/, '');\n    };\n  }\n  /* _ES5_COMPAT_END_ */\n\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function(match, character) {\n      return character ? character.toUpperCase() : '';\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string.replace(/&/g, '&amp;')\n       .replace(/\"/g, '&quot;')\n       .replace(/'/g, '&apos;')\n       .replace(/</g, '&lt;')\n       .replace(/>/g, '&gt;');\n  }\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml\n  };\n})();\n\n\n/* _ES5_COMPAT_START_ */\n(function() {\n\n  var slice = Array.prototype.slice,\n      apply = Function.prototype.apply,\n      Dummy = function() { };\n\n  if (!Function.prototype.bind) {\n    /**\n     * Cross-browser approximation of ES5 Function.prototype.bind (not fully spec conforming)\n     * @see <a href=\"https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind\">Function#bind on MDN</a>\n     * @param {Object} thisArg Object to bind function to\n     * @param {Any[]} Values to pass to a bound function\n     * @return {Function}\n     */\n    Function.prototype.bind = function(thisArg) {\n      var _this = this, args = slice.call(arguments, 1), bound;\n      if (args.length) {\n        bound = function() {\n          return apply.call(_this, this instanceof Dummy ? this : thisArg, args.concat(slice.call(arguments)));\n        };\n      }\n      else {\n        /** @ignore */\n        bound = function() {\n          return apply.call(_this, this instanceof Dummy ? this : thisArg, arguments);\n        };\n      }\n      Dummy.prototype = this.prototype;\n      bound.prototype = new Dummy();\n\n      return bound;\n    };\n  }\n\n})();\n/* _ES5_COMPAT_END_ */\n\n\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { },\n\n      IS_DONTENUM_BUGGY = (function() {\n        for (var p in { toString: 1 }) {\n          if (p === 'toString') {\n            return false;\n          }\n        }\n        return true;\n      })(),\n\n      /** @ignore */\n      addMethods = function(klass, source, parent) {\n        for (var property in source) {\n\n          if (property in klass.prototype &&\n              typeof klass.prototype[property] === 'function' &&\n              (source[property] + '').indexOf('callSuper') > -1) {\n\n            klass.prototype[property] = (function(property) {\n              return function() {\n\n                var superclass = this.constructor.superclass;\n                this.constructor.superclass = parent;\n                var returnValue = source[property].apply(this, arguments);\n                this.constructor.superclass = superclass;\n\n                if (property !== 'initialize') {\n                  return returnValue;\n                }\n              };\n            })(property);\n          }\n          else {\n            klass.prototype[property] = source[property];\n          }\n\n          if (IS_DONTENUM_BUGGY) {\n            if (source.toString !== Object.prototype.toString) {\n              klass.prototype.toString = source.toString;\n            }\n            if (source.valueOf !== Object.prototype.valueOf) {\n              klass.prototype.valueOf = source.valueOf;\n            }\n          }\n        }\n      };\n\n  function Subclass() { }\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n        _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\n    }\n\n    return (arguments.length > 1)\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n\n\n(function () {\n\n  var unknown = 'unknown';\n\n  /* EVENT HANDLING */\n\n  function areHostMethods(object) {\n    var methodNames = Array.prototype.slice.call(arguments, 1),\n        t, i, len = methodNames.length;\n    for (i = 0; i < len; i++) {\n      t = typeof object[methodNames[i]];\n      if (!(/^(?:function|object|unknown)$/).test(t)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /** @ignore */\n  var getElement,\n      setElement,\n      getUniqueId = (function () {\n        var uid = 0;\n        return function (element) {\n          return element.__uniqueID || (element.__uniqueID = 'uniqueID__' + uid++);\n        };\n      })();\n\n  (function () {\n    var elements = { };\n    /** @ignore */\n    getElement = function (uid) {\n      return elements[uid];\n    };\n    /** @ignore */\n    setElement = function (uid, element) {\n      elements[uid] = element;\n    };\n  })();\n\n  function createListener(uid, handler) {\n    return {\n      handler: handler,\n      wrappedHandler: createWrappedHandler(uid, handler)\n    };\n  }\n\n  function createWrappedHandler(uid, handler) {\n    return function (e) {\n      handler.call(getElement(uid), e || fabric.window.event);\n    };\n  }\n\n  function createDispatcher(uid, eventName) {\n    return function (e) {\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          handlersForEvent[i].call(this, e || fabric.window.event);\n        }\n      }\n    };\n  }\n\n  var shouldUseAddListenerRemoveListener = (\n        areHostMethods(fabric.document.documentElement, 'addEventListener', 'removeEventListener') &&\n        areHostMethods(fabric.window, 'addEventListener', 'removeEventListener')),\n\n      shouldUseAttachEventDetachEvent = (\n        areHostMethods(fabric.document.documentElement, 'attachEvent', 'detachEvent') &&\n        areHostMethods(fabric.window, 'attachEvent', 'detachEvent')),\n\n      // IE branch\n      listeners = { },\n\n      // DOM L0 branch\n      handlers = { },\n\n      addListener, removeListener;\n\n  if (shouldUseAddListenerRemoveListener) {\n    /** @ignore */\n    addListener = function (element, eventName, handler, options) {\n      // since ie10 or ie9 can use addEventListener but they do not support options, i need to check\n      element && element.addEventListener(eventName, handler, shouldUseAttachEventDetachEvent ? false : options);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler, options) {\n      element && element.removeEventListener(eventName, handler, shouldUseAttachEventDetachEvent ? false : options);\n    };\n  }\n\n  else if (shouldUseAttachEventDetachEvent) {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element);\n      setElement(uid, element);\n      if (!listeners[uid]) {\n        listeners[uid] = { };\n      }\n      if (!listeners[uid][eventName]) {\n        listeners[uid][eventName] = [];\n\n      }\n      var listener = createListener(uid, handler);\n      listeners[uid][eventName].push(listener);\n      element.attachEvent('on' + eventName, listener.wrappedHandler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element), listener;\n      if (listeners[uid] && listeners[uid][eventName]) {\n        for (var i = 0, len = listeners[uid][eventName].length; i < len; i++) {\n          listener = listeners[uid][eventName][i];\n          if (listener && listener.handler === handler) {\n            element.detachEvent('on' + eventName, listener.wrappedHandler);\n            listeners[uid][eventName][i] = null;\n          }\n        }\n      }\n    };\n  }\n  else {\n    /** @ignore */\n    addListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element);\n      if (!handlers[uid]) {\n        handlers[uid] = { };\n      }\n      if (!handlers[uid][eventName]) {\n        handlers[uid][eventName] = [];\n        var existingHandler = element['on' + eventName];\n        if (existingHandler) {\n          handlers[uid][eventName].push(existingHandler);\n        }\n        element['on' + eventName] = createDispatcher(uid, eventName);\n      }\n      handlers[uid][eventName].push(handler);\n    };\n    /** @ignore */\n    removeListener = function (element, eventName, handler) {\n      if (!element) {\n        return;\n      }\n      var uid = getUniqueId(element);\n      if (handlers[uid] && handlers[uid][eventName]) {\n        var handlersForEvent = handlers[uid][eventName];\n        for (var i = 0, len = handlersForEvent.length; i < len; i++) {\n          if (handlersForEvent[i] === handler) {\n            handlersForEvent.splice(i, 1);\n          }\n        }\n      }\n    };\n  }\n\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = addListener;\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = removeListener;\n\n  /**\n   * Cross-browser wrapper for getting event's coordinates\n   * @memberOf fabric.util\n   * @param {Event} event Event object\n   */\n  function getPointer(event) {\n    event || (event = fabric.window.event);\n\n    var element = event.target ||\n                  (typeof event.srcElement !== unknown ? event.srcElement : null),\n\n        scroll = fabric.util.getScrollLeftTop(element);\n\n    return {\n      x: pointerX(event) + scroll.left,\n      y: pointerY(event) + scroll.top\n    };\n  }\n\n  var pointerX = function(event) {\n    // looks like in IE (<9) clientX at certain point (apparently when mouseup fires on VML element)\n    // is represented as COM object, with all the consequences, like \"unknown\" type and error on [[Get]]\n    // need to investigate later\n        return (typeof event.clientX !== unknown ? event.clientX : 0);\n      },\n\n      pointerY = function(event) {\n        return (typeof event.clientY !== unknown ? event.clientY : 0);\n      };\n\n  function _getPointer(event, pageProp, clientProp) {\n    var touchProp = event.type === 'touchend' ? 'changedTouches' : 'touches';\n\n    return (event[touchProp] && event[touchProp][0]\n      ? (event[touchProp][0][pageProp] - (event[touchProp][0][pageProp] - event[touchProp][0][clientProp]))\n        || event[clientProp]\n      : event[clientProp]);\n  }\n\n  if (fabric.isTouchSupported) {\n    pointerX = function(event) {\n      return _getPointer(event, 'pageX', 'clientX');\n    };\n    pointerY = function(event) {\n      return _getPointer(event, 'pageY', 'clientY');\n    };\n  }\n\n  fabric.util.getPointer = getPointer;\n\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n\n})();\n\n\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle[normalizedProperty] = styles[property];\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n\n\n(function() {\n\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n      /**\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\n       * @memberOf fabric.util\n       * @param {Object} arrayLike\n       * @return {Array}\n       */\n      toArray = function(arrayLike) {\n        return _slice.call(arrayLike, 0);\n      };\n\n  try {\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch (err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n\n    var left = 0,\n        top = 0,\n        docElement = fabric.document.documentElement,\n        body = fabric.document.body || {\n          scrollLeft: 0, scrollTop: 0\n        };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop ||  docElement.scrollTop || 0;\n      }\n      else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 &&\n          fabric.util.getElementStyle(element, 'position') === 'fixed') {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n        doc = element && element.ownerDocument,\n        box = { left: 0, top: 0 },\n        offset = { left: 0, top: 0 },\n        scrollLeftTop,\n        offsetAttributes = {\n          borderLeftWidth: 'left',\n          borderTopWidth:  'top',\n          paddingLeft:     'left',\n          paddingTop:      'top'\n        };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\n    getElementStyle = function(element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  }\n  else {\n    getElementStyle = function(element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n        selectProp = 'userSelect' in style\n          ? 'userSelect'\n          : 'MozUserSelect' in style\n            ? 'MozUserSelect'\n            : 'WebkitUserSelect' in style\n              ? 'WebkitUserSelect'\n              : 'KhtmlUserSelect' in style\n                ? 'KhtmlUserSelect'\n                : '';\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  (function() {\n\n    /**\n     * Inserts a script element with a given url into a document; invokes callback, when that script is finished loading\n     * @memberOf fabric.util\n     * @param {String} url URL of a script to load\n     * @param {Function} callback Callback to execute when script is finished loading\n     */\n    function getScript(url, callback) {\n      var headEl = fabric.document.getElementsByTagName('head')[0],\n          scriptEl = fabric.document.createElement('script'),\n          loading = true;\n\n      /** @ignore */\n      scriptEl.onload = /** @ignore */ scriptEl.onreadystatechange = function(e) {\n        if (loading) {\n          if (typeof this.readyState === 'string' &&\n              this.readyState !== 'loaded' &&\n              this.readyState !== 'complete') {\n            return;\n          }\n          loading = false;\n          callback(e || fabric.window.event);\n          scriptEl = scriptEl.onload = scriptEl.onreadystatechange = null;\n        }\n      };\n      scriptEl.src = url;\n      headEl.appendChild(scriptEl);\n      // causes issue in Opera\n      // headEl.removeChild(scriptEl);\n    }\n\n    fabric.util.getScript = getScript;\n  })();\n\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.makeElement = makeElement;\n  fabric.util.addClass = addClass;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getElementStyle = getElementStyle;\n\n})();\n\n\n(function() {\n\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n\n  var makeXHR = (function() {\n    var factories = [\n      function() { return new ActiveXObject('Microsoft.XMLHTTP'); },\n      function() { return new ActiveXObject('Msxml2.XMLHTTP'); },\n      function() { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); },\n      function() { return new XMLHttpRequest(); }\n    ];\n    for (var i = factories.length; i--; ) {\n      try {\n        var req = factories[i]();\n        if (req) {\n          return factories[i];\n        }\n      }\n      catch (err) { }\n    }\n  })();\n\n  function emptyFn() { }\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        xhr = makeXHR(),\n        body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters === 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === 'POST' || method === 'PUT') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n\n\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = function() { };\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = function() { };\n\n/* eslint-disable */\nif (typeof console !== 'undefined') {\n\n  ['log', 'warn'].forEach(function(methodName) {\n\n    if (typeof console[methodName] !== 'undefined' &&\n        typeof console[methodName].apply === 'function') {\n\n      fabric[methodName] = function() {\n        return console[methodName].apply(console, arguments);\n      };\n    }\n  });\n}\n/* eslint-enable */\n\n\n(function() {\n\n  function noop() {\n    return false;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Number} [options.startValue=0] Starting value\n   * @param {Number} [options.endValue=100] Ending value\n   * @param {Number} [options.byValue=100] Value to modify the property by\n   * @param {Function} [options.easing] Easing function\n   * @param {Number} [options.duration=500] Duration of change (in ms)\n   */\n  function animate(options) {\n\n    requestAnimFrame(function(timestamp) {\n      options || (options = { });\n\n      var start = timestamp || +new Date(),\n          duration = options.duration || 500,\n          finish = start + duration, time,\n          onChange = options.onChange || noop,\n          abort = options.abort || noop,\n          onComplete = options.onComplete || noop,\n          easing = options.easing || function(t, b, c, d) {return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;},\n          startValue = 'startValue' in options ? options.startValue : 0,\n          endValue = 'endValue' in options ? options.endValue : 100,\n          byValue = options.byValue || endValue - startValue;\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        if (abort()) {\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : (time - start),\n            timePerc = currentTime / duration,\n            current = easing(currentTime, startValue, byValue, duration),\n            valuePerc = Math.abs((current - startValue) / byValue);\n        onChange(current, valuePerc, timePerc);\n        if (time > finish) {\n          options.onComplete && options.onComplete();\n          return;\n        }\n        requestAnimFrame(tick);\n      })(start);\n    });\n\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback) {\n                            fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n\n})();\n\n\n(function() {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color = 'rgba('\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\n\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += ')';\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n        endColor = new fabric.Color(toColor).getSource();\n\n    options = options || {};\n\n    fabric.util.animate(fabric.util.object.extend(options, {\n      duration: duration || 500,\n      startValue: startColor,\n      endValue: endColor,\n      byValue: endColor,\n      easing: function (currentTime, startValue, byValue, duration) {\n        var posValue = options.colorEasing\n              ? options.colorEasing(currentTime, duration)\n              : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\n        return calculateColor(startValue, byValue, posValue);\n      }\n    }));\n  }\n\n  fabric.util.animateColor = animateColor;\n\n})();\n\n\n(function() {\n\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    }\n    else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = p / (2 * Math.PI) * Math.asin(1);\n      }\n      else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t + b;\n    }\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n    }\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < (1 / 2.75)) {\n      return c * (7.5625 * t * t) + b;\n    }\n    else if (t < (2 / 2.75)) {\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n    }\n    else if (t < (2.5 / 2.75)) {\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n    }\n    else {\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function(t, b, c, d) {\n      t /= (d / 2);\n      if (t < 1) {\n        return c / 2 * t * t + b;\n      }\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      parseUnit = fabric.util.parseUnit,\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n\n      reAllowedSVGTagNames = /^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,\n      reViewBoxTagNames = /^(symbol|image|marker|pattern|view|svg)$/i,\n      reNotAllowedAncestors = /^(?:pattern|defs|symbol|metadata|clipPath|mask)$/i,\n      reAllowedParents = /^(symbol|g|a|svg)$/i,\n\n      attributesMap = {\n        cx:                   'left',\n        x:                    'left',\n        r:                    'radius',\n        cy:                   'top',\n        y:                    'top',\n        display:              'visible',\n        visibility:           'visible',\n        transform:            'transformMatrix',\n        'fill-opacity':       'fillOpacity',\n        'fill-rule':          'fillRule',\n        'font-family':        'fontFamily',\n        'font-size':          'fontSize',\n        'font-style':         'fontStyle',\n        'font-weight':        'fontWeight',\n        'stroke-dasharray':   'strokeDashArray',\n        'stroke-linecap':     'strokeLineCap',\n        'stroke-linejoin':    'strokeLineJoin',\n        'stroke-miterlimit':  'strokeMiterLimit',\n        'stroke-opacity':     'strokeOpacity',\n        'stroke-width':       'strokeWidth',\n        'text-decoration':    'textDecoration',\n        'text-anchor':        'originX',\n        opacity:              'opacity'\n      },\n\n      colorAttributes = {\n        stroke: 'strokeOpacity',\n        fill:   'fillOpacity'\n      };\n\n  fabric.cssRules = { };\n  fabric.gradientDefs = { };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Object.prototype.toString.call(value) === '[object Array]',\n        parsed;\n\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n      value = '';\n    }\n    else if (attr === 'strokeDashArray') {\n      if (value === 'none') {\n        value = null;\n      }\n      else {\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(function(n) {\n          return parseFloat(n);\n        });\n      }\n    }\n    else if (attr === 'transformMatrix') {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\n      }\n      else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    }\n    else if (attr === 'visible') {\n      value = (value === 'none' || value === 'hidden') ? false : true;\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    }\n    else if (attr === 'opacity') {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\n        value *= parentAttributes.opacity;\n      }\n    }\n    else if (attr === 'originX' /* text-anchor */) {\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\n    }\n    else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return (!isArray && isNaN(parsed) ? value : parsed);\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\n        continue;\n      }\n\n      if (typeof attributes[attr] === 'undefined') {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf('url(') === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName, nodeArray = [], nodeList;\n    for (var i = 0; i < nodeNames.length; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var cos = Math.cos(args[0]), sin = Math.sin(args[0]),\n          x = 0, y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = [\n          1, // a\n          0, // b\n          0, // c\n          1, // d\n          0, // e\n          0  // f\n        ],\n\n        // == begin transform regexp\n        number = fabric.reNum,\n\n        commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)',\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + ')' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\n\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transformList),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform, 'g');\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n          matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              // match !== '' && match != null\n              return (!!match);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewMatrix(matrix, args, 2);\n            break;\n          case 'skewY':\n            skewMatrix(matrix, args, 1);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\n      var pair = chunk.split(':');\n\n      attr = pair[0].trim().toLowerCase();\n      value =  pair[1].trim();\n\n      oStyle[attr] = value;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === 'undefined') {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = { };\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(' '))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching, parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && (selectors.length === 0);\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector, parentMatching = true;\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n        classNames = element.getAttribute('class'),\n        id = element.getAttribute('id'), matcher;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp('^' + nodeName, 'i');\n    selector = selector.replace(matcher, '');\n    if (id && selector.length) {\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\n      selector = selector.replace(matcher, '');\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(' ');\n      for (var i = classNames.length; i--;) {\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\n        selector = selector.replace(matcher, '');\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node, i, nodelist = doc.getElementsByTagName('*');\n    for (i = 0; i < nodelist.length; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute('id')) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\n\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n          xlink = el.getAttribute('xlink:href').substr(1),\n          x = el.getAttribute('x') || 0,\n          y = el.getAttribute('y') || 0,\n          el2 = elementById(doc, xlink).cloneNode(true),\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\n          parentNode, oldLength = nodelist.length, attr, j, attrs, l;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElement('g');\n        for (j = 0, attrs = el2.attributes, l = attrs.length; j < l; j++) {\n          attr = attrs.item(j);\n          el3.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, l = attrs.length; j < l; j++) {\n        attr = attrs.item(j);\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' || attr.nodeName === 'xlink:href') {\n          continue;\n        }\n\n        if (attr.nodeName === 'transform') {\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\n        }\n        else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute('transform', currentTrans);\n      el2.setAttribute('instantiated_by_use', '1');\n      el2.removeAttribute('id');\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    '^' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\n    '$'\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n\n    var viewBoxAttr = element.getAttribute('viewBox'),\n        scaleX = 1,\n        scaleY = 1,\n        minX = 0,\n        minY = 0,\n        viewBoxWidth, viewBoxHeight, matrix, el,\n        widthAttr = element.getAttribute('width'),\n        heightAttr = element.getAttribute('height'),\n        x = element.getAttribute('x') || 0,\n        y = element.getAttribute('y') || 0,\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\n        missingViewBox = (!viewBoxAttr || !reViewBoxTagNames.test(element.nodeName)\n                           || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\n        toBeParsed = missingViewBox && missingDimAttr,\n        parsedDim = { }, translateMatrix = '';\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      return parsedDim;\n    }\n\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    }\n    else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\n    if (preserveAspectRatio.alignX !== 'none') {\n      //translate all container for the effect of Mid, Min, Max\n      scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\n    }\n\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\n      return parsedDim;\n    }\n\n    if (x || y) {\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n    }\n\n    matrix = translateMatrix + ' matrix(' + scaleX +\n                  ' 0' +\n                  ' 0 ' +\n                  scaleY + ' ' +\n                  (minX * scaleX) + ' ' +\n                  (minY * scaleY) + ') ';\n\n    if (element.nodeName === 'svg') {\n      el = element.ownerDocument.createElement('g');\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    }\n    else {\n      el = element;\n      matrix = el.getAttribute('transform') + matrix;\n    }\n\n    el.setAttribute('transform', matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\n        && !element.getAttribute('instantiated_by_use')) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid =  fabric.Object.__uid++,\n        options = applyViewboxTransform(doc),\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (var i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function(el) {\n      applyViewboxTransform(el);\n      return reAllowedSVGTagNames.test(el.nodeName.replace('svg:', '')) &&\n            !hasAncestorWithNodeName(el, reNotAllowedAncestors); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(elements, function(instances) {\n      if (callback) {\n        callback(instances, options);\n      }\n    }, clone(options), reviver, parsingOptions);\n  };\n\n  var reFontDeclaration = new RegExp(\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\n      fabric.reNum +\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function(value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n          // font variant is not used\n          // fontVariant = match[2],\n          fontWeight = match[3],\n          fontSize = match[4],\n          lineHeight = match[5],\n          fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function(doc) {\n      var tagArray = [\n            'linearGradient',\n            'radialGradient',\n            'svg:linearGradient',\n            'svg:radialGradient'],\n          elList = _getMultipleNodes(doc, tagArray),\n          el, j = 0, id, xlink,\n          gradientDefs = { }, idsToXlinkMap = { };\n\n      j = elList.length;\n\n      while (j--) {\n        el = elList[j];\n        xlink = el.getAttribute('xlink:href');\n        id = el.getAttribute('id');\n        if (xlink) {\n          idsToXlinkMap[id] = xlink.substr(1);\n        }\n        gradientDefs[id] = el;\n      }\n\n      for (id in idsToXlinkMap) {\n        var el2 = gradientDefs[idsToXlinkMap[id]].cloneNode(true);\n        el = gradientDefs[id];\n        while (el2.firstChild) {\n          el.appendChild(el2.firstChild);\n        }\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function(element, attributes, svgUid) {\n\n      if (!element) {\n        return;\n      }\n\n      var value,\n          parentAttributes = { },\n          fontSize;\n\n      if (typeof svgUid === 'undefined') {\n        svgUid = element.getAttribute('svgUid');\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (element.parentNode && reAllowedParents.test(element.parentNode.nodeName)) {\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\n      }\n      fontSize = (parentAttributes && parentAttributes.fontSize ) ||\n                 element.getAttribute('font-size') || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n\n      var ownAttributes = attributes.reduce(function(memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) { // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, { });\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      ownAttributes = extend(ownAttributes,\n        extend(getGlobalStylesForElement(element, svgUid), fabric.parseStyleAttribute(element)));\n\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return reAllowedParents.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function(element) {\n      var oStyle = { },\n          style = element.getAttribute('style');\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === 'string') {\n        parseStyleString(style, oStyle);\n      }\n      else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function(points) {\n\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, ' ').trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [], i, len;\n\n      i = 0;\n      len = points.length;\n      for (; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1])\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function(doc) {\n      var styles = doc.getElementsByTagName('style'),\n          allRules = { }, rules;\n\n      // very crude parsing of style contents\n      for (var i = 0, len = styles.length; i < len; i++) {\n        // IE9 doesn't support textContent, but provides text instead.\n        var styleContents = styles[i].textContent || styles[i].text;\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n        if (styleContents.trim() === '') {\n          continue;\n        }\n        rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = rules.map(function(rule) { return rule.trim(); });\n        rules.forEach(function(rule) {\n\n          var match = rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),\n              ruleObj = { }, declaration = match[2].trim(),\n              propertyValuePairs = declaration.replace(/;$/, '').split(/\\s*;\\s*/);\n\n          for (var i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(/\\s*:\\s*/),\n                property = pair[0],\n                value = pair[1];\n            ruleObj[property] = value;\n          }\n          rule = match[1];\n          rule.split(',').forEach(function(_rule) {\n            _rule = _rule.replace(/^svg/i, '').trim();\n            if (_rule === '') {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            }\n            else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function(url, callback, reviver, options) {\n\n      url = url.replace(/^\\n\\s*/, '').trim();\n      new fabric.util.request(url, {\n        method: 'get',\n        onComplete: onComplete\n      });\n\n      function onComplete(r) {\n\n        var xml = r.responseXML;\n        if (xml && !xml.documentElement && fabric.window.ActiveXObject && r.responseText) {\n          xml = new ActiveXObject('Microsoft.XMLDOM');\n          xml.async = 'false';\n          //IE chokes on DOCTYPE\n          xml.loadXML(r.responseText.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i, ''));\n        }\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n        }\n\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options) {\n          callback && callback(results, _options);\n        }, reviver, options);\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function(string, callback, reviver, options) {\n      string = string.trim();\n      var doc;\n      if (typeof DOMParser !== 'undefined') {\n        var parser = new DOMParser();\n        if (parser && parser.parseFromString) {\n          doc = parser.parseFromString(string, 'text/xml');\n        }\n      }\n      else if (fabric.window.ActiveXObject) {\n        doc = new ActiveXObject('Microsoft.XMLDOM');\n        doc.async = 'false';\n        // IE chokes on DOCTYPE\n        doc.loadXML(string.replace(/<!DOCTYPE[\\s\\S]*?(\\[[\\s\\S]*\\])*?>/i, ''));\n      }\n\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options) {\n        callback(results, _options);\n      }, reviver, options);\n    }\n  });\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n};\n\nfabric.ElementsParser.prototype.parse = function() {\n  this.instances = new Array(this.elements.length);\n  this.numElements = this.elements.length;\n\n  this.createObjects();\n};\n\nfabric.ElementsParser.prototype.createObjects = function() {\n  for (var i = 0, len = this.elements.length; i < len; i++) {\n    this.elements[i].setAttribute('svgUid', this.svgUid);\n    (function(_obj, i) {\n      setTimeout(function() {\n        _obj.createObject(_obj.elements[i], i);\n      }, 0);\n    })(this, i);\n  }\n};\n\nfabric.ElementsParser.prototype.createObject = function(el, index) {\n  var klass = fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\n  if (klass && klass.fromElement) {\n    try {\n      this._createObject(klass, el, index);\n    }\n    catch (err) {\n      fabric.log(err);\n    }\n  }\n  else {\n    this.checkIfDone();\n  }\n};\n\nfabric.ElementsParser.prototype._createObject = function(klass, el, index) {\n  if (klass.async) {\n    klass.fromElement(el, this.createCallback(index, el), this.options);\n  }\n  else {\n    var obj = klass.fromElement(el, this.options);\n    this.resolveGradient(obj, 'fill');\n    this.resolveGradient(obj, 'stroke');\n    this.reviver && this.reviver(el, obj);\n    this.instances[index] = obj;\n    this.checkIfDone();\n  }\n};\n\nfabric.ElementsParser.prototype.createCallback = function(index, el) {\n  var _this = this;\n  return function(obj) {\n    _this.resolveGradient(obj, 'fill');\n    _this.resolveGradient(obj, 'stroke');\n    _this.reviver && _this.reviver(el, obj);\n    _this.instances[index] = obj;\n    _this.checkIfDone();\n  };\n};\n\nfabric.ElementsParser.prototype.resolveGradient = function(obj, property) {\n\n  var instanceFillValue = obj.get(property);\n  if (!(/^url\\(/).test(instanceFillValue)) {\n    return;\n  }\n  var gradientId = instanceFillValue.slice(5, instanceFillValue.length - 1);\n  if (fabric.gradientDefs[this.svgUid][gradientId]) {\n    obj.set(property,\n      fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][gradientId], obj));\n  }\n};\n\nfabric.ElementsParser.prototype.checkIfDone = function() {\n  if (--this.numElements === 0) {\n    this.instances = this.instances.filter(function(el) {\n      // eslint-disable-next-line no-eq-null, eqeqeq\n      return el != null;\n    });\n    this.callback(this.instances);\n  }\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {\n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n\n    type: 'point',\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Miltiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Miltiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return (this.x === that.x && this.y === that.y);\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n\n    /**\n\n     * Returns true if this point is greater another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === 'undefined') {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + ',' + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    }\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n          ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection('Intersection');\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection();\n      }\n    }\n    else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection('Coincident');\n      }\n      else {\n        result = new Intersection('Parallel');\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\n    var result = new Intersection(),\n        length = points.length,\n        b1, b2, inter;\n\n    for (var i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n        length = points1.length;\n\n    for (var i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i + 1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function(color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === 'transparent') {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function(r, g, b) {\n      r /= 255; g /= 255; b /= 255;\n\n      var h, s, l,\n          max = fabric.util.array.max([r, g, b]),\n          min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      }\n      else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [\n        Math.round(h * 360),\n        Math.round(s * 100),\n        Math.round(l * 100)\n      ];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource(), r, g, b;\n\n      r = source[0].toString(16);\n      r = (r.length === 1) ? ('0' + r) : r;\n\n      g = source[1].toString(16);\n      g = (g.length === 1) ? ('0' + g) : g;\n\n      b = source[2].toString(16);\n      b = (b.length === 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function() {\n      var source = this.getSource(), a;\n\n      a = source[3] * 255;\n      a = a.toString(16);\n      a = (a.length === 1) ? ('0' + a) : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource();\n\n      for (var i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n   // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 17 basic color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: http://www.w3.org/TR/CSS2/syndata.html#color-units\n   */\n  fabric.Color.colorNameMap = {\n    aqua:    '#00FFFF',\n    black:   '#000000',\n    blue:    '#0000FF',\n    fuchsia: '#FF00FF',\n    gray:    '#808080',\n    grey:    '#808080',\n    green:   '#008000',\n    lime:    '#00FF00',\n    maroon:  '#800000',\n    navy:    '#000080',\n    olive:   '#808000',\n    orange:  '#FFA500',\n    purple:  '#800080',\n    red:     '#FF0000',\n    silver:  '#C0C0C0',\n    teal:    '#008080',\n    white:   '#FFFFFF',\n    yellow:  '#FFFF00'\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function(color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function(color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n        r, g, b;\n\n    if (s === 0) {\n      r = g = b = l;\n    }\n    else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n          p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3 || value.length === 4),\n          isRGBa = (value.length === 8 || value.length === 4),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /* _FROM_SVG_START_ */\n  function getColorStop(el) {\n    var style = el.getAttribute('style'),\n        offset = el.getAttribute('offset') || 0,\n        color, colorAlpha, opacity;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (var i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          color = value;\n        }\n        else if (key === 'stop-opacity') {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\n    }\n    if (!opacity) {\n      opacity = el.getAttribute('stop-opacity');\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute('x1') || 0,\n      y1: el.getAttribute('y1') || 0,\n      x2: el.getAttribute('x2') || '100%',\n      y2: el.getAttribute('y2') || 0\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\n      r1: 0,\n      x2: el.getAttribute('cx') || '50%',\n      y2: el.getAttribute('cy') || '50%',\n      r2: el.getAttribute('r') || '50%'\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\n\n    /**\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object with type, coords, gradientUnits and colorStops\n     * @return {fabric.Gradient} thisArg\n     */\n    initialize: function(options) {\n      options || (options = { });\n\n      var coords = { };\n\n      this.id = fabric.Object.__uid++;\n      this.type = options.type || 'linear';\n\n      coords = {\n        x1: options.coords.x1 || 0,\n        y1: options.coords.y1 || 0,\n        x2: options.coords.x2 || 0,\n        y2: options.coords.y2 || 0\n      };\n\n      if (this.type === 'radial') {\n        coords.r1 = options.coords.r1 || 0;\n        coords.r2 = options.coords.r2 || 0;\n      }\n      this.coords = coords;\n      this.colorStops = options.colorStops.slice();\n      if (options.gradientTransform) {\n        this.gradientTransform = options.gradientTransform;\n      }\n      this.offsetX = options.offsetX || this.offsetX;\n      this.offsetY = options.offsetY || this.offsetY;\n    },\n\n    /**\n     * Adds another colorStop\n     * @param {Object} colorStop Object with offset and color\n     * @return {fabric.Gradient} thisArg\n     */\n    addColorStop: function(colorStops) {\n      for (var position in colorStops) {\n        var color = new fabric.Color(colorStops[position]);\n        this.colorStops.push({\n          offset: parseFloat(position),\n          color: color.toRgb(),\n          opacity: color.getAlpha()\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Returns object representation of a gradient\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object}\n     */\n    toObject: function(propertiesToInclude) {\n      var object = {\n        type: this.type,\n        coords: this.coords,\n        colorStops: this.colorStops,\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an gradient\n     * @param {Object} object Object to create a gradient for\n     * @return {String} SVG representation of an gradient (linear/radial)\n     */\n    toSVG: function(object) {\n      var coords = clone(this.coords, true),\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2;\n      // colorStops must be sorted ascending\n      colorStops.sort(function(a, b) {\n        return a.offset - b.offset;\n      });\n\n      if (!(object.group && object.group.type === 'path-group')) {\n        for (var prop in coords) {\n          if (prop === 'x1' || prop === 'x2') {\n            coords[prop] += this.offsetX - object.width / 2;\n          }\n          else if (prop === 'y1' || prop === 'y2') {\n            coords[prop] += this.offsetY - object.height / 2;\n          }\n        }\n      }\n\n      commonAttributes = 'id=\"SVGID_' + this.id +\n                     '\" gradientUnits=\"userSpaceOnUse\"';\n      if (this.gradientTransform) {\n        commonAttributes += ' gradientTransform=\"matrix(' + this.gradientTransform.join(' ') + ')\" ';\n      }\n      if (this.type === 'linear') {\n        markup = [\n          '<linearGradient ',\n          commonAttributes,\n          ' x1=\"', coords.x1,\n          '\" y1=\"', coords.y1,\n          '\" x2=\"', coords.x2,\n          '\" y2=\"', coords.y2,\n          '\">\\n'\n        ];\n      }\n      else if (this.type === 'radial') {\n        // svg radial gradient has just 1 radius. the biggest.\n        markup = [\n          '<radialGradient ',\n          commonAttributes,\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\n          '\">\\n'\n        ];\n      }\n\n      if (this.type === 'radial') {\n        if (needsSwap) {\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\n          colorStops = colorStops.concat();\n          colorStops.reverse();\n          for (var i = 0; i < colorStops.length; i++) {\n            colorStops[i].offset = 1 - colorStops[i].offset;\n          }\n        }\n        var minRadius = Math.min(coords.r1, coords.r2);\n        if (minRadius > 0) {\n          // i have to shift all colorStops and add new one in 0.\n          var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n          for (var i = 0; i < colorStops.length; i++) {\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\n          }\n        }\n      }\n\n      for (var i = 0; i < colorStops.length; i++) {\n        var colorStop = colorStops[i];\n        markup.push(\n          '<stop ',\n            'offset=\"', (colorStop.offset * 100) + '%',\n            '\" style=\"stop-color:', colorStop.color,\n            (colorStop.opacity !== null ? ';stop-opacity: ' + colorStop.opacity : ';'),\n          '\"/>\\n'\n        );\n      }\n\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\n\n      return markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns an instance of CanvasGradient\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} object\n     * @return {CanvasGradient}\n     */\n    toLive: function(ctx, object) {\n      var gradient, prop, coords = fabric.util.object.clone(this.coords);\n\n      if (!this.type) {\n        return;\n      }\n\n      if (object.group && object.group.type === 'path-group') {\n        for (prop in coords) {\n          if (prop === 'x1' || prop === 'x2') {\n            coords[prop] += -this.offsetX + object.width / 2;\n          }\n          else if (prop === 'y1' || prop === 'y2') {\n            coords[prop] += -this.offsetY + object.height / 2;\n          }\n        }\n      }\n\n      if (this.type === 'linear') {\n        gradient = ctx.createLinearGradient(\n          coords.x1, coords.y1, coords.x2, coords.y2);\n      }\n      else if (this.type === 'radial') {\n        gradient = ctx.createRadialGradient(\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\n      }\n\n      for (var i = 0, len = this.colorStops.length; i < len; i++) {\n        var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n        if (typeof opacity !== 'undefined') {\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\n        }\n        gradient.addColorStop(offset, color);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function(el, instance) {\n\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          type,\n          gradientUnits = el.getAttribute('gradientUnits') || 'objectBoundingBox',\n          gradientTransform = el.getAttribute('gradientTransform'),\n          colorStops = [],\n          coords, ellipseMatrix;\n\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\n        type = 'linear';\n      }\n      else {\n        type = 'radial';\n      }\n\n      if (type === 'linear') {\n        coords = getLinearCoords(el);\n      }\n      else if (type === 'radial') {\n        coords = getRadialCoords(el);\n      }\n\n      for (var i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i]));\n      }\n\n      ellipseMatrix = _convertPercentUnitsToValues(instance, coords, gradientUnits);\n\n      var gradient = new fabric.Gradient({\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        offsetX: -instance.left,\n        offsetY: -instance.top\n      });\n\n      if (gradientTransform || ellipseMatrix !== '') {\n        gradient.gradientTransform = fabric.parseTransformAttribute((gradientTransform || '') + ellipseMatrix);\n      }\n      return gradient;\n    },\n    /* _FROM_SVG_END_ */\n\n    /**\n     * Returns {@link fabric.Gradient} instance from its object representation\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {Object} obj\n     * @param {Object} [options] Options object\n     */\n    forObject: function(obj, options) {\n      options || (options = { });\n      _convertPercentUnitsToValues(obj, options.coords, 'userSpaceOnUse');\n      return new fabric.Gradient(options);\n    }\n  });\n\n  /**\n   * @private\n   */\n  function _convertPercentUnitsToValues(object, options, gradientUnits) {\n    var propValue, addFactor = 0, multFactor = 1, ellipseMatrix = '';\n    for (var prop in options) {\n      if (options[prop] === 'Infinity') {\n        options[prop] = 1;\n      }\n      else if (options[prop] === '-Infinity') {\n        options[prop] = 0;\n      }\n      propValue = parseFloat(options[prop], 10);\n      if (typeof options[prop] === 'string' && /^\\d+%$/.test(options[prop])) {\n        multFactor = 0.01;\n      }\n      else {\n        multFactor = 1;\n      }\n      if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\n        multFactor *= gradientUnits === 'objectBoundingBox' ? object.width : 1;\n        addFactor = gradientUnits === 'objectBoundingBox' ? object.left || 0 : 0;\n      }\n      else if (prop === 'y1' || prop === 'y2') {\n        multFactor *= gradientUnits === 'objectBoundingBox' ? object.height : 1;\n        addFactor = gradientUnits === 'objectBoundingBox' ? object.top || 0 : 0;\n      }\n      options[prop] = propValue * multFactor + addFactor;\n    }\n    if (object.type === 'ellipse' &&\n        options.r2 !== null &&\n        gradientUnits === 'objectBoundingBox' &&\n        object.rx !== object.ry) {\n\n      var scaleFactor = object.ry / object.rx;\n      ellipseMatrix = ' scale(1, ' + scaleFactor + ')';\n      if (options.y1) {\n        options.y1 /= scaleFactor;\n      }\n      if (options.y2) {\n        options.y2 /= scaleFactor;\n      }\n    }\n    return ellipseMatrix;\n  }\n})();\n\n\n(function() {\n\n  'use strict';\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\n\n    /**\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @type String\n     * @default\n     */\n    repeat: 'repeat',\n\n    /**\n     * Pattern horizontal offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Pattern vertical offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @param {Function} [callback] function to invoke after callback init.\n     * @return {fabric.Pattern} thisArg\n     */\n    initialize: function(options, callback) {\n      options || (options = { });\n\n      this.id = fabric.Object.__uid++;\n      this.setOptions(options);\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\n        callback && callback(this);\n        return;\n      }\n      // function string\n      if (typeof fabric.util.getFunctionBody(options.source) !== 'undefined') {\n        this.source = new Function(fabric.util.getFunctionBody(options.source));\n        callback && callback(this);\n      }\n      else {\n        // img src string\n        var _this = this;\n        this.source = fabric.util.createImage();\n        fabric.util.loadImage(options.source, function(img) {\n          _this.source = img;\n          callback && callback(_this);\n        });\n      }\n    },\n\n    /**\n     * Returns object representation of a pattern\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of a pattern instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source, object;\n\n      // callback\n      if (typeof this.source === 'function') {\n        source = String(this.source);\n      }\n      // <img> element\n      else if (typeof this.source.src === 'string') {\n        source = this.source.src;\n      }\n      // <canvas> element\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\n        source = this.source.toDataURL();\n      }\n\n      object = {\n        type: 'pattern',\n        source: source,\n        repeat: this.repeat,\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a pattern\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a pattern\n     */\n    toSVG: function(object) {\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = '';\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\n        patternHeight = 1;\n      }\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\n        patternWidth = 1;\n      }\n      if (patternSource.src) {\n        patternImgSrc = patternSource.src;\n      }\n      else if (patternSource.toDataURL) {\n        patternImgSrc = patternSource.toDataURL();\n      }\n\n      return '<pattern id=\"SVGID_' + this.id +\n                    '\" x=\"' + patternOffsetX +\n                    '\" y=\"' + patternOffsetY +\n                    '\" width=\"' + patternWidth +\n                    '\" height=\"' + patternHeight + '\">\\n' +\n               '<image x=\"0\" y=\"0\"' +\n                      ' width=\"' + patternSource.width +\n                      '\" height=\"' + patternSource.height +\n                      '\" xlink:href=\"' + patternImgSrc +\n               '\"></image>\\n' +\n             '</pattern>\\n';\n    },\n    /* _TO_SVG_END_ */\n\n    setOptions: function(options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Returns an instance of CanvasPattern\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\n     * @return {CanvasPattern}\n     */\n    toLive: function(ctx) {\n      var source = typeof this.source === 'function' ? this.source() : this.source;\n\n      // if the image failed to load, return, and allow rest to continue loading\n      if (!source) {\n        return '';\n      }\n\n      // if an image\n      if (typeof source.src !== 'undefined') {\n        if (!source.complete) {\n          return '';\n        }\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n          return '';\n        }\n      }\n      return ctx.createPattern(source, this.repeat);\n    }\n  });\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn('fabric.Shadow is already defined.');\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\n\n    /**\n     * Shadow color\n     * @type String\n     * @default\n     */\n    color: 'rgb(0,0,0)',\n\n    /**\n     * Shadow blur\n     * @type Number\n     */\n    blur: 0,\n\n    /**\n     * Shadow horizontal offset\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Shadow vertical offset\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Whether the shadow should affect stroke operations\n     * @type Boolean\n     * @default\n     */\n    affectStroke: false,\n\n    /**\n     * Indicates whether toObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Constructor\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetX properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px, \"2px 2px 10px rgba(0,0,0,0.2)\")\n     * @return {fabric.Shadow} thisArg\n     */\n    initialize: function(options) {\n\n      if (typeof options === 'string') {\n        options = this._parseShadow(options);\n      }\n\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.id = fabric.Object.__uid++;\n    },\n\n    /**\n     * @private\n     * @param {String} shadow Shadow value to parse\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\n     */\n    _parseShadow: function(shadow) {\n      var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\n\n      return {\n        color: color.trim(),\n        offsetX: parseInt(offsetsAndBlur[1], 10) || 0,\n        offsetY: parseInt(offsetsAndBlur[2], 10) || 0,\n        blur: parseInt(offsetsAndBlur[3], 10) || 0\n      };\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n     * @return {String} Returns CSS3 text-shadow declaration\n     */\n    toString: function() {\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a shadow\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a shadow\n     */\n    toSVG: function(object) {\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)),\n          BLUR_BOX = 20;\n\n      if (object.width && object.height) {\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n        // we add some extra space to filter box to contain the blur ( 20 )\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n      }\n      if (object.flipX) {\n        offset.x *= -1;\n      }\n      if (object.flipY) {\n        offset.y *= -1;\n      }\n      return (\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' + this.color + '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          '\\t<feMerge>\\n' +\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          '\\t</feMerge>\\n' +\n        '</filter>\\n');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns object representation of a shadow\n     * @return {Object} Object representation of a shadow instance\n     */\n    toObject: function() {\n      if (this.includeDefaultValues) {\n        return {\n          color: this.color,\n          blur: this.blur,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          affectStroke: this.affectStroke\n        };\n      }\n      var obj = { }, proto = fabric.Shadow.prototype;\n\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke'].forEach(function(prop) {\n        if (this[prop] !== proto[prop]) {\n          obj[prop] = this[prop];\n        }\n      }, this);\n\n      return obj;\n    }\n  });\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:px)?(?:\\s?|$))?(-?\\d+(?:px)?(?:\\s?|$))?(\\d+(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function () {\n\n  'use strict';\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      toFixed = fabric.util.toFixed,\n      transformPoint = fabric.util.transformPoint,\n      invertTransform = fabric.util.invertTransform,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n\n      this._initStatic(el, options);\n    },\n\n    /**\n     * Background color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    backgroundColor: '',\n\n    /**\n     * Background image of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundImage}.\n     * <b>Backwards incompatibility note:</b> The \"backgroundImageOpacity\"\n     * and \"backgroundImageStretch\" properties are deprecated since 1.3.9.\n     * Use {@link fabric.Image#opacity}, {@link fabric.Image#width} and {@link fabric.Image#height}.\n     * @type fabric.Image\n     * @default\n     */\n    backgroundImage: null,\n\n    /**\n     * Overlay color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n     * @since 1.3.9\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    overlayColor: '',\n\n    /**\n     * Overlay image of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayImage}.\n     * <b>Backwards incompatibility note:</b> The \"overlayImageLeft\"\n     * and \"overlayImageTop\" properties are deprecated since 1.3.9.\n     * Use {@link fabric.Image#left} and {@link fabric.Image#top}.\n     * @type fabric.Image\n     * @default\n     */\n    overlayImage: null,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @type Boolean\n     * @default\n     */\n    stateful: false,\n\n    /**\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove} should also re-render canvas.\n     * Disabling this option could give a great performance boost when adding/removing a lot of objects to/from canvas at once\n     * (followed by a manual rendering after addition/deletion)\n     * @type Boolean\n     * @default\n     */\n    renderOnAddRemove: true,\n\n    /**\n     * Function that determines clipping of entire canvas area\n     * Being passed context as first argument. See clipping canvas area in {@link https://github.com/kangax/fabric.js/wiki/FAQ}\n     * @type Function\n     * @default\n     */\n    clipTo: null,\n\n    /**\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\n     * @type Boolean\n     * @default\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n     * @type Boolean\n     * @default\n     */\n    allowTouchScrolling: false,\n\n    /**\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n     * @type Boolean\n     * @default\n     */\n    imageSmoothingEnabled: true,\n\n    /**\n     * The transformation (in the format of Canvas transform) which focuses the viewport\n     * @type Array\n     * @default\n     */\n    viewportTransform: fabric.iMatrix.concat(),\n\n    /**\n     * if set to false background image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    backgroundVpt: true,\n\n    /**\n     * if set to false overlya image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    overlayVpt: true,\n\n    /**\n     * Callback; invoked right before object is about to be scaled/rotated\n     */\n    onBeforeScaleRotate: function () {\n      /* NOOP */\n    },\n\n    /**\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n     */\n    enableRetinaScaling: true,\n\n    /**\n     * Describe canvas element extension over design\n     * properties are tl,tr,bl,br.\n     * if canvas is not zoomed/panned those points are the four corner of canvas\n     * if canvas is viewportTransformed you those points indicate the extension\n     * of canvas element in plain untrasformed coordinates\n     * The coordinates get updated with @method calcViewportBoundaries.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    vptCoords: { },\n\n    /**\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\n     * are not included in current viewport.\n     * May greatly help in applications with crowded canvas and use of zoom/pan\n     * If One of the corner of the bounding box of the object is on the canvas\n     * the objects get rendered.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    skipOffscreen: false,\n\n    /**\n     * @private\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     */\n    _initStatic: function(el, options) {\n      var cb = fabric.StaticCanvas.prototype.renderAll.bind(this);\n      this._objects = [];\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n      this._setImageSmoothing();\n      // only initialize retina scaling once\n      if (!this.interactive) {\n        this._initRetinaScaling();\n      }\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, cb);\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, cb);\n      }\n      if (options.backgroundColor) {\n        this.setBackgroundColor(options.backgroundColor, cb);\n      }\n      if (options.overlayColor) {\n        this.setOverlayColor(options.overlayColor, cb);\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * @private\n     */\n    _isRetinaScaling: function() {\n      return (fabric.devicePixelRatio !== 1 && this.enableRetinaScaling);\n    },\n\n    /**\n     * @private\n     * @return {Number} retinaScaling if applied, otherwise 1;\n     */\n    getRetinaScaling: function() {\n      return this._isRetinaScaling() ? fabric.devicePixelRatio : 1;\n    },\n\n    /**\n     * @private\n     */\n    _initRetinaScaling: function() {\n      if (!this._isRetinaScaling()) {\n        return;\n      }\n      this.lowerCanvasEl.setAttribute('width', this.width * fabric.devicePixelRatio);\n      this.lowerCanvasEl.setAttribute('height', this.height * fabric.devicePixelRatio);\n\n      this.contextContainer.scale(fabric.devicePixelRatio, fabric.devicePixelRatio);\n    },\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage with different properties</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage loaded from cross-origin</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setOverlayImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/YH9yD/|jsFiddle demo}\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage with different properties</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setBackgroundImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n     * @example <caption>Normal overlayColor - color value</caption>\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setOverlayColor: function(overlayColor, callback) {\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n     * @example <caption>Normal backgroundColor - color value</caption>\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setBackgroundColor: function(backgroundColor, callback) {\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\n    },\n\n    /**\n     * @private\n     * @see {@link http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-imagesmoothingenabled|WhatWG Canvas Standard}\n     */\n    _setImageSmoothing: function() {\n      var ctx = this.getContext();\n\n      ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\n        || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\n      ctx.imageSmoothingEnabled = this.imageSmoothingEnabled;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n     */\n    __setBgOverlayImage: function(property, image, callback, options) {\n      if (typeof image === 'string') {\n        fabric.util.loadImage(image, function(img) {\n          img && (this[property] = new fabric.Image(img, options));\n          callback && callback(img);\n        }, this, options && options.crossOrigin);\n      }\n      else {\n        options && image.setOptions(options);\n        this[property] = image;\n        callback && callback(image);\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\n     * @param {Function} [callback] Callback is invoked when color is set\n     */\n    __setBgOverlayColor: function(property, color, callback) {\n      this[property] = color;\n      this._initGradient(color, property);\n      this._initPattern(color, property, callback);\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _createCanvasElement: function(canvasEl) {\n      var element = fabric.util.createCanvasElement(canvasEl);\n      if (!element.style) {\n        element.style = { };\n      }\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n      return element;\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initOptions: function (options) {\n      this._setOptions(options);\n\n      this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0;\n      this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) {\n        return;\n      }\n\n      this.lowerCanvasEl.width = this.width;\n      this.lowerCanvasEl.height = this.height;\n\n      this.lowerCanvasEl.style.width = this.width + 'px';\n      this.lowerCanvasEl.style.height = this.height + 'px';\n\n      this.viewportTransform = this.viewportTransform.slice();\n    },\n\n    /**\n     * Creates a bottom canvas\n     * @private\n     * @param {HTMLElement} [canvasEl]\n     */\n    _createLowerCanvas: function (canvasEl) {\n      this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement(canvasEl);\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width (in px)\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height (in px)\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @param {Number|String} value                         Value to set width to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value, options) {\n      return this.setDimensions({ width: value }, options);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @param {Number|String} value                         Value to set height to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value, options) {\n      return this.setDimensions({ height: value }, options);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n     * @param {Object}        dimensions                    Object with width/height properties\n     * @param {Number|String} [dimensions.width]            Width of canvas element\n     * @param {Number|String} [dimensions.height]           Height of canvas element\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function (dimensions, options) {\n      var cssValue;\n\n      options = options || {};\n\n      for (var prop in dimensions) {\n        cssValue = dimensions[prop];\n\n        if (!options.cssOnly) {\n          this._setBackstoreDimension(prop, dimensions[prop]);\n          cssValue += 'px';\n        }\n\n        if (!options.backstoreOnly) {\n          this._setCssDimension(prop, cssValue);\n        }\n      }\n      this._initRetinaScaling();\n      this._setImageSmoothing();\n      this.calcOffset();\n\n      if (!options.cssOnly) {\n        this.renderAll();\n      }\n\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setBackstoreDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n      }\n\n      if (this.cacheCanvasEl) {\n        this.cacheCanvasEl[prop] = value;\n      }\n\n      this[prop] = value;\n\n      return this;\n    },\n\n    /**\n     * Helper for setting css width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {String} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setCssDimension: function (prop, value) {\n      this.lowerCanvasEl.style[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.style[prop] = value;\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value;\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns canvas zoom level\n     * @return {Number}\n     */\n    getZoom: function () {\n      return this.viewportTransform[0];\n    },\n\n    /**\n     * Sets viewport transform of this canvas instance\n     * @param {Array} vpt the transform in the form of context.transform\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setViewportTransform: function (vpt) {\n      var activeGroup = this._activeGroup, object, ignoreVpt = false, skipAbsolute = true;\n      this.viewportTransform = vpt;\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        object = this._objects[i];\n        object.group || object.setCoords(ignoreVpt, skipAbsolute);\n      }\n      if (activeGroup) {\n        activeGroup.setCoords(ignoreVpt, skipAbsolute);\n      }\n      this.calcViewportBoundaries();\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Sets zoom level of this canvas instance, zoom centered around point\n     * @param {fabric.Point} point to zoom with respect to\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    zoomToPoint: function (point, value) {\n      // TODO: just change the scale, preserve other transformations\n      var before = point, vpt = this.viewportTransform.slice(0);\n      point = transformPoint(point, invertTransform(this.viewportTransform));\n      vpt[0] = value;\n      vpt[3] = value;\n      var after = transformPoint(point, vpt);\n      vpt[4] += before.x - after.x;\n      vpt[5] += before.y - after.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Sets zoom level of this canvas instance\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setZoom: function (value) {\n      this.zoomToPoint(new fabric.Point(0, 0), value);\n      return this;\n    },\n\n    /**\n     * Pan viewport so as to place point at top left corner of canvas\n     * @param {fabric.Point} point to move to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    absolutePan: function (point) {\n      var vpt = this.viewportTransform.slice(0);\n      vpt[4] = -point.x;\n      vpt[5] = -point.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Pans viewpoint relatively\n     * @param {fabric.Point} point (position vector) to move by\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    relativePan: function (point) {\n      return this.absolutePan(new fabric.Point(\n        -point.x - this.viewportTransform[4],\n        -point.y - this.viewportTransform[5]\n      ));\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was added\n     */\n    _onObjectAdded: function(obj) {\n      this.stateful && obj.setupState();\n      obj._set('canvas', this);\n      obj.setCoords();\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      this.fire('object:removed', { target: obj });\n      obj.fire('removed');\n      delete obj.canvas;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @param {CanvasRenderingContext2D} ctx Context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this._objects.length = 0;\n      this.backgroundImage = null;\n      this.overlayImage = null;\n      this.backgroundColor = '';\n      this.overlayColor = '';\n      if (this._hasITextHandlers) {\n        this.off('mouse:up', this._mouseUpITextHandler);\n        this._iTextInstances = null;\n        this._hasITextHandlers = false;\n      }\n      this.clearContext(this.contextContainer);\n      this.fire('canvas:cleared');\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Renders the canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._objects);\n      return this;\n    },\n\n    /**\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\n     * helps to determinate when an object is in the current rendering viewport using\n     * object absolute coordinates ( aCoords )\n     * @return {Object} points.tl\n     * @chainable\n     */\n    calcViewportBoundaries: function() {\n      var points = { }, width = this.getWidth(), height = this.getHeight(),\n          iVpt = invertTransform(this.viewportTransform);\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n      points.br = transformPoint({ x: width, y: height }, iVpt);\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\n      this.vptCoords = points;\n      return points;\n    },\n\n    /**\n     * Renders background, objects, overlay and controls.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {Array} objects to render\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderCanvas: function(ctx, objects) {\n      this.calcViewportBoundaries();\n      this.clearContext(ctx);\n      this.fire('before:render');\n      if (this.clipTo) {\n        fabric.util.clipContext(this, ctx);\n      }\n      this._renderBackground(ctx);\n\n      ctx.save();\n      //apply viewport transform once for all rendering process\n      ctx.transform.apply(ctx, this.viewportTransform);\n      this._renderObjects(ctx, objects);\n      ctx.restore();\n      if (!this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      if (this.clipTo) {\n        ctx.restore();\n      }\n      this._renderOverlay(ctx);\n      if (this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      this.fire('after:render');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} objects to render\n     */\n    _renderObjects: function(ctx, objects) {\n      for (var i = 0, length = objects.length; i < length; ++i) {\n        objects[i] && objects[i].render(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {string} property 'background' or 'overlay'\n     */\n    _renderBackgroundOrOverlay: function(ctx, property) {\n      var object = this[property + 'Color'];\n      if (object) {\n        ctx.fillStyle = object.toLive\n          ? object.toLive(ctx, this)\n          : object;\n\n        ctx.fillRect(\n          object.offsetX || 0,\n          object.offsetY || 0,\n          this.width,\n          this.height);\n      }\n      object = this[property + 'Image'];\n      if (object) {\n        if (this[property + 'Vpt']) {\n          ctx.save();\n          ctx.transform.apply(ctx, this.viewportTransform);\n        }\n        object.render(ctx);\n        this[property + 'Vpt'] && ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'background');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderOverlay: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @return {Object} object with \"top\" and \"left\" number values\n     */\n    getCenter: function () {\n      return {\n        top: this.getHeight() / 2,\n        left: this.getWidth() / 2\n      };\n    },\n\n    /**\n     * Centers object horizontally in the canvas\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center horizontally\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      return this._centerObject(object, new fabric.Point(this.getCenter().left, object.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically in the canvas\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenter().top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the canvas\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function(object) {\n      var center = this.getCenter();\n\n      return this._centerObject(object, new fabric.Point(center.left, center.top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the viewport\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObject: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, vpCenter);\n    },\n\n    /**\n     * Centers object horizontally in the viewport, object.top is unchanged\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectH: function(object) {\n      var vpCenter = this.getVpCenter();\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\n      return this;\n    },\n\n    /**\n     * Centers object Vertically in the viewport, object.top is unchanged\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectV: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\n    },\n\n    /**\n     * Calculate the point in canvas that correspond to the center of actual viewport.\n     * @return {fabric.Point} vpCenter, viewport center\n     * @chainable\n     */\n    getVpCenter: function() {\n      var center = this.getCenter(),\n          iVpt = invertTransform(this.viewportTransform);\n      return transformPoint({ x: center.left, y: center.top }, iVpt);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} object Object to center\n     * @param {fabric.Point} center Center point\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    _centerObject: function(object, center) {\n      object.setPositionByOrigin(center, 'center', 'center');\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Returs dataless JSON representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {String} json string\n     */\n    toDatalessJSON: function (propertiesToInclude) {\n      return this.toDatalessObject(propertiesToInclude);\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toObject', propertiesToInclude);\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\n    },\n\n    /**\n     * @private\n     */\n    _toObjectMethod: function (methodName, propertiesToInclude) {\n\n      var data = {\n        objects: this._toObjects(methodName, propertiesToInclude)\n      };\n\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\n\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    _toObjects: function(methodName, propertiesToInclude) {\n      return this.getObjects().filter(function(object) {\n        return !object.excludeFromExport;\n      }).map(function(instance) {\n        return this._toObject(instance, methodName, propertiesToInclude);\n      }, this);\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      var originalValue;\n\n      if (!this.includeDefaultValues) {\n        originalValue = instance.includeDefaultValues;\n        instance.includeDefaultValues = false;\n      }\n\n      var object = instance[methodName](propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        instance.includeDefaultValues = originalValue;\n      }\n      return object;\n    },\n\n    /**\n     * @private\n     */\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\n      var data = { }, bgImage = this.backgroundImage, overlay = this.overlayImage;\n\n      if (this.backgroundColor) {\n        data.background = this.backgroundColor.toObject\n          ? this.backgroundColor.toObject(propertiesToInclude)\n          : this.backgroundColor;\n      }\n\n      if (this.overlayColor) {\n        data.overlay = this.overlayColor.toObject\n          ? this.overlayColor.toObject(propertiesToInclude)\n          : this.overlayColor;\n      }\n      if (bgImage && !bgImage.excludeFromExport) {\n        data.backgroundImage = this._toObject(bgImage, methodName, propertiesToInclude);\n      }\n      if (overlay && !overlay.excludeFromExport) {\n        data.overlayImage = this._toObject(overlay, methodName, propertiesToInclude);\n      }\n\n      return data;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n     * a zoomed canvas will then produce zoomed SVG output.\n     * @type Boolean\n     * @default\n     */\n    svgViewportTransformation: true,\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @param {Object} [options] Options object for SVG output\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n     * @param {Object} [options.viewBox] SVG viewbox object\n     * @param {Number} [options.viewBox.x] x-cooridnate of viewbox\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n     * @param {Number} [options.viewBox.width] Width of viewbox\n     * @param {Number} [options.viewBox.height] Height of viewbox\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n     * @param {String} [options.width] desired width of svg with or without units\n     * @param {String} [options.height] desired height of svg with or without units\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n     * @return {String} SVG string\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n     * @example <caption>Normal SVG output</caption>\n     * var svg = canvas.toSVG();\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n     * var svg = canvas.toSVG({suppressPreamble: true});\n     * @example <caption>SVG output with viewBox attribute</caption>\n     * var svg = canvas.toSVG({\n     *   viewBox: {\n     *     x: 100,\n     *     y: 100,\n     *     width: 200,\n     *     height: 300\n     *   }\n     * });\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n     * @example <caption>Modify SVG output with reviver function</caption>\n     * var svg = canvas.toSVG(null, function(svg) {\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n     * });\n     */\n    toSVG: function(options, reviver) {\n      options || (options = { });\n\n      var markup = [];\n\n      this._setSVGPreamble(markup, options);\n      this._setSVGHeader(markup, options);\n\n      this._setSVGBgOverlayColor(markup, 'backgroundColor');\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\n\n      this._setSVGObjects(markup, reviver);\n\n      this._setSVGBgOverlayColor(markup, 'overlayColor');\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\n\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _setSVGPreamble: function(markup, options) {\n      if (options.suppressPreamble) {\n        return;\n      }\n      markup.push(\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\n          '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n            '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n      );\n    },\n\n    /**\n     * @private\n     */\n    _setSVGHeader: function(markup, options) {\n      var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      if (options.viewBox) {\n        viewBox = 'viewBox=\"' +\n                options.viewBox.x + ' ' +\n                options.viewBox.y + ' ' +\n                options.viewBox.width + ' ' +\n                options.viewBox.height + '\" ';\n      }\n      else {\n        if (this.svgViewportTransformation) {\n          vpt = this.viewportTransform;\n          viewBox = 'viewBox=\"' +\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\n        }\n      }\n\n      markup.push(\n        '<svg ',\n          'xmlns=\"http://www.w3.org/2000/svg\" ',\n          'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n          'version=\"1.1\" ',\n          'width=\"', width, '\" ',\n          'height=\"', height, '\" ',\n          viewBox,\n          'xml:space=\"preserve\">\\n',\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\n        '<defs>\\n',\n          this.createSVGFontFacesMarkup(),\n          this.createSVGRefElementsMarkup(),\n        '</defs>\\n'\n      );\n    },\n\n    /**\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\n     * @return {String}\n     */\n    createSVGRefElementsMarkup: function() {\n      var _this = this,\n          markup = ['backgroundColor', 'overlayColor'].map(function(prop) {\n            var fill = _this[prop];\n            if (fill && fill.toLive) {\n              return fill.toSVG(_this, false);\n            }\n          });\n      return markup.join('');\n    },\n\n    /**\n     * Creates markup containing SVG font faces,\n     * font URLs for font faces must be collected by developers\n     * and are not extracted from the DOM by fabricjs\n     * @param {Array} objects Array of fabric objects\n     * @return {String}\n     */\n    createSVGFontFacesMarkup: function() {\n      var markup = '', fontList = { }, obj, fontFamily,\n          style, row, rowIndex, _char, charIndex,\n          fontPaths = fabric.fontPaths, objects = this.getObjects();\n\n      for (var i = 0, len = objects.length; i < len; i++) {\n        obj = objects[i];\n        fontFamily = obj.fontFamily;\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\n          continue;\n        }\n        fontList[fontFamily] = true;\n        if (!obj.styles) {\n          continue;\n        }\n        style = obj.styles;\n        for (rowIndex in style) {\n          row = style[rowIndex];\n          for (charIndex in row) {\n            _char = row[charIndex];\n            fontFamily = _char.fontFamily;\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n              fontList[fontFamily] = true;\n            }\n          }\n        }\n      }\n\n      for (var j in fontList) {\n        markup += [\n          '\\t\\t@font-face {\\n',\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\n          '\\t\\t}\\n'\n        ].join('');\n      }\n\n      if (markup) {\n        markup = [\n          '\\t<style type=\"text/css\">',\n          '<![CDATA[\\n',\n          markup,\n          ']]>',\n          '</style>\\n'\n        ].join('');\n      }\n\n      return markup;\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObjects: function(markup, reviver) {\n      var instance;\n      for (var i = 0, objects = this.getObjects(), len = objects.length; i < len; i++) {\n        instance = objects[i];\n        if (instance.excludeFromExport) {\n          continue;\n        }\n        this._setSVGObject(markup, instance, reviver);\n      }\n    },\n\n    /**\n     * push single object svg representation in the markup\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      markup.push(instance.toSVG(reviver));\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\n      if (this[property] && this[property].toSVG) {\n        markup.push(this[property].toSVG(reviver));\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayColor: function(markup, property) {\n      var filler = this[property];\n      if (!filler) {\n        return;\n      }\n      if (filler.toLive) {\n        var repeat = filler.repeat;\n        markup.push(\n          '<rect transform=\"translate(', this.width / 2, ',', this.height / 2, ')\"',\n            ' x=\"', filler.offsetX - this.width / 2, '\" y=\"', filler.offsetY - this.height / 2, '\" ',\n            'width=\"',\n              (repeat === 'repeat-y' || repeat === 'no-repeat'\n                ? filler.source.width\n                : this.width),\n            '\" height=\"',\n              (repeat === 'repeat-x' || repeat === 'no-repeat'\n                ? filler.source.height\n                : this.height),\n            '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n          '></rect>\\n'\n        );\n      }\n      else {\n        markup.push(\n          '<rect x=\"0\" y=\"0\" ',\n            'width=\"', this.width,\n            '\" height=\"', this.height,\n            '\" fill=\"', this[property], '\"',\n          '></rect>\\n'\n        );\n      }\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the bottom of the stack of drawn objects\n     * @param {fabric.Object} object Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeGroup = this._activeGroup,\n          i, obj, objs;\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.unshift(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.unshift(object);\n      }\n      return this.renderAll && this.renderAll();\n    },\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the top of the stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeGroup = this._activeGroup,\n          i, obj, objs;\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.push(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.push(object);\n      }\n      return this.renderAll && this.renderAll();\n    },\n\n    /**\n     * Moves an object or a selection down in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n\n      var activeGroup = this._activeGroup,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx > 0 + objsMoved) {\n            newIdx = idx - 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== 0) {\n          // if object is not on the bottom of stack\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderAll && this.renderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewLowerIndex: function(object, idx, intersecting) {\n      var newIdx;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (var i = idx - 1; i >= 0; --i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx - 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object or a selection up in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n\n      var activeGroup = this._activeGroup,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeGroup) {\n        objs = activeGroup._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx < this._objects.length - 1 - objsMoved) {\n            newIdx = idx + 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== this._objects.length - 1) {\n          // if object is not on top of stack (last item in an array)\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderAll && this.renderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewUpperIndex: function(object, idx, intersecting) {\n      var newIdx;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (var i = idx + 1; i < this._objects.length; ++i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx + 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Number} index Position to move to\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    moveTo: function (object, index) {\n      removeFromArray(this._objects, object);\n      this._objects.splice(index, 0, object);\n      return this.renderAll && this.renderAll();\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      this.clear();\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function () {\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\n               '{ objects: ' + this.getObjects().length + ' }>';\n    }\n  });\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @type String\n     * @default\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @param {String} methodName Method to check support for;\n     *                            Could be one of \"getImageData\", \"toDataURL\", \"toDataURLWithQuality\" or \"setLineDash\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = fabric.util.createCanvasElement();\n\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'getImageData':\n          return typeof ctx.getImageData !== 'undefined';\n\n        case 'setLineDash':\n          return typeof ctx.setLineDash !== 'undefined';\n\n        case 'toDataURL':\n          return typeof el.toDataURL !== 'undefined';\n\n        case 'toDataURLWithQuality':\n          try {\n            el.toDataURL('image/jpeg', 0);\n            return true;\n          }\n          catch (e) { }\n          return false;\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returns JSON representation of canvas\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {String} JSON string\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n})();\n\n\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\n\n  /**\n   * Color of a brush\n   * @type String\n   * @default\n   */\n  color: 'rgb(0, 0, 0)',\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 1,\n\n  /**\n   * Shadow object representing shadow of this shape.\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n   * @type fabric.Shadow\n   * @default\n   */\n  shadow: null,\n\n  /**\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n   * @type String\n   * @default\n   */\n  strokeLineCap: 'round',\n\n  /**\n   * Corner style of a brush (one of \"bevil\", \"round\", \"miter\")\n   * @type String\n   * @default\n   */\n  strokeLineJoin: 'round',\n\n  /**\n   * Stroke Dash Array.\n   * @type Array\n   * @default\n   */\n  strokeDashArray: null,\n\n  /**\n   * Sets shadow of an object\n   * @param {Object|String} [options] Options object or string (e.g. \"2px 2px 10px rgba(0,0,0,0.2)\")\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  setShadow: function(options) {\n    this.shadow = new fabric.Shadow(options);\n    return this;\n  },\n\n  /**\n   * Sets brush styles\n   * @private\n   */\n  _setBrushStyles: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = this.width;\n    ctx.lineCap = this.strokeLineCap;\n    ctx.lineJoin = this.strokeLineJoin;\n    if (this.strokeDashArray && fabric.StaticCanvas.supports('setLineDash')) {\n      ctx.setLineDash(this.strokeDashArray);\n    }\n  },\n\n  /**\n   * Sets brush shadow styles\n   * @private\n   */\n  _setShadow: function() {\n    if (!this.shadow) {\n      return;\n    }\n\n    var ctx = this.canvas.contextTop,\n        zoom = this.canvas.getZoom();\n\n    ctx.shadowColor = this.shadow.color;\n    ctx.shadowBlur = this.shadow.blur * zoom;\n    ctx.shadowOffsetX = this.shadow.offsetX * zoom;\n    ctx.shadowOffsetY = this.shadow.offsetY * zoom;\n  },\n\n  /**\n   * Removes brush shadow styles\n   * @private\n   */\n  _resetShadow: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.shadowColor = '';\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n  }\n});\n\n\n(function() {\n\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function(canvas) {\n      this.canvas = canvas;\n      this._points = [];\n    },\n\n    /**\n     * Inovoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function(pointer) {\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Inovoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function(pointer) {\n      this._captureDrawingPath(pointer);\n      // redraw curve\n      // clear top canvas\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._render();\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function() {\n      this._finalizeAndAddPath();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function(pointer) {\n\n      var p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n\n      this.canvas.contextTop.moveTo(p.x, p.y);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function(point) {\n      this._points.push(point);\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function() {\n      this._points.length = 0;\n\n      this._setBrushStyles();\n      this._setShadow();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function(pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     */\n    _render: function() {\n      var ctx  = this.canvas.contextTop, i, len,\n          v = this.canvas.viewportTransform,\n          p1 = this._points[0],\n          p2 = this._points[1];\n\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      ctx.beginPath();\n\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        var width = this.width / 1000;\n        p1 = new fabric.Point(p1.x, p1.y);\n        p2 = new fabric.Point(p2.x, p2.y);\n        p1.x -= width;\n        p2.x += width;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        var midPoint = p1.midPointFrom(p2);\n        ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @return {String} SVG path\n     */\n    convertPointsToSVGPath: function(points) {\n      var path = [], i, width = this.width / 1000,\n          p1 = new fabric.Point(points[0].x, points[0].y),\n          p2 = new fabric.Point(points[1].x, points[1].y),\n          len = points.length;\n\n      path.push('M ', p1.x - width, ' ', p1.y, ' ');\n      for (i = 1; i < len; i++) {\n        if (!p1.eq(p2)) {\n          var midPoint = p1.midPointFrom(p2);\n          // p1 is our bezier control point\n          // midpoint is our endpoint\n          // start point is p(i-1) value.\n          path.push('Q ', p1.x, ' ', p1.y, ' ', midPoint.x, ' ', midPoint.y, ' ');\n        }\n        p1 = points[i];\n        if ((i + 1) < points.length) {\n          p2 = points[i + 1];\n        }\n      }\n      path.push('L ', p1.x + width, ' ', p1.y, ' ');\n      return path;\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {String} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function(pathData) {\n      var path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n      });\n      var position = new fabric.Point(path.left + path.width / 2, path.top + path.height / 2);\n      position = path.translateToGivenOrigin(position, 'center', 'center', path.originX, path.originY);\n      path.top = position.y;\n      path.left = position.x;\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.setShadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function() {\n      var ctx = this.canvas.contextTop;\n      ctx.closePath();\n\n      var pathData = this.convertPointsToSVGPath(this._points).join('');\n      if (pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {\n        // do not create 0 width/height paths, as they are\n        // rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot,\n        // whereas Chrome 10 renders nothing\n        this.canvas.renderAll();\n        return;\n      }\n\n      var path = this.createPath(pathData);\n\n      this.canvas.add(path);\n      path.setCoords();\n\n      this.canvas.clearContext(this.canvas.contextTop);\n      this._resetShadow();\n      this.canvas.renderAll();\n\n      // fire event 'path' created\n      this.canvas.fire('path:created', { path: path });\n    }\n  });\n})();\n\n\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 10,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.CircleBrush} Instance of a circle brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.points = [];\n  },\n\n  /**\n   * Invoked inside on mouse down and mouse move\n   * @param {Object} pointer\n   */\n  drawDot: function(pointer) {\n    var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop,\n        v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n\n    ctx.fillStyle = point.fill;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse down\n   */\n  onMouseDown: function(pointer) {\n    this.points.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var circles = [];\n\n    for (var i = 0, len = this.points.length; i < len; i++) {\n      var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: 'center',\n            originY: 'center',\n            fill: point.fill\n          });\n\n      this.shadow && circle.setShadow(this.shadow);\n\n      circles.push(circle);\n    }\n    var group = new fabric.Group(circles, { originX: 'center', originY: 'center' });\n    group.canvas = this.canvas;\n\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.renderAll();\n  },\n\n  /**\n   * @param {Object} pointer\n   * @return {fabric.Point} Just added pointer point\n   */\n  addPoint: function(pointer) {\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n\n        circleRadius = fabric.util.getRandomInt(\n                        Math.max(0, this.width - 20), this.width + 20) / 2,\n\n        circleColor = new fabric.Color(this.color)\n                        .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n                        .toRgba();\n\n    pointerPoint.radius = circleRadius;\n    pointerPoint.fill = circleColor;\n\n    this.points.push(pointerPoint);\n\n    return pointerPoint;\n  }\n});\n\n\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\n\n  /**\n   * Width of a spray\n   * @type Number\n   * @default\n   */\n  width:              10,\n\n  /**\n   * Density of a spray (number of dots per chunk)\n   * @type Number\n   * @default\n   */\n  density:            20,\n\n  /**\n   * Width of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidth:           1,\n\n  /**\n   * Width variance of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidthVariance:   1,\n\n  /**\n   * Whether opacity of a dot should be random\n   * @type Boolean\n   * @default\n   */\n  randomOpacity:        false,\n\n  /**\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n   * @type Boolean\n   * @default\n   */\n  optimizeOverlapping:  true,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.SprayBrush} Instance of a spray brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.sprayChunks = [];\n  },\n\n  /**\n   * Invoked on mouse down\n   * @param {Object} pointer\n   */\n  onMouseDown: function(pointer) {\n    this.sprayChunks.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n\n    this.addSprayChunk(pointer);\n    this.render();\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    this.addSprayChunk(pointer);\n    this.render();\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var rects = [];\n\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      var sprayChunk = this.sprayChunks[i];\n\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n\n        var rect = new fabric.Rect({\n          width: sprayChunk[j].width,\n          height: sprayChunk[j].width,\n          left: sprayChunk[j].x + 1,\n          top: sprayChunk[j].y + 1,\n          originX: 'center',\n          originY: 'center',\n          fill: this.color\n        });\n\n        this.shadow && rect.setShadow(this.shadow);\n        rects.push(rect);\n      }\n    }\n\n    if (this.optimizeOverlapping) {\n      rects = this._getOptimizedRects(rects);\n    }\n\n    var group = new fabric.Group(rects, { originX: 'center', originY: 'center' });\n    group.canvas = this.canvas;\n\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.renderAll();\n  },\n\n  /**\n   * @private\n   * @param {Array} rects\n   */\n  _getOptimizedRects: function(rects) {\n\n    // avoid creating duplicate rects at the same coordinates\n    var uniqueRects = { }, key;\n\n    for (var i = 0, len = rects.length; i < len; i++) {\n      key = rects[i].left + '' + rects[i].top;\n      if (!uniqueRects[key]) {\n        uniqueRects[key] = rects[i];\n      }\n    }\n    var uniqueRectsArray = [];\n    for (key in uniqueRects) {\n      uniqueRectsArray.push(uniqueRects[key]);\n    }\n\n    return uniqueRectsArray;\n  },\n\n  /**\n   * Renders brush\n   */\n  render: function() {\n    var ctx = this.canvas.contextTop;\n    ctx.fillStyle = this.color;\n\n    var v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n\n    for (var i = 0, len = this.sprayChunkPoints.length; i < len; i++) {\n      var point = this.sprayChunkPoints[i];\n      if (typeof point.opacity !== 'undefined') {\n        ctx.globalAlpha = point.opacity;\n      }\n      ctx.fillRect(point.x, point.y, point.width, point.width);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * @param {Object} pointer\n   */\n  addSprayChunk: function(pointer) {\n    this.sprayChunkPoints = [];\n\n    var x, y, width, radius = this.width / 2;\n\n    for (var i = 0; i < this.density; i++) {\n\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n      if (this.dotWidthVariance) {\n        width = fabric.util.getRandomInt(\n          // bottom clamp width to 1\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\n          this.dotWidth + this.dotWidthVariance);\n      }\n      else {\n        width = this.dotWidth;\n      }\n\n      var point = new fabric.Point(x, y);\n      point.width = width;\n\n      if (this.randomOpacity) {\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n      }\n\n      this.sprayChunkPoints.push(point);\n    }\n\n    this.sprayChunks.push(this.sprayChunkPoints);\n  }\n});\n\n\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\n\n  getPatternSrc: function() {\n\n    var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.document.createElement('canvas'),\n        patternCtx = patternCanvas.getContext('2d');\n\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n    patternCtx.fillStyle = this.color;\n    patternCtx.beginPath();\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\n    patternCtx.closePath();\n    patternCtx.fill();\n\n    return patternCanvas;\n  },\n\n  getPatternSrcFunction: function() {\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\n  },\n\n  /**\n   * Creates \"pattern\" instance property\n   */\n  getPattern: function() {\n    return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), 'repeat');\n  },\n\n  /**\n   * Sets brush styles\n   */\n  _setBrushStyles: function() {\n    this.callSuper('_setBrushStyles');\n    this.canvas.contextTop.strokeStyle = this.getPattern();\n  },\n\n  /**\n   * Creates path\n   */\n  createPath: function(pathData) {\n    var path = this.callSuper('createPath', pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n    path.stroke = new fabric.Pattern({\n      source: this.source || this.getPatternSrcFunction(),\n      offsetX: -topLeft.x,\n      offsetY: -topLeft.y\n    });\n    return path;\n  }\n});\n\n\n(function() {\n\n  var getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      radiansToDegrees = fabric.util.radiansToDegrees,\n      atan2 = Math.atan2,\n      abs = Math.abs,\n      supportLineDash = fabric.StaticCanvas.supports('setLineDash'),\n\n      STROKE_OFFSET = 0.5;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:added\n   * @fires object:modified\n   * @fires object:rotating\n   * @fires object:scaling\n   * @fires object:moving\n   * @fires object:selected\n   *\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:created\n   *\n   * @fires path:created\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:over\n   * @fires mouse:out\n   *\n   */\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n\n      this._initStatic(el, options);\n      this._initInteractive();\n      this._createCacheCanvas();\n    },\n\n    /**\n     * When true, objects can be transformed by one side (unproportionally)\n     * @type Boolean\n     * @default\n     */\n    uniScaleTransform:      false,\n\n    /**\n     * Indicates which key enable unproportional scaling\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    uniScaleKey:           'shiftKey',\n\n    /**\n     * When true, objects use center point as the origin of scale transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:        false,\n\n    /**\n     * When true, objects use center point as the origin of rotate transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:       false,\n\n    /**\n     * Indicates which key enable centered Transfrom\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    centeredKey:           'altKey',\n\n    /**\n     * Indicates which key enable alternate action on corner\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    altActionKey:           'shiftKey',\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @type Boolean\n     * @default\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @type Boolean\n     * @default\n     */\n    selection:              true,\n\n    /**\n     * Indicates which key enable multiple click selection\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    selectionKey:           'shiftKey',\n\n    /**\n     * Indicates which key enable alternative selection\n     * in case of target overlapping with active object\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.5\n     * @type null|String\n     * @default\n     */\n    altSelectionKey:           null,\n\n    /**\n     * Color of selection\n     * @type String\n     * @default\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Default dash array pattern\n     * If not empty the selection border is dashed\n     * @type Array\n     */\n    selectionDashArray:     [],\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @type String\n     * @default\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @type Number\n     * @default\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @type String\n     * @default\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used during free drawing\n     * @type String\n     * @default\n     */\n    freeDrawingCursor:      'crosshair',\n\n    /**\n     * Cursor value used for rotation point\n     * @type String\n     * @default\n     */\n    rotationCursor:         'crosshair',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @type String\n     * @default\n     */\n    containerClass:         'canvas-container',\n\n    /**\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:     false,\n\n    /**\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\n     * @type Number\n     * @default\n     */\n    targetFindTolerance:    0,\n\n    /**\n     * When true, target detection is skipped when hovering over canvas. This can be used to improve performance.\n     * @type Boolean\n     * @default\n     */\n    skipTargetFind:         false,\n\n    /**\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n     * After mousedown, mousemove creates a shape,\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n     * @type Boolean\n     * @default\n     */\n    isDrawingMode:          false,\n\n    /**\n     * Indicates whether objects should remain in current stack position when selected.\n     * When false objects are brought to top and rendered as part of the selection group\n     * @type Boolean\n     * @default\n     */\n    preserveObjectStacking: false,\n\n    /**\n     * Indicates the angle that an object will lock to while rotating.\n     * @type Number\n     * @since 1.6.7\n     * @default\n     */\n    snapAngle: 0,\n\n    /**\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n     * When `null`, the snapThreshold will default to the snapAngle.\n     * @type null|Number\n     * @since 1.6.7\n     * @default\n     */\n    snapThreshold: null,\n\n    /**\n     * Indicates if the right click on canvas can output the context menu or not\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    stopContextMenu: false,\n\n    /**\n     * Indicates if the canvas can fire right click events\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    fireRightClick: false,\n\n    /**\n     * Indicates if the canvas can fire middle click events\n     * @type Boolean\n     * @since 1.7.8\n     * @default\n     */\n    fireMiddleClick: false,\n\n    /**\n     * @private\n     */\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEventListeners();\n\n      this._initRetinaScaling();\n\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n      this.calcOffset();\n    },\n\n    /**\n     * Divides objects in two groups, one to render immediately\n     * and one to render as activeGroup.\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n     */\n    _chooseObjectsToRender: function() {\n      var activeGroup = this.getActiveGroup(),\n          activeObject = this.getActiveObject(),\n          object, objsToRender = [], activeGroupObjects = [];\n\n      if ((activeGroup || activeObject) && !this.preserveObjectStacking) {\n        for (var i = 0, length = this._objects.length; i < length; i++) {\n          object = this._objects[i];\n          if ((!activeGroup || !activeGroup.contains(object)) && object !== activeObject) {\n            objsToRender.push(object);\n          }\n          else {\n            activeGroupObjects.push(object);\n          }\n        }\n        if (activeGroup) {\n          activeGroup._set('_objects', activeGroupObjects);\n          objsToRender.push(activeGroup);\n        }\n        activeObject && objsToRender.push(activeObject);\n      }\n      else {\n        objsToRender = this._objects;\n      }\n      return objsToRender;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\n        this.clearContext(this.contextTop);\n        this.contextTopDirty = false;\n      }\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n      return this;\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      var ctx = this.contextTop;\n      this.clearContext(ctx);\n\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection(ctx);\n      }\n\n      this.fire('after:render');\n      this.contextTopDirty = true;\n      return this;\n    },\n\n    /**\n     * Resets the current transform to its original values and chooses the type of resizing based on the event\n     * @private\n     */\n    _resetCurrentTransform: function() {\n      var t = this._currentTransform;\n\n      t.target.set({\n        scaleX: t.original.scaleX,\n        scaleY: t.original.scaleY,\n        skewX: t.original.skewX,\n        skewY: t.original.skewY,\n        left: t.original.left,\n        top: t.original.top\n      });\n\n      if (this._shouldCenterTransform(t.target)) {\n        if (t.action === 'rotate') {\n          this._setOriginToCenter(t.target);\n        }\n        else {\n          if (t.originX !== 'center') {\n            if (t.originX === 'right') {\n              t.mouseXSign = -1;\n            }\n            else {\n              t.mouseXSign = 1;\n            }\n          }\n          if (t.originY !== 'center') {\n            if (t.originY === 'bottom') {\n              t.mouseYSign = -1;\n            }\n            else {\n              t.mouseYSign = 1;\n            }\n          }\n\n          t.originX = 'center';\n          t.originY = 'center';\n        }\n      }\n      else {\n        t.originX = t.original.originX;\n        t.originY = t.original.originY;\n      }\n    },\n\n    /**\n     * Checks if point is contained within an area of given object\n     * @param {Event} e Event object\n     * @param {fabric.Object} target Object to test against\n     * @param {Object} [point] x,y object of point coordinates we want to check.\n     * @return {Boolean} true if point is contained within an area of given object\n     */\n    containsPoint: function (e, target, point) {\n      var ignoreZoom = true,\n          pointer = point || this.getPointer(e, ignoreZoom),\n          xy;\n\n      if (target.group && target.group === this.getActiveGroup()) {\n        xy = this._normalizePointer(target.group, pointer);\n      }\n      else {\n        xy = { x: pointer.x, y: pointer.y };\n      }\n      // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n      // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n      return (target.containsPoint(xy) || target._findTargetCorner(pointer));\n    },\n\n    /**\n     * @private\n     */\n    _normalizePointer: function (object, pointer) {\n      var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n      return fabric.util.transformPoint(vptPointer, invertedM);\n    },\n\n    /**\n     * Returns true if object is transparent at a certain location\n     * @param {fabric.Object} target Object to check\n     * @param {Number} x Left coordinate\n     * @param {Number} y Top coordinate\n     * @return {Boolean}\n     */\n    isTargetTransparent: function (target, x, y) {\n      var hasBorders = target.hasBorders,\n          transparentCorners = target.transparentCorners,\n          ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor;\n\n      target.hasBorders = target.transparentCorners = false;\n      target.selectionBackgroundColor = '';\n\n      ctx.save();\n      ctx.transform.apply(ctx, this.viewportTransform);\n      target.render(ctx);\n      ctx.restore();\n\n      target.active && target._renderControls(ctx);\n\n      target.hasBorders = hasBorders;\n      target.transparentCorners = transparentCorners;\n      target.selectionBackgroundColor = originalColor;\n\n      var isTransparent = fabric.util.isTransparent(\n        ctx, x, y, this.targetFindTolerance);\n\n      this.clearContext(ctx);\n\n      return isTransparent;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _shouldClearSelection: function (e, target) {\n      var activeGroup = this.getActiveGroup(),\n          activeObject = this.getActiveObject();\n\n      return (\n        !target\n        ||\n        (target &&\n          activeGroup &&\n          !activeGroup.contains(target) &&\n          activeGroup !== target &&\n          !e[this.selectionKey])\n        ||\n        (target && !target.evented)\n        ||\n        (target &&\n          !target.selectable &&\n          activeObject &&\n          activeObject !== target)\n      );\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} target\n     */\n    _shouldCenterTransform: function (target) {\n      if (!target) {\n        return;\n      }\n\n      var t = this._currentTransform,\n          centerTransform;\n\n      if (t.action === 'scale' || t.action === 'scaleX' || t.action === 'scaleY') {\n        centerTransform = this.centeredScaling || target.centeredScaling;\n      }\n      else if (t.action === 'rotate') {\n        centerTransform = this.centeredRotation || target.centeredRotation;\n      }\n\n      return centerTransform ? !t.altKey : t.altKey;\n    },\n\n    /**\n     * @private\n     */\n    _getOriginFromCorner: function(target, corner) {\n      var origin = {\n        x: target.originX,\n        y: target.originY\n      };\n\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\n        origin.x = 'right';\n      }\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\n        origin.x = 'left';\n      }\n\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\n        origin.y = 'bottom';\n      }\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\n        origin.y = 'top';\n      }\n\n      return origin;\n    },\n\n    /**\n     * @private\n     */\n    _getActionFromCorner: function(target, corner, e) {\n      if (!corner) {\n        return 'drag';\n      }\n\n      switch (corner) {\n        case 'mtr':\n          return 'rotate';\n        case 'ml':\n        case 'mr':\n          return e[this.altActionKey] ? 'skewY' : 'scaleX';\n        case 'mt':\n        case 'mb':\n          return e[this.altActionKey] ? 'skewX' : 'scaleY';\n        default:\n          return 'scale';\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _setupCurrentTransform: function (e, target) {\n      if (!target) {\n        return;\n      }\n\n      var pointer = this.getPointer(e),\n          corner = target._findTargetCorner(this.getPointer(e, true)),\n          action = this._getActionFromCorner(target, corner, e),\n          origin = this._getOriginFromCorner(target, corner);\n\n      this._currentTransform = {\n        target: target,\n        action: action,\n        corner: corner,\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        offsetX: pointer.x - target.left,\n        offsetY: pointer.y - target.top,\n        originX: origin.x,\n        originY: origin.y,\n        ex: pointer.x,\n        ey: pointer.y,\n        lastX: pointer.x,\n        lastY: pointer.y,\n        left: target.left,\n        top: target.top,\n        theta: degreesToRadians(target.angle),\n        width: target.width * target.scaleX,\n        mouseXSign: 1,\n        mouseYSign: 1,\n        shiftKey: e.shiftKey,\n        altKey: e[this.centeredKey]\n      };\n\n      this._currentTransform.original = {\n        left: target.left,\n        top: target.top,\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        originX: origin.x,\n        originY: origin.y\n      };\n\n      this._resetCurrentTransform();\n    },\n\n    /**\n     * Translates object by \"setting\" its left/top\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @return {Boolean} true if the translation occurred\n     */\n    _translateObject: function (x, y) {\n      var transform = this._currentTransform,\n          target = transform.target,\n          newLeft = x - transform.offsetX,\n          newTop = y - transform.offsetY,\n          moveX = !target.get('lockMovementX') && target.left !== newLeft,\n          moveY = !target.get('lockMovementY') && target.top !== newTop;\n\n      moveX && target.set('left', newLeft);\n      moveY && target.set('top', newTop);\n      return moveX || moveY;\n    },\n\n    /**\n     * Check if we are increasing a positive skew or lower it,\n     * checking mouse direction and pressed corner.\n     * @private\n     */\n    _changeSkewTransformOrigin: function(mouseMove, t, by) {\n      var property = 'originX', origins = { 0: 'center' },\n          skew = t.target.skewX, originA = 'left', originB = 'right',\n          corner = t.corner === 'mt' || t.corner === 'ml' ? 1 : -1,\n          flipSign = 1;\n\n      mouseMove = mouseMove > 0 ? 1 : -1;\n      if (by === 'y') {\n        skew = t.target.skewY;\n        originA = 'top';\n        originB = 'bottom';\n        property = 'originY';\n      }\n      origins[-1] = originA;\n      origins[1] = originB;\n\n      t.target.flipX && (flipSign *= -1);\n      t.target.flipY && (flipSign *= -1);\n\n      if (skew === 0) {\n        t.skewSign = -corner * mouseMove * flipSign;\n        t[property] = origins[-mouseMove];\n      }\n      else {\n        skew = skew > 0 ? 1 : -1;\n        t.skewSign = skew;\n        t[property] = origins[skew * corner * flipSign];\n      }\n    },\n\n    /**\n     * Skew object by mouse events\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @param {String} by Either 'x' or 'y'\n     * @return {Boolean} true if the skewing occurred\n     */\n    _skewObject: function (x, y, by) {\n      var t = this._currentTransform,\n          target = t.target, skewed = false,\n          lockSkewingX = target.get('lockSkewingX'),\n          lockSkewingY = target.get('lockSkewingY');\n\n      if ((lockSkewingX && by === 'x') || (lockSkewingY && by === 'y')) {\n        return false;\n      }\n\n      // Get the constraint point\n      var center = target.getCenterPoint(),\n          actualMouseByCenter = target.toLocalPoint(new fabric.Point(x, y), 'center', 'center')[by],\n          lastMouseByCenter = target.toLocalPoint(new fabric.Point(t.lastX, t.lastY), 'center', 'center')[by],\n          actualMouseByOrigin, constraintPosition, dim = target._getTransformedDimensions();\n\n      this._changeSkewTransformOrigin(actualMouseByCenter - lastMouseByCenter, t, by);\n      actualMouseByOrigin = target.toLocalPoint(new fabric.Point(x, y), t.originX, t.originY)[by];\n      constraintPosition = target.translateToOriginPoint(center, t.originX, t.originY);\n      // Actually skew the object\n      skewed = this._setObjectSkew(actualMouseByOrigin, t, by, dim);\n      t.lastX = x;\n      t.lastY = y;\n      // Make sure the constraints apply\n      target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n      return skewed;\n    },\n\n    /**\n     * Set object skew\n     * @private\n     * @return {Boolean} true if the skewing occurred\n     */\n    _setObjectSkew: function(localMouse, transform, by, _dim) {\n      var target = transform.target, newValue, skewed = false,\n          skewSign = transform.skewSign, newDim, dimNoSkew,\n          otherBy, _otherBy, _by, newDimMouse, skewX, skewY;\n\n      if (by === 'x') {\n        otherBy = 'y';\n        _otherBy = 'Y';\n        _by = 'X';\n        skewX = 0;\n        skewY = target.skewY;\n      }\n      else {\n        otherBy = 'x';\n        _otherBy = 'X';\n        _by = 'Y';\n        skewX = target.skewX;\n        skewY = 0;\n      }\n\n      dimNoSkew = target._getTransformedDimensions(skewX, skewY);\n      newDimMouse = 2 * Math.abs(localMouse) - dimNoSkew[by];\n      if (newDimMouse <= 2) {\n        newValue = 0;\n      }\n      else {\n        newValue = skewSign * Math.atan((newDimMouse / target['scale' + _by]) /\n                                        (dimNoSkew[otherBy] / target['scale' + _otherBy]));\n        newValue = fabric.util.radiansToDegrees(newValue);\n      }\n      skewed = target['skew' + _by] !== newValue;\n      target.set('skew' + _by, newValue);\n      if (target['skew' + _otherBy] !== 0) {\n        newDim = target._getTransformedDimensions();\n        newValue = (_dim[otherBy] / newDim[otherBy]) * target['scale' + _otherBy];\n        target.set('scale' + _otherBy, newValue);\n      }\n      return skewed;\n    },\n\n    /**\n     * Scales object by invoking its scaleX/scaleY methods\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.\n     *                    When not provided, an object is scaled by both dimensions equally\n     * @return {Boolean} true if the scaling occurred\n     */\n    _scaleObject: function (x, y, by) {\n      var t = this._currentTransform,\n          target = t.target,\n          lockScalingX = target.get('lockScalingX'),\n          lockScalingY = target.get('lockScalingY'),\n          lockScalingFlip = target.get('lockScalingFlip');\n\n      if (lockScalingX && lockScalingY) {\n        return false;\n      }\n\n      // Get the constraint point\n      var constraintPosition = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY),\n          localMouse = target.toLocalPoint(new fabric.Point(x, y), t.originX, t.originY),\n          dim = target._getTransformedDimensions(), scaled = false;\n\n      this._setLocalMouse(localMouse, t);\n\n      // Actually scale the object\n      scaled = this._setObjectScale(localMouse, t, lockScalingX, lockScalingY, by, lockScalingFlip, dim);\n\n      // Make sure the constraints apply\n      target.setPositionByOrigin(constraintPosition, t.originX, t.originY);\n      return scaled;\n    },\n\n    /**\n     * @private\n     * @return {Boolean} true if the scaling occurred\n     */\n    _setObjectScale: function(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {\n      var target = transform.target, forbidScalingX = false, forbidScalingY = false, scaled = false,\n          changeX, changeY, scaleX, scaleY;\n\n      scaleX = localMouse.x * target.scaleX / _dim.x;\n      scaleY = localMouse.y * target.scaleY / _dim.y;\n      changeX = target.scaleX !== scaleX;\n      changeY = target.scaleY !== scaleY;\n\n      if (lockScalingFlip && scaleX <= 0 && scaleX < target.scaleX) {\n        forbidScalingX = true;\n      }\n\n      if (lockScalingFlip && scaleY <= 0 && scaleY < target.scaleY) {\n        forbidScalingY = true;\n      }\n\n      if (by === 'equally' && !lockScalingX && !lockScalingY) {\n        forbidScalingX || forbidScalingY || (scaled = this._scaleObjectEqually(localMouse, target, transform, _dim));\n      }\n      else if (!by) {\n        forbidScalingX || lockScalingX || (target.set('scaleX', scaleX) && (scaled = scaled || changeX));\n        forbidScalingY || lockScalingY || (target.set('scaleY', scaleY) && (scaled = scaled || changeY));\n      }\n      else if (by === 'x' && !target.get('lockUniScaling')) {\n        forbidScalingX || lockScalingX || (target.set('scaleX', scaleX) && (scaled = scaled || changeX));\n      }\n      else if (by === 'y' && !target.get('lockUniScaling')) {\n        forbidScalingY || lockScalingY || (target.set('scaleY', scaleY) && (scaled = scaled || changeY));\n      }\n      transform.newScaleX = scaleX;\n      transform.newScaleY = scaleY;\n      forbidScalingX || forbidScalingY || this._flipObject(transform, by);\n      return scaled;\n    },\n\n    /**\n     * @private\n     * @return {Boolean} true if the scaling occurred\n     */\n    _scaleObjectEqually: function(localMouse, target, transform, _dim) {\n\n      var dist = localMouse.y + localMouse.x,\n          lastDist = _dim.y * transform.original.scaleY / target.scaleY +\n                     _dim.x * transform.original.scaleX / target.scaleX,\n          scaled, signX = localMouse.x / Math.abs(localMouse.x),\n          signY = localMouse.y / Math.abs(localMouse.y);\n\n      // We use transform.scaleX/Y instead of target.scaleX/Y\n      // because the object may have a min scale and we'll loose the proportions\n      transform.newScaleX = signX * Math.abs(transform.original.scaleX * dist / lastDist);\n      transform.newScaleY = signY * Math.abs(transform.original.scaleY * dist / lastDist);\n      scaled = transform.newScaleX !== target.scaleX || transform.newScaleY !== target.scaleY;\n      target.set('scaleX', transform.newScaleX);\n      target.set('scaleY', transform.newScaleY);\n      return scaled;\n    },\n\n    /**\n     * @private\n     */\n    _flipObject: function(transform, by) {\n      if (transform.newScaleX < 0 && by !== 'y') {\n        if (transform.originX === 'left') {\n          transform.originX = 'right';\n        }\n        else if (transform.originX === 'right') {\n          transform.originX = 'left';\n        }\n      }\n\n      if (transform.newScaleY < 0 && by !== 'x') {\n        if (transform.originY === 'top') {\n          transform.originY = 'bottom';\n        }\n        else if (transform.originY === 'bottom') {\n          transform.originY = 'top';\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setLocalMouse: function(localMouse, t) {\n      var target = t.target, zoom = this.getZoom(),\n          padding = target.padding / zoom;\n\n      if (t.originX === 'right') {\n        localMouse.x *= -1;\n      }\n      else if (t.originX === 'center') {\n        localMouse.x *= t.mouseXSign * 2;\n        if (localMouse.x < 0) {\n          t.mouseXSign = -t.mouseXSign;\n        }\n      }\n\n      if (t.originY === 'bottom') {\n        localMouse.y *= -1;\n      }\n      else if (t.originY === 'center') {\n        localMouse.y *= t.mouseYSign * 2;\n        if (localMouse.y < 0) {\n          t.mouseYSign = -t.mouseYSign;\n        }\n      }\n\n      // adjust the mouse coordinates when dealing with padding\n      if (abs(localMouse.x) > padding) {\n        if (localMouse.x < 0) {\n          localMouse.x += padding;\n        }\n        else {\n          localMouse.x -= padding;\n        }\n      }\n      else { // mouse is within the padding, set to 0\n        localMouse.x = 0;\n      }\n\n      if (abs(localMouse.y) > padding) {\n        if (localMouse.y < 0) {\n          localMouse.y += padding;\n        }\n        else {\n          localMouse.y -= padding;\n        }\n      }\n      else {\n        localMouse.y = 0;\n      }\n    },\n\n    /**\n     * Rotates object by invoking its rotate method\n     * @private\n     * @param {Number} x pointer's x coordinate\n     * @param {Number} y pointer's y coordinate\n     * @return {Boolean} true if the rotation occurred\n     */\n    _rotateObject: function (x, y) {\n\n      var t = this._currentTransform;\n\n      if (t.target.get('lockRotation')) {\n        return false;\n      }\n\n      var lastAngle = atan2(t.ey - t.top, t.ex - t.left),\n          curAngle = atan2(y - t.top, x - t.left),\n          angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n          hasRoated = true;\n\n      if (t.target.snapAngle > 0) {\n        var snapAngle  = t.target.snapAngle,\n            snapThreshold  = t.target.snapThreshold || snapAngle,\n            rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n            leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n        if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n          angle = leftAngleLocked;\n        }\n        else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n          angle = rightAngleLocked;\n        }\n      }\n\n      // normalize angle to positive value\n      if (angle < 0) {\n        angle = 360 + angle;\n      }\n      angle %= 360;\n\n      if (t.target.angle === angle) {\n        hasRoated = false;\n      }\n      else {\n        t.target.angle = angle;\n      }\n\n      return hasRoated;\n    },\n\n    /**\n     * Set the cursor type of the canvas element\n     * @param {String} value Cursor type of the canvas element.\n     * @see http://www.w3.org/TR/css3-ui/#cursor\n     */\n    setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * @param {fabric.Object} target to reset transform\n     * @private\n     */\n    _resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.setAngle(0);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\n     */\n    _drawSelection: function (ctx) {\n      var groupSelector = this._groupSelector,\n          left = groupSelector.left,\n          top = groupSelector.top,\n          aleft = abs(left),\n          atop = abs(top);\n\n      if (this.selectionColor) {\n        ctx.fillStyle = this.selectionColor;\n\n        ctx.fillRect(\n          groupSelector.ex - ((left > 0) ? 0 : -left),\n          groupSelector.ey - ((top > 0) ? 0 : -top),\n          aleft,\n          atop\n        );\n      }\n\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\n        return;\n      }\n      ctx.lineWidth = this.selectionLineWidth;\n      ctx.strokeStyle = this.selectionBorderColor;\n\n      // selection border\n      if (this.selectionDashArray.length > 1 && !supportLineDash) {\n\n        var px = groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n            py = groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop);\n\n        ctx.beginPath();\n\n        fabric.util.drawDashedLine(ctx, px, py, px + aleft, py, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py + atop - 1, px + aleft, py + atop - 1, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py, px, py + atop, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px + aleft - 1, py, px + aleft - 1, py + atop, this.selectionDashArray);\n\n        ctx.closePath();\n        ctx.stroke();\n      }\n      else {\n        fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\n        ctx.strokeRect(\n          groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n          groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop),\n          aleft,\n          atop\n        );\n      }\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * the skipGroup parameter is for internal use, is needed for shift+click action\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n     */\n    findTarget: function (e, skipGroup) {\n      if (this.skipTargetFind) {\n        return;\n      }\n\n      var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeGroup = this.getActiveGroup(),\n          activeObject = this.getActiveObject(),\n          activeTarget, activeTargetSubs;\n      // first check current group (if one exists)\n      // active group does not check sub targets like normal groups.\n      // if active group just exits.\n      this.targets = [];\n      if (activeGroup && !skipGroup && activeGroup === this._searchPossibleTargets([activeGroup], pointer)) {\n        this._fireOverOutEvents(activeGroup, e);\n        return activeGroup;\n      }\n      // if we hit the corner of an activeObject, let's return that.\n      if (activeObject && activeObject._findTargetCorner(pointer)) {\n        this._fireOverOutEvents(activeObject, e);\n        return activeObject;\n      }\n      if (activeObject && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        if (!this.preserveObjectStacking) {\n          this._fireOverOutEvents(activeObject, e);\n          return activeObject;\n        }\n        else {\n          activeTarget = activeObject;\n          activeTargetSubs = this.targets;\n          this.targets = [];\n        }\n      }\n\n      var target = this._searchPossibleTargets(this._objects, pointer);\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\n        target = activeTarget;\n        this.targets = activeTargetSubs;\n      }\n      this._fireOverOutEvents(target, e);\n      return target;\n    },\n\n    /**\n     * @private\n     */\n    _fireOverOutEvents: function(target, e) {\n      var overOpt, outOpt, hoveredTarget = this._hoveredTarget;\n      if (hoveredTarget !== target) {\n        overOpt = { e: e, target: target, previousTarget: this._hoveredTarget };\n        outOpt = { e: e, target: this._hoveredTarget, nextTarget: target };\n        this._hoveredTarget = target;\n      }\n      if (target) {\n        if (hoveredTarget !== target) {\n          if (hoveredTarget) {\n            this.fire('mouse:out', outOpt);\n            hoveredTarget.fire('mouseout', outOpt);\n          }\n          this.fire('mouse:over', overOpt);\n          target.fire('mouseover', overOpt);\n        }\n      }\n      else if (hoveredTarget) {\n        this.fire('mouse:out', outOpt);\n        hoveredTarget.fire('mouseout', outOpt);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _checkTarget: function(pointer, obj) {\n      if (obj &&\n          obj.visible &&\n          obj.evented &&\n          this.containsPoint(null, obj, pointer)){\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\n          var isTransparent = this.isTargetTransparent(obj, pointer.x, pointer.y);\n          if (!isTransparent) {\n            return true;\n          }\n        }\n        else {\n          return true;\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _searchPossibleTargets: function(objects, pointer) {\n\n      // Cache all targets where their bounding box contains point.\n      var target, i = objects.length, normalizedPointer, subTarget;\n      // Do not check for currently grouped objects, since we check the parent group itself.\n      // untill we call this function specifically to search inside the activeGroup\n      while (i--) {\n        if (this._checkTarget(pointer, objects[i])) {\n          target = objects[i];\n          if (target.type === 'group' && target.subTargetCheck) {\n            normalizedPointer = this._normalizePointer(target, pointer);\n            subTarget = this._searchPossibleTargets(target._objects, normalizedPointer);\n            subTarget && this.targets.push(subTarget);\n          }\n          break;\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Returns pointer coordinates without the effect of the viewport\n     * @param {Object} pointer with \"x\" and \"y\" number values\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    restorePointerVpt: function(pointer) {\n      return fabric.util.transformPoint(\n        pointer,\n        fabric.util.invertTransform(this.viewportTransform)\n      );\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * Can return coordinates with or without viewportTransform.\n     * ignoreZoom false gives back coordinates that represent\n     * the point clicked on canvas element.\n     * ignoreZoom true gives back coordinates after being processed\n     * by the viewportTransform ( sort of coordinates of what is displayed\n     * on the canvas where you are clicking.\n     * To interact with your shapes top and left you want to use ignoreZoom true\n     * most of the time, while ignoreZoom false will give you coordinates\n     * compatible with the object.oCoords system.\n     * of the time.\n     * @param {Event} e\n     * @param {Boolean} ignoreZoom\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e, ignoreZoom, upperCanvasEl) {\n      if (!upperCanvasEl) {\n        upperCanvasEl = this.upperCanvasEl;\n      }\n      var pointer = getPointer(e),\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n      if (!boundsWidth || !boundsHeight ) {\n        if ('top' in bounds && 'bottom' in bounds) {\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\n        }\n        if ('right' in bounds && 'left' in bounds) {\n          boundsWidth = Math.abs( bounds.right - bounds.left );\n        }\n      }\n\n      this.calcOffset();\n\n      pointer.x = pointer.x - this._offset.left;\n      pointer.y = pointer.y - this._offset.top;\n      if (!ignoreZoom) {\n        pointer = this.restorePointerVpt(pointer);\n      }\n\n      if (boundsWidth === 0 || boundsHeight === 0) {\n        // If bounds are not available (i.e. not visible), do not apply scale.\n        cssScale = { width: 1, height: 1 };\n      }\n      else {\n        cssScale = {\n          width: upperCanvasEl.width / boundsWidth,\n          height: upperCanvasEl.height / boundsHeight\n        };\n      }\n\n      return {\n        x: pointer.x * cssScale.width,\n        y: pointer.y * cssScale.height\n      };\n    },\n\n    /**\n     * @private\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, '');\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.className = '';\n      }\n      else {\n        this.upperCanvasEl = this._createCanvasElement();\n      }\n      fabric.util.addClass(this.upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\n\n      this.wrapperEl.appendChild(this.upperCanvasEl);\n\n      this._copyCanvasStyle(this.lowerCanvasEl, this.upperCanvasEl);\n      this._applyCanvasStyle(this.upperCanvasEl);\n      this.contextTop = this.upperCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.getWidth() + 'px',\n        height: this.getHeight() + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @param {HTMLElement} element canvas element to apply styles on\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.getWidth() || element.width,\n          height = this.getHeight() || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0,\n        'touch-action': 'none'\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Copys the the entire inline style from one element (fromEl) to another (toEl)\n     * @private\n     * @param {Element} fromEl Element style is copied from\n     * @param {Element} toEl Element copied style is applied to\n     */\n    _copyCanvasStyle: function (fromEl, toEl) {\n      toEl.style.cssText = fromEl.style.cssText;\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _setActiveObject: function(object) {\n      var obj = this._activeObject;\n      if (obj) {\n        obj.set('active', false);\n        if (object !== obj && obj.onDeselect && typeof obj.onDeselect === 'function') {\n          obj.onDeselect();\n        }\n      }\n      this._activeObject = object;\n      object.set('active', true);\n    },\n\n    /**\n     * Sets given object as the only active object on canvas\n     * @param {fabric.Object} object Object to set as an active one\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      var currentActiveObject = this.getActiveObject();\n      if (currentActiveObject && currentActiveObject !== object) {\n        currentActiveObject.fire('deselected', { e: e });\n      }\n      this._setActiveObject(object);\n      this.fire('object:selected', { target: object, e: e });\n      object.fire('selected', { e: e });\n      this.renderAll();\n      return this;\n    },\n\n    /**\n     * Returns currently active object\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      // removing active object should fire \"selection:cleared\" events\n      if (this.getActiveObject() === obj) {\n        this.fire('before:selection:cleared', { target: obj });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { target: obj });\n        obj.fire('deselected');\n      }\n      if (this._hoveredTarget === obj) {\n        this._hoveredTarget = null;\n      }\n      this.callSuper('_onObjectRemoved', obj);\n    },\n\n    /**\n     * @private\n     */\n    _discardActiveObject: function() {\n      var obj = this._activeObject;\n      if (obj) {\n        obj.set('active', false);\n        if (obj.onDeselect && typeof obj.onDeselect === 'function') {\n          obj.onDeselect();\n        }\n      }\n      this._activeObject = null;\n    },\n\n    /**\n     * Discards currently active object and fire events. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {event} e\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function (e) {\n      var activeObject = this._activeObject;\n      if (activeObject) {\n        this.fire('before:selection:cleared', { target: activeObject, e: e });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { e: e });\n        activeObject.fire('deselected', { e: e });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Group} group\n     */\n    _setActiveGroup: function(group) {\n      this._activeGroup = group;\n      if (group) {\n        group.set('active', true);\n      }\n    },\n\n    /**\n     * Sets active group to a specified one. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {fabric.Group} group Group to set as a current one\n     * @param {Event} e Event object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveGroup: function (group, e) {\n      this._setActiveGroup(group);\n      if (group) {\n        this.fire('object:selected', { target: group, e: e });\n        group.fire('selected', { e: e });\n      }\n      return this;\n    },\n\n    /**\n     * Returns currently active group\n     * @return {fabric.Group} Current group\n     */\n    getActiveGroup: function () {\n      return this._activeGroup;\n    },\n\n    /**\n     * @private\n     */\n    _discardActiveGroup: function() {\n      var g = this.getActiveGroup();\n      if (g) {\n        g.destroy();\n      }\n      this.setActiveGroup(null);\n    },\n\n    /**\n     * Discards currently active group and fire events If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveGroup: function (e) {\n      var g = this.getActiveGroup();\n      if (g) {\n        this.fire('before:selection:cleared', { e: e, target: g });\n        this._discardActiveGroup();\n        this.fire('selection:cleared', { e: e });\n      }\n      return this;\n    },\n\n    /**\n     * Deactivates all objects on canvas, removing any active group or object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    deactivateAll: function () {\n      var allObjects = this.getObjects(),\n          i = 0,\n          len = allObjects.length,\n          obj;\n      for ( ; i < len; i++) {\n        obj = allObjects[i];\n        obj && obj.set('active', false);\n      }\n      this._discardActiveGroup();\n      this._discardActiveObject();\n      return this;\n    },\n\n    /**\n     * Deactivates all objects and dispatches appropriate events If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parmater and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    deactivateAllWithDispatch: function (e) {\n      var allObjects = this.getObjects(),\n          i = 0,\n          len = allObjects.length,\n          obj;\n      for ( ; i < len; i++) {\n        obj = allObjects[i];\n        obj && obj.set('active', false);\n      }\n      this.discardActiveGroup(e);\n      this.discardActiveObject(e);\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      fabric.StaticCanvas.prototype.dispose.call(this);\n      var wrapper = this.wrapperEl;\n      this.removeListeners();\n      wrapper.removeChild(this.upperCanvasEl);\n      wrapper.removeChild(this.lowerCanvasEl);\n      delete this.upperCanvasEl;\n      if (wrapper.parentNode) {\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n      }\n      delete this.wrapperEl;\n      return this;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this.discardActiveGroup();\n      this.discardActiveObject();\n      this.clearContext(this.contextTop);\n      return this.callSuper('clear');\n    },\n\n    /**\n     * Draws objects' controls (borders/controls)\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeGroup = this.getActiveGroup();\n\n      if (activeGroup) {\n        activeGroup._renderControls(ctx);\n      }\n      else {\n        this._drawObjectsControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _drawObjectsControls: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; ++i) {\n        if (!this._objects[i] || !this._objects[i].active) {\n          continue;\n        }\n        this._objects[i]._renderControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      //If the object is part of the current selection group, it should\n      //be transformed appropriately\n      //i.e. it should be serialised as it would appear if the selection group\n      //were to be destroyed.\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\n      //Undo the damage we did by changing all of its properties\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n      return object;\n    },\n\n    /**\n     * Realises an object's group transformation on it\n     * @private\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\n     * @returns the original values of instance which were changed\n     */\n    _realizeGroupTransformOnObject: function(instance) {\n      if (instance.group && instance.group === this.getActiveGroup()) {\n        //Copy all the positionally relevant properties across now\n        var originalValues = {},\n            layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\n        layoutProps.forEach(function(prop) {\n          originalValues[prop] = instance[prop];\n        });\n        this.getActiveGroup().realizeTransform(instance);\n        return originalValues;\n      }\n      else {\n        return null;\n      }\n    },\n\n    /**\n     * Restores the changed properties of instance\n     * @private\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n     */\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\n      if (originalValues) {\n        instance.set(originalValues);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      var originalProperties;\n      //If the object is in a selection group, simulate what would happen to that\n      //object when the group is deselected\n      originalProperties = this._realizeGroupTransformOnObject(instance);\n      this.callSuper('_setSVGObject', markup, instance, reviver);\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n    },\n  });\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n\n  if (fabric.isTouchSupported) {\n    /** @ignore */\n    fabric.Canvas.prototype._setCursorFromEvent = function() { };\n  }\n\n  /**\n   * @ignore\n   * @class fabric.Element\n   * @alias fabric.Canvas\n   * @deprecated Use {@link fabric.Canvas} instead.\n   * @constructor\n   */\n  fabric.Element = fabric.Canvas;\n})();\n\n\n(function() {\n\n  var cursorOffset = {\n        mt: 0, // n\n        tr: 1, // ne\n        mr: 2, // e\n        br: 3, // se\n        mb: 4, // s\n        bl: 5, // sw\n        ml: 6, // w\n        tl: 7 // nw\n      },\n      addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1;\n\n  function checkClick(e, value) {\n    return 'which' in e ? e.which === value : e.button === value - 1;\n  }\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Map of cursor style values for each of the object controls\n     * @private\n     */\n    cursorMap: [\n      'n-resize',\n      'ne-resize',\n      'e-resize',\n      'se-resize',\n      's-resize',\n      'sw-resize',\n      'w-resize',\n      'nw-resize'\n    ],\n\n    /**\n     * Adds mouse listeners to canvas\n     * @private\n     */\n    _initEventListeners: function () {\n      // in case we initialized the class twice. This should not happen normally\n      // but in some kind of applications where the canvas element may be changed\n      // this is a workaround to having double listeners.\n      this.removeListeners();\n      this._bindEvents();\n\n      addListener(fabric.window, 'resize', this._onResize);\n\n      // mouse events\n      addListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      addListener(this.upperCanvasEl, 'mouseout', this._onMouseOut);\n      addListener(this.upperCanvasEl, 'mouseenter', this._onMouseEnter);\n      addListener(this.upperCanvasEl, 'wheel', this._onMouseWheel);\n      addListener(this.upperCanvasEl, 'contextmenu', this._onContextMenu);\n\n      // touch events\n      addListener(this.upperCanvasEl, 'touchstart', this._onMouseDown, { passive: false });\n      addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove, { passive: false });\n\n      if (typeof eventjs !== 'undefined' && 'add' in eventjs) {\n        eventjs.add(this.upperCanvasEl, 'gesture', this._onGesture);\n        eventjs.add(this.upperCanvasEl, 'drag', this._onDrag);\n        eventjs.add(this.upperCanvasEl, 'orientation', this._onOrientationChange);\n        eventjs.add(this.upperCanvasEl, 'shake', this._onShake);\n        eventjs.add(this.upperCanvasEl, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _bindEvents: function() {\n      if (this.eventsBinded) {\n        // for any reason we pass here twice we do not want to bind events twice.\n        return;\n      }\n      this._onMouseDown = this._onMouseDown.bind(this);\n      this._onMouseMove = this._onMouseMove.bind(this);\n      this._onMouseUp = this._onMouseUp.bind(this);\n      this._onResize = this._onResize.bind(this);\n      this._onGesture = this._onGesture.bind(this);\n      this._onDrag = this._onDrag.bind(this);\n      this._onShake = this._onShake.bind(this);\n      this._onLongPress = this._onLongPress.bind(this);\n      this._onOrientationChange = this._onOrientationChange.bind(this);\n      this._onMouseWheel = this._onMouseWheel.bind(this);\n      this._onMouseOut = this._onMouseOut.bind(this);\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onContextMenu = this._onContextMenu.bind(this);\n      this.eventsBinded = true;\n    },\n\n    /**\n     * Removes all event listeners\n     */\n    removeListeners: function() {\n      removeListener(fabric.window, 'resize', this._onResize);\n\n      removeListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      removeListener(this.upperCanvasEl, 'mouseout', this._onMouseOut);\n      removeListener(this.upperCanvasEl, 'mouseenter', this._onMouseEnter);\n      removeListener(this.upperCanvasEl, 'wheel', this._onMouseWheel);\n      removeListener(this.upperCanvasEl, 'contextmenu', this._onContextMenu);\n\n      removeListener(this.upperCanvasEl, 'touchstart', this._onMouseDown);\n      removeListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);\n\n      if (typeof eventjs !== 'undefined' && 'remove' in eventjs) {\n        eventjs.remove(this.upperCanvasEl, 'gesture', this._onGesture);\n        eventjs.remove(this.upperCanvasEl, 'drag', this._onDrag);\n        eventjs.remove(this.upperCanvasEl, 'orientation', this._onOrientationChange);\n        eventjs.remove(this.upperCanvasEl, 'shake', this._onShake);\n        eventjs.remove(this.upperCanvasEl, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js gesture\n     * @param {Event} [self] Inner Event object\n     */\n    _onGesture: function(e, self) {\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js drag\n     * @param {Event} [self] Inner Event object\n     */\n    _onDrag: function(e, self) {\n      this.__onDrag && this.__onDrag(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on wheel event\n     */\n    _onMouseWheel: function(e) {\n      this.__onMouseWheel(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseOut: function(e) {\n      var target = this._hoveredTarget;\n      this.fire('mouse:out', { target: target, e: e });\n      this._hoveredTarget = null;\n      target && target.fire('mouseout', { e: e });\n      if (this._iTextInstances) {\n        this._iTextInstances.forEach(function(obj) {\n          if (obj.isEditing) {\n            obj.hiddenTextarea.focus();\n          }\n        });\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseenter\n     */\n    _onMouseEnter: function(e) {\n      if (!this.findTarget(e)) {\n        this.fire('mouse:over', { target: null, e: e });\n        this._hoveredTarget = null;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js orientation change\n     * @param {Event} [self] Inner Event object\n     */\n    _onOrientationChange: function(e, self) {\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onShake: function(e, self) {\n      this.__onShake && this.__onShake(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onLongPress: function(e, self) {\n      this.__onLongPress && this.__onLongPress(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onContextMenu: function (e) {\n      if (this.stopContextMenu) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDown: function (e) {\n      this.__onMouseDown(e);\n\n      addListener(fabric.document, 'touchend', this._onMouseUp, { passive: false });\n      addListener(fabric.document, 'touchmove', this._onMouseMove, { passive: false });\n\n      removeListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      removeListener(this.upperCanvasEl, 'touchmove', this._onMouseMove);\n\n      if (e.type === 'touchstart') {\n        // Unbind mousedown to prevent double triggers from touch devices\n        removeListener(this.upperCanvasEl, 'mousedown', this._onMouseDown);\n      }\n      else {\n        addListener(fabric.document, 'mouseup', this._onMouseUp);\n        addListener(fabric.document, 'mousemove', this._onMouseMove);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUp: function (e) {\n      this.__onMouseUp(e);\n\n      removeListener(fabric.document, 'mouseup', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onMouseUp);\n\n      removeListener(fabric.document, 'mousemove', this._onMouseMove);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove);\n\n      addListener(this.upperCanvasEl, 'mousemove', this._onMouseMove);\n      addListener(this.upperCanvasEl, 'touchmove', this._onMouseMove, { passive: false });\n\n      if (e.type === 'touchend') {\n        // Wait 400ms before rebinding mousedown to prevent double triggers\n        // from touch devices\n        var _this = this;\n        setTimeout(function() {\n          addListener(_this.upperCanvasEl, 'mousedown', _this._onMouseDown);\n        }, 400);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMove: function (e) {\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n      this.__onMouseMove(e);\n    },\n\n    /**\n     * @private\n     */\n    _onResize: function () {\n      this.calcOffset();\n    },\n\n    /**\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n     * @private\n     * @param {Object} target\n     * @param {Object} pointer\n     */\n    _shouldRender: function(target, pointer) {\n      var activeObject = this.getActiveGroup() || this.getActiveObject();\n\n      if (activeObject && activeObject.isEditing && target === activeObject) {\n        // if we mouse up/down over a editing textbox a cursor change,\n        // there is no need to re render\n        return false;\n      }\n      return !!(\n        (target && (\n          target.isMoving ||\n          target !== activeObject))\n        ||\n        (!target && !!activeObject)\n        ||\n        (!target && !activeObject && !this._groupSelector)\n        ||\n        (pointer &&\n          this._previousPointer &&\n          this.selection && (\n          pointer.x !== this._previousPointer.x ||\n          pointer.y !== this._previousPointer.y))\n      );\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseUp: function (e) {\n\n      var target;\n      // if right/middle click just fire events and return\n      // target undefined will make the _handleEvent search the target\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'up', target, RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'up', target, MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._onMouseUpInDrawingMode(e);\n        return;\n      }\n\n      var searchTarget = true, transform = this._currentTransform,\n          groupSelector = this._groupSelector,\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\n\n      if (transform) {\n        this._finalizeCurrentTransform(e);\n        searchTarget = !transform.actionPerformed;\n      }\n\n      target = searchTarget ? this.findTarget(e, true) : transform.target;\n\n      var shouldRender = this._shouldRender(target, this.getPointer(e));\n\n      if (target || !isClick) {\n        this._maybeGroupObjects(e);\n      }\n      else {\n        // those are done by default on mouse up\n        // by _maybeGroupObjects, we are skipping it in case of no target find\n        this._groupSelector = null;\n        this._currentTransform = null;\n      }\n\n      if (target) {\n        target.isMoving = false;\n      }\n      this._setCursorFromEvent(e, target);\n      this._handleEvent(e, 'up', target ? target : null, LEFT_CLICK, isClick);\n      target && (target.__corner = 0);\n      shouldRender && this.renderAll();\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @param {fabric.Object} targetObj receiving event\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n     */\n    _handleEvent: function(e, eventType, targetObj, button, isClick) {\n      var target = typeof targetObj === 'undefined' ? this.findTarget(e) : targetObj,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false\n          };\n      this.fire('mouse:' + eventType, options);\n      target && target.fire('mouse' + eventType, options);\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire('mouse' + eventType, options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n     */\n    _finalizeCurrentTransform: function(e) {\n\n      var transform = this._currentTransform,\n          target = transform.target;\n\n      if (target._scaling) {\n        target._scaling = false;\n      }\n\n      target.setCoords();\n      this._restoreOriginXY(target);\n\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\n        this.fire('object:modified', { target: target, e: e });\n        target.fire('modified', { e: e });\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} target Object to restore\n     */\n    _restoreOriginXY: function(target) {\n      if (this._previousOriginX && this._previousOriginY) {\n\n        var originPoint = target.translateToOriginPoint(\n          target.getCenterPoint(),\n          this._previousOriginX,\n          this._previousOriginY);\n\n        target.originX = this._previousOriginX;\n        target.originY = this._previousOriginY;\n\n        target.left = originPoint.x;\n        target.top = originPoint.y;\n\n        this._previousOriginX = null;\n        this._previousOriginY = null;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDownInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = true;\n      this.discardActiveObject(e).renderAll();\n      if (this.clipTo) {\n        fabric.util.clipContext(this, this.contextTop);\n      }\n      var pointer = this.getPointer(e);\n      this.freeDrawingBrush.onMouseDown(pointer);\n      this._handleEvent(e, 'down');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMoveInDrawingMode: function(e) {\n      if (this._isCurrentlyDrawing) {\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseMove(pointer);\n      }\n      this.setCursor(this.freeDrawingCursor);\n      this._handleEvent(e, 'move');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUpInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = false;\n      if (this.clipTo) {\n        this.contextTop.restore();\n      }\n      this.freeDrawingBrush.onMouseUp();\n      this._handleEvent(e, 'up');\n    },\n\n    /**\n     * Method that defines the actions when mouse is clicked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    __onMouseDown: function (e) {\n\n      var target = this.findTarget(e);\n\n      // if right click just fire events\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'down', target ? target : null, RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'down', target ? target : null, MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode) {\n        this._onMouseDownInDrawingMode(e);\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) {\n        return;\n      }\n\n      // save pointer for check in __onMouseUp event\n      var pointer = this.getPointer(e, true);\n      this._previousPointer = pointer;\n\n      var shouldRender = this._shouldRender(target, pointer),\n          shouldGroup = this._shouldGroup(e, target);\n\n      if (this._shouldClearSelection(e, target)) {\n        this.deactivateAllWithDispatch(e);\n      }\n      else if (shouldGroup) {\n        this._handleGrouping(e, target);\n        target = this.getActiveGroup();\n      }\n\n      if (this.selection && (!target || (!target.selectable && !target.isEditing))) {\n        this._groupSelector = {\n          ex: pointer.x,\n          ey: pointer.y,\n          top: 0,\n          left: 0\n        };\n      }\n\n      if (target) {\n        if (target.selectable && (target.__corner || !shouldGroup)) {\n          this._beforeTransform(e, target);\n          this._setupCurrentTransform(e, target);\n        }\n        var activeObject = this.getActiveObject();\n        if (target !== this.getActiveGroup() && target !== activeObject) {\n          this.deactivateAll();\n          if (target.selectable) {\n            activeObject && activeObject.fire('deselected', { e: e });\n            this.setActiveObject(target, e);\n          }\n        }\n      }\n      this._handleEvent(e, 'down', target ? target : null);\n      // we must renderAll so that we update the visuals\n      shouldRender && this.renderAll();\n    },\n\n    /**\n     * @private\n     */\n    _beforeTransform: function(e, target) {\n      this.stateful && target.saveState();\n\n      // determine if it's a drag or rotate case\n      if (target._findTargetCorner(this.getPointer(e))) {\n        this.onBeforeScaleRotate(target);\n      }\n\n    },\n\n    /**\n     * @private\n     * @param {Object} target Object for that origin is set to center\n     */\n    _setOriginToCenter: function(target) {\n      this._previousOriginX = this._currentTransform.target.originX;\n      this._previousOriginY = this._currentTransform.target.originY;\n\n      var center = target.getCenterPoint();\n\n      target.originX = 'center';\n      target.originY = 'center';\n\n      target.left = center.x;\n      target.top = center.y;\n\n      this._currentTransform.left = target.left;\n      this._currentTransform.top = target.top;\n    },\n\n    /**\n     * @private\n     * @param {Object} target Object for that center is set to origin\n     */\n    _setCenterToOrigin: function(target) {\n      var originPoint = target.translateToOriginPoint(\n        target.getCenterPoint(),\n        this._previousOriginX,\n        this._previousOriginY);\n\n      target.originX = this._previousOriginX;\n      target.originY = this._previousOriginY;\n\n      target.left = originPoint.x;\n      target.top = originPoint.y;\n\n      this._previousOriginX = null;\n      this._previousOriginY = null;\n    },\n\n    /**\n     * Method that defines the actions when mouse is hovering the canvas.\n     * The currentTransform parameter will definde whether the user is rotating/scaling/translating\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\n     * all any other type of action.\n     * In case of an image transformation only the top canvas will be rendered.\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    __onMouseMove: function (e) {\n\n      var target, pointer;\n\n      if (this.isDrawingMode) {\n        this._onMouseMoveInDrawingMode(e);\n        return;\n      }\n      if (typeof e.touches !== 'undefined' && e.touches.length > 1) {\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection\n      if (groupSelector) {\n        pointer = this.getPointer(e, true);\n\n        groupSelector.left = pointer.x - groupSelector.ex;\n        groupSelector.top = pointer.y - groupSelector.ey;\n\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n        target = this.findTarget(e);\n        this._setCursorFromEvent(e, target);\n      }\n      else {\n        this._transformObject(e);\n      }\n      this._handleEvent(e, 'move', target ? target : null);\n    },\n\n    /**\n     * Method that defines actions when an Event Mouse Wheel\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseWheel: function(e) {\n      this._handleEvent(e, 'wheel');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event fired on mousemove\n     */\n    _transformObject: function(e) {\n      var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n\n      transform.reset = false;\n      transform.target.isMoving = true;\n      transform.shiftKey = e.shiftKey;\n      transform.altKey = e[this.centeredKey];\n\n      this._beforeScaleTransform(e, transform);\n      this._performTransformAction(e, transform, pointer);\n\n      transform.actionPerformed && this.renderAll();\n    },\n\n    /**\n     * @private\n     */\n    _performTransformAction: function(e, transform, pointer) {\n      var x = pointer.x,\n          y = pointer.y,\n          target = transform.target,\n          action = transform.action,\n          actionPerformed = false;\n\n      if (action === 'rotate') {\n        (actionPerformed = this._rotateObject(x, y)) && this._fire('rotating', target, e);\n      }\n      else if (action === 'scale') {\n        (actionPerformed = this._onScale(e, transform, x, y)) && this._fire('scaling', target, e);\n      }\n      else if (action === 'scaleX') {\n        (actionPerformed = this._scaleObject(x, y, 'x')) && this._fire('scaling', target, e);\n      }\n      else if (action === 'scaleY') {\n        (actionPerformed = this._scaleObject(x, y, 'y')) && this._fire('scaling', target, e);\n      }\n      else if (action === 'skewX') {\n        (actionPerformed = this._skewObject(x, y, 'x')) && this._fire('skewing', target, e);\n      }\n      else if (action === 'skewY') {\n        (actionPerformed = this._skewObject(x, y, 'y')) && this._fire('skewing', target, e);\n      }\n      else {\n        actionPerformed = this._translateObject(x, y);\n        if (actionPerformed) {\n          this._fire('moving', target, e);\n          this.setCursor(target.moveCursor || this.moveCursor);\n        }\n      }\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\n    },\n\n    /**\n     * @private\n     */\n    _fire: function(eventName, target, e) {\n      this.fire('object:' + eventName, { target: target, e: e });\n      target.fire(eventName, { e: e });\n    },\n\n    /**\n     * @private\n     */\n    _beforeScaleTransform: function(e, transform) {\n      if (transform.action === 'scale' || transform.action === 'scaleX' || transform.action === 'scaleY') {\n        var centerTransform = this._shouldCenterTransform(transform.target);\n\n        // Switch from a normal resize to center-based\n        if ((centerTransform && (transform.originX !== 'center' || transform.originY !== 'center')) ||\n           // Switch from center-based resize to normal one\n           (!centerTransform && transform.originX === 'center' && transform.originY === 'center')\n        ) {\n          this._resetCurrentTransform();\n          transform.reset = true;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {Object} transform current tranform\n     * @param {Number} x mouse position x from origin\n     * @param {Number} y mouse poistion y from origin\n     * @return {Boolean} true if the scaling occurred\n     */\n    _onScale: function(e, transform, x, y) {\n      if ((e[this.uniScaleKey] || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {\n        transform.currentAction = 'scale';\n        return this._scaleObject(x, y);\n      }\n      else {\n        // Switch from a normal resize to proportional\n        if (!transform.reset && transform.currentAction === 'scale') {\n          this._resetCurrentTransform();\n        }\n\n        transform.currentAction = 'scaleEqually';\n        return this._scaleObject(x, y, 'equally');\n      }\n    },\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @param {Event} e Event object\n     * @param {Object} target Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      if (!target) {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeGroup = this.getActiveGroup(),\n          // only show proper corner when group selection is not active\n          corner = target._findTargetCorner\n                    && (!activeGroup || !activeGroup.contains(target))\n                    && target._findTargetCorner(this.getPointer(e, true));\n\n      if (!corner) {\n        this.setCursor(hoverCursor);\n      }\n      else {\n        this._setCornerCursor(corner, target, e);\n      }\n      //actually unclear why it should return something\n      //is never evaluated\n      return true;\n    },\n\n    /**\n     * @private\n     */\n    _setCornerCursor: function(corner, target, e) {\n      if (corner in cursorOffset) {\n        this.setCursor(this._getRotatedCornerCursor(corner, target, e));\n      }\n      else if (corner === 'mtr' && target.hasRotatingPoint) {\n        this.setCursor(this.rotationCursor);\n      }\n      else {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _getRotatedCornerCursor: function(corner, target, e) {\n      var n = Math.round((target.getAngle() % 360) / 45);\n\n      if (n < 0) {\n        n += 8; // full circle ahead\n      }\n      n += cursorOffset[corner];\n      if (e[this.altActionKey] && cursorOffset[corner] % 2 === 0) {\n        //if we are holding shift and we are on a mx corner...\n        n += 2;\n      }\n      // normalize n to be from 0 to 7\n      n %= 8;\n\n      return this.cursorMap[n];\n    }\n  });\n})();\n\n\n(function() {\n\n  var min = Math.min,\n      max = Math.max;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     * @return {Boolean}\n     */\n    _shouldGroup: function(e, target) {\n      var activeObject = this.getActiveObject();\n      return e[this.selectionKey] && target && target.selectable &&\n            (this.getActiveGroup() || (activeObject && activeObject !== target))\n            && this.selection;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _handleGrouping: function (e, target) {\n      var activeGroup = this.getActiveGroup();\n\n      if (target === activeGroup) {\n        // if it's a group, find target again, using activeGroup objects\n        target = this.findTarget(e, true);\n        // if even object is not found, bail out\n        if (!target) {\n          return;\n        }\n      }\n      if (activeGroup) {\n        this._updateActiveGroup(target, e);\n      }\n      else {\n        this._createActiveGroup(target, e);\n      }\n\n      if (this._activeGroup) {\n        this._activeGroup.saveCoords();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _updateActiveGroup: function(target, e) {\n      var activeGroup = this.getActiveGroup();\n\n      if (activeGroup.contains(target)) {\n\n        activeGroup.removeWithUpdate(target);\n        target.set('active', false);\n\n        if (activeGroup.size() === 1) {\n          // remove group alltogether if after removal it only contains 1 object\n          this.discardActiveGroup(e);\n          // activate last remaining object\n          this.setActiveObject(activeGroup.item(0), e);\n          return;\n        }\n      }\n      else {\n        activeGroup.addWithUpdate(target);\n      }\n      this.fire('selection:created', { target: activeGroup, e: e });\n      activeGroup.set('active', true);\n    },\n\n    /**\n     * @private\n     */\n    _createActiveGroup: function(target, e) {\n\n      if (this._activeObject && target !== this._activeObject) {\n\n        var group = this._createGroup(target);\n        group.addWithUpdate();\n\n        this.setActiveGroup(group, e);\n        this._activeObject = null;\n\n        this.fire('selection:created', { target: group, e: e });\n      }\n\n      target.set('active', true);\n    },\n\n    /**\n     * @private\n     * @param {Object} target\n     */\n    _createGroup: function(target) {\n\n      var objects = this.getObjects(),\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n      this._activeObject.isEditing && this._activeObject.exitEditing();\n      return new fabric.Group(groupObjects, {\n        canvas: this\n      });\n    },\n\n    /**\n     * @private\n     * @param {Event} e mouse event\n     */\n    _groupSelectedObjects: function (e) {\n\n      var group = this._collectObjects();\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        group = new fabric.Group(group.reverse(), {\n          canvas: this\n        });\n        group.addWithUpdate();\n        this.setActiveGroup(group, e);\n        group.saveCoords();\n        this.fire('selection:created', { target: group, e: e });\n        this.renderAll();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _collectObjects: function() {\n      var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          isClick = x1 === x2 && y1 === y2;\n\n      for (var i = this._objects.length; i--; ) {\n        currentObject = this._objects[i];\n\n        if (!currentObject || !currentObject.selectable || !currentObject.visible) {\n          continue;\n        }\n\n        if (currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2) ||\n            currentObject.containsPoint(selectionX1Y1) ||\n            currentObject.containsPoint(selectionX2Y2)\n        ) {\n          currentObject.set('active', true);\n          group.push(currentObject);\n\n          // only add one object if it's a click\n          if (isClick) {\n            break;\n          }\n        }\n      }\n\n      return group;\n    },\n\n    /**\n     * @private\n     */\n    _maybeGroupObjects: function(e) {\n      if (this.selection && this._groupSelector) {\n        this._groupSelectedObjects(e);\n      }\n\n      var activeGroup = this.getActiveGroup();\n      if (activeGroup) {\n        activeGroup.setObjectsCoords().setCoords();\n        activeGroup.isMoving = false;\n        this.setCursor(this.defaultCursor);\n      }\n\n      // clear selection and current transformation\n      this._groupSelector = null;\n      this._currentTransform = null;\n    }\n  });\n\n})();\n\n\n(function () {\n\n  var supportQuality = fabric.StaticCanvas.supports('toDataURLWithQuality');\n\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n     * @param {Object} [options] Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'jpeg',\n     *   quality: 0.8\n     * });\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   left: 100,\n     *   top: 100,\n     *   width: 200,\n     *   height: 200\n     * });\n     * @example <caption>Generate double scaled png dataURL</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   multiplier: 2\n     * });\n     */\n    toDataURL: function (options) {\n      options || (options = { });\n\n      var format = options.format || 'png',\n          quality = options.quality || 1,\n          multiplier = options.multiplier || 1,\n          cropping = {\n            left: options.left || 0,\n            top: options.top || 0,\n            width: options.width || 0,\n            height: options.height || 0,\n          };\n      return this.__toDataURLWithMultiplier(format, quality, cropping, multiplier);\n    },\n\n    /**\n     * @private\n     */\n    __toDataURLWithMultiplier: function(format, quality, cropping, multiplier) {\n\n      var origWidth = this.getWidth(),\n          origHeight = this.getHeight(),\n          scaledWidth = (cropping.width || this.getWidth()) * multiplier,\n          scaledHeight = (cropping.height || this.getHeight()) * multiplier,\n          zoom = this.getZoom(),\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - cropping.left) * multiplier,\n          translateY = (vp[5] - cropping.top) * multiplier,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalInteractive = this.interactive;\n\n      this.viewportTransform = newVp;\n      // setting interactive to false avoid exporting controls\n      this.interactive && (this.interactive = false);\n      if (origWidth !== scaledWidth || origHeight !== scaledHeight) {\n        // this.setDimensions is going to renderAll also;\n        this.setDimensions({ width: scaledWidth, height: scaledHeight });\n      }\n      else {\n        this.renderAll();\n      }\n      var data = this.__toDataURL(format, quality, cropping);\n      originalInteractive && (this.interactive = originalInteractive);\n      this.viewportTransform = vp;\n      //setDimensions with no option object is taking care of:\n      //this.width, this.height, this.renderAll()\n      this.setDimensions({ width: origWidth, height: origHeight });\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    __toDataURL: function(format, quality) {\n\n      var canvasEl = this.contextContainer.canvas;\n      // to avoid common confusion https://github.com/kangax/fabric.js/issues/806\n      if (format === 'jpg') {\n        format = 'jpeg';\n      }\n\n      var data = supportQuality\n                ? canvasEl.toDataURL('image/' + format, quality)\n                : canvasEl.toDataURL('image/' + format);\n\n      return data;\n    },\n\n    /**\n     * Exports canvas element to a dataurl image (allowing to change image size via multiplier).\n     * @deprecated since 1.0.13\n     * @param {String} format (png|jpeg)\n     * @param {Number} multiplier\n     * @param {Number} quality (0..1)\n     * @return {String}\n     */\n    toDataURLWithMultiplier: function (format, multiplier, quality) {\n      return this.toDataURL({\n        format: format,\n        multiplier: multiplier,\n        quality: quality\n      });\n    },\n  });\n\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Populates canvas with data from the specified dataless JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toDatalessJSON}\n   * @deprecated since 1.2.2\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   */\n  loadFromDatalessJSON: function (json, callback, reviver) {\n    return this.loadFromJSON(json, callback, reviver);\n  },\n\n  /**\n   * Populates canvas with data from the specified JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n   * @example <caption>loadFromJSON</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n   * @example <caption>loadFromJSON with reviver</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n   *   // `o` = json object\n   *   // `object` = fabric.Object instance\n   *   // ... do some stuff ...\n   * });\n   */\n  loadFromJSON: function (json, callback, reviver) {\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : fabric.util.object.clone(json);\n\n    var _this = this,\n        renderOnAddRemove = this.renderOnAddRemove;\n    this.renderOnAddRemove = false;\n\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\n      _this.clear();\n      _this._setBgOverlay(serialized, function () {\n        enlivenedObjects.forEach(function(obj, index) {\n          // we splice the array just in case some custom classes restored from JSON\n          // will add more object to canvas at canvas init.\n          _this.insertAt(obj, index);\n        });\n        _this.renderOnAddRemove = renderOnAddRemove;\n        // remove parts i cannot set as options\n        delete serialized.objects;\n        delete serialized.backgroundImage;\n        delete serialized.overlayImage;\n        delete serialized.background;\n        delete serialized.overlay;\n        // this._initOptions does too many things to just\n        // call it. Normally loading an Object from JSON\n        // create the Object instance. Here the Canvas is\n        // already an instance and we are just loading things over it\n        _this._setOptions(serialized);\n        _this.renderAll();\n        callback && callback();\n      });\n    }, reviver);\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  _setBgOverlay: function(serialized, callback) {\n    var loaded = {\n      backgroundColor: false,\n      overlayColor: false,\n      backgroundImage: false,\n      overlayImage: false\n    };\n\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\n      callback && callback();\n      return;\n    }\n\n    var cbIfLoaded = function () {\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\n        callback && callback();\n      }\n    };\n\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n   * @param {(Object|String)} value Value to set\n   * @param {Object} loaded Set loaded property to true if property is set\n   * @param {Object} callback Callback function to invoke after property is set\n   */\n  __setBgOverlay: function(property, value, loaded, callback) {\n    var _this = this;\n\n    if (!value) {\n      loaded[property] = true;\n      callback && callback();\n      return;\n    }\n\n    if (property === 'backgroundImage' || property === 'overlayImage') {\n      fabric.util.enlivenObjects([value], function(enlivedObject){\n        _this[property] = enlivedObject[0];\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n    else {\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n  },\n\n  /**\n   * @private\n   * @param {Array} objects\n   * @param {Function} callback\n   * @param {Function} [reviver]\n   */\n  _enlivenObjects: function (objects, callback, reviver) {\n    if (!objects || objects.length === 0) {\n      callback && callback([]);\n      return;\n    }\n\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      callback && callback(enlivenedObjects);\n    }, null, reviver);\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n   */\n  clone: function (callback, properties) {\n    var data = JSON.stringify(this.toJSON(properties));\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.document.createElement('canvas');\n\n    el.width = this.getWidth();\n    el.height = this.getHeight();\n\n    var clone = new fabric.Canvas(el);\n    clone.clipTo = this.clipTo;\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      degreesToRadians = fabric.util.degreesToRadians,\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash'),\n      objectCaching = !fabric.isLikelyNode,\n      ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   */\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Retrieves object's {@link fabric.Object#clipTo|clipping function}\n     * @method getClipTo\n     * @memberOf fabric.Object.prototype\n     * @return {Function}\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#clipTo|clipping function}\n     * @method setClipTo\n     * @memberOf fabric.Object.prototype\n     * @param {Function} clipTo Clipping function\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#transformMatrix|transformMatrix}\n     * @method getTransformMatrix\n     * @memberOf fabric.Object.prototype\n     * @return {Array} transformMatrix\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#transformMatrix|transformMatrix}\n     * @method setTransformMatrix\n     * @memberOf fabric.Object.prototype\n     * @param {Array} transformMatrix\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#visible|visible} state\n     * @method getVisible\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean} True if visible\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#visible|visible} state\n     * @method setVisible\n     * @memberOf fabric.Object.prototype\n     * @param {Boolean} value visible value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#shadow|shadow}\n     * @method getShadow\n     * @memberOf fabric.Object.prototype\n     * @return {Object} Shadow instance\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#stroke|stroke}\n     * @method getStroke\n     * @memberOf fabric.Object.prototype\n     * @return {String} stroke value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#stroke|stroke}\n     * @method setStroke\n     * @memberOf fabric.Object.prototype\n     * @param {String} value stroke value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#strokeWidth|strokeWidth}\n     * @method getStrokeWidth\n     * @memberOf fabric.Object.prototype\n     * @return {Number} strokeWidth value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#strokeWidth|strokeWidth}\n     * @method setStrokeWidth\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value strokeWidth value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#originX|originX}\n     * @method getOriginX\n     * @memberOf fabric.Object.prototype\n     * @return {String} originX value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#originX|originX}\n     * @method setOriginX\n     * @memberOf fabric.Object.prototype\n     * @param {String} value originX value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#originY|originY}\n     * @method getOriginY\n     * @memberOf fabric.Object.prototype\n     * @return {String} originY value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#originY|originY}\n     * @method setOriginY\n     * @memberOf fabric.Object.prototype\n     * @param {String} value originY value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#fill|fill}\n     * @method getFill\n     * @memberOf fabric.Object.prototype\n     * @return {String} Fill value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#fill|fill}\n     * @method setFill\n     * @memberOf fabric.Object.prototype\n     * @param {String} value Fill value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#opacity|opacity}\n     * @method getOpacity\n     * @memberOf fabric.Object.prototype\n     * @return {Number} Opacity value (0-1)\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#opacity|opacity}\n     * @method setOpacity\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value Opacity value (0-1)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#angle|angle} (in degrees)\n     * @method getAngle\n     * @memberOf fabric.Object.prototype\n     * @return {Number}\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#top|top position}\n     * @method getTop\n     * @memberOf fabric.Object.prototype\n     * @return {Number} Top value (in pixels)\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#top|top position}\n     * @method setTop\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value Top value (in pixels)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#left|left position}\n     * @method getLeft\n     * @memberOf fabric.Object.prototype\n     * @return {Number} Left value (in pixels)\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#left|left position}\n     * @method setLeft\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value Left value (in pixels)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#scaleX|scaleX} value\n     * @method getScaleX\n     * @memberOf fabric.Object.prototype\n     * @return {Number} scaleX value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#scaleX|scaleX} value\n     * @method setScaleX\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value scaleX value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#scaleY|scaleY} value\n     * @method getScaleY\n     * @memberOf fabric.Object.prototype\n     * @return {Number} scaleY value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#scaleY|scaleY} value\n     * @method setScaleY\n     * @memberOf fabric.Object.prototype\n     * @param {Number} value scaleY value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#flipX|flipX} value\n     * @method getFlipX\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean} flipX value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#flipX|flipX} value\n     * @method setFlipX\n     * @memberOf fabric.Object.prototype\n     * @param {Boolean} value flipX value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's {@link fabric.Object#flipY|flipY} value\n     * @method getFlipY\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean} flipY value\n     */\n\n    /**\n     * Sets object's {@link fabric.Object#flipY|flipY} value\n     * @method setFlipY\n     * @memberOf fabric.Object.prototype\n     * @param {Boolean} value flipY value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n\n    /**\n     * Type of an object (rect, circle, path, etc.).\n     * Note that this property is meant to be read-only and not meant to be modified.\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n     * @type String\n     * @default\n     */\n    type:                     'object',\n\n    /**\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/40/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originX:                  'left',\n\n    /**\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/40/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originY:                  'top',\n\n    /**\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n     * @type Number\n     * @default\n     */\n    top:                      0,\n\n    /**\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n     * @type Number\n     * @default\n     */\n    left:                     0,\n\n    /**\n     * Object width\n     * @type Number\n     * @default\n     */\n    width:                    0,\n\n    /**\n     * Object height\n     * @type Number\n     * @default\n     */\n    height:                   0,\n\n    /**\n     * Object scale factor (horizontal)\n     * @type Number\n     * @default\n     */\n    scaleX:                   1,\n\n    /**\n     * Object scale factor (vertical)\n     * @type Number\n     * @default\n     */\n    scaleY:                   1,\n\n    /**\n     * When true, an object is rendered as flipped horizontally\n     * @type Boolean\n     * @default\n     */\n    flipX:                    false,\n\n    /**\n     * When true, an object is rendered as flipped vertically\n     * @type Boolean\n     * @default\n     */\n    flipY:                    false,\n\n    /**\n     * Opacity of an object\n     * @type Number\n     * @default\n     */\n    opacity:                  1,\n\n    /**\n     * Angle of rotation of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    angle:                    0,\n\n    /**\n     * Angle of skew on x axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewX:                    0,\n\n    /**\n     * Angle of skew on y axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewY:                    0,\n\n    /**\n     * Size of object's controlling corners (in pixels)\n     * @type Number\n     * @default\n     */\n    cornerSize:               13,\n\n    /**\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n     * @type Boolean\n     * @default\n     */\n    transparentCorners:       true,\n\n    /**\n     * Default cursor value used when hovering over this object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:              null,\n\n    /**\n     * Default cursor value used when moving this object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:               null,\n\n    /**\n     * Padding between object and its controlling borders (in pixels)\n     * @type Number\n     * @default\n     */\n    padding:                  0,\n\n    /**\n     * Color of controlling borders of an object (when it's active)\n     * @type String\n     * @default\n     */\n    borderColor:              'rgba(102,153,255,0.75)',\n\n    /**\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    borderDashArray:          null,\n\n    /**\n     * Color of controlling corners of an object (when it's active)\n     * @type String\n     * @default\n     */\n    cornerColor:              'rgba(102,153,255,0.5)',\n\n    /**\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    cornerStrokeColor:        null,\n\n    /**\n     * Specify style of control, 'rect' or 'circle'\n     * @since 1.6.2\n     * @type String\n     */\n    cornerStyle:          'rect',\n\n    /**\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    cornerDashArray:          null,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being scaled via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:          false,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being rotated via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:         true,\n\n    /**\n     * Color of object's fill\n     * @type String\n     * @default\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * Fill rule used to fill an object\n     * accepted values are nonzero, evenodd\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n     * @type String\n     * @default\n     */\n    fillRule:                 'nonzero',\n\n    /**\n     * Composite rule used for canvas globalCompositeOperation\n     * @type String\n     * @default\n     */\n    globalCompositeOperation: 'source-over',\n\n    /**\n     * Background color of an object.\n     * @type String\n     * @default\n     */\n    backgroundColor:          '',\n\n    /**\n     * Selection Background color of an object. colored layer behind the object when it is active.\n     * does not mix good with globalCompositeOperation methods.\n     * @type String\n     * @default\n     */\n    selectionBackgroundColor:          '',\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color\n     * @type String\n     * @default\n     */\n    stroke:                   null,\n\n    /**\n     * Width of a stroke used to render this object\n     * @type Number\n     * @default\n     */\n    strokeWidth:              1,\n\n    /**\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap:            'butt',\n\n    /**\n     * Corner style of an object's stroke (one of \"bevil\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin:           'miter',\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit:         10,\n\n    /**\n     * Shadow object representing shadow of this shape\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:                   null,\n\n    /**\n     * Opacity of object's controlling borders when object is active and moving\n     * @type Number\n     * @default\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * Scale factor of object's controlling borders\n     * @type Number\n     * @default\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Transform matrix (similar to SVG's transform matrix)\n     * @type Array\n     */\n    transformMatrix:          null,\n\n    /**\n     * Minimum allowed scale value of an object\n     * @type Number\n     * @default\n     */\n    minScaleLimit:            0.01,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n     * But events still fire on it.\n     * @type Boolean\n     * @default\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n     * @type Boolean\n     * @default\n     */\n    evented:                  true,\n\n    /**\n     * When set to `false`, an object is not rendered on canvas\n     * @type Boolean\n     * @default\n     */\n    visible:                  true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @type Boolean\n     * @default\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's controlling borders are not rendered\n     * @type Boolean\n     * @default\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `false`, object's controlling rotating point will not be visible or selectable\n     * @type Boolean\n     * @default\n     */\n    hasRotatingPoint:         true,\n\n    /**\n     * Offset for object's controlling rotating point (when enabled via `hasRotatingPoint`)\n     * @type Number\n     * @default\n     */\n    rotatingPointOffset:      40,\n\n    /**\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:       false,\n\n    /**\n     * When `false`, default object's values are not included in its serialization\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues:     true,\n\n    /**\n     * Function that determines clipping of an object (context is passed as a first argument)\n     * Note that context origin is at the object's center point (not left/top corner)\n     * @type Function\n     */\n    clipTo:                   null,\n\n    /**\n     * When `true`, object horizontal movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementX:            false,\n\n    /**\n     * When `true`, object vertical movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementY:            false,\n\n    /**\n     * When `true`, object rotation is locked\n     * @type Boolean\n     * @default\n     */\n    lockRotation:             false,\n\n    /**\n     * When `true`, object horizontal scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingX:             false,\n\n    /**\n     * When `true`, object vertical scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingY:             false,\n\n    /**\n     * When `true`, object non-uniform scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockUniScaling:           false,\n\n    /**\n     * When `true`, object horizontal skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingX:             false,\n\n    /**\n     * When `true`, object vertical skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingY:             false,\n\n    /**\n     * When `true`, object cannot be flipped by scaling into negative values\n     * @type Boolean\n     * @default\n     */\n    lockScalingFlip:          false,\n\n    /**\n     * When `true`, object is not exported in SVG or OBJECT/JSON\n     * since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    excludeFromExport:        false,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    objectCaching:            objectCaching,\n\n    /**\n     * When `true`, object properties are checked for cache invalidation. In some particular\n     * situation you may want this to be disabled ( spray brush, very big pathgroups, groups)\n     * or if your application does not allow you to modify properties for groups child you want\n     * to disable it for groups.\n     * default to false\n     * since 1.7.0\n     * @type Boolean\n     * @default false\n     */\n    statefullCache:            false,\n\n    /**\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n     * too much and will be redrawn with correct details at the end of scaling.\n     * this setting is performance and application dependant.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    noScaleCache:              true,\n\n    /**\n     * When set to `true`, object's cache will be rerendered next render call.\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    dirty:                true,\n\n    /**\n     * List of properties to consider when checking if state\n     * of an object is changed (fabric.Object#hasStateChanged)\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: (\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit ' +\n      'angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor ' +\n      'skewX skewY fillRule'\n    ).split(' '),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties: (\n      'fill stroke strokeWidth strokeDashArray width height' +\n      ' strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor'\n    ).split(' '),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      options = options || { };\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Create a the canvas used to keep the cached copy of the object\n     * @private\n     */\n    _createCacheCanvas: function() {\n      this._cacheProperties = {};\n      this._cacheCanvas = fabric.document.createElement('canvas');\n      this._cacheContext = this._cacheCanvas.getContext('2d');\n      this._updateCacheCanvas();\n    },\n\n    /**\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n     * and each side do not cross fabric.cacheSideLimit\n     * those numbers are configurable so that you can get as much detail as you want\n     * making bargain with performances.\n     * @param {Object} dims\n     * @param {Object} dims.width width of canvas\n     * @param {Object} dims.height height of canvas\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _limitCacheSize: function(dims) {\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          maximumSide = fabric.cacheSideLimit,\n          width = dims.width, height = dims.height,\n          ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal, maximumSide),\n          capValue = fabric.util.capValue, max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n      if (width > x) {\n        dims.zoomX /= width / x;\n        dims.width = x;\n      }\n      else if (width < min) {\n        dims.width = min;\n      }\n      if (height > y) {\n        dims.zoomY /= height / y;\n        dims.height = y;\n      }\n      else if (height < min) {\n        dims.height = min;\n      }\n      return dims;\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var zoom = this.canvas && this.canvas.getZoom() || 1,\n          objectScale = this.getObjectScaling(),\n          dim = this._getNonTransformedDimensions(),\n          retina = this.canvas && this.canvas._isRetinaScaling() ? fabric.devicePixelRatio : 1,\n          zoomX = objectScale.scaleX * zoom * retina,\n          zoomY = objectScale.scaleY * zoom * retina,\n          width = dim.x * zoomX,\n          height = dim.y * zoomY;\n      return {\n        width: width + ALIASING_LIMIT,\n        height: height + ALIASING_LIMIT,\n        zoomX: zoomX,\n        zoomY: zoomY\n      };\n    },\n\n    /**\n     * Update width and height of the canvas for cache\n     * returns true or false if canvas needed resize.\n     * @private\n     * @return {Boolean} true if the canvas has been resized\n     */\n    _updateCacheCanvas: function() {\n      if (this.noScaleCache && this.canvas && this.canvas._currentTransform) {\n        var action = this.canvas._currentTransform.action;\n        if (action.slice && action.slice(0, 5) === 'scale') {\n          return false;\n        }\n      }\n      var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width, height = dims.height,\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\n      if (dimensionsChanged) {\n        var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\n        if (sizeGrowing) {\n          additionalWidth = (width * 0.1) & ~1;\n          additionalHeight = (height * 0.1) & ~1;\n        }\n      }\n      if (shouldRedraw) {\n        if (shouldResizeCanvas) {\n          this._cacheCanvas.width = Math.max(Math.ceil(width) + additionalWidth, minCacheSize);\n          this._cacheCanvas.height = Math.max(Math.ceil(height) + additionalHeight, minCacheSize);\n          this.cacheTranslationX = (width + additionalWidth) / 2;\n          this.cacheTranslationY = (height + additionalHeight) / 2;\n        }\n        else {\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n          this._cacheContext.clearRect(0, 0, this._cacheCanvas.width, this._cacheCanvas.height);\n        }\n        this.cacheWidth = width;\n        this.cacheHeight = height;\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\n        this._cacheContext.scale(zoomX, zoomY);\n        this.zoomX = zoomX;\n        this.zoomY = zoomY;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Sets object's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function(options) {\n      this._setOptions(options);\n      this._initGradient(options.fill, 'fill');\n      this._initGradient(options.stroke, 'stroke');\n      this._initClipping(options);\n      this._initPattern(options.fill, 'fill');\n      this._initPattern(options.stroke, 'stroke');\n    },\n\n    /**\n     * Transforms context when rendering an object\n     * @param {CanvasRenderingContext2D} ctx Context\n     * @param {Boolean} fromLeft When true, context is transformed to object's top/left corner. This is used when rendering text on Node\n     */\n    transform: function(ctx, fromLeft) {\n      if (this.group && !this.group._transformDone && this.group === this.canvas._activeGroup) {\n        this.group.transform(ctx);\n      }\n      var center = fromLeft ? this._getLeftTopCoords() : this.getCenterPoint();\n      ctx.translate(center.x, center.y);\n      this.angle && ctx.rotate(degreesToRadians(this.angle));\n      ctx.scale(\n        this.scaleX * (this.flipX ? -1 : 1),\n        this.scaleY * (this.flipY ? -1 : 1)\n      );\n      this.skewX && ctx.transform(1, 0, Math.tan(degreesToRadians(this.skewX)), 1, 0, 0);\n      this.skewY && ctx.transform(1, Math.tan(degreesToRadians(this.skewY)), 0, 1, 0, 0);\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          object = {\n            type:                     this.type,\n            originX:                  this.originX,\n            originY:                  this.originY,\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\n            strokeLineCap:            this.strokeLineCap,\n            strokeLineJoin:           this.strokeLineJoin,\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle:                    toFixed(this.getAngle(), NUM_FRACTION_DIGITS),\n            flipX:                    this.flipX,\n            flipY:                    this.flipY,\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\n            visible:                  this.visible,\n            clipTo:                   this.clipTo && String(this.clipTo),\n            backgroundColor:          this.backgroundColor,\n            fillRule:                 this.fillRule,\n            globalCompositeOperation: this.globalCompositeOperation,\n            transformMatrix:          this.transformMatrix ? this.transformMatrix.concat() : null,\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS)\n          };\n\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      // will be overwritten by subclasses\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _removeDefaultValues: function(object) {\n      var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n      stateProperties.forEach(function(prop) {\n        if (object[prop] === prototype[prop]) {\n          delete object[prop];\n        }\n        var isArray = Object.prototype.toString.call(object[prop]) === '[object Array]' &&\n                      Object.prototype.toString.call(prototype[prop]) === '[object Array]';\n\n        // basically a check for [] === []\n        if (isArray && object[prop].length === 0 && prototype[prop].length === 0) {\n          delete object[prop];\n        }\n      });\n\n      return object;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.' + capitalize(this.type) + '>';\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getObjectScaling: function() {\n      var scaleX = this.scaleX, scaleY = this.scaleY;\n      if (this.group) {\n        var scaling = this.group.getObjectScaling();\n        scaleX *= scaling.scaleX;\n        scaleY *= scaling.scaleY;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Object} thisArg\n     */\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY');\n\n      if (shouldConstrainValue) {\n        value = this._constrainScale(value);\n      }\n      if (key === 'scaleX' && value < 0) {\n        this.flipX = !this.flipX;\n        value *= -1;\n      }\n      else if (key === 'scaleY' && value < 0) {\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\n        value = new fabric.Shadow(value);\n      }\n      else if (key === 'dirty' && this.group) {\n        this.group.set('dirty', value);\n      }\n\n      this[key] = value;\n\n      if (this.cacheProperties.indexOf(key) > -1) {\n        if (this.group) {\n          this.group.set('dirty', true);\n        }\n        this.dirty = true;\n      }\n\n      if (this.group && this.stateProperties.indexOf(key) > -1) {\n        this.group.set('dirty', true);\n      }\n\n      if (key === 'width' || key === 'height') {\n        this.minScaleLimit = Math.min(0.1, 1 / Math.max(this.width, this.height));\n      }\n\n      return this;\n    },\n\n    /**\n     * This callback function is called by the parent group of an object every\n     * time a non-delegated property changes on the group. It is passed the key\n     * and value as parameters. Not adding in this function's signature to avoid\n     * Travis build error about unused variables.\n     */\n    setOnGroup: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n    /**\n     * Sets sourcePath of an object\n     * @param {String} value Value to set sourcePath to\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setSourcePath: function(value) {\n      this.sourcePath = value;\n      return this;\n    },\n\n    /**\n     * Retrieves viewportTransform from Object's canvas if possible\n     * @method getViewportTransform\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    getViewportTransform: function() {\n      if (this.canvas && this.canvas.viewportTransform) {\n        return this.canvas.viewportTransform;\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /*\n     * @private\n     * return if the object would be visible in rendering\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    isNotVisible: function() {\n      return this.opacity === 0 || (this.width === 0 && this.height === 0) || !this.visible;\n    },\n\n    /**\n     * Renders an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    render: function(ctx, noTransform) {\n      // do not render if width/height are zeros or object is not visible\n      if (this.isNotVisible()) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      ctx.save();\n      //setup fill rule for current object\n      this._setupCompositeOperation(ctx);\n      this.drawSelectionBackground(ctx);\n      if (!noTransform) {\n        this.transform(ctx);\n      }\n      this._setOpacity(ctx);\n      this._setShadow(ctx);\n      if (this.transformMatrix) {\n        ctx.transform.apply(ctx, this.transformMatrix);\n      }\n      this.clipTo && fabric.util.clipContext(this, ctx);\n      if (this.shouldCache(noTransform)) {\n        if (!this._cacheCanvas) {\n          this._createCacheCanvas();\n        }\n        if (this.isCacheDirty(noTransform)) {\n          this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\n          this.drawObject(this._cacheContext, noTransform);\n          this.dirty = false;\n        }\n        this.drawCacheOnCanvas(ctx);\n      }\n      else {\n        this.dirty = false;\n        this.drawObject(ctx, noTransform);\n        if (noTransform && this.objectCaching && this.statefullCache) {\n          this.saveState({ propertySet: 'cacheProperties' });\n        }\n      }\n      this.clipTo && ctx.restore();\n      ctx.restore();\n    },\n\n    /**\n     * When returns `true`, force the object to have its own cache, even if it is inside a group\n     * it may be needed when your object behave in a particular way on the cache and always needs\n     * its own isolated canvas to render correctly.\n     * This function is created to be subclassed by custom classes.\n     * since 1.7.12\n     * @type function\n     * @return false\n     */\n    needsItsOwnCache: function() {\n      return false;\n    },\n\n    /**\n     * Decide if the object should cache or not.\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @param {Boolean} noTransform if rendereing in pathGroup, caching is not supported at object level\n     * @return {Boolean}\n     */\n    shouldCache: function(noTransform) {\n      return !noTransform && this.objectCaching &&\n      (!this.group || this.needsItsOwnCache() || !this.group.isCaching());\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * used by Group.shouldCache to know if child has a shadow recursively\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    drawObject: function(ctx, noTransform) {\n      this._renderBackground(ctx);\n      this._setStrokeStyles(ctx);\n      this._setFillStyles(ctx);\n      this._render(ctx, noTransform);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\n    },\n\n    /**\n     * Check if cache is dirty\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n     * on parent canvas.\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.isNotVisible()) {\n        return false;\n      }\n      if (this._cacheCanvas && !skipCanvas && this._updateCacheCanvas()) {\n        // in this case the context is already cleared.\n        return true;\n      }\n      else {\n        if (this.dirty || (this.statefullCache && this.hasStateChanged('cacheProperties'))) {\n          if (this._cacheCanvas && !skipCanvas) {\n            var width = this.cacheWidth / this.zoomX;\n            var height = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Draws a background for the object big as its untrasformed dimensions\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      if (!this.backgroundColor) {\n        return;\n      }\n      var dim = this._getNonTransformedDimensions();\n      ctx.fillStyle = this.backgroundColor;\n\n      ctx.fillRect(\n        -dim.x / 2,\n        -dim.y / 2,\n        dim.x,\n        dim.y\n      );\n      // if there is background color no other shadows\n      // should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setOpacity: function(ctx) {\n      ctx.globalAlpha *= this.opacity;\n    },\n\n    _setStrokeStyles: function(ctx) {\n      if (this.stroke) {\n        ctx.lineWidth = this.strokeWidth;\n        ctx.lineCap = this.strokeLineCap;\n        ctx.lineJoin = this.strokeLineJoin;\n        ctx.miterLimit = this.strokeMiterLimit;\n        ctx.strokeStyle = this.stroke.toLive\n          ? this.stroke.toLive(ctx, this)\n          : this.stroke;\n      }\n    },\n\n    _setFillStyles: function(ctx) {\n      if (this.fill) {\n        ctx.fillStyle = this.fill.toLive\n          ? this.fill.toLive(ctx, this)\n          : this.fill;\n      }\n    },\n\n    /**\n     * @private\n     * Sets line dash\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n     * @param {Array} dashArray array representing dashes\n     * @param {Function} alternative function to call if browaser does not support lineDash\n     */\n    _setLineDash: function(ctx, dashArray, alternative) {\n      if (!dashArray) {\n        return;\n      }\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n      if (1 & dashArray.length) {\n        dashArray.push.apply(dashArray, dashArray);\n      }\n      if (supportsLineDash) {\n        ctx.setLineDash(dashArray);\n      }\n      else {\n        alternative && alternative(ctx);\n      }\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderControls: function(ctx) {\n      if (!this.active || (this.group && this.group !== this.canvas.getActiveGroup())) {\n        return;\n      }\n\n      var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options;\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n      options = fabric.util.qrDecompose(matrix);\n\n      ctx.save();\n      ctx.translate(options.translateX, options.translateY);\n      ctx.lineWidth = 1 * this.borderScaleFactor;\n      if (!this.group) {\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      }\n      if (this.group && this.group === this.canvas.getActiveGroup()) {\n        ctx.rotate(degreesToRadians(options.angle));\n        this.drawBordersInGroup(ctx, options);\n      }\n      else {\n        ctx.rotate(degreesToRadians(this.angle));\n        this.drawBorders(ctx);\n      }\n      this.drawControls(ctx);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      var multX = (this.canvas && this.canvas.viewportTransform[0]) || 1,\n          multY = (this.canvas && this.canvas.viewportTransform[3]) || 1,\n          scaling = this.getObjectScaling();\n      if (this.canvas && this.canvas._isRetinaScaling()) {\n        multX *= fabric.devicePixelRatio;\n        multY *= fabric.devicePixelRatio;\n      }\n      ctx.shadowColor = this.shadow.color;\n      ctx.shadowBlur = this.shadow.blur * (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\n      ctx.shadowOffsetX = this.shadow.offsetX * multX * scaling.scaleX;\n      ctx.shadowOffsetY = this.shadow.offsetY * multY * scaling.scaleY;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _removeShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      ctx.shadowColor = '';\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\n     */\n    _applyPatternGradientTransform: function(ctx, filler) {\n      if (!filler.toLive) {\n        return;\n      }\n      var transform = filler.gradientTransform || filler.patternTransform;\n      if (transform) {\n        ctx.transform.apply(ctx, transform);\n      }\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n      ctx.translate(offsetX, offsetY);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderFill: function(ctx) {\n      if (!this.fill) {\n        return;\n      }\n\n      ctx.save();\n      this._applyPatternGradientTransform(ctx, this.fill);\n      if (this.fillRule === 'evenodd') {\n        ctx.fill('evenodd');\n      }\n      else {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderStroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray, this._renderDashedStroke);\n      this._applyPatternGradientTransform(ctx, this.stroke);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Clones an instance, some objects are async, so using callback method will work for every object.\n     * Using the direct return does not work for images and groups.\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {fabric.Object} clone of an instance\n     */\n    clone: function(callback, propertiesToInclude) {\n      if (this.constructor.fromObject) {\n        return this.constructor.fromObject(this.toObject(propertiesToInclude), callback);\n      }\n      return new fabric.Object(this.toObject(propertiesToInclude));\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * @param {Function} callback callback, invoked with an instance as a first argument\n     * @param {Object} [options] for clone as image, passed to toDataURL\n     * @param {Boolean} [options.enableRetinaScaling] enable retina scaling for the cloned image\n     * @return {fabric.Object} thisArg\n     */\n    cloneAsImage: function(callback, options) {\n      var dataUrl = this.toDataURL(options);\n      fabric.util.loadImage(dataUrl, function(img) {\n        if (callback) {\n          callback(new fabric.Image(img));\n        }\n      });\n      return this;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @param {Object} options Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetina] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     */\n    toDataURL: function(options) {\n      options || (options = { });\n\n      var el = fabric.util.createCanvasElement(),\n          boundingRect = this.getBoundingRect();\n\n      el.width = boundingRect.width;\n      el.height = boundingRect.height;\n      fabric.util.wrapElement(el, 'div');\n      var canvas = new fabric.StaticCanvas(el, { enableRetinaScaling: options.enableRetinaScaling });\n      // to avoid common confusion https://github.com/kangax/fabric.js/issues/806\n      if (options.format === 'jpg') {\n        options.format = 'jpeg';\n      }\n\n      if (options.format === 'jpeg') {\n        canvas.backgroundColor = '#fff';\n      }\n\n      var origParams = {\n        active: this.get('active'),\n        left: this.getLeft(),\n        top: this.getTop()\n      };\n\n      this.set('active', false);\n      this.setPositionByOrigin(new fabric.Point(canvas.getWidth() / 2, canvas.getHeight() / 2), 'center', 'center');\n\n      var originalCanvas = this.canvas;\n      canvas.add(this);\n      var data = canvas.toDataURL(options);\n\n      this.set(origParams).setCoords();\n      this.canvas = originalCanvas;\n\n      canvas.dispose();\n      canvas = null;\n\n      return data;\n    },\n\n    /**\n     * Returns true if specified type is identical to the type of an instance\n     * @param {String} type Type to check against\n     * @return {Boolean}\n     */\n    isType: function(type) {\n      return this.type === type;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} JSON\n     */\n    toJSON: function(propertiesToInclude) {\n      // delegate, not alias\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * Sets gradient (fill or stroke) of an object\n     * <b>Backwards incompatibility note:</b> This method was named \"setGradientFill\" until v1.1.0\n     * @param {String} property Property name 'stroke' or 'fill'\n     * @param {Object} [options] Options object\n     * @param {String} [options.type] Type of gradient 'radial' or 'linear'\n     * @param {Number} [options.x1=0] x-coordinate of start point\n     * @param {Number} [options.y1=0] y-coordinate of start point\n     * @param {Number} [options.x2=0] x-coordinate of end point\n     * @param {Number} [options.y2=0] y-coordinate of end point\n     * @param {Number} [options.r1=0] Radius of start point (only for radial gradients)\n     * @param {Number} [options.r2=0] Radius of end point (only for radial gradients)\n     * @param {Object} [options.colorStops] Color stops object eg. {0: 'ff0000', 1: '000000'}\n     * @param {Object} [options.gradientTransform] transforMatrix for gradient\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/58y8b/|jsFiddle demo}\n     * @example <caption>Set linear gradient</caption>\n     * object.setGradient('fill', {\n     *   type: 'linear',\n     *   x1: -object.width / 2,\n     *   y1: 0,\n     *   x2: object.width / 2,\n     *   y2: 0,\n     *   colorStops: {\n     *     0: 'red',\n     *     0.5: '#005555',\n     *     1: 'rgba(0,0,255,0.5)'\n     *   }\n     * });\n     * canvas.renderAll();\n     * @example <caption>Set radial gradient</caption>\n     * object.setGradient('fill', {\n     *   type: 'radial',\n     *   x1: 0,\n     *   y1: 0,\n     *   x2: 0,\n     *   y2: 0,\n     *   r1: object.width / 2,\n     *   r2: 10,\n     *   colorStops: {\n     *     0: 'red',\n     *     0.5: '#005555',\n     *     1: 'rgba(0,0,255,0.5)'\n     *   }\n     * });\n     * canvas.renderAll();\n     */\n    setGradient: function(property, options) {\n      options || (options = { });\n\n      var gradient = { colorStops: [] };\n\n      gradient.type = options.type || (options.r1 || options.r2 ? 'radial' : 'linear');\n      gradient.coords = {\n        x1: options.x1,\n        y1: options.y1,\n        x2: options.x2,\n        y2: options.y2\n      };\n\n      if (options.r1 || options.r2) {\n        gradient.coords.r1 = options.r1;\n        gradient.coords.r2 = options.r2;\n      }\n\n      gradient.gradientTransform = options.gradientTransform;\n      fabric.Gradient.prototype.addColorStop.call(gradient, options.colorStops);\n\n      return this.set(property, fabric.Gradient.forObject(this, gradient));\n    },\n\n    /**\n     * Sets pattern fill of an object\n     * @param {Object} options Options object\n     * @param {(String|HTMLImageElement)} options.source Pattern source\n     * @param {String} [options.repeat=repeat] Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @param {Number} [options.offsetX=0] Pattern horizontal offset from object's left/top corner\n     * @param {Number} [options.offsetY=0] Pattern vertical offset from object's left/top corner\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/QT3pa/|jsFiddle demo}\n     * @example <caption>Set pattern</caption>\n     * fabric.util.loadImage('http://fabricjs.com/assets/escheresque_ste.png', function(img) {\n     *   object.setPatternFill({\n     *     source: img,\n     *     repeat: 'repeat'\n     *   });\n     *   canvas.renderAll();\n     * });\n     */\n    setPatternFill: function(options) {\n      return this.set('fill', new fabric.Pattern(options));\n    },\n\n    /**\n     * Sets {@link fabric.Object#shadow|shadow} of an object\n     * @param {Object|String} [options] Options object or string (e.g. \"2px 2px 10px rgba(0,0,0,0.2)\")\n     * @param {String} [options.color=rgb(0,0,0)] Shadow color\n     * @param {Number} [options.blur=0] Shadow blur\n     * @param {Number} [options.offsetX=0] Shadow horizontal offset\n     * @param {Number} [options.offsetY=0] Shadow vertical offset\n     * @return {fabric.Object} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/7gvJG/|jsFiddle demo}\n     * @example <caption>Set shadow with string notation</caption>\n     * object.setShadow('2px 2px 10px rgba(0,0,0,0.2)');\n     * canvas.renderAll();\n     * @example <caption>Set shadow with object notation</caption>\n     * object.setShadow({\n     *   color: 'red',\n     *   blur: 10,\n     *   offsetX: 20,\n     *   offsetY: 20\n     * });\n     * canvas.renderAll();\n     */\n    setShadow: function(options) {\n      return this.set('shadow', options ? new fabric.Shadow(options) : null);\n    },\n\n    /**\n     * Sets \"color\" of an instance (alias of `set('fill', &hellip;)`)\n     * @param {String} color Color value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setColor: function(color) {\n      this.set('fill', color);\n      return this;\n    },\n\n    /**\n     * Sets \"angle\" of an instance\n     * @param {Number} angle Angle value (in degrees)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setAngle: function(angle) {\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\n\n      if (shouldCenterOrigin) {\n        this._setOriginToCenter();\n      }\n\n      this.set('angle', angle);\n\n      if (shouldCenterOrigin) {\n        this._resetOrigin();\n      }\n\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerH: function () {\n      this.canvas && this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterH: function () {\n      this.canvas && this.canvas.viewportCenterObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas && this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterV: function () {\n      this.canvas && this.canvas.viewportCenterObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      this.canvas && this.canvas.centerObject(this);\n      return this;\n    },\n\n    /**\n     * Centers object on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenter: function () {\n      this.canvas && this.canvas.viewportCenterObject(this);\n      return this;\n    },\n\n    /**\n     * Removes object from canvas to which it was added last\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    remove: function() {\n      if (this.canvas) {\n        if (this.group && this.group === this.canvas._activeGroup) {\n          this.group.remove(this);\n        }\n        this.canvas.remove(this);\n      }\n      return this;\n    },\n\n    /**\n     * Returns coordinates of a pointer relative to an object\n     * @param {Event} e Event to operate upon\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\n     * @return {Object} Coordinates of a pointer (x, y)\n     */\n    getLocalPointer: function(e, pointer) {\n      pointer = pointer || this.canvas.getPointer(e);\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n      if (this.angle) {\n        pClicked = fabric.util.rotatePoint(\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\n      }\n      return {\n        x: pClicked.x - objectLeftTop.x,\n        y: pClicked.y - objectLeftTop.y\n      };\n    },\n\n    /**\n     * Sets canvas globalCompositeOperation for specific object\n     * custom composition operation for the particular object can be specifed using globalCompositeOperation property\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n     */\n    _setupCompositeOperation: function (ctx) {\n      if (this.globalCompositeOperation) {\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\n      }\n    }\n  });\n\n  fabric.util.createAccessors(fabric.Object);\n\n  /**\n   * Alias for {@link fabric.Object.prototype.setAngle}\n   * @alias rotate -> setAngle\n   * @memberOf fabric.Object\n   */\n  fabric.Object.prototype.rotate = fabric.Object.prototype.setAngle;\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  fabric.Object._fromObject = function(className, object, callback, forceAsync, extraParam) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    if (forceAsync) {\n      fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\n        if (typeof patterns[0] !== 'undefined') {\n          object.fill = patterns[0];\n        }\n        if (typeof patterns[1] !== 'undefined') {\n          object.stroke = patterns[1];\n        }\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n        callback && callback(instance);\n      });\n    }\n    else {\n      var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n      callback && callback(instance);\n      return instance;\n    }\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      originXOffset = {\n        left: -0.5,\n        center: 0,\n        right: 0.5\n      },\n      originYOffset = {\n        top: -0.5,\n        center: 0,\n        bottom: 0.5\n      };\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\n      var x = point.x,\n          y = point.y,\n          offsetX, offsetY, dim;\n\n      if (typeof fromOriginX === 'string') {\n        fromOriginX = originXOffset[fromOriginX];\n      }\n      else {\n        fromOriginX -= 0.5;\n      }\n\n      if (typeof toOriginX === 'string') {\n        toOriginX = originXOffset[toOriginX];\n      }\n      else {\n        toOriginX -= 0.5;\n      }\n\n      offsetX = toOriginX - fromOriginX;\n\n      if (typeof fromOriginY === 'string') {\n        fromOriginY = originYOffset[fromOriginY];\n      }\n      else {\n        fromOriginY -= 0.5;\n      }\n\n      if (typeof toOriginY === 'string') {\n        toOriginY = originYOffset[toOriginY];\n      }\n      else {\n        toOriginY -= 0.5;\n      }\n\n      offsetY = toOriginY - fromOriginY;\n\n      if (offsetX || offsetY) {\n        dim = this._getTransformedDimensions();\n        x = point.x + offsetX * dim.x;\n        y = point.y + offsetY * dim.y;\n      }\n\n      return new fabric.Point(x, y);\n    },\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToCenterPoint: function(point, originX, originY) {\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n     * @param {fabric.Point} center The point which corresponds to center of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToOriginPoint: function(center, originX, originY) {\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Returns the real center coordinates of the object\n     * @return {fabric.Point}\n     */\n    getCenterPoint: function() {\n      var leftTop = new fabric.Point(this.left, this.top);\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n    },\n\n    /**\n     * Returns the coordinates of the object based on center coordinates\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @return {fabric.Point}\n     */\n    // getOriginPoint: function(center) {\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\n    // },\n\n    /**\n     * Returns the coordinates of the object as if it has a different origin\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    getPointByOrigin: function(originX, originY) {\n      var center = this.getCenterPoint();\n      return this.translateToOriginPoint(center, originX, originY);\n    },\n\n    /**\n     * Returns the point in local coordinates\n     * @param {fabric.Point} point The point relative to the global coordinate system\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    toLocalPoint: function(point, originX, originY) {\n      var center = this.getCenterPoint(),\n          p, p2;\n\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      }\n      else {\n        p = new fabric.Point(this.left, this.top);\n      }\n\n      p2 = new fabric.Point(point.x, point.y);\n      if (this.angle) {\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\n      }\n      return p2.subtractEquals(p);\n    },\n\n    /**\n     * Returns the point in global coordinates\n     * @param {fabric.Point} The point relative to the local coordinate system\n     * @return {fabric.Point}\n     */\n    // toGlobalPoint: function(point) {\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n    // },\n\n    /**\n     * Sets the position of the object taking into consideration the object's origin\n     * @param {fabric.Point} pos The new position of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {void}\n     */\n    setPositionByOrigin: function(pos, originX, originY) {\n      var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\n\n      this.set('left', position.x);\n      this.set('top', position.y);\n    },\n\n    /**\n     * @param {String} to One of 'left', 'center', 'right'\n     */\n    adjustPosition: function(to) {\n      var angle = degreesToRadians(this.angle),\n          hypotFull = this.getWidth(),\n          xFull = Math.cos(angle) * hypotFull,\n          yFull = Math.sin(angle) * hypotFull,\n          offsetFrom, offsetTo;\n\n      //TODO: this function does not consider mixed situation like top, center.\n      if (typeof this.originX === 'string') {\n        offsetFrom = originXOffset[this.originX];\n      }\n      else {\n        offsetFrom = this.originX - 0.5;\n      }\n      if (typeof to === 'string') {\n        offsetTo = originXOffset[to];\n      }\n      else {\n        offsetTo = to - 0.5;\n      }\n      this.left += xFull * (offsetTo - offsetFrom);\n      this.top += yFull * (offsetTo - offsetFrom);\n      this.setCoords();\n      this.originX = to;\n    },\n\n    /**\n     * Sets the origin/position of the object to it's center point\n     * @private\n     * @return {void}\n     */\n    _setOriginToCenter: function() {\n      this._originalOriginX = this.originX;\n      this._originalOriginY = this.originY;\n\n      var center = this.getCenterPoint();\n\n      this.originX = 'center';\n      this.originY = 'center';\n\n      this.left = center.x;\n      this.top = center.y;\n    },\n\n    /**\n     * Resets the origin/position of the object to it's original origin\n     * @private\n     * @return {void}\n     */\n    _resetOrigin: function() {\n      var originPoint = this.translateToOriginPoint(\n        this.getCenterPoint(),\n        this._originalOriginX,\n        this._originalOriginY);\n\n      this.originX = this._originalOriginX;\n      this.originY = this._originalOriginY;\n\n      this.left = originPoint.x;\n      this.top = originPoint.y;\n\n      this._originalOriginX = null;\n      this._originalOriginY = null;\n    },\n\n    /**\n     * @private\n     */\n    _getLeftTopCoords: function() {\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\n    },\n\n    /**\n    * Callback; invoked right before object is about to go from active to inactive\n    */\n    onDeselect: function() {\n      /* NOOP */\n    }\n  });\n\n})();\n\n\n(function() {\n\n  function getCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y)\n    ];\n  }\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      multiplyMatrices = fabric.util.multiplyTransformMatrices;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * properties are tl,mt,tr,ml,mr,bl,mb,br,mtr for the main controls.\n     * each property is an object with x, y and corner.\n     * The `corner` property contains in a similar manner the 4 points of the\n     * interactive area of the corner.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, viewportTransform, top, left, padding.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcCoords;\n     * @memberOf fabric.Object.prototype\n     */\n    oCoords: null,\n\n    /**\n     * Describe object's corner position in canvas object absolute coordinates\n     * properties are tl,tr,bl,br and describe the four main corner.\n     * each property is an object with x, y, instance of Fabric.Point.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, top, left.\n     * Those coordinates are usefull to understand where an object is. They get updated\n     * with oCoords but they do not need to be updated when zoom or panning change.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcCoords(true);\n     * @memberOf fabric.Object.prototype\n     */\n    aCoords: null,\n\n    /**\n     * return correct set of coordinates for intersection\n     */\n    getCoords: function(absolute, calculate) {\n      if (!this.oCoords) {\n        this.setCoords();\n      }\n      var coords = absolute ? this.aCoords : this.oCoords;\n      return getCoords(calculate ? this.calcCoords(absolute) : coords);\n    },\n\n    /**\n     * Checks if object intersects with an area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with an area formed by 2 points\n     */\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n      return intersection.status === 'Intersection';\n    },\n\n    /**\n     * Checks if object intersects with another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with another object\n     */\n    intersectsWithObject: function(other, absolute, calculate) {\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n            this.getCoords(absolute, calculate),\n            other.getCoords(absolute, calculate)\n          );\n\n      return intersection.status === 'Intersection'\n        || other.isContainedWithinObject(this, absolute, calculate)\n        || this.isContainedWithinObject(other, absolute, calculate);\n    },\n\n    /**\n     * Checks if object is fully contained within area of another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area of another object\n     */\n    isContainedWithinObject: function(other, absolute, calculate) {\n      var points = this.getCoords(absolute, calculate),\n          i = 0, lines = other._getImageLines(\n            calculate ? other.calcCoords(absolute) : absolute ? other.aCoords : other.oCoords\n          );\n      for (; i < 4; i++) {\n        if (!other.containsPoint(points[i], lines)) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Checks if object is fully contained within area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\n     */\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\n      var boundingRect = this.getBoundingRect(absolute, calculate);\n\n      return (\n        boundingRect.left >= pointTL.x &&\n        boundingRect.left + boundingRect.width <= pointBR.x &&\n        boundingRect.top >= pointTL.y &&\n        boundingRect.top + boundingRect.height <= pointBR.y\n      );\n    },\n\n    /**\n     * Checks if point is inside the object\n     * @param {fabric.Point} point Point to check against\n     * @param {Object} [lines] object returned from @method _getImageLines\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if point is inside the object\n     */\n    containsPoint: function(point, lines, absolute, calculate) {\n      var lines = lines || this._getImageLines(\n        calculate ? this.calcCoords(absolute) : absolute ? this.aCoords : this.oCoords\n      ),\n          xPoints = this._findCrossPoints(point, lines);\n\n      // if xPoints is odd then point is inside the object\n      return (xPoints !== 0 && xPoints % 2 === 1);\n    },\n\n    /**\n     * Checks if object is contained within the canvas with current viewportTransform\n     * the check is done stopping at first point that appear on screen\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within canvas\n     */\n    isOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      var points = this.getCoords(true, calculate), point;\n      for (var i = 0; i < 4; i++) {\n        point = points[i];\n        if (point.x <= pointBR.x && point.x >= pointTL.x && point.y <= pointBR.y && point.y >= pointTL.y) {\n          return true;\n        }\n      }\n      // no points on screen, check intersection with absolute coordinates\n      if (this.intersectsWithRect(pointTL, pointBR, true)) {\n        return true;\n      }\n      // worst case scenario the object is so big that contanins the screen\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\n      if (this.containsPoint(centerPoint, null, true)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\n     * @private\n     * @param {Object} oCoords Coordinates of the object corners\n     */\n    _getImageLines: function(oCoords) {\n      return {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      };\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 object edges\n     * and the horizontal line determined by a point on canvas\n     * @private\n     * @param {fabric.Point} point Point to check\n     * @param {Object} lines Coordinates of the object being evaluated\n     */\n     // remove yi, not used but left code here just in case.\n    _findCrossPoints: function(point, lines) {\n      var b1, b2, a1, a2, xi, // yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in lines) {\n        iLine = lines[lineKey];\n        // optimisation 1: line below point. no cross\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\n          continue;\n        }\n        // optimisation 2: line above point. no cross\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\n          xi = iLine.o.x;\n          // yi = point.y;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n          a1 = point.y - b1 * point.x;\n          a2 = iLine.o.y - b2 * iLine.o.x;\n\n          xi = -(a1 - a2) / (b1 - b2);\n          // yi = a1 + b1 * xi;\n        }\n        // dont count xi < point.x cases\n        if (xi >= point.x) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount === 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Returns width of an object's bounding rectangle\n     * @deprecated since 1.0.4\n     * @return {Number} width value\n     */\n    getBoundingRectWidth: function() {\n      return this.getBoundingRect().width;\n    },\n\n    /**\n     * Returns height of an object's bounding rectangle\n     * @deprecated since 1.0.4\n     * @return {Number} height value\n     */\n    getBoundingRectHeight: function() {\n      return this.getBoundingRect().height;\n    },\n\n    /**\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\n     * the box is intented as aligned to axis of canvas.\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Object} Object with left, top, width, height properties\n     */\n    getBoundingRect: function(absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate);\n      return fabric.util.makeBoundingBoxFromPoints(coords);\n    },\n\n    /**\n     * Returns width of an object bounding box counting transformations\n     * @return {Number} width value\n     */\n    getWidth: function() {\n      return this._getTransformedDimensions().x;\n    },\n\n    /**\n     * Returns height of an object bounding box counting transformations\n     * to be renamed in 2.0\n     * @return {Number} height value\n     */\n    getHeight: function() {\n      return this._getTransformedDimensions().y;\n    },\n\n    /**\n     * Makes sure the scale is valid and modifies it if necessary\n     * @private\n     * @param {Number} value\n     * @return {Number}\n     */\n    _constrainScale: function(value) {\n      if (Math.abs(value) < this.minScaleLimit) {\n        if (value < 0) {\n          return -this.minScaleLimit;\n        }\n        else {\n          return this.minScaleLimit;\n        }\n      }\n      return value;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @param {Number} value Scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      value = this._constrainScale(value);\n\n      if (value < 0) {\n        this.flipX = !this.flipX;\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n\n      this.scaleX = value;\n      this.scaleY = value;\n      return this.setCoords();\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New width value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect().width / this.getWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New height value\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect().height / this.getHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    /**\n     * Calculate and returns the .coords of an object.\n     * @return {Object} Object with tl, tr, br, bl ....\n     * @chainable\n     */\n    calcCoords: function(absolute) {\n      var theta = degreesToRadians(this.angle),\n          vpt = this.getViewportTransform(),\n          dim = absolute ? this._getTransformedDimensions() : this._calculateCurrentDimensions(),\n          currentWidth = dim.x, currentHeight = dim.y,\n          sinTh = Math.sin(theta),\n          cosTh = Math.cos(theta),\n          _angle = currentWidth > 0 ? Math.atan(currentHeight / currentWidth) : 0,\n          _hypotenuse = (currentWidth / Math.cos(_angle)) / 2,\n          offsetX = Math.cos(_angle + theta) * _hypotenuse,\n          offsetY = Math.sin(_angle + theta) * _hypotenuse,\n          center = this.getCenterPoint(),\n          // offset added for rotate and scale actions\n          coords = absolute ? center : fabric.util.transformPoint(center, vpt),\n          tl  = new fabric.Point(coords.x - offsetX, coords.y - offsetY),\n          tr  = new fabric.Point(tl.x + (currentWidth * cosTh), tl.y + (currentWidth * sinTh)),\n          bl  = new fabric.Point(tl.x - (currentHeight * sinTh), tl.y + (currentHeight * cosTh)),\n          br  = new fabric.Point(coords.x + offsetX, coords.y + offsetY);\n      if (!absolute) {\n        var ml  = new fabric.Point((tl.x + bl.x) / 2, (tl.y + bl.y) / 2),\n            mt  = new fabric.Point((tr.x + tl.x) / 2, (tr.y + tl.y) / 2),\n            mr  = new fabric.Point((br.x + tr.x) / 2, (br.y + tr.y) / 2),\n            mb  = new fabric.Point((br.x + bl.x) / 2, (br.y + bl.y) / 2),\n            mtr = new fabric.Point(mt.x + sinTh * this.rotatingPointOffset, mt.y - cosTh * this.rotatingPointOffset);\n      }\n\n      // debugging\n\n      /* setTimeout(function() {\n         canvas.contextTop.fillStyle = 'green';\n         canvas.contextTop.fillRect(mb.x, mb.y, 3, 3);\n         canvas.contextTop.fillRect(bl.x, bl.y, 3, 3);\n         canvas.contextTop.fillRect(br.x, br.y, 3, 3);\n         canvas.contextTop.fillRect(tl.x, tl.y, 3, 3);\n         canvas.contextTop.fillRect(tr.x, tr.y, 3, 3);\n         canvas.contextTop.fillRect(ml.x, ml.y, 3, 3);\n         canvas.contextTop.fillRect(mr.x, mr.y, 3, 3);\n         canvas.contextTop.fillRect(mt.x, mt.y, 3, 3);\n         canvas.contextTop.fillRect(mtr.x, mtr.y, 3, 3);\n       }, 50); */\n\n      var coords = {\n        // corners\n        tl: tl, tr: tr, br: br, bl: bl,\n      };\n      if (!absolute) {\n        // middle\n        coords.ml = ml;\n        coords.mt = mt;\n        coords.mr = mr;\n        coords.mb = mb;\n        // rotating point\n        coords.mtr = mtr;\n      }\n      return coords;\n    },\n\n    /**\n     * Sets corner position coordinates based on current angle, width and height\n     * See https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords\n     * @param {Boolean} [ignoreZoom] set oCoords with or without the viewport transform.\n     * @param {Boolean} [skipAbsolute] skip calculation of aCoords, usefull in setViewportTransform\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function(ignoreZoom, skipAbsolute) {\n      this.oCoords = this.calcCoords(ignoreZoom);\n      if (!skipAbsolute) {\n        this.aCoords = this.calcCoords(true);\n      }\n\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      ignoreZoom || (this._setCornerCoords && this._setCornerCoords());\n\n      return this;\n    },\n\n    /**\n     * calculate rotation matrix of an object\n     * @return {Array} rotation matrix for the object\n     */\n    _calcRotateMatrix: function() {\n      if (this.angle) {\n        var theta = degreesToRadians(this.angle), cos = Math.cos(theta), sin = Math.sin(theta);\n        // trying to keep rounding error small, ugly but it works.\n        if (cos === 6.123233995736766e-17 || cos === -1.8369701987210297e-16) {\n          cos = 0;\n        }\n        return [cos, sin, -sin, cos, 0, 0];\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /**\n     * calculate trasform Matrix that represent current transformation from\n     * object properties.\n     * @param {Boolean} [skipGroup] return transformMatrix for object and not go upward with parents\n     * @return {Array} matrix Transform Matrix for the object\n     */\n    calcTransformMatrix: function(skipGroup) {\n      var center = this.getCenterPoint(),\n          translateMatrix = [1, 0, 0, 1, center.x, center.y],\n          rotateMatrix,\n          dimensionMatrix = this._calcDimensionsTransformMatrix(this.skewX, this.skewY, true),\n          matrix;\n      if (this.group && !skipGroup) {\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(), translateMatrix);\n      }\n      else {\n        matrix = translateMatrix;\n      }\n      if (this.angle) {\n        rotateMatrix = this._calcRotateMatrix();\n        matrix = multiplyMatrices(matrix, rotateMatrix);\n      }\n      matrix = multiplyMatrices(matrix, dimensionMatrix);\n      return matrix;\n    },\n\n    _calcDimensionsTransformMatrix: function(skewX, skewY, flipping) {\n      var skewMatrix,\n          scaleX = this.scaleX * (flipping && this.flipX ? -1 : 1),\n          scaleY = this.scaleY * (flipping && this.flipY ? -1 : 1),\n          scaleMatrix = [scaleX, 0, 0, scaleY, 0, 0];\n      if (skewX) {\n        skewMatrix = [1, 0, Math.tan(degreesToRadians(skewX)), 1];\n        scaleMatrix = multiplyMatrices(scaleMatrix, skewMatrix, true);\n      }\n      if (skewY) {\n        skewMatrix = [1, Math.tan(degreesToRadians(skewY)), 0, 1];\n        scaleMatrix = multiplyMatrices(scaleMatrix, skewMatrix, true);\n      }\n      return scaleMatrix;\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getNonTransformedDimensions: function() {\n      var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n      return { x: w, y: h };\n    },\n\n    /*\n     * Calculate object bounding boxdimensions from its properties scale, skew.\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getTransformedDimensions: function(skewX, skewY) {\n      if (typeof skewX === 'undefined') {\n        skewX = this.skewX;\n      }\n      if (typeof skewY === 'undefined') {\n        skewY = this.skewY;\n      }\n      var dimensions = this._getNonTransformedDimensions(),\n          dimX = dimensions.x / 2, dimY = dimensions.y / 2,\n          points = [\n            {\n              x: -dimX,\n              y: -dimY\n            },\n            {\n              x: dimX,\n              y: -dimY\n            },\n            {\n              x: -dimX,\n              y: dimY\n            },\n            {\n              x: dimX,\n              y: dimY\n            }],\n          i, transformMatrix = this._calcDimensionsTransformMatrix(skewX, skewY, false),\n          bbox;\n      for (i = 0; i < points.length; i++) {\n        points[i] = fabric.util.transformPoint(points[i], transformMatrix);\n      }\n      bbox = fabric.util.makeBoundingBoxFromPoints(points);\n      return { x: bbox.width, y: bbox.height };\n    },\n\n    /*\n     * Calculate object dimensions for controls. include padding and canvas zoom\n     * private\n     */\n    _calculateCurrentDimensions: function()  {\n      var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = fabric.util.transformPoint(dim, vpt, true);\n\n      return p.scalarAdd(2 * this.padding);\n    },\n  });\n})();\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * Moves an object to the bottom of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendToBack: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n    }\n    else {\n      this.canvas.sendToBack(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to the top of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringToFront: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n    }\n    else {\n      this.canvas.bringToFront(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object down in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendBackwards: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\n    }\n    else {\n      this.canvas.sendBackwards(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object up in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringForward: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\n    }\n    else {\n      this.canvas.bringForward(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to specified level in stack of drawn objects\n   * @param {Number} index New position of object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  moveTo: function(index) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n    }\n    else {\n      this.canvas.moveTo(this, index);\n    }\n    return this;\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + ': none; ';\n    }\n    else if (value.toLive) {\n      return prop + ': url(#SVGID_' + value.id + '); ';\n    }\n    else {\n      var color = new fabric.Color(value),\n          str = prop + ': ' + color.toRgb() + '; ',\n          opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\n      }\n      return str;\n    }\n  }\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n\n      var fillRule = this.fillRule,\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\n          visibility = this.visible ? '' : ' visibility: hidden;',\n          filter = skipShadow ? '' : this.getSvgFilter(),\n          fill = getSvgColorString('fill', this.fill),\n          stroke = getSvgColorString('stroke', this.stroke);\n\n      return [\n        stroke,\n        'stroke-width: ', strokeWidth, '; ',\n        'stroke-dasharray: ', strokeDashArray, '; ',\n        'stroke-linecap: ', strokeLineCap, '; ',\n        'stroke-linejoin: ', strokeLineJoin, '; ',\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\n        fill,\n        'fill-rule: ', fillRule, '; ',\n        'opacity: ', opacity, ';',\n        filter,\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns filter for svg shadow\n     * @return {String}\n     */\n    getSvgFilter: function() {\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\n    },\n\n    /**\n     * Returns id attribute for svg output\n     * @return {String}\n     */\n    getSvgId: function() {\n      return this.id ? 'id=\"' + this.id + '\" ' : '';\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @return {String}\n     */\n    getSvgTransform: function() {\n      if (this.group && this.group.type === 'path-group') {\n        return '';\n      }\n      var toFixed = fabric.util.toFixed,\n          angle = this.getAngle(),\n          skewX = (this.getSkewX() % 360),\n          skewY = (this.getSkewY() % 360),\n          center = this.getCenterPoint(),\n\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          translatePart = this.type === 'path-group' ? '' : 'translate(' +\n                            toFixed(center.x, NUM_FRACTION_DIGITS) +\n                            ' ' +\n                            toFixed(center.y, NUM_FRACTION_DIGITS) +\n                          ')',\n\n          anglePart = angle !== 0\n            ? (' rotate(' + toFixed(angle, NUM_FRACTION_DIGITS) + ')')\n            : '',\n\n          scalePart = (this.scaleX === 1 && this.scaleY === 1)\n            ? '' :\n            (' scale(' +\n              toFixed(this.scaleX, NUM_FRACTION_DIGITS) +\n              ' ' +\n              toFixed(this.scaleY, NUM_FRACTION_DIGITS) +\n            ')'),\n\n          skewXPart = skewX !== 0 ? ' skewX(' + toFixed(skewX, NUM_FRACTION_DIGITS) + ')' : '',\n\n          skewYPart = skewY !== 0 ? ' skewY(' + toFixed(skewY, NUM_FRACTION_DIGITS) + ')' : '',\n\n          addTranslateX = this.type === 'path-group' ? this.width : 0,\n\n          flipXPart = this.flipX ? ' matrix(-1 0 0 1 ' + addTranslateX + ' 0) ' : '',\n\n          addTranslateY = this.type === 'path-group' ? this.height : 0,\n\n          flipYPart = this.flipY ? ' matrix(1 0 0 -1 0 ' + addTranslateY + ')' : '';\n\n      return [\n        translatePart, anglePart, scalePart, flipXPart, flipYPart, skewXPart, skewYPart\n      ].join('');\n    },\n\n    /**\n     * Returns transform-string for svg-export from the transform matrix of single elements\n     * @return {String}\n     */\n    getSvgTransformMatrix: function() {\n      return this.transformMatrix ? ' matrix(' + this.transformMatrix.join(' ') + ') ' : '';\n    },\n\n    /**\n     * @private\n     */\n    _createBaseSVGMarkup: function() {\n      var markup = [];\n\n      if (this.fill && this.fill.toLive) {\n        markup.push(this.fill.toSVG(this, false));\n      }\n      if (this.stroke && this.stroke.toLive) {\n        markup.push(this.stroke.toSVG(this, false));\n      }\n      if (this.shadow) {\n        markup.push(this.shadow.toSVG(this));\n      }\n      return markup;\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function() {\n\n  var extend = fabric.util.object.extend,\n      originalSet = 'stateProperties';\n\n  /*\n    Depends on `stateProperties`\n  */\n  function saveProps(origin, destination, props) {\n    var tmpObj = { }, deep = true;\n    props.forEach(function(prop) {\n      tmpObj[prop] = origin[prop];\n    });\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    }\n    else if (Array.isArray(origValue)) {\n      if (origValue.length !== currentValue.length) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    else if (origValue && typeof origValue === 'object') {\n      var keys = Object.keys(origValue), key;\n      if (!firstPass && keys.length !== Object.keys(currentValue).length) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Returns true if object state (one of its state properties) was changed\n     * @param {String} [propertySet] optional name for the set of property we want to save\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n     */\n    hasStateChanged: function(propertySet) {\n      propertySet = propertySet || originalSet;\n      var dashedPropertySet = '_' + propertySet;\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\n        return true;\n      }\n      return !_isEqual(this[dashedPropertySet], this, true);\n    },\n\n    /**\n     * Saves state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    saveState: function(options) {\n      var propertySet = options && options.propertySet || originalSet,\n          destination = '_' + propertySet;\n      if (!this[destination]) {\n        return this.setupState(options);\n      }\n      saveProps(this, destination, this[propertySet]);\n      if (options && options.stateProperties) {\n        saveProps(this, destination, options.stateProperties);\n      }\n      return this;\n    },\n\n    /**\n     * Setups state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    setupState: function(options) {\n      options = options || { };\n      var propertySet = options.propertySet || originalSet;\n      options.propertySet = propertySet;\n      this['_' + propertySet] = { };\n      this.saveState(options);\n      return this;\n    }\n  });\n})();\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      /* eslint-disable camelcase */\n      isVML = function() { return typeof G_vmlCanvasManager !== 'undefined'; };\n      /* eslint-enable camelcase */\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * The object interactivity controls.\n     * @private\n     */\n    _controlsVisibility: null,\n\n    /**\n     * Determines which corner has been clicked\n     * @private\n     * @param {Object} pointer The pointer indicating the mouse position\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(pointer) {\n      if (!this.hasControls || !this.active) {\n        return false;\n      }\n\n      var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines;\n      this.__corner = 0;\n      for (var i in this.oCoords) {\n\n        if (!this.isControlVisible(i)) {\n          continue;\n        }\n\n        if (i === 'mtr' && !this.hasRotatingPoint) {\n          continue;\n        }\n\n        if (this.get('lockUniScaling') &&\n           (i === 'mt' || i === 'mr' || i === 'mb' || i === 'ml')) {\n          continue;\n        }\n\n        lines = this._getImageLines(this.oCoords[i].corner);\n\n        // debugging\n\n        // canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n\n        // canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n        if (xPoints !== 0 && xPoints % 2 === 1) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords,\n          newTheta = degreesToRadians(45 - this.angle),\n          /* Math.sqrt(2 * Math.pow(this.cornerSize, 2)) / 2, */\n          /* 0.707106 stands for sqrt(2)/2 */\n          cornerHypotenuse = this.cornerSize * 0.707106,\n          cosHalfOffset = cornerHypotenuse * Math.cos(newTheta),\n          sinHalfOffset = cornerHypotenuse * Math.sin(newTheta),\n          x, y;\n\n      for (var point in coords) {\n        x = coords[point].x;\n        y = coords[point].y;\n        coords[point].corner = {\n          tl: {\n            x: x - sinHalfOffset,\n            y: y - cosHalfOffset\n          },\n          tr: {\n            x: x + cosHalfOffset,\n            y: y - sinHalfOffset\n          },\n          bl: {\n            x: x - cosHalfOffset,\n            y: y + sinHalfOffset\n          },\n          br: {\n            x: x + sinHalfOffset,\n            y: y + cosHalfOffset\n          }\n        };\n      }\n    },\n\n    /**\n     * Draws a colored layer behind the object, inside its selection borders.\n     * Requires public options: padding, selectionBackgroundColor\n     * this function is called when the context is transformed\n     * has checks to be skipped when the object is on a staticCanvas\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawSelectionBackground: function(ctx) {\n      if (!this.selectionBackgroundColor || this.group || !this.active ||\n        (this.canvas && !this.canvas.interactive)) {\n        return this;\n      }\n      ctx.save();\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n      ctx.translate(center.x, center.y);\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\n      ctx.rotate(degreesToRadians(this.angle));\n      ctx.fillStyle = this.selectionBackgroundColor;\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx) {\n      if (!this.hasBorders) {\n        return this;\n      }\n\n      var wh = this._calculateCurrentDimensions(),\n          strokeWidth = 1 / this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth;\n\n      ctx.save();\n      ctx.strokeStyle = this.borderColor;\n      this._setLineDash(ctx, this.borderDashArray, null);\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      if (this.hasRotatingPoint && this.isControlVisible('mtr') && !this.get('lockRotation') && this.hasControls) {\n\n        var rotateHeight = -height / 2;\n\n        ctx.beginPath();\n        ctx.moveTo(0, rotateHeight);\n        ctx.lineTo(0, rotateHeight - this.rotatingPointOffset);\n        ctx.closePath();\n        ctx.stroke();\n      }\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box when it is inside a group.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {object} options object representing current object parameters\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBordersInGroup: function(ctx, options) {\n      if (!this.hasBorders) {\n        return this;\n      }\n\n      var p = this._getNonTransformedDimensions(),\n          matrix = fabric.util.customTransformMatrix(options.scaleX, options.scaleY, options.skewX),\n          wh = fabric.util.transformPoint(p, matrix),\n          strokeWidth = 1 / this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth;\n\n      ctx.save();\n      this._setLineDash(ctx, this.borderDashArray, null);\n      ctx.strokeStyle = this.borderColor;\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: cornerSize, padding\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawControls: function(ctx) {\n      if (!this.hasControls) {\n        return this;\n      }\n\n      var wh = this._calculateCurrentDimensions(),\n          width = wh.x,\n          height = wh.y,\n          scaleOffset = this.cornerSize,\n          left = -(width + scaleOffset) / 2,\n          top = -(height + scaleOffset) / 2,\n          methodName = this.transparentCorners ? 'stroke' : 'fill';\n\n      ctx.save();\n      ctx.strokeStyle = ctx.fillStyle = this.cornerColor;\n      if (!this.transparentCorners) {\n        ctx.strokeStyle = this.cornerStrokeColor;\n      }\n      this._setLineDash(ctx, this.cornerDashArray, null);\n\n      // top-left\n      this._drawControl('tl', ctx, methodName,\n        left,\n        top);\n\n      // top-right\n      this._drawControl('tr', ctx, methodName,\n        left + width,\n        top);\n\n      // bottom-left\n      this._drawControl('bl', ctx, methodName,\n        left,\n        top + height);\n\n      // bottom-right\n      this._drawControl('br', ctx, methodName,\n        left + width,\n        top + height);\n\n      if (!this.get('lockUniScaling')) {\n\n        // middle-top\n        this._drawControl('mt', ctx, methodName,\n          left + width / 2,\n          top);\n\n        // middle-bottom\n        this._drawControl('mb', ctx, methodName,\n          left + width / 2,\n          top + height);\n\n        // middle-right\n        this._drawControl('mr', ctx, methodName,\n          left + width,\n          top + height / 2);\n\n        // middle-left\n        this._drawControl('ml', ctx, methodName,\n          left,\n          top + height / 2);\n      }\n\n      // middle-top-rotate\n      if (this.hasRotatingPoint) {\n        this._drawControl('mtr', ctx, methodName,\n          left + width / 2,\n          top - this.rotatingPointOffset);\n      }\n\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _drawControl: function(control, ctx, methodName, left, top) {\n      if (!this.isControlVisible(control)) {\n        return;\n      }\n      var size = this.cornerSize, stroke = !this.transparentCorners && this.cornerStrokeColor;\n      switch (this.cornerStyle) {\n        case 'circle':\n          ctx.beginPath();\n          ctx.arc(left + size / 2, top + size / 2, size / 2, 0, 2 * Math.PI, false);\n          ctx[methodName]();\n          if (stroke) {\n            ctx.stroke();\n          }\n          break;\n        default:\n          isVML() || this.transparentCorners || ctx.clearRect(left, top, size, size);\n          ctx[methodName + 'Rect'](left, top, size, size);\n          if (stroke) {\n            ctx.strokeRect(left, top, size, size);\n          }\n      }\n    },\n\n    /**\n     * Returns true if the specified control is visible, false otherwise.\n     * @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @returns {Boolean} true if the specified control is visible, false otherwise\n     */\n    isControlVisible: function(controlName) {\n      return this._getControlsVisibility()[controlName];\n    },\n\n    /**\n     * Sets the visibility of the specified control.\n     * @param {String} controlName The name of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlVisible: function(controlName, visible) {\n      this._getControlsVisibility()[controlName] = visible;\n      return this;\n    },\n\n    /**\n     * Sets the visibility state of object controls.\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlsVisibility: function(options) {\n      options || (options = { });\n\n      for (var p in options) {\n        this.setControlVisible(p, options[p]);\n      }\n      return this;\n    },\n\n    /**\n     * Returns the instance of the control visibility set for this object.\n     * @private\n     * @returns {Object}\n     */\n    _getControlsVisibility: function() {\n      if (!this._controlsVisibility) {\n        this._controlsVisibility = {\n          tl: true,\n          tr: true,\n          br: true,\n          bl: true,\n          ml: true,\n          mt: true,\n          mr: true,\n          mb: true,\n          mtr: true\n        };\n      }\n      return this._controlsVisibility;\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Animation duration (in ms) for fx* methods\n   * @type Number\n   * @default\n   */\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('left'),\n      endValue: this.getCenter().left,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('top'),\n      endValue: this.getCenter().top,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @param {fabric.Object} object Object to remove\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.get('opacity'),\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onStart: function() {\n        object.set('active', false);\n      },\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.renderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n  /**\n   * Animates object's properties\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n   * @return {fabric.Object} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n   * @chainable\n   *\n   * As object — multiple properties\n   *\n   * object.animate({ left: ..., top: ... });\n   * object.animate({ left: ..., top: ... }, { duration: ... });\n   *\n   * As string — one property\n   *\n   * object.animate('left', ...);\n   * object.animate('left', { duration: ... });\n   *\n   */\n  animate: function() {\n    if (arguments[0] && typeof arguments[0] === 'object') {\n      var propsToAnimate = [], prop, skipCallbacks;\n      for (prop in arguments[0]) {\n        propsToAnimate.push(prop);\n      }\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n        prop = propsToAnimate[i];\n        skipCallbacks = i !== len - 1;\n        this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks);\n      }\n    }\n    else {\n      this._animate.apply(this, arguments);\n    }\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to animate\n   * @param {String} to Value to animate to\n   * @param {Object} [options] Options object\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n   */\n  _animate: function(property, to, options, skipCallbacks) {\n    var _this = this, propPair;\n\n    to = to.toString();\n\n    if (!options) {\n      options = { };\n    }\n    else {\n      options = fabric.util.object.clone(options);\n    }\n\n    if (~property.indexOf('.')) {\n      propPair = property.split('.');\n    }\n\n    var currentValue = propPair\n      ? this.get(propPair[0])[propPair[1]]\n      : this.get(property);\n\n    if (!('from' in options)) {\n      options.from = currentValue;\n    }\n\n    if (~to.indexOf('=')) {\n      to = currentValue + parseFloat(to.replace('=', ''));\n    }\n    else {\n      to = parseFloat(to);\n    }\n\n    fabric.util.animate({\n      startValue: options.from,\n      endValue: to,\n      byValue: options.by,\n      easing: options.easing,\n      duration: options.duration,\n      abort: options.abort && function() {\n        return options.abort.call(_this);\n      },\n      onChange: function(value, valueProgress, timeProgress) {\n        if (propPair) {\n          _this[propPair[0]][propPair[1]] = value;\n        }\n        else {\n          _this.set(property, value);\n        }\n        if (skipCallbacks) {\n          return;\n        }\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\n      },\n      onComplete: function(value, valueProgress, timeProgress) {\n        if (skipCallbacks) {\n          return;\n        }\n\n        _this.setCoords();\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\n      }\n    });\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 },\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash');\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'x1',\n    'x2',\n    'y1',\n    'y2'\n  );\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'line',\n\n    /**\n     * x value or first line edge\n     * @type Number\n     * @default\n     */\n    x1: 0,\n\n    /**\n     * y value or first line edge\n     * @type Number\n     * @default\n     */\n    y1: 0,\n\n    /**\n     * x value or second line edge\n     * @type Number\n     * @default\n     */\n    x2: 0,\n\n    /**\n     * y value or second line edge\n     * @type Number\n     * @default\n     */\n    y2: 0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Array} [points] Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.width = Math.abs(this.x2 - this.x1);\n      this.height = Math.abs(this.y2 - this.y1);\n\n      this.left = 'left' in options\n        ? options.left\n        : this._getLeftToOriginX();\n\n      this.top = 'top' in options\n        ? options.top\n        : this._getTopToOriginY();\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      if (typeof coordProps[key] !== 'undefined') {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n     */\n    _getLeftToOriginX: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originX',\n        axis1: 'x1',\n        axis2: 'x2',\n        dimension: 'width'\n      },\n      { // possible values of origin\n        nearest: 'left',\n        center: 'center',\n        farthest: 'right'\n      }\n    ),\n\n    /**\n     * @private\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n     */\n    _getTopToOriginY: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originY',\n        axis1: 'y1',\n        axis2: 'y2',\n        dimension: 'height'\n      },\n      { // possible values of origin\n        nearest: 'top',\n        center: 'center',\n        farthest: 'bottom'\n      }\n    ),\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n\n      if (noTransform) {\n        //  Line coords are distances from left-top of canvas to origin of line.\n        //  To render line in a path-group, we need to translate them to\n        //  distances from center of path-group to center of line.\n        var cp = this.getCenterPoint(),\n            offset = this.strokeWidth / 2;\n        ctx.translate(\n          cp.x - (this.strokeLineCap === 'butt' && this.height === 0 ? 0 : offset),\n          cp.y - (this.strokeLineCap === 'butt' && this.width === 0 ? 0 : offset)\n        );\n      }\n\n      if (!this.strokeDashArray || this.strokeDashArray && supportsLineDash) {\n        // move from center (of virtual box) to its left/top corner\n        // we can't assume x1, y1 is top left and x2, y2 is bottom right\n        var p = this.calcLinePoints();\n        ctx.moveTo(p.x1, p.y1);\n        ctx.lineTo(p.x2, p.y2);\n      }\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\n      this.stroke && this._renderStroke(ctx);\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p = this.calcLinePoints();\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, p.x1, p.y1, p.x2, p.y2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @methd toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     */\n    _getNonTransformedDimensions: function() {\n      var dim = this.callSuper('_getNonTransformedDimensions');\n      if (this.strokeLineCap === 'butt') {\n        if (this.width === 0) {\n          dim.y -= this.strokeWidth;\n        }\n        if (this.height === 0) {\n          dim.x -= this.strokeWidth;\n        }\n      }\n      return dim;\n    },\n\n    /**\n     * Recalculates line points given width and height\n     * @private\n     */\n    calcLinePoints: function() {\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = (xMult * this.width * 0.5),\n          y1 = (yMult * this.height * 0.5),\n          x2 = (xMult * this.width * -0.5),\n          y2 = (yMult * this.height * -0.5);\n\n      return {\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      };\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(),\n          p = { x1: this.x1, x2: this.x2, y1: this.y1, y2: this.y2 };\n\n      if (!(this.group && this.group.type === 'path-group')) {\n        p = this.calcLinePoints();\n      }\n      markup.push(\n        '<line ', this.getSvgId(),\n          'x1=\"', p.x1,\n          '\" y1=\"', p.y1,\n          '\" x2=\"', p.x2,\n          '\" y2=\"', p.y2,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          this.getSvgTransformMatrix(),\n        '\"/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Line} instance of fabric.Line\n   */\n  fabric.Line.fromElement = function(element, options) {\n    options = options || { };\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\n        points = [\n          parsedAttributes.x1 || 0,\n          parsedAttributes.y1 || 0,\n          parsedAttributes.x2 || 0,\n          parsedAttributes.y2 || 0\n        ];\n    options.originX = 'left';\n    options.originY = 'top';\n    return new fabric.Line(points, extend(parsedAttributes, options));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Line} instance of fabric.Line\n   */\n  fabric.Line.fromObject = function(object, callback, forceAsync) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    };\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    var line = fabric.Object._fromObject('Line', options, _callback, forceAsync, 'points');\n    if (line) {\n      delete line.points;\n    }\n    return line;\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n        axis1 = propertyNames.axis1,\n        axis2 = propertyNames.axis2,\n        dimension = propertyNames.dimension,\n        nearest = originValues.nearest,\n        center = originValues.center,\n        farthest = originValues.farthest;\n\n    return function() {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n\n  }\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      pi = Math.PI,\n      extend = fabric.util.object.extend;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'radius'\n  );\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'circle',\n\n    /**\n     * Radius of this circle\n     * @type Number\n     * @default\n     */\n    radius: 0,\n\n    /**\n     * Start angle of the circle, moving clockwise\n     * @type Number\n     * @default 0\n     */\n    startAngle: 0,\n\n    /**\n     * End angle of the circle\n     * @type Number\n     * @default 2Pi\n     */\n    endAngle: pi * 2,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Circle} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('radius', options && options.radius || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Circle} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (key === 'radius') {\n        this.setRadius(value);\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = 0, y = 0,\n          angle = (this.endAngle - this.startAngle) % ( 2 * pi);\n\n      if (angle === 0) {\n        if (this.group && this.group.type === 'path-group') {\n          x = this.left + this.radius;\n          y = this.top + this.radius;\n        }\n        markup.push(\n          '<circle ', this.getSvgId(),\n            'cx=\"' + x + '\" cy=\"' + y + '\" ',\n            'r=\"', this.radius,\n            '\" style=\"', this.getSvgStyles(),\n            '\" transform=\"', this.getSvgTransform(),\n            ' ', this.getSvgTransformMatrix(),\n          '\"/>\\n'\n        );\n      }\n      else {\n        var startX = Math.cos(this.startAngle) * this.radius,\n            startY = Math.sin(this.startAngle) * this.radius,\n            endX = Math.cos(this.endAngle) * this.radius,\n            endY = Math.sin(this.endAngle) * this.radius,\n            largeFlag = angle > pi ? '1' : '0';\n\n        markup.push(\n          '<path d=\"M ' + startX + ' ' + startY,\n          ' A ' + this.radius + ' ' + this.radius,\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          ' ', this.getSvgTransformMatrix(),\n          '\"/>\\n'\n        );\n      }\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n      ctx.arc(noTransform ? this.left + this.radius : 0,\n              noTransform ? this.top + this.radius : 0,\n              this.radius,\n              this.startAngle,\n              this.endAngle, false);\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @return {fabric.Circle} thisArg\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      return this.set('width', value * 2).set('height', value * 2);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   * @return {fabric.Circle} Instance of fabric.Circle\n   */\n  fabric.Circle.fromElement = function(element, options) {\n    options || (options = { });\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error('value of `r` attribute is required and can not be negative');\n    }\n\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top = parsedAttributes.top || 0;\n\n    var obj = new fabric.Circle(extend(parsedAttributes, options));\n\n    obj.left -= obj.radius;\n    obj.top -= obj.radius;\n    return obj;\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius >= 0));\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {Object} Instance of fabric.Circle\n   */\n  fabric.Circle.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Circle', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'triangle',\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('width', options && options.width || 100)\n          .set('height', options && options.height || 100);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, -widthBy2, heightBy2, 0, -heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, 0, -heightBy2, widthBy2, heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, widthBy2, heightBy2, -widthBy2, heightBy2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(),\n          widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + ' ' + heightBy2,\n            '0 ' + -heightBy2,\n            widthBy2 + ' ' + heightBy2\n          ]\n          .join(',');\n\n      markup.push(\n        '<polygon ', this.getSvgId(),\n          'points=\"', points,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n        '\"/>'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Triangle}\n   */\n  fabric.Triangle.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Triangle', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2,\n      extend = fabric.util.object.extend;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'rx',\n    'ry'\n  );\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'ellipse',\n\n    /**\n     * Horizontal radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Ellipse} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('rx', options && options.rx || 0);\n      this.set('ry', options && options.ry || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Ellipse} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      switch (key) {\n\n        case 'rx':\n          this.rx = value;\n          this.set('width', value * 2);\n          break;\n\n        case 'ry':\n          this.ry = value;\n          this.set('height', value * 2);\n          break;\n\n      }\n      return this;\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRx: function() {\n      return this.get('rx') * this.get('scaleX');\n    },\n\n    /**\n     * Returns Vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRy: function() {\n      return this.get('ry') * this.get('scaleY');\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = 0, y = 0;\n      if (this.group && this.group.type === 'path-group') {\n        x = this.left + this.rx;\n        y = this.top + this.ry;\n      }\n      markup.push(\n        '<ellipse ', this.getSvgId(),\n          'cx=\"', x, '\" cy=\"', y, '\" ',\n          'rx=\"', this.rx,\n          '\" ry=\"', this.ry,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          this.getSvgTransformMatrix(),\n        '\"/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    _render: function(ctx, noTransform) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n      ctx.arc(\n        noTransform ? this.left + this.rx : 0,\n        noTransform ? (this.top + this.ry) * this.rx / this.ry : 0,\n        this.rx,\n        0,\n        piBy2,\n        false);\n      ctx.restore();\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, options) {\n    options || (options = { });\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top = parsedAttributes.top || 0;\n\n    var ellipse = new fabric.Ellipse(extend(parsedAttributes, options));\n\n    ellipse.top -= ellipse.ry;\n    ellipse.left -= ellipse.rx;\n    return ellipse;\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Ellipse', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push('rx', 'ry');\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push('rx', 'ry');\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\n\n    /**\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: stateProperties,\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'rect',\n\n    /**\n     * Horizontal border radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical border radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Initializes rx/ry attributes\n     * @private\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n\n      // optimize 1x1 case (used in spray brush)\n      if (this.width === 1 && this.height === 1) {\n        ctx.fillRect(-0.5, -0.5, 1, 1);\n        return;\n      }\n\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = noTransform ? this.left : -this.width / 2,\n          y = noTransform ? this.top : -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n      ctx.beginPath();\n\n      ctx.moveTo(x + rx, y);\n\n      ctx.lineTo(x + w - rx, y);\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\n\n      ctx.lineTo(x + w, y + h - ry);\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\n\n      ctx.lineTo(x + rx, y + h);\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\n\n      ctx.lineTo(x, y + ry);\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n      ctx.closePath();\n\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = this.left, y = this.top;\n      if (!(this.group && this.group.type === 'path-group')) {\n        x = -this.width / 2;\n        y = -this.height / 2;\n      }\n      markup.push(\n        '<rect ', this.getSvgId(),\n          'x=\"', x, '\" y=\"', y,\n          '\" rx=\"', this.get('rx'), '\" ry=\"', this.get('ry'),\n          '\" width=\"', this.width, '\" height=\"', this.height,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          this.getSvgTransformMatrix(),\n        '\"/>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Rect} Instance of fabric.Rect\n   */\n  fabric.Rect.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n    options = options || { };\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top  = parsedAttributes.top  || 0;\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    return rect;\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {Object} instance of fabric.Rect\n   */\n  fabric.Rect.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Rect', object, callback, forceAsync);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed,\n      NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push('points');\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polyline',\n\n    /**\n     * Points array\n     * @type Array\n     * @default\n     */\n    points: null,\n\n    /**\n     * Minimum X from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minX: 0,\n\n    /**\n     * Minimum Y from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minY: 0,\n\n    cacheProperties: cacheProperties,\n\n    /**\n     * Constructor\n     * @param {Array} points Array of points (where each point is an object with x and y)\n     * @param {Object} [options] Options object\n     * @return {fabric.Polyline} thisArg\n     * @example\n     * var poly = new fabric.Polyline([\n     *     { x: 10, y: 10 },\n     *     { x: 50, y: 30 },\n     *     { x: 40, y: 70 },\n     *     { x: 60, y: 50 },\n     *     { x: 100, y: 150 },\n     *     { x: 40, y: 100 }\n     *   ], {\n     *   stroke: 'red',\n     *   left: 100,\n     *   top: 100\n     * });\n     */\n    initialize: function(points, options) {\n      options = options || {};\n      this.points = points || [];\n      this.callSuper('initialize', options);\n      this._calcDimensions();\n      if (!('top' in options)) {\n        this.top = this.minY;\n      }\n      if (!('left' in options)) {\n        this.left = this.minX;\n      }\n      this.pathOffset = {\n        x: this.minX + this.width / 2,\n        y: this.minY + this.height / 2\n      };\n    },\n\n    /**\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var points = this.points,\n          minX = min(points, 'x'),\n          minY = min(points, 'y'),\n          maxX = max(points, 'x'),\n          maxY = max(points, 'y');\n\n      this.width = (maxX - minX) || 0;\n      this.height = (maxY - minY) || 0;\n      this.minX = minX || 0;\n      this.minY = minY || 0;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        points: this.points.concat()\n      });\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var points = [],\n          diffX = 0,\n          diffY = 0,\n          markup = this._createBaseSVGMarkup();\n\n      if (!(this.group && this.group.type === 'path-group')) {\n        diffX = this.pathOffset.x;\n        diffY = this.pathOffset.y;\n      }\n\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\n        );\n      }\n      markup.push(\n        '<', this.type, ' ', this.getSvgId(),\n          'points=\"', points.join(''),\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(),\n          ' ', this.getSvgTransformMatrix(),\n        '\"/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    commonRender: function(ctx, noTransform) {\n      var point, len = this.points.length,\n          x = noTransform ? 0 : this.pathOffset.x,\n          y = noTransform ? 0 : this.pathOffset.y;\n\n      if (!len || isNaN(this.points[len - 1].y)) {\n        // do not draw if no points or odd points\n        // NaN comes from parseFloat of a empty string in parser\n        return false;\n      }\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n      for (var i = 0; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x - x, point.y - y);\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      if (!this.commonRender(ctx, noTransform)) {\n        return;\n      }\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p1, p2;\n\n      ctx.beginPath();\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        p1 = this.points[i];\n        p2 = this.points[i + 1] || p1;\n        fabric.util.drawDashedLine(ctx, p1.x, p1.y, p2.x, p2.y, this.strokeDashArray);\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Polyline} Instance of fabric.Polyline\n   */\n  fabric.Polyline.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polyline.ATTRIBUTE_NAMES);\n\n    return new fabric.Polyline(points, fabric.util.object.extend(parsedAttributes, options));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Polyline} Instance of fabric.Polyline\n   */\n  fabric.Polyline.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Polyline', object, callback, forceAsync, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polygon',\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      if (!this.commonRender(ctx, noTransform)) {\n        return;\n      }\n      ctx.closePath();\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      this.callSuper('_renderDashedStroke', ctx);\n      ctx.closePath();\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Polygon} Instance of fabric.Polygon\n   */\n  fabric.Polygon.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n\n    options || (options = { });\n\n    var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n        parsedAttributes = fabric.parseAttributes(element, fabric.Polygon.ATTRIBUTE_NAMES);\n\n    return new fabric.Polygon(points, extend(parsedAttributes, options));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Polygon} Instance of fabric.Polygon\n   */\n  fabric.Polygon.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Polygon', object, callback, forceAsync, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      _toString = Object.prototype.toString,\n      drawArc = fabric.util.drawArc,\n      commandLengths = {\n        m: 2,\n        l: 2,\n        h: 1,\n        v: 1,\n        c: 6,\n        s: 4,\n        q: 4,\n        t: 2,\n        a: 7\n      },\n      repeatedCommands = {\n        m: 'l',\n        M: 'L'\n      };\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push('path');\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push('path', 'fillRule');\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path',\n\n    /**\n     * Array of path points\n     * @type Array\n     * @default\n     */\n    path: null,\n\n    /**\n     * Minimum X from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minX: 0,\n\n    /**\n     * Minimum Y from points values, necessary to offset points\n     * @type Number\n     * @default\n     */\n    minY: 0,\n\n    cacheProperties: cacheProperties,\n\n    stateProperties: stateProperties,\n\n    /**\n     * Constructor\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     * @return {fabric.Path} thisArg\n     */\n    initialize: function(path, options) {\n      options = options || { };\n      this.callSuper('initialize', options);\n\n      if (!path) {\n        path = [];\n      }\n\n      var fromArray = _toString.call(path) === '[object Array]';\n\n      this.path = fromArray\n        ? path\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        : path.match && path.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n      if (!this.path) {\n        return;\n      }\n\n      if (!fromArray) {\n        this.path = this._parsePath();\n      }\n\n      this._setPositionDimensions(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} options Options object\n     */\n    _setPositionDimensions: function(options) {\n      var calcDim = this._parseDimensions();\n\n      this.minX = calcDim.left;\n      this.minY = calcDim.top;\n      this.width = calcDim.width;\n      this.height = calcDim.height;\n\n      if (typeof options.left === 'undefined') {\n        this.left = calcDim.left + (this.originX === 'center'\n          ? this.width / 2\n          : this.originX === 'right'\n            ? this.width\n            : 0);\n      }\n\n      if (typeof options.top === 'undefined') {\n        this.top = calcDim.top + (this.originY === 'center'\n          ? this.height / 2\n          : this.originY === 'bottom'\n            ? this.height\n            : 0);\n      }\n\n      this.pathOffset = this.pathOffset || {\n        x: this.minX + this.width / 2,\n        y: this.minY + this.height / 2\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _renderPathCommands: function(ctx) {\n      var current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n      if (this.group && this.group.type === 'path-group') {\n        l = 0;\n        t = 0;\n      }\n\n      ctx.beginPath();\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'l': // lineto, relative\n            x += current[1];\n            y += current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'h': // horizontal lineto, relative\n            x += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'H': // horizontal lineto, absolute\n            x = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'v': // vertical lineto, relative\n            y += current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'V': // verical lineto, absolute\n            y = current[1];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'm': // moveTo, relative\n            x += current[1];\n            y += current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'c': // bezierCurveTo, relative\n            tempX = x + current[5];\n            tempY = y + current[6];\n            controlX = x + current[3];\n            controlY = y + current[4];\n            ctx.bezierCurveTo(\n              x + current[1] + l, // x1\n              y + current[2] + t, // y1\n              controlX + l, // x2\n              controlY + t, // y2\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 's': // shorthand cubic bezierCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              x + current[1] + l,\n              y + current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'S': // shorthand cubic bezierCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            ctx.bezierCurveTo(\n              controlX + l,\n              controlY + t,\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = current[1];\n            controlY = current[2];\n\n            break;\n\n          case 'q': // quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            controlX = x + current[1];\n            controlY = y + current[2];\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 't': // shorthand quadraticCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[1];\n            tempY = y + current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n\n            break;\n\n          case 'T':\n            tempX = current[1];\n            tempY = current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            ctx.quadraticCurveTo(\n              controlX + l,\n              controlY + t,\n              tempX + l,\n              tempY + t\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'a':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + x + l,\n              current[7] + y + t\n            ]);\n            x += current[6];\n            y += current[7];\n            break;\n\n          case 'A':\n            // TODO: optimize this\n            drawArc(ctx, x + l, y + t, [\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + l,\n              current[7] + t\n            ]);\n            x = current[6];\n            y = current[7];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            ctx.closePath();\n            break;\n        }\n        previous = current;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _render: function(ctx) {\n      this._renderPathCommands(ctx);\n      this._renderFill(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var o = extend(this.callSuper('toObject', ['sourcePath', 'pathOffset'].concat(propertiesToInclude)), {\n        path: this.path.map(function(item) { return item.slice(); }),\n        top: this.top,\n        left: this.left,\n      });\n      return o;\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(propertiesToInclude);\n      if (this.sourcePath) {\n        o.path = this.sourcePath;\n      }\n      delete o.sourcePath;\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var chunks = [],\n          markup = this._createBaseSVGMarkup(), addTransform = '';\n\n      for (var i = 0, len = this.path.length; i < len; i++) {\n        chunks.push(this.path[i].join(' '));\n      }\n      var path = chunks.join(' ');\n      if (!(this.group && this.group.type === 'path-group')) {\n        addTransform = ' translate(' + (-this.pathOffset.x) + ', ' + (-this.pathOffset.y) + ') ';\n      }\n      markup.push(\n        '<path ', this.getSvgId(),\n          'd=\"', path,\n          '\" style=\"', this.getSvgStyles(),\n          '\" transform=\"', this.getSvgTransform(), addTransform,\n          this.getSvgTransformMatrix(), '\" stroke-linecap=\"round\" ',\n        '/>\\n'\n      );\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns number representation of an instance complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     */\n    _parsePath: function() {\n      var result = [],\n          coords = [],\n          currentPath,\n          parsed,\n          re = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:e[-+]?\\d+)?)/ig,\n          match,\n          coordsStr;\n\n      for (var i = 0, coordsParsed, len = this.path.length; i < len; i++) {\n        currentPath = this.path[i];\n\n        coordsStr = currentPath.slice(1).trim();\n        coords.length = 0;\n\n        while ((match = re.exec(coordsStr))) {\n          coords.push(match[0]);\n        }\n\n        coordsParsed = [currentPath.charAt(0)];\n\n        for (var j = 0, jlen = coords.length; j < jlen; j++) {\n          parsed = parseFloat(coords[j]);\n          if (!isNaN(parsed)) {\n            coordsParsed.push(parsed);\n          }\n        }\n\n        var command = coordsParsed[0],\n            commandLength = commandLengths[command.toLowerCase()],\n            repeatedCommand = repeatedCommands[command] || command;\n\n        if (coordsParsed.length - 1 > commandLength) {\n          for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\n            result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\n            command = repeatedCommand;\n          }\n        }\n        else {\n          result.push(coordsParsed);\n        }\n      }\n\n      return result;\n    },\n\n    /**\n     * @private\n     */\n    _parseDimensions: function() {\n\n      var aX = [],\n          aY = [],\n          current, // current instruction\n          previous = null,\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          tempX,\n          tempY,\n          bounds;\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'l': // lineto, relative\n            x += current[1];\n            y += current[2];\n            bounds = [];\n            break;\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            bounds = [];\n            break;\n\n          case 'h': // horizontal lineto, relative\n            x += current[1];\n            bounds = [];\n            break;\n\n          case 'H': // horizontal lineto, absolute\n            x = current[1];\n            bounds = [];\n            break;\n\n          case 'v': // vertical lineto, relative\n            y += current[1];\n            bounds = [];\n            break;\n\n          case 'V': // verical lineto, absolute\n            y = current[1];\n            bounds = [];\n            break;\n\n          case 'm': // moveTo, relative\n            x += current[1];\n            y += current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'c': // bezierCurveTo, relative\n            tempX = x + current[5];\n            tempY = y + current[6];\n            controlX = x + current[3];\n            controlY = y + current[4];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              x + current[1], // x1\n              y + current[2], // y1\n              controlX, // x2\n              controlY, // y2\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            controlX = current[3];\n            controlY = current[4];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              controlX,\n              controlY,\n              current[5],\n              current[6]\n            );\n            x = current[5];\n            y = current[6];\n            break;\n\n          case 's': // shorthand cubic bezierCurveTo, relative\n\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              x + current[1],\n              y + current[2],\n              tempX,\n              tempY\n            );\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = x + current[1];\n            controlY = y + current[2];\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'S': // shorthand cubic bezierCurveTo, absolute\n            tempX = current[3];\n            tempY = current[4];\n            if (previous[0].match(/[CcSs]/) === null) {\n              // If there is no previous command or if the previous command was not a C, c, S, or s,\n              // the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control points\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              current[1],\n              current[2],\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            // set control point to 2nd one of this command\n            // \"... the first control point is assumed to be\n            // the reflection of the second control point on\n            // the previous command relative to the current point.\"\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 'q': // quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[3];\n            tempY = y + current[4];\n            controlX = x + current[1];\n            controlY = y + current[2];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            controlX = current[1];\n            controlY = current[2];\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              current[3],\n              current[4]\n            );\n            x = current[3];\n            y = current[4];\n            break;\n\n          case 't': // shorthand quadraticCurveTo, relative\n            // transform to absolute x,y\n            tempX = x + current[1];\n            tempY = y + current[2];\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n\n            break;\n\n          case 'T':\n            tempX = current[1];\n            tempY = current[2];\n\n            if (previous[0].match(/[QqTt]/) === null) {\n              // If there is no previous command or if the previous command was not a Q, q, T or t,\n              // assume the control point is coincident with the current point\n              controlX = x;\n              controlY = y;\n            }\n            else {\n              // calculate reflection of previous control point\n              controlX = 2 * x - controlX;\n              controlY = 2 * y - controlY;\n            }\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              controlX,\n              controlY,\n              controlX,\n              controlY,\n              tempX,\n              tempY\n            );\n            x = tempX;\n            y = tempY;\n            break;\n\n          case 'a':\n            // TODO: optimize this\n            bounds = fabric.util.getBoundsOfArc(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6] + x,\n              current[7] + y\n            );\n            x += current[6];\n            y += current[7];\n            break;\n\n          case 'A':\n            // TODO: optimize this\n            bounds = fabric.util.getBoundsOfArc(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6],\n              current[7]\n            );\n            x = current[6];\n            y = current[7];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            break;\n        }\n        previous = current;\n        bounds.forEach(function (point) {\n          aX.push(point.x);\n          aY.push(point.y);\n        });\n        aX.push(x);\n        aY.push(y);\n      }\n\n      var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY,\n\n          o = {\n            left: minX,\n            top: minY,\n            width: deltaX,\n            height: deltaY\n          };\n\n      return o;\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   */\n  fabric.Path.fromObject = function(object, callback, forceAsync) {\n    // remove this pattern rom 2.0, accept just object.\n    var path;\n    if (typeof object.path === 'string') {\n      fabric.loadSVGFromURL(object.path, function (elements) {\n        var pathUrl = object.path;\n        path = elements[0];\n        delete object.path;\n\n        path.setOptions(object);\n        path.setSourcePath(pathUrl);\n\n        callback && callback(path);\n      });\n    }\n    else {\n      return fabric.Object._fromObject('Path', object, callback, forceAsync, 'path');\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   */\n  fabric.Path.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    callback && callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @memberOf fabric.Path\n   * @type Boolean\n   * @default\n   */\n  fabric.Path.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.PathGroup) {\n    fabric.warn('fabric.PathGroup is already defined');\n    return;\n  }\n\n  /**\n   * Path group class\n   * @class fabric.PathGroup\n   * @extends fabric.Path\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.PathGroup#initialize} for constructor definition\n   */\n  fabric.PathGroup = fabric.util.createClass(fabric.Object, /** @lends fabric.PathGroup.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path-group',\n\n    /**\n     * Fill value\n     * @type String\n     * @default\n     */\n    fill: '',\n\n    /**\n     * Pathgroups are container, do not render anything on theyr own, ence no cache properties\n     * @type Boolean\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * Constructor\n     * @param {Array} paths\n     * @param {Object} [options] Options object\n     * @return {fabric.PathGroup} thisArg\n     */\n    initialize: function(paths, options) {\n\n      options = options || { };\n      this.paths = paths || [];\n\n      for (var i = this.paths.length; i--;) {\n        this.paths[i].group = this;\n      }\n\n      if (options.toBeParsed) {\n        this.parseDimensionsFromPaths(options);\n        delete options.toBeParsed;\n      }\n      this.setOptions(options);\n      this.setCoords();\n    },\n\n    /**\n     * Calculate width and height based on paths contained\n     */\n    parseDimensionsFromPaths: function(options) {\n      var points, p, xC = [], yC = [], path, height, width,\n          m;\n      for (var j = this.paths.length; j--;) {\n        path = this.paths[j];\n        height = path.height + path.strokeWidth;\n        width = path.width + path.strokeWidth;\n        points = [\n          { x: path.left, y: path.top },\n          { x: path.left + width, y: path.top },\n          { x: path.left, y: path.top + height },\n          { x: path.left + width, y: path.top + height }\n        ];\n        m = this.paths[j].transformMatrix;\n        for (var i = 0; i < points.length; i++) {\n          p = points[i];\n          if (m) {\n            p = fabric.util.transformPoint(p, m, false);\n          }\n          xC.push(p.x);\n          yC.push(p.y);\n        }\n      }\n      options.width = Math.max.apply(null, xC);\n      options.height = Math.max.apply(null, yC);\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    drawObject: function(ctx) {\n      ctx.save();\n      ctx.translate(-this.width / 2, -this.height / 2);\n      for (var i = 0, l = this.paths.length; i < l; ++i) {\n        this.paths[i].render(ctx, true);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Decide if the object should cache or not.\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var parentCache = this.objectCaching && (!this.group || this.needsItsOwnCache() || !this.group.isCaching());\n      this.caching = parentCache;\n      if (parentCache) {\n        for (var i = 0, len = this.paths.length; i < len; i++) {\n          if (this.paths[i].willDrawShadow()) {\n            this.caching = false;\n            return false;\n          }\n        }\n      }\n      return parentCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (this.shadow) {\n        return true;\n      }\n      for (var i = 0, len = this.paths.length; i < len; i++) {\n        if (this.paths[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isCaching: function() {\n      return this.caching || this.group && this.group.isCaching();\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function() {\n      if (this.callSuper('isCacheDirty')) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this.paths.length; i < len; i++) {\n        if (this.paths[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Sets certain property to a certain value\n     * @param {String} prop\n     * @param {*} value\n     * @return {fabric.PathGroup} thisArg\n     */\n    _set: function(prop, value) {\n\n      if (prop === 'fill' && value && this.isSameColor()) {\n        var i = this.paths.length;\n        while (i--) {\n          this.paths[i]._set(prop, value);\n        }\n      }\n\n      return this.callSuper('_set', prop, value);\n    },\n\n    /**\n     * Returns object representation of this path group\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var pathsToObject = this.paths.map(function(path) {\n        var originalDefaults = path.includeDefaultValues;\n        path.includeDefaultValues = path.group.includeDefaultValues;\n        var obj = path.toObject(propertiesToInclude);\n        path.includeDefaultValues = originalDefaults;\n        return obj;\n      });\n      var o = extend(this.callSuper('toObject', ['sourcePath'].concat(propertiesToInclude)), {\n        paths: pathsToObject\n      });\n      return o;\n    },\n\n    /**\n     * Returns dataless object representation of this path group\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} dataless object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(propertiesToInclude);\n      if (this.sourcePath) {\n        o.paths = this.sourcePath;\n      }\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var objects = this.getObjects(),\n          p = this.getPointByOrigin('left', 'top'),\n          translatePart = 'translate(' + p.x + ' ' + p.y + ')',\n          markup = this._createBaseSVGMarkup();\n      markup.push(\n        '<g ', this.getSvgId(),\n        'style=\"', this.getSvgStyles(), '\" ',\n        'transform=\"', this.getSvgTransformMatrix(), translatePart, this.getSvgTransform(), '\" ',\n        '>\\n'\n      );\n\n      for (var i = 0, len = objects.length; i < len; i++) {\n        markup.push('\\t', objects[i].toSVG(reviver));\n      }\n      markup.push('</g>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns a string representation of this path group\n     * @return {String} string representation of an object\n     */\n    toString: function() {\n      return '#<fabric.PathGroup (' + this.complexity() +\n        '): { top: ' + this.top + ', left: ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns true if all paths in this group are of same color\n     * @return {Boolean} true if all paths are of the same color (`fill`)\n     */\n    isSameColor: function() {\n      var firstPathFill = this.getObjects()[0].get('fill') || '';\n      if (typeof firstPathFill !== 'string') {\n        return false;\n      }\n      firstPathFill = firstPathFill.toLowerCase();\n      return this.getObjects().every(function(path) {\n        var pathFill = path.get('fill') || '';\n        return typeof pathFill === 'string' && (pathFill).toLowerCase() === firstPathFill;\n      });\n    },\n\n    /**\n     * Returns number representation of object's complexity\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return this.paths.reduce(function(total, path) {\n        return total + ((path && path.complexity) ? path.complexity() : 0);\n      }, 0);\n    },\n\n    /**\n     * Returns all paths in this path group\n     * @return {Array} array of path objects included in this path group\n     */\n    getObjects: function() {\n      return this.paths;\n    }\n  });\n\n  /**\n   * Creates fabric.PathGroup instance from an object representation\n   * @static\n   * @memberOf fabric.PathGroup\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.PathGroup instance is created\n   */\n  fabric.PathGroup.fromObject = function(object, callback) {\n    var originalPaths = object.paths;\n    delete object.paths;\n    if (typeof originalPaths === 'string') {\n      fabric.loadSVGFromURL(originalPaths, function (elements) {\n        var pathUrl = originalPaths;\n        var pathGroup = fabric.util.groupSVGElements(elements, object, pathUrl);\n        object.paths = originalPaths;\n        callback(pathGroup);\n      });\n    }\n    else {\n      fabric.util.enlivenObjects(originalPaths, function(enlivenedObjects) {\n        var pathGroup = new fabric.PathGroup(enlivenedObjects, object);\n        object.paths = originalPaths;\n        callback(pathGroup);\n      });\n    }\n  };\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @memberOf fabric.PathGroup\n   * @type Boolean\n   * @default\n   */\n  fabric.PathGroup.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  // lock-related properties, for use in fabric.Group#get\n  // to enable locking behavior on group\n  // when one of its objects has lock-related properties set\n  var _lockProperties = {\n    lockMovementX:  true,\n    lockMovementY:  true,\n    lockRotation:   true,\n    lockScalingX:   true,\n    lockScalingY:   true,\n    lockUniScaling: true\n  };\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'group',\n\n    /**\n     * Width of stroke\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * Indicates if click events should also check for subtargets\n     * @type Boolean\n     * @default\n     */\n    subTargetCheck: false,\n\n    /**\n     * Groups are container, do not render anything on theyr own, ence no cache properties\n     * @type Boolean\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * Constructor\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options, isAlreadyGrouped) {\n      options = options || { };\n\n      this._objects = [];\n      // if objects enclosed in a group have been grouped already,\n      // we cannot change properties of objects.\n      // Thus we need to set options to group without objects,\n      // because delegatedProperties propagate to objects.\n      isAlreadyGrouped && this.callSuper('initialize', options);\n\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (options.originX) {\n        this.originX = options.originX;\n      }\n      if (options.originY) {\n        this.originY = options.originY;\n      }\n\n      if (isAlreadyGrouped) {\n        // do not change coordinate of objects enclosed in a group,\n        // because objects coordinate system have been group coodinate system already.\n        this._updateObjectsCoords(true);\n      }\n      else {\n        this._calcBounds();\n        this._updateObjectsCoords();\n        this.callSuper('initialize', options);\n      }\n\n      this.setCoords();\n      this.saveCoords();\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsCoords: function(skipCoordsChange) {\n      var center = this.getCenterPoint();\n      for (var i = this._objects.length; i--; ){\n        this._updateObjectCoords(this._objects[i], center, skipCoordsChange);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     * @param {fabric.Point} center, current center of group.\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of object dose not change\n     */\n    _updateObjectCoords: function(object, center, skipCoordsChange) {\n      // do not display corners of objects enclosed in a group\n      object.__origHasControls = object.hasControls;\n      object.hasControls = false;\n\n      if (skipCoordsChange) {\n        return;\n      }\n\n      var objectLeft = object.getLeft(),\n          objectTop = object.getTop(),\n          ignoreZoom = true, skipAbsolute = true;\n\n      object.set({\n        left: objectLeft - center.x,\n        top: objectTop - center.y\n      });\n      object.setCoords(ignoreZoom, skipAbsolute);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      if (object) {\n        this._objects.push(object);\n        object.group = this;\n        object._set('canvas', this.canvas);\n      }\n      // since _restoreObjectsState set objects inactive\n      this.forEachObject(this._setObjectActive, this);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _setObjectActive: function(object) {\n      object.set('active', true);\n      object.group = this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      // since _restoreObjectsState set objects inactive\n      this.forEachObject(this._setObjectActive, this);\n\n      this.remove(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _onObjectAdded: function(object) {\n      this.dirty = true;\n      object.group = this;\n      object._set('canvas', this.canvas);\n    },\n\n    /**\n     * @private\n     */\n    _onObjectRemoved: function(object) {\n      this.dirty = true;\n      delete object.group;\n      object.set('active', false);\n    },\n\n    /**\n     * Properties that are delegated to group objects when reading/writing\n     * @param {Object} delegatedProperties\n     */\n    delegatedProperties: {\n      fill:             true,\n      stroke:           true,\n      strokeWidth:      true,\n      fontFamily:       true,\n      fontWeight:       true,\n      fontSize:         true,\n      fontStyle:        true,\n      lineHeight:       true,\n      textDecoration:   true,\n      textAlign:        true,\n      backgroundColor:  true\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      var i = this._objects.length;\n\n      if (this.delegatedProperties[key] || key === 'canvas') {\n        while (i--) {\n          this._objects[i].set(key, value);\n        }\n      }\n      else {\n        while (i--) {\n          this._objects[i].setOnGroup(key, value);\n        }\n      }\n\n      this.callSuper('_set', key, value);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var objsToObject = this.getObjects().map(function(obj) {\n        var originalDefaults = obj.includeDefaultValues;\n        obj.includeDefaultValues = obj.group.includeDefaultValues;\n        var _obj = obj.toObject(propertiesToInclude);\n        obj.includeDefaultValues = originalDefaults;\n        return _obj;\n      });\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        objects: objsToObject\n      });\n    },\n\n    /**\n     * Returns object representation of an instance, in dataless mode.\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var objsToObject = this.getObjects().map(function(obj) {\n        var originalDefaults = obj.includeDefaultValues;\n        obj.includeDefaultValues = obj.group.includeDefaultValues;\n        var _obj = obj.toDatalessObject(propertiesToInclude);\n        obj.includeDefaultValues = originalDefaults;\n        return _obj;\n      });\n      return extend(this.callSuper('toDatalessObject', propertiesToInclude), {\n        objects: objsToObject\n      });\n    },\n\n    /**\n     * Renders instance on a given context\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx) {\n      this._transformDone = true;\n      this.callSuper('render', ctx);\n      this._transformDone = false;\n    },\n\n    /**\n     * Decide if the object should cache or not.\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var parentCache = this.objectCaching && (!this.group || this.needsItsOwnCache() || !this.group.isCaching());\n      this.caching = parentCache;\n      if (parentCache) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            this.caching = false;\n            return false;\n          }\n        }\n      }\n      return parentCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (this.callSuper('willDrawShadow')) {\n        return true;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isCaching: function() {\n      return this.caching || this.group && this.group.isCaching();\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    drawObject: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._renderObject(this._objects[i], ctx);\n      }\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function() {\n      if (this.callSuper('isCacheDirty')) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            // if this group has not a cache canvas there is nothing to clean\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} [noTransform] When true, context is not transformed\n     */\n    _renderControls: function(ctx, noTransform) {\n      ctx.save();\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      this.callSuper('_renderControls', ctx, noTransform);\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i]._renderControls(ctx);\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     */\n    _renderObject: function(object, ctx) {\n      // do not render if object is not visible\n      if (!object.visible) {\n        return;\n      }\n\n      var originalHasRotatingPoint = object.hasRotatingPoint;\n      object.hasRotatingPoint = false;\n      object.render(ctx);\n      object.hasRotatingPoint = originalHasRotatingPoint;\n    },\n\n    /**\n     * Retores original state of each of group objects (original state is that which was before group was created).\n     * @private\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      this._objects.forEach(this._restoreObjectState, this);\n      return this;\n    },\n\n    /**\n     * Realises the transform from this group onto the supplied object\n     * i.e. it tells you what would happen if the supplied object was in\n     * the group, and then the group was destroyed. It mutates the supplied\n     * object.\n     * @param {fabric.Object} object\n     * @return {fabric.Object} transformedObject\n     */\n    realizeTransform: function(object) {\n      var matrix = object.calcTransformMatrix(),\n          options = fabric.util.qrDecompose(matrix),\n          center = new fabric.Point(options.translateX, options.translateY);\n      object.flipX = false;\n      object.flipY = false;\n      object.set('scaleX', options.scaleX);\n      object.set('scaleY', options.scaleY);\n      object.skewX = options.skewX;\n      object.skewY = options.skewY;\n      object.angle = options.angle;\n      object.setPositionByOrigin(center, 'center', 'center');\n      return object;\n    },\n\n    /**\n     * Restores original state of a specified object in group\n     * @private\n     * @param {fabric.Object} object\n     * @return {fabric.Group} thisArg\n     */\n    _restoreObjectState: function(object) {\n      this.realizeTransform(object);\n      object.setCoords();\n      object.hasControls = object.__origHasControls;\n      delete object.__origHasControls;\n      object.set('active', false);\n      delete object.group;\n\n      return this;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      // when group is destroyed objects needs to get a repaint to be eventually\n      // displayed on canvas.\n      this._objects.forEach(function(object) {\n        object.set('dirty', true);\n      });\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Saves coordinates of this instance (to be used together with `hasMoved`)\n     * @saveCoords\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    saveCoords: function() {\n      this._originalLeft = this.get('left');\n      this._originalTop = this.get('top');\n      return this;\n    },\n\n    /**\n     * Checks whether this group was moved (since `saveCoords` was called last)\n     * @return {Boolean} true if an object was moved (since fabric.Group#saveCoords was called)\n     */\n    hasMoved: function() {\n      return this._originalLeft !== this.get('left') ||\n             this._originalTop !== this.get('top');\n    },\n\n    /**\n     * Sets coordinates of all objects inside group\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      var ignoreZoom = true, skipAbsolute = true;\n      this.forEachObject(function(object) {\n        object.setCoords(ignoreZoom, skipAbsolute);\n      });\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _calcBounds: function(onlyWidthHeight) {\n      var aX = [],\n          aY = [],\n          o, prop,\n          props = ['tr', 'br', 'bl', 'tl'],\n          i = 0, iLen = this._objects.length,\n          j, jLen = props.length,\n          ignoreZoom = true;\n\n      for ( ; i < iLen; ++i) {\n        o = this._objects[i];\n        o.setCoords(ignoreZoom);\n        for (j = 0; j < jLen; j++) {\n          prop = props[j];\n          aX.push(o.oCoords[prop].x);\n          aY.push(o.oCoords[prop].y);\n        }\n      }\n\n      this.set(this._getBounds(aX, aY, onlyWidthHeight));\n    },\n\n    /**\n     * @private\n     */\n    _getBounds: function(aX, aY, onlyWidthHeight) {\n      var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          obj = {\n            width: (maxXY.x - minXY.x) || 0,\n            height: (maxXY.y - minXY.y) || 0\n          };\n\n      if (!onlyWidthHeight) {\n        obj.left = minXY.x || 0;\n        obj.top = minXY.y || 0;\n        if (this.originX === 'center') {\n          obj.left += obj.width / 2;\n        }\n        if (this.originX === 'right') {\n          obj.left += obj.width;\n        }\n        if (this.originY === 'center') {\n          obj.top += obj.height / 2;\n        }\n        if (this.originY === 'bottom') {\n          obj.top += obj.height;\n        }\n      }\n      return obj;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup();\n      markup.push(\n        '<g ', this.getSvgId(), 'transform=\"',\n        /* avoiding styles intentionally */\n        this.getSvgTransform(),\n        this.getSvgTransformMatrix(),\n        '\" style=\"',\n        this.getSvgFilter(),\n        '\">\\n'\n      );\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        markup.push('\\t', this._objects[i].toSVG(reviver));\n      }\n\n      markup.push('</g>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns requested property\n     * @param {String} prop Property to get\n     * @return {*}\n     */\n    get: function(prop) {\n      if (prop in _lockProperties) {\n        if (this[prop]) {\n          return this[prop];\n        }\n        else {\n          for (var i = 0, len = this._objects.length; i < len; i++) {\n            if (this._objects[i][prop]) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }\n      else {\n        if (prop in this.delegatedProperties) {\n          return this._objects[0] && this._objects[0].get(prop);\n        }\n        return this[prop];\n      }\n    }\n  });\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      var options = fabric.util.object.clone(object, true);\n      delete options.objects;\n      callback && callback(new fabric.Group(enlivenedObjects, options, true));\n    });\n  };\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @memberOf fabric.Group\n   * @type Boolean\n   * @default\n   */\n  fabric.Group.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push(\n    'alignX',\n    'alignY',\n    'meetOrSlice'\n  );\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'image',\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * AlignX value, part of preserveAspectRatio (one of \"none\", \"mid\", \"min\", \"max\")\n     * @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\n     * This parameter defines how the picture is aligned to its viewport when image element width differs from image width.\n     * @type String\n     * @default\n     */\n    alignX: 'none',\n\n    /**\n     * AlignY value, part of preserveAspectRatio (one of \"none\", \"mid\", \"min\", \"max\")\n     * @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\n     * This parameter defines how the picture is aligned to its viewport when image element height differs from image height.\n     * @type String\n     * @default\n     */\n    alignY: 'none',\n\n    /**\n     * meetOrSlice value, part of preserveAspectRatio  (one of \"meet\", \"slice\").\n     * if meet the image is always fully visibile, if slice the viewport is always filled with image.\n     * @see http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\n     * @type String\n     * @default\n     */\n    meetOrSlice: 'meet',\n\n    /**\n     * Width of a stroke.\n     * For image quality a stroke multiple of 2 gives better results.\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * private\n     * contains last value of scaleX to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleX: 1,\n\n    /**\n     * private\n     * contains last value of scaleY to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleY: 1,\n\n    /**\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\n     * number bigger than 1 can be used in case we want to scale with some filter above\n     * the natural image dimensions\n     * @type Number\n     */\n    minimumScaleTrigger: 0.5,\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: stateProperties,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * default to false for images\n     * since 1.7.0\n     * @type Boolean\n     * @default\n     */\n    objectCaching: false,\n\n    /**\n     * Constructor\n     * @param {HTMLImageElement | String} element Image element\n     * @param {Object} [options] Options object\n     * @param {function} [callback] callback function to call after eventual filters applied.\n     * @return {fabric.Image} thisArg\n     */\n    initialize: function(element, options, callback) {\n      options || (options = { });\n      this.filters = [];\n      this.resizeFilters = [];\n      this.callSuper('initialize', options);\n      this._initElement(element, options, callback);\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @return {HTMLImageElement} Image element\n     */\n    getElement: function() {\n      return this._element;\n    },\n\n    /**\n     * Sets image element for this instance to a specified one.\n     * If filters defined they are applied to new image.\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n     * @param {HTMLImageElement} element\n     * @param {Function} [callback] Callback is invoked when all filters have been applied and new image is generated\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element, callback, options) {\n\n      var _callback, _this;\n\n      this._element = element;\n      this._originalElement = element;\n      this._initConfig(options);\n\n      if (this.resizeFilters.length === 0) {\n        _callback = callback;\n      }\n      else {\n        _this = this;\n        _callback = function() {\n          _this.applyFilters(callback, _this.resizeFilters, _this._filteredEl || _this._originalElement, true);\n        };\n      }\n\n      if (this.filters.length !== 0) {\n        this.applyFilters(_callback);\n      }\n      else if (_callback) {\n        _callback(this);\n      }\n\n      return this;\n    },\n\n    /**\n     * Sets crossOrigin value (on an instance and corresponding image element)\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setCrossOrigin: function(value) {\n      this.crossOrigin = value;\n      this._element.crossOrigin = value;\n\n      return this;\n    },\n\n    /**\n     * Returns original size of an image\n     * @return {Object} Object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.width,\n        height: element.height\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _stroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n      var w = this.width / 2, h = this.height / 2;\n      ctx.beginPath();\n      ctx.moveTo(-w, -h);\n      ctx.lineTo(w, -h);\n      ctx.lineTo(w, h);\n      ctx.lineTo(-w, h);\n      ctx.lineTo(-w, -h);\n      ctx.closePath();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.save();\n      this._setStrokeStyles(ctx);\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var filters = [], resizeFilters = [],\n          scaleX = 1, scaleY = 1;\n\n      this.filters.forEach(function(filterObj) {\n        if (filterObj) {\n          if (filterObj.type === 'Resize') {\n            scaleX *= filterObj.scaleX;\n            scaleY *= filterObj.scaleY;\n          }\n          filters.push(filterObj.toObject());\n        }\n      });\n\n      this.resizeFilters.forEach(function(filterObj) {\n        filterObj && resizeFilters.push(filterObj.toObject());\n      });\n      var object = extend(\n        this.callSuper(\n          'toObject',\n          ['crossOrigin', 'alignX', 'alignY', 'meetOrSlice'].concat(propertiesToInclude)\n        ), {\n          src: this.getSrc(),\n          filters: filters,\n          resizeFilters: resizeFilters,\n        });\n\n      object.width /= scaleX;\n      object.height /= scaleY;\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var markup = this._createBaseSVGMarkup(), x = -this.width / 2, y = -this.height / 2,\n          preserveAspectRatio = 'none', filtered = true;\n      if (this.group && this.group.type === 'path-group') {\n        x = this.left;\n        y = this.top;\n      }\n      if (this.alignX !== 'none' && this.alignY !== 'none') {\n        preserveAspectRatio = 'x' + this.alignX + 'Y' + this.alignY + ' ' + this.meetOrSlice;\n      }\n      markup.push(\n        '<g transform=\"', this.getSvgTransform(), this.getSvgTransformMatrix(), '\">\\n',\n          '<image ', this.getSvgId(), 'xlink:href=\"', this.getSvgSrc(filtered),\n            '\" x=\"', x, '\" y=\"', y,\n            '\" style=\"', this.getSvgStyles(),\n            // we're essentially moving origin of transformation from top/left corner to the center of the shape\n            // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n            // so that object's center aligns with container's left/top\n            '\" width=\"', this.width,\n            '\" height=\"', this.height,\n            '\" preserveAspectRatio=\"', preserveAspectRatio, '\"',\n          '></image>\\n'\n      );\n\n      if (this.stroke || this.strokeDashArray) {\n        var origFill = this.fill;\n        this.fill = null;\n        markup.push(\n          '<rect ',\n            'x=\"', x, '\" y=\"', y,\n            '\" width=\"', this.width, '\" height=\"', this.height,\n            '\" style=\"', this.getSvgStyles(),\n          '\"/>\\n'\n        );\n        this.fill = origFill;\n      }\n\n      markup.push('</g>\\n');\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns source of an image\n     * @param {Boolean} filtered indicates if the src is needed for svg\n     * @return {String} Source of an image\n     */\n    getSrc: function(filtered) {\n      var element = filtered ? this._element : this._originalElement;\n      if (element) {\n        return fabric.isLikelyNode ? element._src : element.src;\n      }\n      else {\n        return this.src || '';\n      }\n    },\n\n    /**\n     * Sets source of an image\n     * @param {String} src Source string (URL)\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setSrc: function(src, callback, options) {\n      fabric.util.loadImage(src, function(img) {\n        return this.setElement(img, callback, options);\n      }, this, options && options.crossOrigin);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array)\n     * @method applyFilters\n     * @param {Function} callback Callback is invoked when all filters have been applied and new image is generated\n     * @param {Array} filters to be applied\n     * @param {fabric.Image} imgElement image to filter ( default to this._element )\n     * @param {Boolean} forResizing\n     * @return {CanvasElement} canvasEl to be drawn immediately\n     * @chainable\n     */\n    applyFilters: function(callback, filters, imgElement, forResizing) {\n\n      filters = filters || this.filters;\n      imgElement = imgElement || this._originalElement;\n\n      if (!imgElement) {\n        return;\n      }\n\n      var replacement = fabric.util.createImage(),\n          retinaScaling = this.canvas ? this.canvas.getRetinaScaling() : fabric.devicePixelRatio,\n          minimumScale = this.minimumScaleTrigger / retinaScaling,\n          _this = this, scaleX, scaleY;\n\n      if (filters.length === 0) {\n        this._element = imgElement;\n        callback && callback(this);\n        return imgElement;\n      }\n\n      var canvasEl = fabric.util.createCanvasElement();\n      canvasEl.width = imgElement.width;\n      canvasEl.height = imgElement.height;\n      canvasEl.getContext('2d').drawImage(imgElement, 0, 0, imgElement.width, imgElement.height);\n\n      filters.forEach(function(filter) {\n        if (!filter) {\n          return;\n        }\n        if (forResizing) {\n          scaleX = _this.scaleX < minimumScale ? _this.scaleX : 1;\n          scaleY = _this.scaleY < minimumScale ? _this.scaleY : 1;\n          if (scaleX * retinaScaling < 1) {\n            scaleX *= retinaScaling;\n          }\n          if (scaleY * retinaScaling < 1) {\n            scaleY *= retinaScaling;\n          }\n        }\n        else {\n          scaleX = filter.scaleX;\n          scaleY = filter.scaleY;\n        }\n        filter.applyTo(canvasEl, scaleX, scaleY);\n        if (!forResizing && filter.type === 'Resize') {\n          _this.width *= filter.scaleX;\n          _this.height *= filter.scaleY;\n        }\n      });\n\n      /** @ignore */\n      replacement.width = canvasEl.width;\n      replacement.height = canvasEl.height;\n      if (fabric.isLikelyNode) {\n        replacement.src = canvasEl.toBuffer(undefined, fabric.Image.pngCompression);\n        // onload doesn't fire in some node versions, so we invoke callback manually\n        _this._element = replacement;\n        !forResizing && (_this._filteredEl = replacement);\n        callback && callback(_this);\n      }\n      else {\n        replacement.onload = function() {\n          _this._element = replacement;\n          !forResizing && (_this._filteredEl = replacement);\n          callback && callback(_this);\n          replacement.onload = canvasEl = null;\n        };\n        replacement.src = canvasEl.toDataURL('image/png');\n      }\n      return canvasEl;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    _render: function(ctx, noTransform) {\n      var x, y, imageMargins = this._findMargins(), elementToDraw;\n\n      x = (noTransform ? this.left : -this.width / 2);\n      y = (noTransform ? this.top : -this.height / 2);\n\n      if (this.meetOrSlice === 'slice') {\n        ctx.beginPath();\n        ctx.rect(x, y, this.width, this.height);\n        ctx.clip();\n      }\n\n      if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {\n        this._lastScaleX = this.scaleX;\n        this._lastScaleY = this.scaleY;\n        elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);\n      }\n      else {\n        elementToDraw = this._element;\n      }\n      elementToDraw && ctx.drawImage(elementToDraw,\n                                     x + imageMargins.marginX,\n                                     y + imageMargins.marginY,\n                                     imageMargins.width,\n                                     imageMargins.height\n                                    );\n\n      this._stroke(ctx);\n      this._renderStroke(ctx);\n    },\n\n    /**\n     * @private, needed to check if image needs resize\n     */\n    _needsResize: function() {\n      return (this.scaleX !== this._lastScaleX || this.scaleY !== this._lastScaleY);\n    },\n\n    /**\n     * @private\n     */\n    _findMargins: function() {\n      var width = this.width, height = this.height, scales,\n          scale, marginX = 0, marginY = 0;\n\n      if (this.alignX !== 'none' || this.alignY !== 'none') {\n        scales = [this.width / this._element.width, this.height / this._element.height];\n        scale = this.meetOrSlice === 'meet'\n                ? Math.min.apply(null, scales) : Math.max.apply(null, scales);\n        width = this._element.width * scale;\n        height = this._element.height * scale;\n        if (this.alignX === 'Mid') {\n          marginX = (this.width - width) / 2;\n        }\n        if (this.alignX === 'Max') {\n          marginX = this.width - width;\n        }\n        if (this.alignY === 'Mid') {\n          marginY = (this.height - height) / 2;\n        }\n        if (this.alignY === 'Max') {\n          marginY = this.height - height;\n        }\n      }\n      return {\n        width:  width,\n        height: height,\n        marginX: marginX,\n        marginY: marginY\n      };\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      var element = this.getElement();\n\n      this.set('width', element.width);\n      this.set('height', element.height);\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @private\n     * @param {HTMLImageElement|String} element The element representing the image\n     * @param {Object} [options] Options object\n     */\n    _initElement: function(element, options, callback) {\n      this.setElement(fabric.util.getById(element), callback, options);\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setWidthHeight(options);\n      if (this._element && this.crossOrigin) {\n        this._element.crossOrigin = this.crossOrigin;\n      }\n    },\n\n    /**\n     * @private\n     * @param {Array} filters to be initialized\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n     */\n    _initFilters: function(filters, callback) {\n      if (filters && filters.length) {\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        }, 'fabric.Image.filters');\n      }\n      else {\n        callback && callback();\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Object with width/height properties\n     */\n    _setWidthHeight: function(options) {\n      this.width = 'width' in options\n        ? options.width\n        : (this.getElement()\n            ? this.getElement().width || 0\n            : 0);\n\n      this.height = 'height' in options\n        ? options.height\n        : (this.getElement()\n            ? this.getElement().height || 0\n            : 0);\n    },\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = 'canvas-img';\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function(object, callback) {\n    fabric.util.loadImage(object.src, function(img, error) {\n      if (error) {\n        callback && callback(null, error);\n        return;\n      }\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\n        object.filters = filters || [];\n        fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function(resizeFilters) {\n          object.resizeFilters = resizeFilters || [];\n          return new fabric.Image(img, object, callback);\n        });\n      });\n    }, null, object.crossOrigin);\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument)\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    fabric.util.loadImage(url, function(img) {\n      callback && callback(new fabric.Image(img, imgOptions));\n    }, null, imgOptions && imgOptions.crossOrigin);\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES =\n    fabric.SHARED_ATTRIBUTES.concat('x y width height preserveAspectRatio xlink:href crossOrigin'.split(' '));\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @param {Object} [options] Options object\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES),\n        preserveAR;\n\n    if (parsedAttributes.preserveAspectRatio) {\n      preserveAR = fabric.util.parsePreserveAspectRatioAttribute(parsedAttributes.preserveAspectRatio);\n      extend(parsedAttributes, preserveAR);\n    }\n\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @type Boolean\n   * @default\n   */\n  fabric.Image.async = true;\n\n  /**\n   * Indicates compression level used when generating PNG under Node (in applyFilters). Any of 0-9\n   * @static\n   * @type Number\n   * @default\n   */\n  fabric.Image.pngCompression = 1;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * @private\n   * @return {Number} angle value\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.getAngle() % 360;\n    if (angle > 0) {\n      return Math.round((angle - 1) / 90) * 90;\n    }\n    return Math.round(angle / 90) * 90;\n  },\n\n  /**\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    this.setAngle(this._getAngleValueForStraighten());\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\n   * @param {Object} callbacks Object with callback functions\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.setAngle(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n      onStart: function() {\n        _this.set('active', false);\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.renderAll();\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxStraightenObject: function (object) {\n    object.fxStraighten({\n      onChange: this.renderAll.bind(this)\n    });\n    return this;\n  }\n});\n\n\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image.filters = fabric.Image.filters || { };\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\n\n  /**\n   * Filter type\n   * @param {String} type\n   * @default\n   */\n  type: 'BaseFilter',\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    if (options) {\n      this.setOptions(options);\n    }\n  },\n\n  /**\n   * Sets filter's properties from options\n   * @param {Object} [options] Options object\n   */\n  setOptions: function(options) {\n    for (var prop in options) {\n      this[prop] = options[prop];\n    }\n  },\n\n  /**\n   * Returns object representation of an instance\n   * @return {Object} Object representation of an instance\n   */\n  toObject: function() {\n    return { type: this.type };\n  },\n\n  /**\n   * Returns a JSON representation of an instance\n   * @return {Object} JSON\n   */\n  toJSON: function() {\n    // delegate, not alias\n    return this.toObject();\n  }\n});\n\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 200\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Brightness',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Brightness.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.brightness=0] Value to brighten the image up (-255..255)\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.brightness = options.brightness || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          brightness = this.brightness;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        data[i] += brightness;\n        data[i + 1] += brightness;\n        data[i + 2] += brightness;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        brightness: this.brightness\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Convolute',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Convolute.prototype\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n     * @param {Array} [options.matrix] Filter matrix\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.opaque = options.opaque;\n      this.matrix = options.matrix || [\n        0, 0, 0,\n        0, 1, 0,\n        0, 0, 0\n      ];\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n\n      var weights = this.matrix,\n          context = canvasEl.getContext('2d'),\n          pixels = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          src = pixels.data,\n          sw = pixels.width,\n          sh = pixels.height,\n          output = context.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r, g, b, a, dstOff,\n          scx, scy, srcOff, wt;\n\n      for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n          dstOff = (y * sw + x) * 4;\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          r = 0; g = 0; b = 0; a = 0;\n\n          for (var cy = 0; cy < side; cy++) {\n            for (var cx = 0; cx < side; cx++) {\n              scy = y + cy - halfSide;\n              scx = x + cx - halfSide;\n\n              // eslint-disable-next-line max-depth\n              if (scy < 0 || scy > sh || scx < 0 || scx > sw) {\n                continue;\n              }\n\n              srcOff = (scy * sw + scx) * 4;\n              wt = weights[cy * side + cx];\n\n              r += src[srcOff] * wt;\n              g += src[srcOff + 1] * wt;\n              b += src[srcOff + 2] * wt;\n              a += src[srcOff + 3] * wt;\n            }\n          }\n          dst[dstOff] = r;\n          dst[dstOff + 1] = g;\n          dst[dstOff + 2] = b;\n          dst[dstOff + 3] = a + alphaFac * (255 - a);\n        }\n      }\n\n      context.putImageData(output, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        opaque: this.opaque,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * GradientTransparency filter class\n   * @class fabric.Image.filters.GradientTransparency\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.GradientTransparency#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.GradientTransparency({\n   *   threshold: 200\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n   // eslint-disable-next-line max-len\n  filters.GradientTransparency = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.GradientTransparency.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'GradientTransparency',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.GradientTransparency.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.threshold=100] Threshold value\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.threshold = options.threshold || 100;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          threshold = this.threshold,\n          total = data.length;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        data[i + 3] = threshold + 255 * (total - i) / total;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        threshold: this.threshold\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.GradientTransparency} Instance of fabric.Image.filters.GradientTransparency\n   */\n  fabric.Image.filters.GradientTransparency.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Grayscale',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Grayscale.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          len = imageData.width * imageData.height * 4,\n          index = 0,\n          average;\n\n      while (index < len) {\n        average = (data[index] + data[index + 1] + data[index + 2]) / 3;\n        data[index]     = average;\n        data[index + 1] = average;\n        data[index + 2] = average;\n        index += 4;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Grayscale';\n    return fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Invert',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Invert.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i;\n\n      for (i = 0; i < iLen; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Invert';\n    return fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Mask filter class\n   * See http://resources.aleph-1.com/mask/\n   * @class fabric.Image.filters.Mask\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Mask#initialize} for constructor definition\n   */\n  filters.Mask = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Mask.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Mask',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Mask.prototype\n     * @param {Object} [options] Options object\n     * @param {fabric.Image} [options.mask] Mask image object\n     * @param {Number} [options.channel=0] Rgb channel (0, 1, 2 or 3)\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.mask = options.mask;\n      this.channel = [0, 1, 2, 3].indexOf(options.channel) > -1 ? options.channel : 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      if (!this.mask) {\n        return;\n      }\n\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          maskEl = this.mask.getElement(),\n          maskCanvasEl = fabric.util.createCanvasElement(),\n          channel = this.channel,\n          i,\n          iLen = imageData.width * imageData.height * 4;\n\n      maskCanvasEl.width = canvasEl.width;\n      maskCanvasEl.height = canvasEl.height;\n\n      maskCanvasEl.getContext('2d').drawImage(maskEl, 0, 0, canvasEl.width, canvasEl.height);\n\n      var maskImageData = maskCanvasEl.getContext('2d').getImageData(0, 0, canvasEl.width, canvasEl.height),\n          maskData = maskImageData.data;\n\n      for (i = 0; i < iLen; i += 4) {\n        data[i + 3] = maskData[i + channel];\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        mask: this.mask.toObject(),\n        channel: this.channel\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when a mask filter instance is created\n   */\n  fabric.Image.filters.Mask.fromObject = function(object, callback) {\n    fabric.util.loadImage(object.mask.src, function(img) {\n      object.mask = new fabric.Image(img, object.mask);\n      return fabric.Image.filters.BaseFilter.fromObject(object, callback);\n    });\n  };\n\n  /**\n   * Indicates that instances of this type are async\n   * @static\n   * @type Boolean\n   * @default\n   */\n  fabric.Image.filters.Mask.async = true;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Noise',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Noise.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.noise=0] Noise value\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.noise = options.noise || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          noise = this.noise, rand;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n\n        rand = (0.5 - Math.random()) * noise;\n\n        data[i] += rand;\n        data[i + 1] += rand;\n        data[i + 2] += rand;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        noise: this.noise\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Pixelate',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Pixelate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.blocksize=4] Blocksize for pixelate\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.blocksize = options.blocksize || 4;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index, i, j, r, g, b, a;\n\n      for (i = 0; i < iLen; i += this.blocksize) {\n        for (j = 0; j < jLen; j += this.blocksize) {\n\n          index = (i * 4) * jLen + (j * 4);\n\n          r = data[index];\n          g = data[index + 1];\n          b = data[index + 2];\n          a = data[index + 3];\n\n          /*\n           blocksize: 4\n\n           [1,x,x,x,1]\n           [x,x,x,x,1]\n           [x,x,x,x,1]\n           [x,x,x,x,1]\n           [1,1,1,1,1]\n           */\n\n          for (var _i = i, _ilen = i + this.blocksize; _i < _ilen; _i++) {\n            for (var _j = j, _jlen = j + this.blocksize; _j < _jlen; _j++) {\n              index = (_i * 4) * jLen + (_j * 4);\n              data[index] = r;\n              data[index + 1] = g;\n              data[index + 2] = b;\n              data[index + 3] = a;\n            }\n          }\n        }\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        blocksize: this.blocksize\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveWhite\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveWhite#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveWhite({\n   *   threshold: 40,\n   *   distance: 140\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.RemoveWhite = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveWhite.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'RemoveWhite',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.threshold=30] Threshold value\n     * @param {Number} [options.distance=20] Distance value\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.threshold = options.threshold || 30;\n      this.distance = options.distance || 20;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          threshold = this.threshold,\n          distance = this.distance,\n          limit = 255 - threshold,\n          abs = Math.abs,\n          r, g, b;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (r > limit &&\n            g > limit &&\n            b > limit &&\n            abs(r - g) < distance &&\n            abs(r - b) < distance &&\n            abs(g - b) < distance\n        ) {\n          data[i + 3] = 0;\n        }\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        threshold: this.threshold,\n        distance: this.distance\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveWhite} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveWhite.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Sepia filter class\n   * @class fabric.Image.filters.Sepia\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Sepia();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Sepia = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Sepia.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Sepia',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Sepia.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i, avg;\n\n      for (i = 0; i < iLen; i += 4) {\n        avg = 0.3  * data[i] + 0.59 * data[i + 1] + 0.11 * data[i + 2];\n        data[i] = avg + 100;\n        data[i + 1] = avg + 50;\n        data[i + 2] = avg + 255;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Sepia} Instance of fabric.Image.filters.Sepia\n   */\n  fabric.Image.filters.Sepia.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Sepia';\n    return new fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Sepia2 filter class\n   * @class fabric.Image.filters.Sepia2\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Sepia2();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Sepia2 = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Sepia2.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Sepia2',\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Sepia.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i, r, g, b;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        data[i] = (r * 0.393 + g * 0.769 + b * 0.189 ) / 1.351;\n        data[i + 1] = (r * 0.349 + g * 0.686 + b * 0.168 ) / 1.203;\n        data[i + 2] = (r * 0.272 + g * 0.534 + b * 0.131 ) / 2.140;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Sepia2} Instance of fabric.Image.filters.Sepia2\n   */\n  fabric.Image.filters.Sepia2.fromObject = function(object, callback) {\n    object = object || { };\n    object.type = 'Sepia2';\n    return new fabric.Image.filters.BaseFilter.fromObject(object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Tint filter class\n   * Adapted from <a href=\"https://github.com/mezzoblue/PaintbrushJS\">https://github.com/mezzoblue/PaintbrushJS</a>\n   * @class fabric.Image.filters.Tint\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Tint#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Tint filter with hex color and opacity</caption>\n   * var filter = new fabric.Image.filters.Tint({\n   *   color: '#3513B0',\n   *   opacity: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Tint filter with rgba color</caption>\n   * var filter = new fabric.Image.filters.Tint({\n   *   color: 'rgba(53, 21, 176, 0.5)'\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Tint = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Tint.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Tint',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Tint.prototype\n     * @param {Object} [options] Options object\n     * @param {String} [options.color=#000000] Color to tint the image with\n     * @param {Number} [options.opacity] Opacity value that controls the tint effect's transparency (0..1)\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.color = options.color || '#000000';\n      this.opacity = typeof options.opacity !== 'undefined'\n                      ? options.opacity\n                      : new fabric.Color(this.color).getAlpha();\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i,\n          tintR, tintG, tintB,\n          r, g, b, alpha1,\n          source;\n\n      source = new fabric.Color(this.color).getSource();\n\n      tintR = source[0] * this.opacity;\n      tintG = source[1] * this.opacity;\n      tintB = source[2] * this.opacity;\n\n      alpha1 = 1 - this.opacity;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        // alpha compositing\n        data[i] = tintR + r * alpha1;\n        data[i + 1] = tintG + g * alpha1;\n        data[i + 2] = tintB + b * alpha1;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color,\n        opacity: this.opacity\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Tint} Instance of fabric.Image.filters.Tint\n   */\n  fabric.Image.filters.Tint.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Multiply filter class\n   * Adapted from <a href=\"http://www.laurenscorijn.com/articles/colormath-basics\">http://www.laurenscorijn.com/articles/colormath-basics</a>\n   * @class fabric.Image.filters.Multiply\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example <caption>Multiply filter with hex color</caption>\n   * var filter = new fabric.Image.filters.Multiply({\n   *   color: '#F0F'\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   * @example <caption>Multiply filter with rgb color</caption>\n   * var filter = new fabric.Image.filters.Multiply({\n   *   color: 'rgb(53, 21, 176)'\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Multiply = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Multiply.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Multiply',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Multiply.prototype\n     * @param {Object} [options] Options object\n     * @param {String} [options.color=#000000] Color to multiply the image pixels with\n     */\n    initialize: function(options) {\n      options = options || { };\n\n      this.color = options.color || '#000000';\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          iLen = data.length, i,\n          source;\n\n      source = new fabric.Color(this.color).getSource();\n\n      for (i = 0; i < iLen; i += 4) {\n        data[i] *= source[0] / 255;\n        data[i + 1] *= source[1] / 255;\n        data[i + 2] *= source[2] / 255;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Multiply} Instance of fabric.Image.filters.Multiply\n   */\n  fabric.Image.filters.Multiply.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.Blend\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.Blend({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.Blend({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n\n  filters.Blend = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\n    type: 'Blend',\n\n    initialize: function(options) {\n      options = options || {};\n      this.color = options.color || '#000';\n      this.image = options.image || false;\n      this.mode = options.mode || 'multiply';\n      this.alpha = options.alpha || 1;\n    },\n\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          tr, tg, tb,\n          r, g, b,\n          _r, _g, _b,\n          source,\n          isImage = false;\n\n      if (this.image) {\n        // Blend images\n        isImage = true;\n\n        var _el = fabric.util.createCanvasElement();\n        _el.width = this.image.width;\n        _el.height = this.image.height;\n\n        var tmpCanvas = new fabric.StaticCanvas(_el);\n        tmpCanvas.add(this.image);\n        var context2 =  tmpCanvas.getContext('2d');\n        source = context2.getImageData(0, 0, tmpCanvas.width, tmpCanvas.height).data;\n      }\n      else {\n        // Blend color\n        source = new fabric.Color(this.color).getSource();\n\n        tr = source[0] * this.alpha;\n        tg = source[1] * this.alpha;\n        tb = source[2] * this.alpha;\n      }\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (isImage) {\n          tr = source[i] * this.alpha;\n          tg = source[i + 1] * this.alpha;\n          tb = source[i + 2] * this.alpha;\n        }\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            break;\n          case 'screen':\n            data[i] = 1 - (1 - r) * (1 - tr);\n            data[i + 1] = 1 - (1 - g) * (1 - tg);\n            data[i + 2] = 1 - (1 - b) * (1 - tb);\n            break;\n          case 'add':\n            data[i] = Math.min(255, r + tr);\n            data[i + 1] = Math.min(255, g + tg);\n            data[i + 2] = Math.min(255, b + tb);\n            break;\n          case 'diff':\n          case 'difference':\n            data[i] = Math.abs(r - tr);\n            data[i + 1] = Math.abs(g - tg);\n            data[i + 2] = Math.abs(b - tb);\n            break;\n          case 'subtract':\n            _r = r - tr;\n            _g = g - tg;\n            _b = b - tb;\n\n            data[i] = (_r < 0) ? 0 : _r;\n            data[i + 1] = (_g < 0) ? 0 : _g;\n            data[i + 2] = (_b < 0) ? 0 : _b;\n            break;\n          case 'darken':\n            data[i] = Math.min(r, tr);\n            data[i + 1] = Math.min(g, tg);\n            data[i + 2] = Math.min(b, tb);\n            break;\n          case 'lighten':\n            data[i] = Math.max(r, tr);\n            data[i + 1] = Math.max(g, tg);\n            data[i + 2] = Math.max(b, tb);\n            break;\n        }\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        color: this.color,\n        image: this.image,\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Blend} Instance of fabric.Image.filters.Blend\n   */\n  fabric.Image.filters.Blend.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\n      sqrt = Math.sqrt, abs = Math.abs, max = Math.max, round = Math.round, sin = Math.sin,\n      ceil = Math.ceil,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Resize',\n\n    /**\n     * Resize type\n     * @param {String} resizeType\n     * @default\n     */\n    resizeType: 'hermite',\n\n    /**\n     * Scale factor for resizing, x axis\n     * @param {Number} scaleX\n     * @default\n     */\n    scaleX: 0,\n\n    /**\n     * Scale factor for resizing, y axis\n     * @param {Number} scaleY\n     * @default\n     */\n    scaleY: 0,\n\n    /**\n     * LanczosLobes parameter for lanczos filter\n     * @param {Number} lanczosLobes\n     * @default\n     */\n    lanczosLobes: 3,\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Resize.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} scaleX\n     * @param {Number} scaleY\n     */\n    applyTo: function(canvasEl, scaleX, scaleY) {\n      if (scaleX === 1 && scaleY === 1) {\n        return;\n      }\n\n      this.rcpScaleX = 1 / scaleX;\n      this.rcpScaleY = 1 / scaleY;\n\n      var oW = canvasEl.width, oH = canvasEl.height,\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\n          imageData;\n\n      if (this.resizeType === 'sliceHack') {\n        imageData = this.sliceByTwo(canvasEl, oW, oH, dW, dH);\n      }\n      if (this.resizeType === 'hermite') {\n        imageData = this.hermiteFastResize(canvasEl, oW, oH, dW, dH);\n      }\n      if (this.resizeType === 'bilinear') {\n        imageData = this.bilinearFiltering(canvasEl, oW, oH, dW, dH);\n      }\n      if (this.resizeType === 'lanczos') {\n        imageData = this.lanczosResize(canvasEl, oW, oH, dW, dH);\n      }\n      canvasEl.width = dW;\n      canvasEl.height = dH;\n      canvasEl.getContext('2d').putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Filter sliceByTwo\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    sliceByTwo: function(canvasEl, oW, oH, dW, dH) {\n      var context = canvasEl.getContext('2d'), imageData,\n          multW = 0.5, multH = 0.5, signW = 1, signH = 1,\n          doneW = false, doneH = false, stepW = oW, stepH = oH,\n          tmpCanvas = fabric.util.createCanvasElement(),\n          tmpCtx = tmpCanvas.getContext('2d');\n      dW = floor(dW);\n      dH = floor(dH);\n      tmpCanvas.width = max(dW, oW);\n      tmpCanvas.height = max(dH, oH);\n\n      if (dW > oW) {\n        multW = 2;\n        signW = -1;\n      }\n      if (dH > oH) {\n        multH = 2;\n        signH = -1;\n      }\n      imageData = context.getImageData(0, 0, oW, oH);\n      canvasEl.width = max(dW, oW);\n      canvasEl.height = max(dH, oH);\n      context.putImageData(imageData, 0, 0);\n\n      while (!doneW || !doneH) {\n        oW = stepW;\n        oH = stepH;\n        if (dW * signW < floor(stepW * multW * signW)) {\n          stepW = floor(stepW * multW);\n        }\n        else {\n          stepW = dW;\n          doneW = true;\n        }\n        if (dH * signH < floor(stepH * multH * signH)) {\n          stepH = floor(stepH * multH);\n        }\n        else {\n          stepH = dH;\n          doneH = true;\n        }\n        imageData = context.getImageData(0, 0, oW, oH);\n        tmpCtx.putImageData(imageData, 0, 0);\n        context.clearRect(0, 0, stepW, stepH);\n        context.drawImage(tmpCanvas, 0, 0, oW, oH, 0, 0, stepW, stepH);\n      }\n      return context.getImageData(0, 0, dW, dH);\n    },\n\n    /**\n     * Filter lanczosResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    lanczosResize: function(canvasEl, oW, oH, dW, dH) {\n\n      function lanczosCreate(lobes) {\n        return function(x) {\n          if (x > lobes) {\n            return 0;\n          }\n          x *= Math.PI;\n          if (abs(x) < 1e-16) {\n            return 1;\n          }\n          var xx = x / lobes;\n          return sin(x) * sin(xx) / x / xx;\n        };\n      }\n\n      function process(u) {\n        var v, i, weight, idx, a, red, green,\n            blue, alpha, fX, fY;\n        center.x = (u + 0.5) * ratioX;\n        icenter.x = floor(center.x);\n        for (v = 0; v < dH; v++) {\n          center.y = (v + 0.5) * ratioY;\n          icenter.y = floor(center.y);\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n            if (i < 0 || i >= oW) {\n              continue;\n            }\n            fX = floor(1000 * abs(i - center.x));\n            if (!cacheLanc[fX]) {\n              cacheLanc[fX] = { };\n            }\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n              if (j < 0 || j >= oH) {\n                continue;\n              }\n              fY = floor(1000 * abs(j - center.y));\n              if (!cacheLanc[fX][fY]) {\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\n              }\n              weight = cacheLanc[fX][fY];\n              if (weight > 0) {\n                idx = (j * oW + i) * 4;\n                a += weight;\n                red += weight * srcData[idx];\n                green += weight * srcData[idx + 1];\n                blue += weight * srcData[idx + 2];\n                alpha += weight * srcData[idx + 3];\n              }\n            }\n          }\n          idx = (v * dW + u) * 4;\n          destData[idx] = red / a;\n          destData[idx + 1] = green / a;\n          destData[idx + 2] = blue / a;\n          destData[idx + 3] = alpha / a;\n        }\n\n        if (++u < dW) {\n          return process(u);\n        }\n        else {\n          return destImg;\n        }\n      }\n\n      var context = canvasEl.getContext('2d'),\n          srcImg = context.getImageData(0, 0, oW, oH),\n          destImg = context.getImageData(0, 0, dW, dH),\n          srcData = srcImg.data, destData = destImg.data,\n          lanczos = lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\n          cacheLanc = { }, center = { }, icenter = { };\n\n      return process(0);\n    },\n\n    /**\n     * bilinearFiltering\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    bilinearFiltering: function(canvasEl, oW, oH, dW, dH) {\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY, context = canvasEl.getContext('2d'),\n          w4 = 4 * (oW - 1), img = context.getImageData(0, 0, oW, oH),\n          pixels = img.data, destImage = context.getImageData(0, 0, dW, dH),\n          destPixels = destImage.data;\n      for (i = 0; i < dH; i++) {\n        for (j = 0; j < dW; j++) {\n          x = floor(ratioX * j);\n          y = floor(ratioY * i);\n          xDiff = ratioX * j - x;\n          yDiff = ratioY * i - y;\n          origPix = 4 * (y * oW + x);\n\n          for (chnl = 0; chnl < 4; chnl++) {\n            a = pixels[origPix + chnl];\n            b = pixels[origPix + 4 + chnl];\n            c = pixels[origPix + w4 + chnl];\n            d = pixels[origPix + w4 + 4 + chnl];\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\n            destPixels[offset++] = color;\n          }\n        }\n      }\n      return destImage;\n    },\n\n    /**\n     * hermiteFastResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    hermiteFastResize: function(canvasEl, oW, oH, dW, dH) {\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          context = canvasEl.getContext('2d'),\n          img = context.getImageData(0, 0, oW, oH), data = img.data,\n          img2 = context.getImageData(0, 0, dW, dH), data2 = img2.data;\n      for (var j = 0; j < dH; j++) {\n        for (var i = 0; i < dW; i++) {\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n              /* eslint-disable max-depth */\n              if (w > 1 && w < -1) {\n                continue;\n              }\n              //hermite filter\n              weight = 2 * w * w * w - 3 * w * w + 1;\n              if (weight > 0) {\n                dx = 4 * (xx + yy * oW);\n                //alpha\n                gxA += weight * data[dx + 3];\n                weightsAlpha += weight;\n                //colors\n                if (data[dx + 3] < 255) {\n                  weight = weight * data[dx + 3] / 250;\n                }\n                gxR += weight * data[dx];\n                gxG += weight * data[dx + 1];\n                gxB += weight * data[dx + 2];\n                weights += weight;\n              }\n              /* eslint-enable max-depth */\n            }\n          }\n          data2[x2] = gxR / weights;\n          data2[x2 + 1] = gxG / weights;\n          data2[x2 + 2] = gxB / weights;\n          data2[x2 + 3] = gxA / weightsAlpha;\n        }\n      }\n      return img2;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        resizeType: this.resizeType,\n        lanczosLobes: this.lanczosLobes\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Matrix filter class\n   * @class fabric.Image.filters.ColorMatrix\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n   * @example <caption>Kodachrome filter</caption>\n   * var filter = new fabric.Image.filters.ColorMatrix({\n   *  matrix: [\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n       0, 0, 0, 1, 0\n      ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'ColorMatrix',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.ColorMatrix.prototype\n     * @param {Object} [options] Options object\n     * @param {Array} [options.matrix] Color Matrix to modify the image data with\n     */\n    initialize: function( options ) {\n      options || ( options = {} );\n      this.matrix = options.matrix || [\n        1, 0, 0, 0, 0,\n        0, 1, 0, 0, 0,\n        0, 0, 1, 0, 0,\n        0, 0, 0, 1, 0\n      ];\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function( canvasEl ) {\n      var context = canvasEl.getContext( '2d' ),\n          imageData = context.getImageData( 0, 0, canvasEl.width, canvasEl.height ),\n          data = imageData.data,\n          iLen = data.length,\n          i,\n          r,\n          g,\n          b,\n          a,\n          m = this.matrix;\n\n      for ( i = 0; i < iLen; i += 4 ) {\n        r = data[ i ];\n        g = data[ i + 1 ];\n        b = data[ i + 2 ];\n        a = data[ i + 3 ];\n\n        data[ i ] = r * m[ 0 ] + g * m[ 1 ] + b * m[ 2 ] + a * m[ 3 ] + m[ 4 ];\n        data[ i + 1 ] = r * m[ 5 ] + g * m[ 6 ] + b * m[ 7 ] + a * m[ 8 ] + m[ 9 ];\n        data[ i + 2 ] = r * m[ 10 ] + g * m[ 11 ] + b * m[ 12 ] + a * m[ 13 ] + m[ 14 ];\n        data[ i + 3 ] = r * m[ 15 ] + g * m[ 16 ] + b * m[ 17 ] + a * m[ 18 ] + m[ 19 ];\n      }\n\n      context.putImageData( imageData, 0, 0 );\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        type: this.type,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 40\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Contrast',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Contrast.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-255...255)\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.contrast = options.contrast || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          contrastF = 259 * (this.contrast + 255) / (255 * (259 - this.contrast));\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        data[i] = contrastF * (data[i] - 128) + 128;\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        contrast: this.contrast\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturate({\n   *   saturate: 100\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Saturate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Saturate',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Saturate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.saturate=0] Value to saturate the image (-100...100)\n     */\n    initialize: function(options) {\n      options = options || { };\n      this.saturate = options.saturate || 0;\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo: function(canvasEl) {\n      var context = canvasEl.getContext('2d'),\n          imageData = context.getImageData(0, 0, canvasEl.width, canvasEl.height),\n          data = imageData.data,\n          max, adjust = -this.saturate * 0.01;\n\n      for (var i = 0, len = data.length; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n      }\n\n      context.putImageData(imageData, 0, 0);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        saturate: this.saturate\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturate} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed,\n      NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n      MIN_TEXT_WIDTH = 2;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n\n  var stateProperties = fabric.Object.prototype.stateProperties.concat();\n  stateProperties.push(\n    'fontFamily',\n    'fontWeight',\n    'fontSize',\n    'text',\n    'textDecoration',\n    'textAlign',\n    'fontStyle',\n    'lineHeight',\n    'textBackgroundColor',\n    'charSpacing'\n  );\n\n  var cacheProperties = fabric.Object.prototype.cacheProperties.concat();\n  cacheProperties.push(\n    'fontFamily',\n    'fontWeight',\n    'fontSize',\n    'text',\n    'textDecoration',\n    'textAlign',\n    'fontStyle',\n    'lineHeight',\n    'textBackgroundColor',\n    'charSpacing',\n    'styles'\n  );\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: [\n      'fontSize',\n      'fontWeight',\n      'fontFamily',\n      'fontStyle',\n      'lineHeight',\n      'text',\n      'charSpacing',\n      'textAlign'\n    ],\n\n    /**\n     * @private\n     */\n    _reNewline: /\\r?\\n/,\n\n    /**\n     * Use this regular expression to filter for whitespace that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpacesAndTabs: /[ \\t\\r]+/g,\n\n    /**\n     * Retrieves object's fontSize\n     * @method getFontSize\n     * @memberOf fabric.Text.prototype\n     * @return {String} Font size (in pixels)\n     */\n\n    /**\n     * Sets object's fontSize\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontSize\n     * @memberOf fabric.Text.prototype\n     * @param {Number} fontSize Font size (in pixels)\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's fontWeight\n     * @method getFontWeight\n     * @memberOf fabric.Text.prototype\n     * @return {(String|Number)} Font weight\n     */\n\n    /**\n     * Sets object's fontWeight\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontWeight\n     * @memberOf fabric.Text.prototype\n     * @param {(Number|String)} fontWeight Font weight\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's fontFamily\n     * @method getFontFamily\n     * @memberOf fabric.Text.prototype\n     * @return {String} Font family\n     */\n\n    /**\n     * Sets object's fontFamily\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontFamily\n     * @memberOf fabric.Text.prototype\n     * @param {String} fontFamily Font family\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's text\n     * @method getText\n     * @memberOf fabric.Text.prototype\n     * @return {String} text\n     */\n\n    /**\n     * Sets object's text\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setText\n     * @memberOf fabric.Text.prototype\n     * @param {String} text Text\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's textDecoration\n     * @method getTextDecoration\n     * @memberOf fabric.Text.prototype\n     * @return {String} Text decoration\n     */\n\n    /**\n     * Sets object's textDecoration\n     * @method setTextDecoration\n     * @memberOf fabric.Text.prototype\n     * @param {String} textDecoration Text decoration\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's fontStyle\n     * @method getFontStyle\n     * @memberOf fabric.Text.prototype\n     * @return {String} Font style\n     */\n\n    /**\n     * Sets object's fontStyle\n     * Does not update the object .width and .height,\n     * call ._initDimensions() to update the values.\n     * @method setFontStyle\n     * @memberOf fabric.Text.prototype\n     * @param {String} fontStyle Font style\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's lineHeight\n     * @method getLineHeight\n     * @memberOf fabric.Text.prototype\n     * @return {Number} Line height\n     */\n\n    /**\n     * Sets object's lineHeight\n     * @method setLineHeight\n     * @memberOf fabric.Text.prototype\n     * @param {Number} lineHeight Line height\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's textAlign\n     * @method getTextAlign\n     * @memberOf fabric.Text.prototype\n     * @return {String} Text alignment\n     */\n\n    /**\n     * Sets object's textAlign\n     * @method setTextAlign\n     * @memberOf fabric.Text.prototype\n     * @param {String} textAlign Text alignment\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Retrieves object's textBackgroundColor\n     * @method getTextBackgroundColor\n     * @memberOf fabric.Text.prototype\n     * @return {String} Text background color\n     */\n\n    /**\n     * Sets object's textBackgroundColor\n     * @method setTextBackgroundColor\n     * @memberOf fabric.Text.prototype\n     * @param {String} textBackgroundColor Text background color\n     * @return {fabric.Text}\n     * @chainable\n     */\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type:                 'text',\n\n    /**\n     * Font size (in pixels)\n     * @type Number\n     * @default\n     */\n    fontSize:             40,\n\n    /**\n     * Font weight (e.g. bold, normal, 400, 600, 800)\n     * @type {(Number|String)}\n     * @default\n     */\n    fontWeight:           'normal',\n\n    /**\n     * Font family\n     * @type String\n     * @default\n     */\n    fontFamily:           'Times New Roman',\n\n    /**\n     * Text decoration Possible values: \"\", \"underline\", \"overline\" or \"line-through\".\n     * @type String\n     * @default\n     */\n    textDecoration:       '',\n\n    /**\n     * Text alignment. Possible values: \"left\", \"center\", \"right\" or \"justify\".\n     * @type String\n     * @default\n     */\n    textAlign:            'left',\n\n    /**\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n     * @type String\n     * @default\n     */\n    fontStyle:            '',\n\n    /**\n     * Line height\n     * @type Number\n     * @default\n     */\n    lineHeight:           1.16,\n\n    /**\n     * Background color of text lines\n     * @type String\n     * @default\n     */\n    textBackgroundColor:  '',\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties:      stateProperties,\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties:      cacheProperties,\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color.\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n     * @type String\n     * @default\n     */\n    stroke:               null,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:               null,\n\n    /**\n     * @private\n     */\n    _fontSizeFraction: 0.25,\n\n    /**\n     * Text Line proportion to font Size (in pixels)\n     * @type Number\n     * @default\n     */\n    _fontSizeMult:             1.13,\n\n    /**\n     * additional space between characters\n     * expressed in thousands of em unit\n     * @type Number\n     * @default\n     */\n    charSpacing:             0,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      options = options || { };\n      this.text = text;\n      this.__skipDimension = true;\n      this.callSuper('initialize', options);\n      this.__skipDimension = false;\n      this._initDimensions();\n      this.setCoords();\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @param {CanvasRenderingContext2D} [ctx] Context to render on\n     * @private\n     */\n    _initDimensions: function(ctx) {\n      if (this.__skipDimension) {\n        return;\n      }\n      if (!ctx) {\n        ctx = fabric.util.createCanvasElement().getContext('2d');\n        this._setTextStyles(ctx);\n      }\n      this._textLines = this._splitTextIntoLines();\n      this._clearCache();\n      this.width = this._getTextWidth(ctx) || this.cursorWidth || MIN_TEXT_WIDTH;\n      this.height = this._getTextHeight(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var dim = this.callSuper('_getCacheCanvasDimensions');\n      var fontSize = this.fontSize;\n      dim.width += fontSize * dim.zoomX;\n      dim.height += fontSize * dim.zoomY;\n      return dim;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this._setTextStyles(ctx);\n      if (this.group && this.group.type === 'path-group') {\n        ctx.translate(this.left, this.top);\n      }\n      this._renderTextLinesBackground(ctx);\n      this._renderText(ctx);\n      this._renderTextDecoration(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderText: function(ctx) {\n      this._renderTextFill(ctx);\n      this._renderTextStroke(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setTextStyles: function(ctx) {\n      ctx.textBaseline = 'alphabetic';\n      ctx.font = this._getFontDeclaration();\n    },\n\n    /**\n     * @private\n     * @return {Number} Height of fabric.Text object\n     */\n    _getTextHeight: function() {\n      return this._getHeightOfSingleLine() + (this._textLines.length - 1) * this._getHeightOfLine();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {Number} Maximum width of fabric.Text object\n     */\n    _getTextWidth: function(ctx) {\n      var maxWidth = this._getLineWidth(ctx, 0);\n\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\n        var currentLineWidth = this._getLineWidth(ctx, i);\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} chars Chars to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     */\n    _renderChars: function(method, ctx, chars, left, top) {\n      // remove Text word from method var\n      var shortM = method.slice(0, -4), _char, width;\n      if (this[shortM].toLive) {\n        var offsetX = -this.width / 2 + this[shortM].offsetX || 0,\n            offsetY = -this.height / 2 + this[shortM].offsetY || 0;\n        ctx.save();\n        ctx.translate(offsetX, offsetY);\n        left -= offsetX;\n        top -= offsetY;\n      }\n      if (this.charSpacing !== 0) {\n        var additionalSpace = this._getWidthOfCharSpacing();\n        chars = chars.split('');\n        for (var i = 0, len = chars.length; i < len; i++) {\n          _char = chars[i];\n          width = ctx.measureText(_char).width + additionalSpace;\n          ctx[method](_char, left, top);\n          left += width > 0 ? width : 0;\n        }\n      }\n      else {\n        ctx[method](chars, left, top);\n      }\n      this[shortM].toLive && ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Text to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     * @param {Number} lineIndex Index of a line in a text\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      // lift the line by quarter of fontSize\n      top -= this.fontSize * this._fontSizeFraction;\n\n      // short-circuit\n      var lineWidth = this._getLineWidth(ctx, lineIndex);\n      if (this.textAlign !== 'justify' || this.width < lineWidth) {\n        this._renderChars(method, ctx, line, left, top, lineIndex);\n        return;\n      }\n\n      // stretch the line\n      var words = line.split(/\\s+/),\n          charOffset = 0,\n          wordsWidth = this._getWidthOfWords(ctx, words.join(' '), lineIndex, 0),\n          widthDiff = this.width - wordsWidth,\n          numSpaces = words.length - 1,\n          spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,\n          leftOffset = 0, word;\n\n      for (var i = 0, len = words.length; i < len; i++) {\n        while (line[charOffset] === ' ' && charOffset < line.length) {\n          charOffset++;\n        }\n        word = words[i];\n        this._renderChars(method, ctx, word, left + leftOffset, top, lineIndex, charOffset);\n        leftOffset += this._getWidthOfWords(ctx, word, lineIndex, charOffset) + spaceWidth;\n        charOffset += word.length;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} word\n     */\n    _getWidthOfWords: function (ctx, word) {\n      var width = ctx.measureText(word).width, charCount, additionalSpace;\n      if (this.charSpacing !== 0) {\n        charCount = word.split('').length;\n        additionalSpace = charCount * this._getWidthOfCharSpacing();\n        width += additionalSpace;\n      }\n      return width > 0 ? width : 0;\n    },\n\n    /**\n     * @private\n     * @return {Number} Left offset\n     */\n    _getLeftOffset: function() {\n      return -this.width / 2;\n    },\n\n    /**\n     * @private\n     * @return {Number} Top offset\n     */\n    _getTopOffset: function() {\n      return -this.height / 2;\n    },\n\n    /**\n     * Returns true because text has no style\n     */\n    isEmptyStyles: function() {\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     */\n    _renderTextCommon: function(ctx, method) {\n\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset();\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        var heightOfLine = this._getHeightOfLine(ctx, i),\n            maxHeight = heightOfLine / this.lineHeight,\n            lineWidth = this._getLineWidth(ctx, i),\n            leftOffset = this._getLineLeftOffset(lineWidth);\n        this._renderTextLine(\n          method,\n          ctx,\n          this._textLines[i],\n          left + leftOffset,\n          top + lineHeights + maxHeight,\n          i\n        );\n        lineHeights += heightOfLine;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextFill: function(ctx) {\n      if (!this.fill && this.isEmptyStyles()) {\n        return;\n      }\n\n      this._renderTextCommon(ctx, 'fillText');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextStroke: function(ctx) {\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray);\n      ctx.beginPath();\n      this._renderTextCommon(ctx, 'strokeText');\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @return {Number} height of line\n     */\n    _getHeightOfLine: function() {\n      return this._getHeightOfSingleLine() * this.lineHeight;\n    },\n\n    /**\n     * @private\n     * @return {Number} height of line without lineHeight\n     */\n    _getHeightOfSingleLine: function() {\n      return this.fontSize * this._fontSizeMult;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      if (!this.textBackgroundColor) {\n        return;\n      }\n      var lineTopOffset = 0, heightOfLine,\n          lineWidth, lineLeftOffset, originalFill = ctx.fillStyle;\n\n      ctx.fillStyle = this.textBackgroundColor;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this._getHeightOfLine(ctx, i);\n        lineWidth = this._getLineWidth(ctx, i);\n        if (lineWidth > 0) {\n          lineLeftOffset = this._getLineLeftOffset(lineWidth);\n          ctx.fillRect(\n            this._getLeftOffset() + lineLeftOffset,\n            this._getTopOffset() + lineTopOffset,\n            lineWidth,\n            heightOfLine / this.lineHeight\n          );\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.fillStyle = originalFill;\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {Number} lineWidth Width of text line\n     * @return {Number} Line left offset\n     */\n    _getLineLeftOffset: function(lineWidth) {\n      if (this.textAlign === 'center') {\n        return (this.width - lineWidth) / 2;\n      }\n      if (this.textAlign === 'right') {\n        return this.width - lineWidth;\n      }\n      return 0;\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.__lineWidths = [];\n      this.__lineHeights = [];\n    },\n\n    /**\n     * @private\n     */\n    _shouldClearDimensionCache: function() {\n      var shouldClear = this._forceClearCache;\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\n      if (shouldClear) {\n        this.saveState({ propertySet: '_dimensionAffectingProps' });\n        this.dirty = true;\n      }\n      return shouldClear;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    _getLineWidth: function(ctx, lineIndex) {\n      if (this.__lineWidths[lineIndex]) {\n        return this.__lineWidths[lineIndex] === -1 ? this.width : this.__lineWidths[lineIndex];\n      }\n\n      var width, wordCount, line = this._textLines[lineIndex];\n\n      if (line === '') {\n        width = 0;\n      }\n      else {\n        width = this._measureLine(ctx, lineIndex);\n      }\n      this.__lineWidths[lineIndex] = width;\n\n      if (width && this.textAlign === 'justify') {\n        wordCount = line.split(/\\s+/);\n        if (wordCount.length > 1) {\n          this.__lineWidths[lineIndex] = -1;\n        }\n      }\n      return width;\n    },\n\n    _getWidthOfCharSpacing: function() {\n      if (this.charSpacing !== 0) {\n        return this.fontSize * this.charSpacing / 1000;\n      }\n      return 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    _measureLine: function(ctx, lineIndex) {\n      var line = this._textLines[lineIndex],\n          width = ctx.measureText(line).width,\n          additionalSpace = 0, charCount, finalWidth;\n      if (this.charSpacing !== 0) {\n        charCount = line.split('').length;\n        additionalSpace = (charCount - 1) * this._getWidthOfCharSpacing();\n      }\n      finalWidth = width + additionalSpace;\n      return finalWidth > 0 ? finalWidth : 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx) {\n      if (!this.textDecoration) {\n        return;\n      }\n      var halfOfVerticalBox = this.height / 2,\n          _this = this, offsets = [];\n\n      /** @ignore */\n      function renderLinesAtOffset(offsets) {\n        var i, lineHeight = 0, len, j, oLen, lineWidth,\n            lineLeftOffset, heightOfLine;\n\n        for (i = 0, len = _this._textLines.length; i < len; i++) {\n\n          lineWidth = _this._getLineWidth(ctx, i);\n          lineLeftOffset = _this._getLineLeftOffset(lineWidth);\n          heightOfLine = _this._getHeightOfLine(ctx, i);\n\n          for (j = 0, oLen = offsets.length; j < oLen; j++) {\n            ctx.fillRect(\n              _this._getLeftOffset() + lineLeftOffset,\n              lineHeight + (_this._fontSizeMult - 1 + offsets[j] ) * _this.fontSize - halfOfVerticalBox,\n              lineWidth,\n              _this.fontSize / 15);\n          }\n          lineHeight += heightOfLine;\n        }\n      }\n\n      if (this.textDecoration.indexOf('underline') > -1) {\n        offsets.push(0.85); // 1 - 3/16\n      }\n      if (this.textDecoration.indexOf('line-through') > -1) {\n        offsets.push(0.43);\n      }\n      if (this.textDecoration.indexOf('overline') > -1) {\n        offsets.push(-0.12);\n      }\n      if (offsets.length > 0) {\n        renderLinesAtOffset(offsets);\n      }\n    },\n\n    /**\n     * return font declaration string for canvas context\n     * @returns {String} font declaration formatted for canvas context.\n     */\n    _getFontDeclaration: function() {\n      return [\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\n        (fabric.isLikelyNode ? this.fontWeight : this.fontStyle),\n        (fabric.isLikelyNode ? this.fontStyle : this.fontWeight),\n        this.fontSize + 'px',\n        (fabric.isLikelyNode ? ('\"' + this.fontFamily + '\"') : this.fontFamily)\n      ].join(' ');\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    render: function(ctx, noTransform) {\n      // do not render if object is not visible\n      if (!this.visible) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      if (this._shouldClearDimensionCache()) {\n        this._setTextStyles(ctx);\n        this._initDimensions(ctx);\n      }\n      this.callSuper('render', ctx, noTransform);\n    },\n\n    /**\n     * Returns the text as an array of lines.\n     * @returns {Array} Lines in the text\n     */\n    _splitTextIntoLines: function() {\n      return this.text.split(this._reNewline);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var additionalProperties = [\n        'text',\n        'fontSize',\n        'fontWeight',\n        'fontFamily',\n        'fontStyle',\n        'lineHeight',\n        'textDecoration',\n        'textAlign',\n        'textBackgroundColor',\n        'charSpacing'\n      ].concat(propertiesToInclude);\n      return this.callSuper('toObject', additionalProperties);\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      if (!this.ctx) {\n        this.ctx = fabric.util.createCanvasElement().getContext('2d');\n      }\n      var markup = this._createBaseSVGMarkup(),\n          offsets = this._getSVGLeftTopOffsets(this.ctx),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\n      this._wrapSVGTextAndBg(markup, textAndBg);\n\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLeftTopOffsets: function(ctx) {\n      var lineTop = this._getHeightOfLine(ctx, 0),\n          textLeft = -this.width / 2,\n          textTop = 0;\n\n      return {\n        textLeft: textLeft + (this.group && this.group.type === 'path-group' ? this.left : 0),\n        textTop: textTop + (this.group && this.group.type === 'path-group' ? -this.top : 0),\n        lineTop: lineTop\n      };\n    },\n\n    /**\n     * @private\n     */\n    _wrapSVGTextAndBg: function(markup, textAndBg) {\n      var noShadow = true, filter = this.getSvgFilter(),\n          style = filter === '' ? '' : ' style=\"' + filter + '\"';\n\n      markup.push(\n        '\\t<g ', this.getSvgId(), 'transform=\"', this.getSvgTransform(), this.getSvgTransformMatrix(), '\"',\n          style, '>\\n',\n          textAndBg.textBgRects.join(''),\n          '\\t\\t<text xml:space=\"preserve\" ',\n            (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n            (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\n            (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\n            (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\n            (this.textDecoration ? 'text-decoration=\"' + this.textDecoration + '\" ' : ''),\n            'style=\"', this.getSvgStyles(noShadow), '\" >\\n',\n            textAndBg.textSpans.join(''),\n          '\\t\\t</text>\\n',\n        '\\t</g>\\n'\n      );\n    },\n\n    getSvgStyles: function(skipShadow) {\n      var svgStyle = fabric.Object.prototype.getSvgStyles.call(this, skipShadow);\n      return svgStyle + ' white-space: pre;';\n    },\n\n    /**\n     * @private\n     * @param {Number} textTopOffset Text top offset\n     * @param {Number} textLeftOffset Text left offset\n     * @return {Object}\n     */\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\n      var textSpans = [],\n          textBgRects = [],\n          height = 0;\n      // bounding-box background\n      this._setSVGBg(textBgRects);\n\n      // text and text-background\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (this.textBackgroundColor) {\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset, textTopOffset, height);\n        }\n        this._setSVGTextLineText(i, textSpans, height, textLeftOffset, textTopOffset, textBgRects);\n        height += this._getHeightOfLine(this.ctx, i);\n      }\n\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    _setSVGTextLineText: function(i, textSpans, height, textLeftOffset, textTopOffset) {\n      var yPos = this.fontSize * (this._fontSizeMult - this._fontSizeFraction)\n        - textTopOffset + height - this.height / 2;\n      if (this.textAlign === 'justify') {\n        // i call from here to do not intefere with IText\n        this._setSVGTextLineJustifed(i, textSpans, yPos, textLeftOffset);\n        return;\n      }\n      textSpans.push(\n        '\\t\\t\\t<tspan x=\"',\n          toFixed(textLeftOffset + this._getLineLeftOffset(this._getLineWidth(this.ctx, i)), NUM_FRACTION_DIGITS), '\" ',\n          'y=\"',\n          toFixed(yPos, NUM_FRACTION_DIGITS),\n          '\" ',\n          // doing this on <tspan> elements since setting opacity\n          // on containing <text> one doesn't work in Illustrator\n          this._getFillAttributes(this.fill), '>',\n          fabric.util.string.escapeXml(this._textLines[i]),\n        '</tspan>\\n'\n      );\n    },\n\n    _setSVGTextLineJustifed: function(i, textSpans, yPos, textLeftOffset) {\n      var ctx = fabric.util.createCanvasElement().getContext('2d');\n\n      this._setTextStyles(ctx);\n\n      var line = this._textLines[i],\n          words = line.split(/\\s+/),\n          wordsWidth = this._getWidthOfWords(ctx, words.join('')),\n          widthDiff = this.width - wordsWidth,\n          numSpaces = words.length - 1,\n          spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,\n          word, attributes = this._getFillAttributes(this.fill),\n          len;\n\n      textLeftOffset += this._getLineLeftOffset(this._getLineWidth(ctx, i));\n\n      for (i = 0, len = words.length; i < len; i++) {\n        word = words[i];\n        textSpans.push(\n          '\\t\\t\\t<tspan x=\"',\n            toFixed(textLeftOffset, NUM_FRACTION_DIGITS), '\" ',\n            'y=\"',\n            toFixed(yPos, NUM_FRACTION_DIGITS),\n            '\" ',\n            // doing this on <tspan> elements since setting opacity\n            // on containing <text> one doesn't work in Illustrator\n            attributes, '>',\n            fabric.util.string.escapeXml(word),\n          '</tspan>\\n'\n        );\n        textLeftOffset += this._getWidthOfWords(ctx, word) + spaceWidth;\n      }\n    },\n\n    _setSVGTextLineBg: function(textBgRects, i, textLeftOffset, textTopOffset, height) {\n      textBgRects.push(\n        '\\t\\t<rect ',\n          this._getFillAttributes(this.textBackgroundColor),\n          ' x=\"',\n          toFixed(textLeftOffset + this._getLineLeftOffset(this._getLineWidth(this.ctx, i)), NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(height - this.height / 2, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(this._getLineWidth(this.ctx, i), NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(this._getHeightOfLine(this.ctx, i) / this.lineHeight, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n');\n    },\n\n    _setSVGBg: function(textBgRects) {\n      if (this.backgroundColor) {\n        textBgRects.push(\n          '\\t\\t<rect ',\n            this._getFillAttributes(this.backgroundColor),\n            ' x=\"',\n            toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n            '\" y=\"',\n            toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n            '\" width=\"',\n            toFixed(this.width, NUM_FRACTION_DIGITS),\n            '\" height=\"',\n            toFixed(this.height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n');\n      }\n    },\n\n    /**\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n     *\n     * @private\n     * @param {*} value\n     * @return {String}\n     */\n    _getFillAttributes: function(value) {\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Sets specified property to a specified value\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Text} thisArg\n     * @chainable\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (this._dimensionAffectingProps.indexOf(key) > -1) {\n        this._initDimensions();\n        this.setCoords();\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    'x y dx dy font-family font-style font-weight font-size text-decoration text-anchor'.split(' '));\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @return {fabric.Text} Instance of fabric.Text\n   */\n  fabric.Text.fromElement = function(element, options) {\n    if (!element) {\n      return null;\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES);\n    options = fabric.util.object.extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes);\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if ('dx' in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if ('dy' in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!('fontSize' in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    if (!options.originX) {\n      options.originX = 'left';\n    }\n\n    var textContent = '';\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!('textContent' in element)) {\n      if ('firstChild' in element && element.firstChild !== null) {\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    }\n    else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\n\n    var text = new fabric.Text(textContent, options),\n        textHeightScaleFactor = text.getHeight() / text.height,\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\n        textHeight = text.getHeight() + scaledDiff,\n        offX = 0;\n    /*\n      Adjust positioning:\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n        top/left properties in Fabric correspond to center point of text bounding box\n    */\n    if (text.originX === 'left') {\n      offX = text.getWidth() / 2;\n    }\n    if (text.originX === 'right') {\n      offX = -text.getWidth() / 2;\n    }\n    text.set({\n      left: text.getLeft() + offX,\n      top: text.getTop() - textHeight / 2 + text.fontSize * (0.18 + text._fontSizeFraction) / text.lineHeight /* 0.3 is the old lineHeight */\n    });\n\n    return text;\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Text} Instance of fabric.Text\n   */\n  fabric.Text.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Text', object, callback, forceAsync, 'text');\n  };\n\n  fabric.util.createAccessors(fabric.Text);\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'i-text',\n\n    /**\n     * Index where text selection starts (or where cursor is when there is no selection)\n     * @type Number\n     * @default\n     */\n    selectionStart: 0,\n\n    /**\n     * Index where text selection ends\n     * @type Number\n     * @default\n     */\n    selectionEnd: 0,\n\n    /**\n     * Color of text selection\n     * @type String\n     * @default\n     */\n    selectionColor: 'rgba(17,119,255,0.3)',\n\n    /**\n     * Indicates whether text is in editing mode\n     * @type Boolean\n     * @default\n     */\n    isEditing: false,\n\n    /**\n     * Indicates whether a text can be edited\n     * @type Boolean\n     * @default\n     */\n    editable: true,\n\n    /**\n     * Border color of text object while it's in editing mode\n     * @type String\n     * @default\n     */\n    editingBorderColor: 'rgba(102,153,255,0.25)',\n\n    /**\n     * Width of cursor (in px)\n     * @type Number\n     * @default\n     */\n    cursorWidth: 2,\n\n    /**\n     * Color of default cursor (when not overwritten by character style)\n     * @type String\n     * @default\n     */\n    cursorColor: '#333',\n\n    /**\n     * Delay between cursor blink (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDelay: 1000,\n\n    /**\n     * Duration of cursor fadein (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDuration: 600,\n\n    /**\n     * Object containing character styles\n     * (where top-level properties corresponds to line number and 2nd-level properties -- to char number in a line)\n     * @type Object\n     * @default\n     */\n    styles: null,\n\n    /**\n     * Indicates whether internal text char widths can be cached\n     * @type Boolean\n     * @default\n     */\n    caching: true,\n\n    /**\n     * @private\n     */\n    _reSpace: /\\s|\\n/,\n\n    /**\n     * @private\n     */\n    _currentCursorOpacity: 0,\n\n    /**\n     * @private\n     */\n    _selectionDirection: null,\n\n    /**\n     * @private\n     */\n    _abortCursorAnimation: false,\n\n    /**\n     * @private\n     */\n    __widthOfSpace: [],\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.IText} thisArg\n     */\n    initialize: function(text, options) {\n      this.styles = options ? (options.styles || { }) : { };\n      this.callSuper('initialize', text, options);\n      this.initBehavior();\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.callSuper('_clearCache');\n      this.__widthOfSpace = [];\n    },\n\n    /**\n     * Returns true if object has no styling\n     */\n    isEmptyStyles: function() {\n      if (!this.styles) {\n        return true;\n      }\n      var obj = this.styles;\n\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          // eslint-disable-next-line no-unused-vars\n          for (var p3 in obj[p1][p2]) {\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Sets selection start (left boundary of a selection)\n     * @param {Number} index Index to set selection start to\n     */\n    setSelectionStart: function(index) {\n      index = Math.max(index, 0);\n      this._updateAndFire('selectionStart', index);\n    },\n\n    /**\n     * Sets selection end (right boundary of a selection)\n     * @param {Number} index Index to set selection end to\n     */\n    setSelectionEnd: function(index) {\n      index = Math.min(index, this.text.length);\n      this._updateAndFire('selectionEnd', index);\n    },\n\n    /**\n     * @private\n     * @param {String} property 'selectionStart' or 'selectionEnd'\n     * @param {Number} index new position of property\n     */\n    _updateAndFire: function(property, index) {\n      if (this[property] !== index) {\n        this._fireSelectionChanged();\n        this[property] = index;\n      }\n      this._updateTextarea();\n    },\n\n    /**\n     * Fires the even of selection changed\n     * @private\n     */\n    _fireSelectionChanged: function() {\n      this.fire('selection:changed');\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\n    },\n\n    /**\n     * Gets style of a current selection/cursor (at the start position)\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at\n     * @return {Object} styles Style object at a specified (or current) index\n     */\n    getSelectionStyles: function(startIndex, endIndex) {\n\n      if (arguments.length === 2) {\n        var styles = [];\n        for (var i = startIndex; i < endIndex; i++) {\n          styles.push(this.getSelectionStyles(i));\n        }\n        return styles;\n      }\n\n      var loc = this.get2DCursorLocation(startIndex),\n          style = this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n\n      return style || {};\n    },\n\n    /**\n     * Sets style of a current selection\n     * @param {Object} [styles] Styles object\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    setSelectionStyles: function(styles) {\n      if (this.selectionStart === this.selectionEnd) {\n        this._extendStyles(this.selectionStart, styles);\n      }\n      else {\n        for (var i = this.selectionStart; i < this.selectionEnd; i++) {\n          this._extendStyles(i, styles);\n        }\n      }\n      /* not included in _extendStyles to avoid clearing cache more than once */\n      this._forceClearCache = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _extendStyles: function(index, styles) {\n      var loc = this.get2DCursorLocation(index);\n\n      if (!this._getLineStyle(loc.lineIndex)) {\n        this._setLineStyle(loc.lineIndex, {});\n      }\n\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n      }\n\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @param {CanvasRenderingContext2D} [ctx] Context to render on\n     * @private\n     */\n    _initDimensions: function(ctx) {\n      if (!ctx) {\n        this.clearContextTop();\n      }\n      this.callSuper('_initDimensions', ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Boolean} noTransform\n     */\n    render: function(ctx, noTransform) {\n      this.clearContextTop();\n      this.callSuper('render', ctx, noTransform);\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n      // the correct position but not at every cursor animation.\n      this.cursorOffsetCache = { };\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this.callSuper('_render', ctx);\n      this.ctx = ctx;\n    },\n\n    /**\n     * Prepare and clean the contextTop\n     */\n    clearContextTop: function() {\n      if (!this.active || !this.isEditing) {\n        return;\n      }\n      if (this.canvas && this.canvas.contextTop) {\n        var ctx = this.canvas.contextTop;\n        ctx.save();\n        ctx.transform.apply(ctx, this.canvas.viewportTransform);\n        this.transform(ctx);\n        this.transformMatrix && ctx.transform.apply(ctx, this.transformMatrix);\n        this._clearTextArea(ctx);\n        ctx.restore();\n      }\n    },\n\n    /**\n     * Renders cursor or selection (depending on what exists)\n     */\n    renderCursorOrSelection: function() {\n      if (!this.active || !this.isEditing) {\n        return;\n      }\n      var chars = this.text.split(''),\n          boundaries, ctx;\n      if (this.canvas && this.canvas.contextTop) {\n        ctx = this.canvas.contextTop;\n        ctx.save();\n        ctx.transform.apply(ctx, this.canvas.viewportTransform);\n        this.transform(ctx);\n        this.transformMatrix && ctx.transform.apply(ctx, this.transformMatrix);\n        this._clearTextArea(ctx);\n      }\n      else {\n        ctx = this.ctx;\n        ctx.save();\n      }\n      if (this.selectionStart === this.selectionEnd) {\n        boundaries = this._getCursorBoundaries(chars, 'cursor');\n        this.renderCursor(boundaries, ctx);\n      }\n      else {\n        boundaries = this._getCursorBoundaries(chars, 'selection');\n        this.renderSelection(chars, boundaries, ctx);\n      }\n      ctx.restore();\n    },\n\n    _clearTextArea: function(ctx) {\n      // we add 4 pixel, to be sure to do not leave any pixel out\n      var width = this.width + 4, height = this.height + 4;\n      ctx.clearRect(-width / 2, -height / 2, width, height);\n    },\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     */\n    get2DCursorLocation: function(selectionStart) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n      var len = this._textLines.length;\n      for (var i = 0; i < len; i++) {\n        if (selectionStart <= this._textLines[i].length) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart\n          };\n        }\n        selectionStart -= this._textLines[i].length + 1;\n      }\n      return {\n        lineIndex: i - 1,\n        charIndex: this._textLines[i - 1].length < selectionStart ? this._textLines[i - 1].length : selectionStart\n      };\n    },\n\n    /**\n     * Returns complete style of char at the current cursor\n     * @param {Number} lineIndex Line index\n     * @param {Number} charIndex Char index\n     * @return {Object} Character style\n     */\n    getCurrentCharStyle: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex === 0 ? 0 : charIndex - 1);\n\n      return {\n        fontSize: style && style.fontSize || this.fontSize,\n        fill: style && style.fill || this.fill,\n        textBackgroundColor: style && style.textBackgroundColor || this.textBackgroundColor,\n        textDecoration: style && style.textDecoration || this.textDecoration,\n        fontFamily: style && style.fontFamily || this.fontFamily,\n        fontWeight: style && style.fontWeight || this.fontWeight,\n        fontStyle: style && style.fontStyle || this.fontStyle,\n        stroke: style && style.stroke || this.stroke,\n        strokeWidth: style && style.strokeWidth || this.strokeWidth\n      };\n    },\n\n    /**\n     * Returns fontSize of char at the current cursor\n     * @param {Number} lineIndex Line index\n     * @param {Number} charIndex Char index\n     * @return {Number} Character font size\n     */\n    getCurrentCharFontSize: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex === 0 ? 0 : charIndex - 1);\n      return style && style.fontSize ? style.fontSize : this.fontSize;\n    },\n\n    /**\n     * Returns color (fill) of char at the current cursor\n     * @param {Number} lineIndex Line index\n     * @param {Number} charIndex Char index\n     * @return {String} Character color (fill)\n     */\n    getCurrentCharColor: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex === 0 ? 0 : charIndex - 1);\n      return style && style.fill ? style.fill : this.cursorColor;\n    },\n\n    /**\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\n     * @private\n     * @param {Array} chars Array of characters\n     * @param {String} typeOfBoundaries\n     */\n    _getCursorBoundaries: function(chars, typeOfBoundaries) {\n\n      // left/top are left/top of entire text box\n      // leftOffset/topOffset are offset from that left/top point of a text box\n\n      var left = Math.round(this._getLeftOffset()),\n          top = this._getTopOffset(),\n\n          offsets = this._getCursorBoundariesOffsets(\n                      chars, typeOfBoundaries);\n\n      return {\n        left: left,\n        top: top,\n        leftOffset: offsets.left + offsets.lineLeft,\n        topOffset: offsets.top\n      };\n    },\n\n    /**\n     * @private\n     */\n    _getCursorBoundariesOffsets: function(chars, typeOfBoundaries) {\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\n        return this.cursorOffsetCache;\n      }\n      var lineLeftOffset = 0,\n          lineIndex = 0,\n          charIndex = 0,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries;\n\n      for (var i = 0; i < this.selectionStart; i++) {\n        if (chars[i] === '\\n') {\n          leftOffset = 0;\n          topOffset += this._getHeightOfLine(this.ctx, lineIndex);\n\n          lineIndex++;\n          charIndex = 0;\n        }\n        else {\n          leftOffset += this._getWidthOfChar(this.ctx, chars[i], lineIndex, charIndex);\n          charIndex++;\n        }\n\n        lineLeftOffset = this._getLineLeftOffset(this._getLineWidth(this.ctx, lineIndex));\n      }\n      if (typeOfBoundaries === 'cursor') {\n        topOffset += (1 - this._fontSizeFraction) * this._getHeightOfLine(this.ctx, lineIndex) / this.lineHeight\n          - this.getCurrentCharFontSize(lineIndex, charIndex) * (1 - this._fontSizeFraction);\n      }\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\n        leftOffset -= this._getWidthOfCharSpacing();\n      }\n      boundaries = {\n        top: topOffset,\n        left: leftOffset > 0 ? leftOffset : 0,\n        lineLeft: lineLeftOffset\n      };\n      this.cursorOffsetCache = boundaries;\n      return this.cursorOffsetCache;\n    },\n\n    /**\n     * Renders cursor\n     * @param {Object} boundaries\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderCursor: function(boundaries, ctx) {\n\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getCurrentCharFontSize(lineIndex, charIndex),\n          leftOffset = boundaries.leftOffset,\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier;\n\n      ctx.fillStyle = this.getCurrentCharColor(lineIndex, charIndex);\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n\n      ctx.fillRect(\n        boundaries.left + leftOffset - cursorWidth / 2,\n        boundaries.top + boundaries.topOffset,\n        cursorWidth,\n        charHeight);\n    },\n\n    /**\n     * Renders text selection\n     * @param {Array} chars Array of characters\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderSelection: function(chars, boundaries, ctx) {\n\n      ctx.fillStyle = this.selectionColor;\n\n      var start = this.get2DCursorLocation(this.selectionStart),\n          end = this.get2DCursorLocation(this.selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex;\n      for (var i = startLine; i <= endLine; i++) {\n        var lineOffset = this._getLineLeftOffset(this._getLineWidth(ctx, i)) || 0,\n            lineHeight = this._getHeightOfLine(this.ctx, i),\n            realLineHeight = 0, boxWidth = 0, line = this._textLines[i];\n\n        if (i === startLine) {\n          for (var j = 0, len = line.length; j < len; j++) {\n            if (j >= start.charIndex && (i !== endLine || j < end.charIndex)) {\n              boxWidth += this._getWidthOfChar(ctx, line[j], i, j);\n            }\n            if (j < start.charIndex) {\n              lineOffset += this._getWidthOfChar(ctx, line[j], i, j);\n            }\n          }\n          if (j === line.length) {\n            boxWidth -= this._getWidthOfCharSpacing();\n          }\n        }\n        else if (i > startLine && i < endLine) {\n          boxWidth += this._getLineWidth(ctx, i) || 5;\n        }\n        else if (i === endLine) {\n          for (var j2 = 0, j2len = end.charIndex; j2 < j2len; j2++) {\n            boxWidth += this._getWidthOfChar(ctx, line[j2], i, j2);\n          }\n          if (end.charIndex === line.length) {\n            boxWidth -= this._getWidthOfCharSpacing();\n          }\n        }\n        realLineHeight = lineHeight;\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n          lineHeight /= this.lineHeight;\n        }\n        ctx.fillRect(\n          boundaries.left + lineOffset,\n          boundaries.top + boundaries.topOffset,\n          boxWidth > 0 ? boxWidth : 0,\n          lineHeight);\n\n        boundaries.topOffset += realLineHeight;\n      }\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Content of the line\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     * @param {Number} charOffset\n     */\n    _renderChars: function(method, ctx, line, left, top, lineIndex, charOffset) {\n\n      if (this.isEmptyStyles()) {\n        return this._renderCharsFast(method, ctx, line, left, top);\n      }\n\n      charOffset = charOffset || 0;\n\n      // set proper line offset\n      var lineHeight = this._getHeightOfLine(ctx, lineIndex),\n          prevStyle,\n          thisStyle,\n          charsToRender = '';\n\n      ctx.save();\n      top -= lineHeight / this.lineHeight * this._fontSizeFraction;\n      for (var i = charOffset, len = line.length + charOffset; i <= len; i++) {\n        prevStyle = prevStyle || this.getCurrentCharStyle(lineIndex, i);\n        thisStyle = this.getCurrentCharStyle(lineIndex, i + 1);\n\n        if (this._hasStyleChanged(prevStyle, thisStyle) || i === len) {\n          this._renderChar(method, ctx, lineIndex, i - 1, charsToRender, left, top, lineHeight);\n          charsToRender = '';\n          prevStyle = thisStyle;\n        }\n        charsToRender += line[i - charOffset];\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Content of the line\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     */\n    _renderCharsFast: function(method, ctx, line, left, top) {\n\n      if (method === 'fillText' && this.fill) {\n        this.callSuper('_renderChars', method, ctx, line, left, top);\n      }\n      if (method === 'strokeText' && ((this.stroke && this.strokeWidth > 0) || this.skipFillStrokeCheck)) {\n        this.callSuper('_renderChars', method, ctx, line, left, top);\n      }\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} i\n     * @param {String} _char\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     * @param {Number} lineHeight Height of the line\n     */\n    _renderChar: function(method, ctx, lineIndex, i, _char, left, top, lineHeight) {\n      var charWidth, charHeight, shouldFill, shouldStroke,\n          decl = this._getStyleDeclaration(lineIndex, i),\n          offset, textDecoration, chars, additionalSpace, _charWidth;\n\n      if (decl) {\n        charHeight = this._getHeightOfChar(ctx, _char, lineIndex, i);\n        shouldStroke = decl.stroke;\n        shouldFill = decl.fill;\n        textDecoration = decl.textDecoration;\n      }\n      else {\n        charHeight = this.fontSize;\n      }\n\n      shouldStroke = (shouldStroke || this.stroke) && method === 'strokeText';\n      shouldFill = (shouldFill || this.fill) && method === 'fillText';\n\n      decl && ctx.save();\n\n      charWidth = this._applyCharStylesGetWidth(ctx, _char, lineIndex, i, decl || null);\n      textDecoration = textDecoration || this.textDecoration;\n\n      if (decl && decl.textBackgroundColor) {\n        this._removeShadow(ctx);\n      }\n      if (this.charSpacing !== 0) {\n        additionalSpace = this._getWidthOfCharSpacing();\n        chars = _char.split('');\n        charWidth = 0;\n        for (var j = 0, len = chars.length, jChar; j < len; j++) {\n          jChar = chars[j];\n          shouldFill && ctx.fillText(jChar, left + charWidth, top);\n          shouldStroke && ctx.strokeText(jChar, left + charWidth, top);\n          _charWidth = ctx.measureText(jChar).width + additionalSpace;\n          charWidth += _charWidth > 0 ? _charWidth : 0;\n        }\n      }\n      else {\n        shouldFill && ctx.fillText(_char, left, top);\n        shouldStroke && ctx.strokeText(_char, left, top);\n      }\n\n      if (textDecoration || textDecoration !== '') {\n        offset = this._fontSizeFraction * lineHeight / this.lineHeight;\n        this._renderCharDecoration(ctx, textDecoration, left, top, offset, charWidth, charHeight);\n      }\n\n      decl && ctx.restore();\n      ctx.translate(charWidth, 0);\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChanged: function(prevStyle, thisStyle) {\n      return (prevStyle.fill !== thisStyle.fill ||\n              prevStyle.fontSize !== thisStyle.fontSize ||\n              prevStyle.textBackgroundColor !== thisStyle.textBackgroundColor ||\n              prevStyle.textDecoration !== thisStyle.textDecoration ||\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\n              prevStyle.stroke !== thisStyle.stroke ||\n              prevStyle.strokeWidth !== thisStyle.strokeWidth\n      );\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderCharDecoration: function(ctx, textDecoration, left, top, offset, charWidth, charHeight) {\n\n      if (!textDecoration) {\n        return;\n      }\n\n      var decorationWeight = charHeight / 15,\n          positions = {\n            underline: top + charHeight / 10,\n            'line-through': top - charHeight * (this._fontSizeFraction + this._fontSizeMult - 1) + decorationWeight,\n            overline: top - (this._fontSizeMult - this._fontSizeFraction) * charHeight\n          },\n          decorations = ['underline', 'line-through', 'overline'], i, decoration;\n\n      for (i = 0; i < decorations.length; i++) {\n        decoration = decorations[i];\n        if (textDecoration.indexOf(decoration) > -1) {\n          ctx.fillRect(left, positions[decoration], charWidth , decorationWeight);\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      // to \"cancel\" this.fontSize subtraction in fabric.Text#_renderTextLine\n      // the adding 0.03 is just to align text with itext by overlap test\n      if (!this.isEmptyStyles()) {\n        top += this.fontSize * (this._fontSizeFraction + 0.03);\n      }\n      this.callSuper('_renderTextLine', method, ctx, line, left, top, lineIndex);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx) {\n      if (this.isEmptyStyles()) {\n        return this.callSuper('_renderTextDecoration', ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      this.callSuper('_renderTextLinesBackground', ctx);\n\n      var lineTopOffset = 0, heightOfLine,\n          lineWidth, lineLeftOffset,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(),\n          colorCache = '',\n          line, _char, style, leftCache,\n          topCache, widthCache, heightCache;\n      ctx.save();\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this._getHeightOfLine(ctx, i);\n        line = this._textLines[i];\n\n        if (line === '' || !this.styles || !this._getLineStyle(i)) {\n          lineTopOffset += heightOfLine;\n          continue;\n        }\n\n        lineWidth = this._getLineWidth(ctx, i);\n        lineLeftOffset = this._getLineLeftOffset(lineWidth);\n        leftCache = topCache = widthCache = heightCache = 0;\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          style = this._getStyleDeclaration(i, j) || {};\n\n          if (colorCache !== style.textBackgroundColor) {\n            if (heightCache && widthCache) {\n              ctx.fillStyle = colorCache;\n              ctx.fillRect(leftCache, topCache, widthCache, heightCache);\n            }\n            leftCache = topCache = widthCache = heightCache = 0;\n            colorCache = style.textBackgroundColor || '';\n          }\n\n          if (!style.textBackgroundColor) {\n            colorCache = '';\n            continue;\n          }\n          _char = line[j];\n\n          if (colorCache === style.textBackgroundColor) {\n            colorCache = style.textBackgroundColor;\n            if (!leftCache) {\n              leftCache = leftOffset + lineLeftOffset + this._getWidthOfCharsAt(ctx, i, j);\n            }\n            topCache = topOffset + lineTopOffset;\n            widthCache += this._getWidthOfChar(ctx, _char, i, j);\n            heightCache = heightOfLine / this.lineHeight;\n          }\n        }\n        // if a textBackgroundColor ends on the last character of a line\n        if (heightCache && widthCache) {\n          ctx.fillStyle = colorCache;\n          ctx.fillRect(leftCache, topCache, widthCache, heightCache);\n          leftCache = topCache = widthCache = heightCache = 0;\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     */\n    _getCacheProp: function(_char, styleDeclaration) {\n      return _char +\n             styleDeclaration.fontSize +\n             styleDeclaration.fontWeight +\n             styleDeclaration.fontStyle;\n    },\n\n    /**\n     * @private\n     * @param {String} fontFamily name\n     * @return {Object} reference to cache\n     */\n    _getFontCache: function(fontFamily) {\n      if (!fabric.charWidthsCache[fontFamily]) {\n        fabric.charWidthsCache[fontFamily] = { };\n      }\n      return fabric.charWidthsCache[fontFamily];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} _char\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} [decl]\n     */\n    _applyCharStylesGetWidth: function(ctx, _char, lineIndex, charIndex, decl) {\n      var charDecl = decl || this._getStyleDeclaration(lineIndex, charIndex),\n          styleDeclaration = clone(charDecl),\n          width, cacheProp, charWidthsCache;\n\n      this._applyFontStyles(styleDeclaration);\n      charWidthsCache = this._getFontCache(styleDeclaration.fontFamily);\n      cacheProp = this._getCacheProp(_char, styleDeclaration);\n\n      // short-circuit if no styles for this char\n      // global style from object is always applyed and handled by save and restore\n      if (!charDecl && charWidthsCache[cacheProp] && this.caching) {\n        return charWidthsCache[cacheProp];\n      }\n\n      if (typeof styleDeclaration.shadow === 'string') {\n        styleDeclaration.shadow = new fabric.Shadow(styleDeclaration.shadow);\n      }\n\n      var fill = styleDeclaration.fill || this.fill;\n      ctx.fillStyle = fill.toLive\n        ? fill.toLive(ctx, this)\n        : fill;\n\n      if (styleDeclaration.stroke) {\n        ctx.strokeStyle = (styleDeclaration.stroke && styleDeclaration.stroke.toLive)\n          ? styleDeclaration.stroke.toLive(ctx, this)\n          : styleDeclaration.stroke;\n      }\n\n      ctx.lineWidth = styleDeclaration.strokeWidth || this.strokeWidth;\n      ctx.font = this._getFontDeclaration.call(styleDeclaration);\n\n      //if we want this._setShadow.call to work with styleDeclarion\n      //we have to add those references\n      if (styleDeclaration.shadow) {\n        styleDeclaration.scaleX = this.scaleX;\n        styleDeclaration.scaleY = this.scaleY;\n        styleDeclaration.canvas = this.canvas;\n        styleDeclaration.getObjectScaling = this.getObjectScaling;\n        this._setShadow.call(styleDeclaration, ctx);\n      }\n\n      if (!this.caching || !charWidthsCache[cacheProp]) {\n        width = ctx.measureText(_char).width;\n        this.caching && (charWidthsCache[cacheProp] = width);\n        return width;\n      }\n\n      return charWidthsCache[cacheProp];\n    },\n\n    /**\n     * @private\n     * @param {Object} styleDeclaration\n     */\n    _applyFontStyles: function(styleDeclaration) {\n      if (!styleDeclaration.fontFamily) {\n        styleDeclaration.fontFamily = this.fontFamily;\n      }\n      if (!styleDeclaration.fontSize) {\n        styleDeclaration.fontSize = this.fontSize;\n      }\n      if (!styleDeclaration.fontWeight) {\n        styleDeclaration.fontWeight = this.fontWeight;\n      }\n      if (!styleDeclaration.fontStyle) {\n        styleDeclaration.fontStyle = this.fontStyle;\n      }\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Boolean} [returnCloneOrEmpty=false]\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex, returnCloneOrEmpty) {\n      if (returnCloneOrEmpty) {\n        return (this.styles[lineIndex] && this.styles[lineIndex][charIndex])\n          ? clone(this.styles[lineIndex][charIndex])\n          : { };\n      }\n\n      return this.styles[lineIndex] && this.styles[lineIndex][charIndex] ? this.styles[lineIndex][charIndex] : null;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     *\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      return this.styles[lineIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex, style) {\n      this.styles[lineIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      delete this.styles[lineIndex];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _getWidthOfChar: function(ctx, _char, lineIndex, charIndex) {\n      if (!this._isMeasuring && this.textAlign === 'justify' && this._reSpacesAndTabs.test(_char)) {\n        return this._getWidthOfSpace(ctx, lineIndex);\n      }\n      ctx.save();\n      var width = this._applyCharStylesGetWidth(ctx, _char, lineIndex, charIndex);\n      if (this.charSpacing !== 0) {\n        width += this._getWidthOfCharSpacing();\n      }\n      ctx.restore();\n      return width > 0 ? width : 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     */\n    _getHeightOfChar: function(ctx, lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex);\n      return style && style.fontSize ? style.fontSize : this.fontSize;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     */\n    _getWidthOfCharsAt: function(ctx, lineIndex, charIndex) {\n      var width = 0, i, _char;\n      for (i = 0; i < charIndex; i++) {\n        _char = this._textLines[lineIndex][i];\n        width += this._getWidthOfChar(ctx, _char, lineIndex, i);\n      }\n      return width;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    _measureLine: function(ctx, lineIndex) {\n      this._isMeasuring = true;\n      var width = this._getWidthOfCharsAt(ctx, lineIndex, this._textLines[lineIndex].length);\n      if (this.charSpacing !== 0) {\n        width -= this._getWidthOfCharSpacing();\n      }\n      this._isMeasuring = false;\n      return width > 0 ? width : 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     */\n    _getWidthOfSpace: function (ctx, lineIndex) {\n      if (this.__widthOfSpace[lineIndex]) {\n        return this.__widthOfSpace[lineIndex];\n      }\n      var line = this._textLines[lineIndex],\n          wordsWidth = this._getWidthOfWords(ctx, line, lineIndex, 0),\n          widthDiff = this.width - wordsWidth,\n          numSpaces = line.length - line.replace(this._reSpacesAndTabs, '').length,\n          width = Math.max(widthDiff / numSpaces, ctx.measureText(' ').width);\n      this.__widthOfSpace[lineIndex] = width;\n      return width;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line\n     * @param {Number} lineIndex\n     * @param {Number} charOffset\n     */\n    _getWidthOfWords: function (ctx, line, lineIndex, charOffset) {\n      var width = 0;\n\n      for (var charIndex = 0; charIndex < line.length; charIndex++) {\n        var _char = line[charIndex];\n\n        if (!_char.match(/\\s/)) {\n          width += this._getWidthOfChar(ctx, _char, lineIndex, charIndex + charOffset);\n        }\n      }\n\n      return width;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _getHeightOfLine: function(ctx, lineIndex) {\n      if (this.__lineHeights[lineIndex]) {\n        return this.__lineHeights[lineIndex];\n      }\n\n      var line = this._textLines[lineIndex],\n          maxHeight = this._getHeightOfChar(ctx, lineIndex, 0);\n\n      for (var i = 1, len = line.length; i < len; i++) {\n        var currentCharHeight = this._getHeightOfChar(ctx, lineIndex, i);\n        if (currentCharHeight > maxHeight) {\n          maxHeight = currentCharHeight;\n        }\n      }\n      this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\n      return this.__lineHeights[lineIndex];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _getTextHeight: function(ctx) {\n      var lineHeight, height = 0;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineHeight = this._getHeightOfLine(ctx, i);\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\n      }\n      return height;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return fabric.util.object.extend(this.callSuper('toObject', propertiesToInclude), {\n        styles: clone(this.styles, true)\n      });\n    }\n  });\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.IText} instance of fabric.IText\n   */\n  fabric.IText.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('IText', object, callback, forceAsync, 'text');\n  };\n})();\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Initializes all the interactive behavior of IText\n     */\n    initBehavior: function() {\n      this.initAddedHandler();\n      this.initRemovedHandler();\n      this.initCursorSelectionHandlers();\n      this.initDoubleClickSimulation();\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    },\n\n    onDeselect: function() {\n      this.isEditing && this.exitEditing();\n      this.selected = false;\n      this.callSuper('onDeselect');\n    },\n\n    /**\n     * Initializes \"added\" event handler\n     */\n    initAddedHandler: function() {\n      var _this = this;\n      this.on('added', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          if (!canvas._hasITextHandlers) {\n            canvas._hasITextHandlers = true;\n            _this._initCanvasHandlers(canvas);\n          }\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          canvas._iTextInstances.push(_this);\n        }\n      });\n    },\n\n    initRemovedHandler: function() {\n      var _this = this;\n      this.on('removed', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\n          if (canvas._iTextInstances.length === 0) {\n            canvas._hasITextHandlers = false;\n            _this._removeCanvasHandlers(canvas);\n          }\n        }\n      });\n    },\n\n    /**\n     * register canvas event to manage exiting on other instances\n     * @private\n     */\n    _initCanvasHandlers: function(canvas) {\n      canvas._mouseUpITextHandler = (function() {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function(obj) {\n            obj.__isMousedown = false;\n          });\n        }\n      }).bind(this);\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * remove canvas event to manage exiting on other instances\n     * @private\n     */\n    _removeCanvasHandlers: function(canvas) {\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * @private\n     */\n    _tick: function() {\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\n    },\n\n    /**\n     * @private\n     */\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\n\n      var tickState;\n\n      tickState = {\n        isAborted: false,\n        abort: function() {\n          this.isAborted = true;\n        },\n      };\n\n      obj.animate('_currentCursorOpacity', targetOpacity, {\n        duration: duration,\n        onComplete: function() {\n          if (!tickState.isAborted) {\n            obj[completeMethod]();\n          }\n        },\n        onChange: function() {\n          // we do not want to animate a selection, only cursor\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n            obj.renderCursorOrSelection();\n          }\n        },\n        abort: function() {\n          return tickState.isAborted;\n        }\n      });\n      return tickState;\n    },\n\n    /**\n     * @private\n     */\n    _onTickComplete: function() {\n\n      var _this = this;\n\n      if (this._cursorTimeout1) {\n        clearTimeout(this._cursorTimeout1);\n      }\n      this._cursorTimeout1 = setTimeout(function() {\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\n      }, 100);\n    },\n\n    /**\n     * Initializes delayed cursor\n     */\n    initDelayedCursor: function(restart) {\n      var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this._cursorTimeout2 = setTimeout(function() {\n        _this._tick();\n      }, delay);\n    },\n\n    /**\n     * Aborts cursor animation and clears all timeouts\n     */\n    abortCursorAnimation: function() {\n      var shouldClear = this._currentTickState || this._currentTickCompleteState;\n      this._currentTickState && this._currentTickState.abort();\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\n\n      clearTimeout(this._cursorTimeout1);\n      clearTimeout(this._cursorTimeout2);\n\n      this._currentCursorOpacity = 0;\n      // to clear just itext area we need to transform the context\n      // it may not be worth it\n      if (shouldClear) {\n        this.canvas && this.canvas.clearContext(this.canvas.contextTop || this.ctx);\n      }\n\n    },\n\n    /**\n     * Selects entire text\n     */\n    selectAll: function() {\n      this.selectionStart = 0;\n      this.selectionEnd = this.text.length;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    },\n\n    /**\n     * Returns selected text\n     * @return {String}\n     */\n    getSelectedText: function() {\n      return this.text.slice(this.selectionStart, this.selectionEnd);\n    },\n\n    /**\n     * Find new selection index representing start of current word according to current selection index\n     * @param {Number} startFrom Surrent selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      // remove space before cursor first\n      if (this._reSpace.test(this.text.charAt(index))) {\n        while (this._reSpace.test(this.text.charAt(index))) {\n          offset++;\n          index--;\n        }\n      }\n      while (/\\S/.test(this.text.charAt(index)) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      // remove space after cursor first\n      if (this._reSpace.test(this.text.charAt(index))) {\n        while (this._reSpace.test(this.text.charAt(index))) {\n          offset++;\n          index++;\n        }\n      }\n      while (/\\S/.test(this.text.charAt(index)) && index < this.text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Find new selection index representing start of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      while (!/\\n/.test(this.text.charAt(index)) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      while (!/\\n/.test(this.text.charAt(index)) && index < this.text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Returns number of newlines in selected text\n     * @return {Number} Number of newlines in selected text\n     */\n    getNumNewLinesInSelectedText: function() {\n      var selectedText = this.getSelectedText(),\n          numNewLines  = 0;\n\n      for (var i = 0, len = selectedText.length; i < len; i++) {\n        if (selectedText[i] === '\\n') {\n          numNewLines++;\n        }\n      }\n      return numNewLines;\n    },\n\n    /**\n     * Finds index corresponding to beginning or end of a word\n     * @param {Number} selectionStart Index of a character\n     * @param {Number} direction 1 or -1\n     * @return {Number} Index of the beginning or end of a word\n     */\n    searchWordBoundary: function(selectionStart, direction) {\n      var index     = this._reSpace.test(this.text.charAt(selectionStart)) ? selectionStart - 1 : selectionStart,\n          _char     = this.text.charAt(index),\n          reNonWord = /[ \\n\\.,;!\\?\\-]/;\n\n      while (!reNonWord.test(_char) && index > 0 && index < this.text.length) {\n        index += direction;\n        _char = this.text.charAt(index);\n      }\n      if (reNonWord.test(_char) && _char !== '\\n') {\n        index += direction === 1 ? 0 : 1;\n      }\n      return index;\n    },\n\n    /**\n     * Selects a word based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectWord: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * Selects a line based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectLine: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    },\n\n    /**\n     * Enters editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    enterEditing: function(e) {\n      if (this.isEditing || !this.editable) {\n        return;\n      }\n\n      if (this.canvas) {\n        this.exitEditingOnOthers(this.canvas);\n      }\n\n      this.isEditing = true;\n      this.selected = true;\n      this.initHiddenTextarea(e);\n      this.hiddenTextarea.focus();\n      this._updateTextarea();\n      this._saveEditingProps();\n      this._setEditingProps();\n      this._textBeforeEdit = this.text;\n\n      this._tick();\n      this.fire('editing:entered');\n      this._fireSelectionChanged();\n      if (!this.canvas) {\n        return this;\n      }\n      this.canvas.fire('text:editing:entered', { target: this });\n      this.initMouseMoveHandler();\n      this.canvas.renderAll();\n      return this;\n    },\n\n    exitEditingOnOthers: function(canvas) {\n      if (canvas._iTextInstances) {\n        canvas._iTextInstances.forEach(function(obj) {\n          obj.selected = false;\n          if (obj.isEditing) {\n            obj.exitEditing();\n          }\n        });\n      }\n    },\n\n    /**\n     * Initializes \"mousemove\" event handler\n     */\n    initMouseMoveHandler: function() {\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\n    },\n\n    /**\n     * @private\n     */\n    mouseMoveHandler: function(options) {\n      if (!this.__isMousedown || !this.isEditing) {\n        return;\n      }\n\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n      if (\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\n        &&\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\n      ) {\n        return;\n      }\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\n        this.selectionStart = this.__selectionStartOnMouseDown;\n        this.selectionEnd = newSelectionStart;\n      }\n      else {\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = this.__selectionStartOnMouseDown;\n      }\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\n        this.restartCursorIfNeeded();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setEditingProps: function() {\n      this.hoverCursor = 'text';\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\n      }\n\n      this.borderColor = this.editingBorderColor;\n\n      this.hasControls = this.selectable = false;\n      this.lockMovementX = this.lockMovementY = true;\n    },\n\n    /**\n     * @private\n     */\n    _updateTextarea: function() {\n      if (!this.hiddenTextarea || this.inCompositionMode) {\n        return;\n      }\n      this.cursorOffsetCache = { };\n      this.hiddenTextarea.value = this.text;\n      this.hiddenTextarea.selectionStart = this.selectionStart;\n      this.hiddenTextarea.selectionEnd = this.selectionEnd;\n      if (this.selectionStart === this.selectionEnd) {\n        var style = this._calcTextareaPosition();\n        this.hiddenTextarea.style.left = style.left;\n        this.hiddenTextarea.style.top = style.top;\n        this.hiddenTextarea.style.fontSize = style.fontSize;\n      }\n    },\n\n    /**\n     * @private\n     * @return {Object} style contains style for hiddenTextarea\n     */\n    _calcTextareaPosition: function() {\n      if (!this.canvas) {\n        return { x: 1, y: 1 };\n      }\n      var chars = this.text.split(''),\n          boundaries = this._getCursorBoundaries(chars, 'cursor'),\n          cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getCurrentCharFontSize(lineIndex, charIndex),\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight\n          },\n          upperCanvas = this.canvas.upperCanvasEl,\n          maxWidth = upperCanvas.width - charHeight,\n          maxHeight = upperCanvas.height - charHeight;\n\n      p = fabric.util.transformPoint(p, m);\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n\n      if (p.x < 0) {\n        p.x = 0;\n      }\n      if (p.x > maxWidth) {\n        p.x = maxWidth;\n      }\n      if (p.y < 0) {\n        p.y = 0;\n      }\n      if (p.y > maxHeight) {\n        p.y = maxHeight;\n      }\n\n      // add canvas offset on document\n      p.x += this.canvas._offset.left;\n      p.y += this.canvas._offset.top;\n\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight };\n    },\n\n    /**\n     * @private\n     */\n    _saveEditingProps: function() {\n      this._savedProps = {\n        hasControls: this.hasControls,\n        borderColor: this.borderColor,\n        lockMovementX: this.lockMovementX,\n        lockMovementY: this.lockMovementY,\n        hoverCursor: this.hoverCursor,\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\n        moveCursor: this.canvas && this.canvas.moveCursor\n      };\n    },\n\n    /**\n     * @private\n     */\n    _restoreEditingProps: function() {\n      if (!this._savedProps) {\n        return;\n      }\n\n      this.hoverCursor = this._savedProps.overCursor;\n      this.hasControls = this._savedProps.hasControls;\n      this.borderColor = this._savedProps.borderColor;\n      this.lockMovementX = this._savedProps.lockMovementX;\n      this.lockMovementY = this._savedProps.lockMovementY;\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\n        this.canvas.moveCursor = this._savedProps.moveCursor;\n      }\n    },\n\n    /**\n     * Exits from editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    exitEditing: function() {\n      var isTextChanged = (this._textBeforeEdit !== this.text);\n      this.selected = false;\n      this.isEditing = false;\n      this.selectable = true;\n\n      this.selectionEnd = this.selectionStart;\n\n      if (this.hiddenTextarea) {\n        this.hiddenTextarea.blur && this.hiddenTextarea.blur();\n        this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);\n        this.hiddenTextarea = null;\n      }\n\n      this.abortCursorAnimation();\n      this._restoreEditingProps();\n      this._currentCursorOpacity = 0;\n\n      this.fire('editing:exited');\n      isTextChanged && this.fire('modified');\n      if (this.canvas) {\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\n        this.canvas.fire('text:editing:exited', { target: this });\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this.styles) {\n        if (!this._textLines[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _removeCharsFromTo: function(start, end) {\n      while (end !== start) {\n        this._removeSingleCharAndStyle(start + 1);\n        end--;\n      }\n      this.selectionStart = start;\n      this.selectionEnd = start;\n    },\n\n    _removeSingleCharAndStyle: function(index) {\n      var isBeginningOfLine = this.text[index - 1] === '\\n',\n          indexStyle        = isBeginningOfLine ? index : index - 1;\n      this.removeStyleObject(isBeginningOfLine, indexStyle);\n      this.text = this.text.slice(0, index - 1) +\n        this.text.slice(index);\n\n      this._textLines = this._splitTextIntoLines();\n    },\n\n    /**\n     * Inserts characters where cursor is (replacing selection if one exists)\n     * @param {String} _chars Characters to insert\n     * @param {Boolean} useCopiedStyle use fabric.copiedTextStyle\n     */\n    insertChars: function(_chars, useCopiedStyle) {\n      var style;\n\n      if (this.selectionEnd - this.selectionStart > 1) {\n        this._removeCharsFromTo(this.selectionStart, this.selectionEnd);\n      }\n      //short circuit for block paste\n      if (!useCopiedStyle && this.isEmptyStyles()) {\n        this.insertChar(_chars, false);\n        return;\n      }\n      for (var i = 0, len = _chars.length; i < len; i++) {\n        if (useCopiedStyle) {\n          style = fabric.util.object.clone(fabric.copiedTextStyle[i], true);\n        }\n        this.insertChar(_chars[i], i < len - 1, style);\n      }\n    },\n\n    /**\n     * Inserts a character where cursor is\n     * @param {String} _char Characters to insert\n     * @param {Boolean} skipUpdate trigger rendering and updates at the end of text insert\n     * @param {Object} styleObject Style to be inserted for the new char\n     */\n    insertChar: function(_char, skipUpdate, styleObject) {\n      var isEndOfLine = this.text[this.selectionStart] === '\\n';\n      this.text = this.text.slice(0, this.selectionStart) +\n        _char + this.text.slice(this.selectionEnd);\n      this._textLines = this._splitTextIntoLines();\n      this.insertStyleObjects(_char, isEndOfLine, styleObject);\n      this.selectionStart += _char.length;\n      this.selectionEnd = this.selectionStart;\n      if (skipUpdate) {\n        return;\n      }\n      this._updateTextarea();\n      this.setCoords();\n      this._fireSelectionChanged();\n      this.fire('changed');\n      this.restartCursorIfNeeded();\n      if (this.canvas) {\n        this.canvas.fire('text:changed', { target: this });\n        this.canvas.renderAll();\n      }\n    },\n\n    restartCursorIfNeeded: function() {\n      if (!this._currentTickState || this._currentTickState.isAborted\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\n      ) {\n        this.initDelayedCursor();\n      }\n    },\n\n    /**\n     * Inserts new style object\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Boolean} isEndOfLine True if it's end of line\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, isEndOfLine) {\n\n      this.shiftLineStyles(lineIndex, +1);\n\n      var currentCharStyle = {},\n          newLineStyles    = {};\n\n      if (this.styles[lineIndex] && this.styles[lineIndex][charIndex - 1]) {\n        currentCharStyle = this.styles[lineIndex][charIndex - 1];\n      }\n\n      // if there's nothing after cursor,\n      // we clone current char style onto the next (otherwise empty) line\n      if (isEndOfLine && currentCharStyle) {\n        newLineStyles[0] = clone(currentCharStyle);\n        this.styles[lineIndex + 1] = newLineStyles;\n      }\n      // otherwise we clone styles of all chars\n      // after cursor onto the next line, from the beginning\n      else {\n        var somethingAdded = false;\n        for (var index in this.styles[lineIndex]) {\n          var numIndex = parseInt(index, 10);\n          if (numIndex >= charIndex) {\n            somethingAdded = true;\n            newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n            // remove lines from the previous line since they're on a new line now\n            delete this.styles[lineIndex][index];\n          }\n        }\n        somethingAdded && (this.styles[lineIndex + 1] = newLineStyles);\n      }\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Object} [style] Style object to insert, if given\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, style) {\n\n      var currentLineStyles       = this.styles[lineIndex],\n          currentLineStylesCloned = clone(currentLineStyles);\n\n      if (charIndex === 0 && !style) {\n        charIndex = 1;\n      }\n\n      // shift all char styles by 1 forward\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n      for (var index in currentLineStylesCloned) {\n        var numericIndex = parseInt(index, 10);\n\n        if (numericIndex >= charIndex) {\n          currentLineStyles[numericIndex + 1] = currentLineStylesCloned[numericIndex];\n\n          // only delete the style if there was nothing moved there\n          if (!currentLineStylesCloned[numericIndex - 1]) {\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n      var newStyle = style || clone(currentLineStyles[charIndex - 1]);\n      newStyle && (this.styles[lineIndex][charIndex] = newStyle);\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object(s)\n     * @param {String} _chars Characters at the location where style is inserted\n     * @param {Boolean} isEndOfLine True if it's end of line\n     * @param {Object} [styleObject] Style to insert\n     */\n    insertStyleObjects: function(_chars, isEndOfLine, styleObject) {\n      // removed shortcircuit over isEmptyStyles\n\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex      = cursorLocation.lineIndex,\n          charIndex      = cursorLocation.charIndex;\n\n      if (!this._getLineStyle(lineIndex)) {\n        this._setLineStyle(lineIndex, {});\n      }\n\n      if (_chars === '\\n') {\n        this.insertNewlineStyleObject(lineIndex, charIndex, isEndOfLine);\n      }\n      else {\n        this.insertCharStyleObject(lineIndex, charIndex, styleObject);\n      }\n    },\n\n    /**\n     * Shifts line styles up or down\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can be -1 or +1\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by 1 upward or downward\n      var clonedStyles = clone(this.styles);\n      for (var line in clonedStyles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine <= lineIndex) {\n          delete clonedStyles[numericLine];\n        }\n      }\n      for (var line in this.styles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine > lineIndex) {\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\n          if (!clonedStyles[numericLine - offset]) {\n            delete this.styles[numericLine];\n          }\n        }\n      }\n      //TODO: evaluate if delete old style lines with offset -1\n    },\n\n    /**\n     * Removes style object\n     * @param {Boolean} isBeginningOfLine True if cursor is at the beginning of line\n     * @param {Number} [index] Optional index. When not given, current selectionStart is used.\n     */\n    removeStyleObject: function(isBeginningOfLine, index) {\n\n      var cursorLocation = this.get2DCursorLocation(index),\n          lineIndex      = cursorLocation.lineIndex,\n          charIndex      = cursorLocation.charIndex;\n\n      this._removeStyleObject(isBeginningOfLine, cursorLocation, lineIndex, charIndex);\n    },\n\n    _getTextOnPreviousLine: function(lIndex) {\n      return this._textLines[lIndex - 1];\n    },\n\n    _removeStyleObject: function(isBeginningOfLine, cursorLocation, lineIndex, charIndex) {\n\n      if (isBeginningOfLine) {\n        var textOnPreviousLine     = this._getTextOnPreviousLine(cursorLocation.lineIndex),\n            newCharIndexOnPrevLine = textOnPreviousLine ? textOnPreviousLine.length : 0;\n\n        if (!this.styles[lineIndex - 1]) {\n          this.styles[lineIndex - 1] = {};\n        }\n        for (charIndex in this.styles[lineIndex]) {\n          this.styles[lineIndex - 1][parseInt(charIndex, 10) + newCharIndexOnPrevLine]\n            = this.styles[lineIndex][charIndex];\n        }\n        this.shiftLineStyles(cursorLocation.lineIndex, -1);\n      }\n      else {\n        var currentLineStyles = this.styles[lineIndex];\n\n        if (currentLineStyles) {\n          delete currentLineStyles[charIndex];\n        }\n        var currentLineStylesCloned = clone(currentLineStyles);\n        // shift all styles by 1 backwards\n        for (var i in currentLineStylesCloned) {\n          var numericIndex = parseInt(i, 10);\n          if (numericIndex >= charIndex && numericIndex !== 0) {\n            currentLineStyles[numericIndex - 1] = currentLineStylesCloned[numericIndex];\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n    },\n\n    /**\n     * Inserts new line\n     */\n    insertNewline: function() {\n      this.insertChars('\\n');\n    },\n\n    /**\n     * Set the selectionStart and selectionEnd according to the ne postion of cursor\n     * mimic the key - mouse navigation when shift is pressed.\n     */\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\n      if (newSelection <= start) {\n        if (end === start) {\n          this._selectionDirection = 'left';\n        }\n        else if (this._selectionDirection === 'right') {\n          this._selectionDirection = 'left';\n          this.selectionEnd = start;\n        }\n        this.selectionStart = newSelection;\n      }\n      else if (newSelection > start && newSelection < end) {\n        if (this._selectionDirection === 'right') {\n          this.selectionEnd = newSelection;\n        }\n        else {\n          this.selectionStart = newSelection;\n        }\n      }\n      else {\n        // newSelection is > selection start and end\n        if (end === start) {\n          this._selectionDirection = 'right';\n        }\n        else if (this._selectionDirection === 'left') {\n          this._selectionDirection = 'right';\n          this.selectionStart = end;\n        }\n        this.selectionEnd = newSelection;\n      }\n    },\n\n    setSelectionInBoundaries: function() {\n      var length = this.text.length;\n      if (this.selectionStart > length) {\n        this.selectionStart = length;\n      }\n      else if (this.selectionStart < 0) {\n        this.selectionStart = 0;\n      }\n      if (this.selectionEnd > length) {\n        this.selectionEnd = length;\n      }\n      else if (this.selectionEnd < 0) {\n        this.selectionEnd = 0;\n      }\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n  /**\n   * Initializes \"dbclick\" event handler\n   */\n  initDoubleClickSimulation: function() {\n\n    // for double click\n    this.__lastClickTime = +new Date();\n\n    // for triple click\n    this.__lastLastClickTime = +new Date();\n\n    this.__lastPointer = { };\n\n    this.on('mousedown', this.onMouseDown.bind(this));\n  },\n\n  onMouseDown: function(options) {\n\n    this.__newClickTime = +new Date();\n    var newPointer = this.canvas.getPointer(options.e);\n\n    if (this.isTripleClick(newPointer, options.e)) {\n      this.fire('tripleclick', options);\n      this._stopEvent(options.e);\n    }\n    else if (this.isDoubleClick(newPointer)) {\n      this.fire('dblclick', options);\n      this._stopEvent(options.e);\n    }\n\n    this.__lastLastClickTime = this.__lastClickTime;\n    this.__lastClickTime = this.__newClickTime;\n    this.__lastPointer = newPointer;\n    this.__lastIsEditing = this.isEditing;\n    this.__lastSelected = this.selected;\n  },\n\n  isDoubleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y && this.__lastIsEditing;\n  },\n\n  isTripleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y;\n  },\n\n  /**\n   * @private\n   */\n  _stopEvent: function(e) {\n    e.preventDefault && e.preventDefault();\n    e.stopPropagation && e.stopPropagation();\n  },\n\n  /**\n   * Initializes event handlers related to cursor or selection\n   */\n  initCursorSelectionHandlers: function() {\n    this.initMousedownHandler();\n    this.initMouseupHandler();\n    this.initClicks();\n  },\n\n  /**\n   * Initializes double and triple click event handlers\n   */\n  initClicks: function() {\n    this.on('dblclick', function(options) {\n      this.selectWord(this.getSelectionStartFromPointer(options.e));\n    });\n    this.on('tripleclick', function(options) {\n      this.selectLine(this.getSelectionStartFromPointer(options.e));\n    });\n  },\n\n  /**\n   * Initializes \"mousedown\" event handler\n   */\n  initMousedownHandler: function() {\n    this.on('mousedown', function(options) {\n      if (!this.editable || (options.e.button && options.e.button !== 1)) {\n        return;\n      }\n      var pointer = this.canvas.getPointer(options.e);\n      this.__mousedownX = pointer.x;\n      this.__mousedownY = pointer.y;\n      this.__isMousedown = true;\n\n      if (this.selected) {\n        this.setCursorByClick(options.e);\n      }\n\n      if (this.isEditing) {\n        this.__selectionStartOnMouseDown = this.selectionStart;\n        if (this.selectionStart === this.selectionEnd) {\n          this.abortCursorAnimation();\n        }\n        this.renderCursorOrSelection();\n      }\n    });\n  },\n\n  /**\n   * @private\n   */\n  _isObjectMoved: function(e) {\n    var pointer = this.canvas.getPointer(e);\n\n    return this.__mousedownX !== pointer.x ||\n           this.__mousedownY !== pointer.y;\n  },\n\n  /**\n   * Initializes \"mouseup\" event handler\n   */\n  initMouseupHandler: function() {\n    this.on('mouseup', function(options) {\n      this.__isMousedown = false;\n      if (!this.editable || this._isObjectMoved(options.e) || (options.e.button && options.e.button !== 1)) {\n        return;\n      }\n\n      if (this.__lastSelected && !this.__corner) {\n        this.enterEditing(options.e);\n        if (this.selectionStart === this.selectionEnd) {\n          this.initDelayedCursor(true);\n        }\n        else {\n          this.renderCursorOrSelection();\n        }\n      }\n      this.selected = true;\n    });\n  },\n\n  /**\n   * Changes cursor location in a text depending on passed pointer (x/y) object\n   * @param {Event} e Event object\n   */\n  setCursorByClick: function(e) {\n    var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart, end = this.selectionEnd;\n    if (e.shiftKey) {\n      this.setSelectionStartEndWithShift(start, end, newSelection);\n    }\n    else {\n      this.selectionStart = newSelection;\n      this.selectionEnd = newSelection;\n    }\n    if (this.isEditing) {\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Returns index of a character corresponding to where an object was clicked\n   * @param {Event} e Event object\n   * @return {Number} Index of a character\n   */\n  getSelectionStartFromPointer: function(e) {\n    var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        newSelectionStart,\n        line;\n\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\n      line = this._textLines[i];\n      height += this._getHeightOfLine(this.ctx, i) * this.scaleY;\n\n      var widthOfLine = this._getLineWidth(this.ctx, i),\n          lineLeftOffset = this._getLineLeftOffset(widthOfLine);\n\n      width = lineLeftOffset * this.scaleX;\n\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n\n        prevWidth = width;\n\n        width += this._getWidthOfChar(this.ctx, line[j], i, this.flipX ? jlen - j : j) *\n                 this.scaleX;\n\n        if (height <= mouseOffset.y || width <= mouseOffset.x) {\n          charIndex++;\n          continue;\n        }\n\n        return this._getNewSelectionStartFromOffset(\n          mouseOffset, prevWidth, width, charIndex + i, jlen);\n      }\n\n      if (mouseOffset.y < height) {\n        //this happens just on end of lines.\n        return this._getNewSelectionStartFromOffset(\n          mouseOffset, prevWidth, width, charIndex + i - 1, jlen);\n      }\n    }\n\n    // clicked somewhere after all chars, so set at the end\n    if (typeof newSelectionStart === 'undefined') {\n      return this.text.length;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\n\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ? 0 : 1,\n        newSelectionStart = index + offset;\n\n    // if object is horizontally flipped, mirror cursor location from the end\n    if (this.flipX) {\n      newSelectionStart = jlen - newSelectionStart;\n    }\n\n    if (newSelectionStart > this.text.length) {\n      newSelectionStart = this.text.length;\n    }\n\n    return newSelectionStart;\n  }\n});\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n  /**\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\n   */\n  initHiddenTextarea: function() {\n    this.hiddenTextarea = fabric.document.createElement('textarea');\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\n    this.hiddenTextarea.setAttribute('autocorrect', 'off');\n    this.hiddenTextarea.setAttribute('autocomplete', 'off');\n    this.hiddenTextarea.setAttribute('spellcheck', 'false');\n    this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea', '');\n    this.hiddenTextarea.setAttribute('wrap', 'off');\n    var style = this._calcTextareaPosition();\n    this.hiddenTextarea.style.cssText = 'position: absolute; top: ' + style.top +\n    '; left: ' + style.left + '; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;' +\n    ' line-height: 1px; paddingｰtop: ' + style.fontSize + ';';\n    fabric.document.body.appendChild(this.hiddenTextarea);\n\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.cut.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\n\n    if (!this._clickHandlerInitialized && this.canvas) {\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\n      this._clickHandlerInitialized = true;\n    }\n  },\n\n  /**\n   * For functionalities on keyDown\n   * Map a special key to a function of the instance/prototype\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\n   * this map setting the name of a function that you build on the fabric.Itext or\n   * your prototype.\n   * the map change will affect all Instances unless you need for only some text Instances\n   * in that case you have to clone this object and assign your Instance.\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n   */\n  keysMap: {\n    8:  'removeChars',\n    9:  'exitEditing',\n    27: 'exitEditing',\n    13: 'insertNewline',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorRight',\n    36: 'moveCursorLeft',\n    37: 'moveCursorLeft',\n    38: 'moveCursorUp',\n    39: 'moveCursorRight',\n    40: 'moveCursorDown',\n    46: 'forwardDelete'\n  },\n\n  /**\n   * For functionalities on keyUp + ctrl || cmd\n   */\n  ctrlKeysMapUp: {\n    67: 'copy',\n    88: 'cut'\n  },\n\n  /**\n   * For functionalities on keyDown + ctrl || cmd\n   */\n  ctrlKeysMapDown: {\n    65: 'selectAll'\n  },\n\n  onClick: function() {\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n    this.hiddenTextarea && this.hiddenTextarea.focus();\n  },\n\n  /**\n   * Handles keyup event\n   * @param {Event} e Event object\n   */\n  onKeyDown: function(e) {\n    if (!this.isEditing) {\n      return;\n    }\n    if (e.keyCode in this.keysMap) {\n      this[this.keysMap[e.keyCode]](e);\n    }\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\n      // if i press an arrow key just update selection\n      this.clearContextTop();\n      this.renderCursorOrSelection();\n    }\n    else {\n      this.canvas && this.canvas.renderAll();\n    }\n  },\n\n  /**\n   * Handles keyup event\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n   * if a copy/cut event fired, keyup is dismissed\n   * @param {Event} e Event object\n   */\n  onKeyUp: function(e) {\n    if (!this.isEditing || this._copyDone) {\n      this._copyDone = false;\n      return;\n    }\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this.canvas && this.canvas.renderAll();\n  },\n\n  /**\n   * Handles onInput event\n   * @param {Event} e Event object\n   */\n  onInput: function(e) {\n    if (!this.isEditing || this.inCompositionMode) {\n      return;\n    }\n    var offset = this.selectionStart || 0,\n        offsetEnd = this.selectionEnd || 0,\n        textLength = this.text.length,\n        newTextLength = this.hiddenTextarea.value.length,\n        diff, charsToInsert, start;\n    if (newTextLength > textLength) {\n      //we added some character\n      start = this._selectionDirection === 'left' ? offsetEnd : offset;\n      diff = newTextLength - textLength;\n      charsToInsert = this.hiddenTextarea.value.slice(start, start + diff);\n    }\n    else {\n      //we selected a portion of text and then input something else.\n      //Internet explorer does not trigger this else\n      diff = newTextLength - textLength + offsetEnd - offset;\n      charsToInsert = this.hiddenTextarea.value.slice(offset, offset + diff);\n    }\n    this.insertChars(charsToInsert);\n    e.stopPropagation();\n  },\n\n  /**\n   * Composition start\n   */\n  onCompositionStart: function() {\n    this.inCompositionMode = true;\n    this.prevCompositionLength = 0;\n    this.compositionStart = this.selectionStart;\n  },\n\n  /**\n   * Composition end\n   */\n  onCompositionEnd: function() {\n    this.inCompositionMode = false;\n  },\n\n  /**\n   * Composition update\n   */\n  onCompositionUpdate: function(e) {\n    var data = e.data;\n    this.selectionStart = this.compositionStart;\n    this.selectionEnd = this.selectionEnd === this.selectionStart ?\n      this.compositionStart + this.prevCompositionLength : this.selectionEnd;\n    this.insertChars(data, false);\n    this.prevCompositionLength = data.length;\n  },\n\n  /**\n   * Forward delete\n   */\n  forwardDelete: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      if (this.selectionStart === this.text.length) {\n        return;\n      }\n      this.moveCursorRight(e);\n    }\n    this.removeChars(e);\n  },\n\n  /**\n   * Copies selected text\n   * @param {Event} e Event object\n   */\n  copy: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      //do not cut-copy if no selection\n      return;\n    }\n    var selectedText = this.getSelectedText(),\n        clipboardData = this._getClipboardData(e);\n\n    // Check for backward compatibility with old browsers\n    if (clipboardData) {\n      clipboardData.setData('text', selectedText);\n    }\n\n    fabric.copiedText = selectedText;\n    fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd);\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this._copyDone = true;\n  },\n\n  /**\n   * Pastes text\n   * @param {Event} e Event object\n   */\n  paste: function(e) {\n    var copiedText = null,\n        clipboardData = this._getClipboardData(e),\n        useCopiedStyle = true;\n\n    // Check for backward compatibility with old browsers\n    if (clipboardData) {\n      copiedText = clipboardData.getData('text').replace(/\\r/g, '');\n      if (!fabric.copiedTextStyle || fabric.copiedText !== copiedText) {\n        useCopiedStyle = false;\n      }\n    }\n    else {\n      copiedText = fabric.copiedText;\n    }\n\n    if (copiedText) {\n      this.insertChars(copiedText, useCopiedStyle);\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n  },\n\n  /**\n   * Cuts text\n   * @param {Event} e Event object\n   */\n  cut: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      return;\n    }\n\n    this.copy(e);\n    this.removeChars(e);\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   * @return {Object} Clipboard data object\n   */\n  _getClipboardData: function(e) {\n    return (e && e.clipboardData) || fabric.window.clipboardData;\n  },\n\n  /**\n   * Finds the width in pixels before the cursor on the same line\n   * @private\n   * @param {Number} lineIndex\n   * @param {Number} charIndex\n   * @return {Number} widthBeforeCursor width before cursor\n   */\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\n    var textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\n        widthOfLine = this._getLineWidth(this.ctx, lineIndex),\n        widthBeforeCursor = this._getLineLeftOffset(widthOfLine), _char;\n\n    for (var i = 0, len = textBeforeCursor.length; i < len; i++) {\n      _char = textBeforeCursor[i];\n      widthBeforeCursor += this._getWidthOfChar(this.ctx, _char, lineIndex, i);\n    }\n    return widthBeforeCursor;\n  },\n\n  /**\n   * Gets start offset of a selection\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getDownCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    // if on last line, down cursor goes to end of line\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\n      // move to the end of a text\n      return this.text.length - selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n\n    return textAfterCursor.length + indexOnOtherLine + 2;\n  },\n\n  /**\n   * private\n   * Helps finding if the offset should be counted from Start or End\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  _getSelectionForOffset: function(e, isRight) {\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n      return this.selectionEnd;\n    }\n    else {\n      return this.selectionStart;\n    }\n  },\n\n  /**\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getUpCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n      // if on first line, up cursor goes to start of line\n      return -selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex);\n    // return a negative offset\n    return -this._textLines[lineIndex - 1].length + indexOnOtherLine - textBeforeCursor.length;\n  },\n\n  /**\n   * find for a given width it founds the matching character.\n   * @private\n   */\n  _getIndexOnLine: function(lineIndex, width) {\n\n    var widthOfLine = this._getLineWidth(this.ctx, lineIndex),\n        textOnLine = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(widthOfLine),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0,\n        foundMatch;\n\n    for (var j = 0, jlen = textOnLine.length; j < jlen; j++) {\n\n      var _char = textOnLine[j],\n          widthOfChar = this._getWidthOfChar(this.ctx, _char, lineIndex, j);\n\n      widthOfCharsOnLine += widthOfChar;\n\n      if (widthOfCharsOnLine > width) {\n\n        foundMatch = true;\n\n        var leftEdge = widthOfCharsOnLine - widthOfChar,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\n\n        break;\n      }\n    }\n\n    // reached end\n    if (!foundMatch) {\n      indexOnLine = textOnLine.length - 1;\n    }\n\n    return indexOnLine;\n  },\n\n\n  /**\n   * Moves cursor down\n   * @param {Event} e Event object\n   */\n  moveCursorDown: function(e) {\n    if (this.selectionStart >= this.text.length && this.selectionEnd >= this.text.length) {\n      return;\n    }\n    this._moveCursorUpOrDown('Down', e);\n  },\n\n  /**\n   * Moves cursor up\n   * @param {Event} e Event object\n   */\n  moveCursorUp: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorUpOrDown('Up', e);\n  },\n\n  /**\n   * Moves cursor up or down, fires the events\n   * @param {String} direction 'Up' or 'Down'\n   * @param {Event} e Event object\n   */\n  _moveCursorUpOrDown: function(direction, e) {\n    // getUpCursorOffset\n    // getDownCursorOffset\n    var action = 'get' + direction + 'CursorOffset',\n        offset = this[action](e, this._selectionDirection === 'right');\n    if (e.shiftKey) {\n      this.moveCursorWithShift(offset);\n    }\n    else {\n      this.moveCursorWithoutShift(offset);\n    }\n    if (offset !== 0) {\n      this.setSelectionInBoundaries();\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor with shift\n   * @param {Number} offset\n   */\n  moveCursorWithShift: function(offset) {\n    var newSelection = this._selectionDirection === 'left'\n    ? this.selectionStart + offset\n    : this.selectionEnd + offset;\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor up without shift\n   * @param {Number} offset\n   */\n  moveCursorWithoutShift: function(offset) {\n    if (offset < 0) {\n      this.selectionStart += offset;\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionEnd += offset;\n      this.selectionStart = this.selectionEnd;\n    }\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor left\n   * @param {Event} e Event object\n   */\n  moveCursorLeft: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Left', e);\n  },\n\n  /**\n   * @private\n   * @return {Boolean} true if a change happened\n   */\n  _move: function(e, prop, direction) {\n    var newValue;\n    if (e.altKey) {\n      newValue = this['findWordBoundary' + direction](this[prop]);\n    }\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\n      newValue = this['findLineBoundary' + direction](this[prop]);\n    }\n    else {\n      this[prop] += direction === 'Left' ? -1 : 1;\n      return true;\n    }\n    if (typeof newValue !== undefined && this[prop] !== newValue) {\n      this[prop] = newValue;\n      return true;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _moveLeft: function(e, prop) {\n    return this._move(e, prop, 'Left');\n  },\n\n  /**\n   * @private\n   */\n  _moveRight: function(e, prop) {\n    return this._move(e, prop, 'Right');\n  },\n\n  /**\n   * Moves cursor left without keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithoutShift: function(e) {\n    var change = true;\n    this._selectionDirection = 'left';\n\n    // only move cursor when there is no selection,\n    // otherwise we discard it, and leave cursor on same place\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\n      change = this._moveLeft(e, 'selectionStart');\n\n    }\n    this.selectionEnd = this.selectionStart;\n    return change;\n  },\n\n  /**\n   * Moves cursor left while keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithShift: function(e) {\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\n      return this._moveLeft(e, 'selectionEnd');\n    }\n    else if (this.selectionStart !== 0){\n      this._selectionDirection = 'left';\n      return this._moveLeft(e, 'selectionStart');\n    }\n  },\n\n  /**\n   * Moves cursor right\n   * @param {Event} e Event object\n   */\n  moveCursorRight: function(e) {\n    if (this.selectionStart >= this.text.length && this.selectionEnd >= this.text.length) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Right', e);\n  },\n\n  /**\n   * Moves cursor right or Left, fires event\n   * @param {String} direction 'Left', 'Right'\n   * @param {Event} e Event object\n   */\n  _moveCursorLeftOrRight: function(direction, e) {\n    var actionName = 'moveCursor' + direction + 'With';\n    this._currentCursorOpacity = 1;\n\n    if (e.shiftKey) {\n      actionName += 'Shift';\n    }\n    else {\n      actionName += 'outShift';\n    }\n    if (this[actionName](e)) {\n      this.abortCursorAnimation();\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor right while keeping selection\n   * @param {Event} e\n   */\n  moveCursorRightWithShift: function(e) {\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\n      return this._moveRight(e, 'selectionStart');\n    }\n    else if (this.selectionEnd !== this.text.length) {\n      this._selectionDirection = 'right';\n      return this._moveRight(e, 'selectionEnd');\n    }\n  },\n\n  /**\n   * Moves cursor right without keeping selection\n   * @param {Event} e Event object\n   */\n  moveCursorRightWithoutShift: function(e) {\n    var changed = true;\n    this._selectionDirection = 'right';\n\n    if (this.selectionStart === this.selectionEnd) {\n      changed = this._moveRight(e, 'selectionStart');\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionStart = this.selectionEnd;\n    }\n    return changed;\n  },\n\n  /**\n   * Removes characters selected by selection\n   * @param {Event} e Event object\n   */\n  removeChars: function(e) {\n    if (this.selectionStart === this.selectionEnd) {\n      this._removeCharsNearCursor(e);\n    }\n    else {\n      this._removeCharsFromTo(this.selectionStart, this.selectionEnd);\n    }\n\n    this.set('dirty', true);\n    this.setSelectionEnd(this.selectionStart);\n\n    this._removeExtraneousStyles();\n\n    this.canvas && this.canvas.renderAll();\n\n    this.setCoords();\n    this.fire('changed');\n    this.canvas && this.canvas.fire('text:changed', { target: this });\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   */\n  _removeCharsNearCursor: function(e) {\n    if (this.selectionStart === 0) {\n      return;\n    }\n    if (e.metaKey) {\n      // remove all till the start of current line\n      var leftLineBoundary = this.findLineBoundaryLeft(this.selectionStart);\n\n      this._removeCharsFromTo(leftLineBoundary, this.selectionStart);\n      this.setSelectionStart(leftLineBoundary);\n    }\n    else if (e.altKey) {\n      // remove all till the start of current word\n      var leftWordBoundary = this.findWordBoundaryLeft(this.selectionStart);\n\n      this._removeCharsFromTo(leftWordBoundary, this.selectionStart);\n      this.setSelectionStart(leftWordBoundary);\n    }\n    else {\n      this._removeSingleCharAndStyle(this.selectionStart);\n      this.setSelectionStart(this.selectionStart - 1);\n    }\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  var toFixed = fabric.util.toFixed,\n      NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * @private\n     */\n    _setSVGTextLineText: function(lineIndex, textSpans, height, textLeftOffset, textTopOffset, textBgRects) {\n      if (!this._getLineStyle(lineIndex)) {\n        fabric.Text.prototype._setSVGTextLineText.call(this,\n          lineIndex, textSpans, height, textLeftOffset, textTopOffset);\n      }\n      else {\n        this._setSVGTextLineChars(\n          lineIndex, textSpans, height, textLeftOffset, textBgRects);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGTextLineChars: function(lineIndex, textSpans, height, textLeftOffset, textBgRects) {\n\n      var chars = this._textLines[lineIndex],\n          charOffset = 0,\n          lineLeftOffset = this._getLineLeftOffset(this._getLineWidth(this.ctx, lineIndex)) - this.width / 2,\n          lineOffset = this._getSVGLineTopOffset(lineIndex),\n          heightOfLine = this._getHeightOfLine(this.ctx, lineIndex);\n\n      for (var i = 0, len = chars.length; i < len; i++) {\n        var styleDecl = this._getStyleDeclaration(lineIndex, i) || { };\n\n        textSpans.push(\n          this._createTextCharSpan(\n            chars[i], styleDecl, lineLeftOffset, lineOffset.lineTop + lineOffset.offset, charOffset));\n\n        var charWidth = this._getWidthOfChar(this.ctx, chars[i], lineIndex, i);\n\n        if (styleDecl.textBackgroundColor) {\n          textBgRects.push(\n            this._createTextCharBg(\n              styleDecl, lineLeftOffset, lineOffset.lineTop, heightOfLine, charWidth, charOffset));\n        }\n\n        charOffset += charWidth;\n      }\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLineTopOffset: function(lineIndex) {\n      var lineTopOffset = 0, lastHeight = 0;\n      for (var j = 0; j < lineIndex; j++) {\n        lineTopOffset += this._getHeightOfLine(this.ctx, j);\n      }\n      lastHeight = this._getHeightOfLine(this.ctx, j);\n      return {\n        lineTop: lineTopOffset,\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\n      };\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharBg: function(styleDecl, lineLeftOffset, lineTopOffset, heightOfLine, charWidth, charOffset) {\n      return [\n        '\\t\\t<rect fill=\"', styleDecl.textBackgroundColor,\n        '\" x=\"', toFixed(lineLeftOffset + charOffset, NUM_FRACTION_DIGITS),\n        '\" y=\"', toFixed(lineTopOffset - this.height / 2, NUM_FRACTION_DIGITS),\n        '\" width=\"', toFixed(charWidth, NUM_FRACTION_DIGITS),\n        '\" height=\"', toFixed(heightOfLine / this.lineHeight, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n'\n      ].join('');\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharSpan: function(_char, styleDecl, lineLeftOffset, lineTopOffset, charOffset) {\n\n      var fillStyles = this.getSvgStyles.call(fabric.util.object.extend({\n        visible: true,\n        fill: this.fill,\n        stroke: this.stroke,\n        type: 'text',\n        getSvgFilter: fabric.Object.prototype.getSvgFilter\n      }, styleDecl));\n\n      return [\n        '\\t\\t\\t<tspan x=\"', toFixed(lineLeftOffset + charOffset, NUM_FRACTION_DIGITS), '\" y=\"',\n        toFixed(lineTopOffset - this.height / 2, NUM_FRACTION_DIGITS), '\" ',\n          (styleDecl.fontFamily ? 'font-family=\"' + styleDecl.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n          (styleDecl.fontSize ? 'font-size=\"' + styleDecl.fontSize + '\" ' : ''),\n          (styleDecl.fontStyle ? 'font-style=\"' + styleDecl.fontStyle + '\" ' : ''),\n          (styleDecl.fontWeight ? 'font-weight=\"' + styleDecl.fontWeight + '\" ' : ''),\n          (styleDecl.textDecoration ? 'text-decoration=\"' + styleDecl.textDecoration + '\" ' : ''),\n        'style=\"', fillStyles, '\">',\n        fabric.util.string.escapeXml(_char),\n        '</tspan>\\n'\n      ].join('');\n    },\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'textbox',\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingY: true,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Constructor. Some scaling related property values are forced. Visibility\n     * of controls is also fixed; only the rotation and width controls are\n     * made available.\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Textbox} thisArg\n     */\n    initialize: function(text, options) {\n\n      this.callSuper('initialize', text, options);\n      this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());\n      this.ctx = this.objectCaching ? this._cacheContext : fabric.util.createCanvasElement().getContext('2d');\n      // add width to this list of props that effect line wrapping.\n      this._dimensionAffectingProps.push('width');\n    },\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @param {CanvasRenderingContext2D} ctx Context to use for measurements\n     * @private\n     * @override\n     */\n    _initDimensions: function(ctx) {\n      if (this.__skipDimension) {\n        return;\n      }\n\n      if (!ctx) {\n        ctx = fabric.util.createCanvasElement().getContext('2d');\n        this._setTextStyles(ctx);\n        this.clearContextTop();\n      }\n\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n\n      // wrap lines\n      this._textLines = this._splitTextIntoLines(ctx);\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set('width', this.dynamicMinWidth);\n      }\n\n      // clear cache and re-calculate height\n      this._clearCache();\n      this.height = this._getTextHeight(ctx);\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function() {\n      var realLineCount     = 0,\n          realLineCharCount = 0,\n          charCount         = 0,\n          map               = {};\n\n      for (var i = 0; i < this._textLines.length; i++) {\n        if (this.text[charCount] === '\\n' && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        }\n        else if (this.text[charCount] === ' ' && i > 0) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += this._textLines[i].length;\n        realLineCharCount += this._textLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Boolean} [returnCloneOrEmpty=false]\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex, returnCloneOrEmpty) {\n      if (this._styleMap) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return returnCloneOrEmpty ? { } : null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex, returnCloneOrEmpty);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return this.styles[map.line];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex, style) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      delete this.styles[map.line];\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {CanvasRenderingContext2D} ctx Context to use for measurements\n     * @param {String} text The string of text that is split into lines\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function(ctx, text) {\n      var lines = text.split(this._reNewline), wrapped = [], i;\n\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(ctx, lines[i], i));\n      }\n\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     *\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureText: function(ctx, text, lineIndex, charOffset) {\n      var width = 0;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = text.length; i < len; i++) {\n        width += this._getWidthOfChar(ctx, text[i], lineIndex, i + charOffset);\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {CanvasRenderingContext2D} ctx Context to use for measurements\n     * @param {String} text The string of text to split into lines\n     * @param {Number} lineIndex\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function(ctx, text, lineIndex) {\n      var lineWidth        = 0,\n          lines            = [],\n          line             = '',\n          words            = text.split(' '),\n          word             = '',\n          offset           = 0,\n          infix            = ' ',\n          wordWidth        = 0,\n          infixWidth       = 0,\n          largestWordWidth = 0,\n          lineJustStarted = true,\n          additionalSpace = this._getWidthOfCharSpacing();\n\n      for (var i = 0; i < words.length; i++) {\n        word = words[i];\n        wordWidth = this._measureText(ctx, word, lineIndex, offset);\n\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n\n        if (lineWidth >= this.width && !lineJustStarted) {\n          lines.push(line);\n          line = '';\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        }\n        else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted) {\n          line += infix;\n        }\n        line += word;\n\n        infixWidth = this._measureText(ctx, infix, lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && lines.push(line);\n\n      if (largestWordWidth > this.dynamicMinWidth) {\n        this.dynamicMinWidth = largestWordWidth - additionalSpace;\n      }\n\n      return lines;\n    },\n    /**\n     * Gets lines of text to render in the Textbox. This function calculates\n     * text wrapping on the fly everytime it is called.\n     * @returns {Array} Array of lines in the Textbox.\n     * @override\n     */\n    _splitTextIntoLines: function(ctx) {\n      ctx = ctx || this.ctx;\n      var originalAlign = this.textAlign;\n      this._styleMap = null;\n      ctx.save();\n      this._setTextStyles(ctx);\n      this.textAlign = 'left';\n      var lines = this._wrapText(ctx, this.text);\n      this.textAlign = originalAlign;\n      ctx.restore();\n      this._textLines = lines;\n      this._styleMap = this._generateStyleMap();\n      return lines;\n    },\n\n    /**\n     * When part of a group, we don't want the Textbox's scale to increase if\n     * the group's increases. That's why we reduce the scale of the Textbox by\n     * the amount that the group's increases. This is to maintain the effective\n     * scale of the Textbox at 1, so that font-size values make sense. Otherwise\n     * the same font-size value would result in different actual size depending\n     * on the value of the scale.\n     * @param {String} key\n     * @param {*} value\n     */\n    setOnGroup: function(key, value) {\n      if (key === 'scaleX') {\n        this.set('scaleX', Math.abs(1 / value));\n        this.set('width', (this.get('width') * value) /\n          (typeof this.__oldScaleX === 'undefined' ? 1 : this.__oldScaleX));\n        this.__oldScaleX = value;\n      }\n    },\n\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start).\n     * Overrides the superclass function to take into account text wrapping.\n     *\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     */\n    get2DCursorLocation: function(selectionStart) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n\n      var numLines = this._textLines.length,\n          removed  = 0;\n\n      for (var i = 0; i < numLines; i++) {\n        var line    = this._textLines[i],\n            lineLen = line.length;\n\n        if (selectionStart <= removed + lineLen) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart - removed\n          };\n        }\n\n        removed += lineLen;\n\n        if (this.text[removed] === '\\n' || this.text[removed] === ' ') {\n          removed++;\n        }\n      }\n\n      return {\n        lineIndex: numLines - 1,\n        charIndex: this._textLines[numLines - 1].length\n      };\n    },\n\n    /**\n     * Overrides superclass function and uses text wrapping data to get cursor\n     * boundary offsets instead of the array of chars.\n     * @param {Array} chars Unused\n     * @param {String} typeOfBoundaries Can be 'cursor' or 'selection'\n     * @returns {Object} Object with 'top', 'left', and 'lineLeft' properties set.\n     */\n    _getCursorBoundariesOffsets: function(chars, typeOfBoundaries) {\n      var topOffset      = 0,\n          leftOffset     = 0,\n          cursorLocation = this.get2DCursorLocation(),\n          lineChars      = this._textLines[cursorLocation.lineIndex].split(''),\n          lineLeftOffset = this._getLineLeftOffset(this._getLineWidth(this.ctx, cursorLocation.lineIndex));\n\n      for (var i = 0; i < cursorLocation.charIndex; i++) {\n        leftOffset += this._getWidthOfChar(this.ctx, lineChars[i], cursorLocation.lineIndex, i);\n      }\n\n      for (i = 0; i < cursorLocation.lineIndex; i++) {\n        topOffset += this._getHeightOfLine(this.ctx, i);\n      }\n\n      if (typeOfBoundaries === 'cursor') {\n        topOffset += (1 - this._fontSizeFraction) * this._getHeightOfLine(this.ctx, cursorLocation.lineIndex)\n          / this.lineHeight - this.getCurrentCharFontSize(cursorLocation.lineIndex, cursorLocation.charIndex)\n          * (1 - this._fontSizeFraction);\n      }\n\n      return {\n        top: topOffset,\n        left: leftOffset,\n        lineLeft: lineLeftOffset\n      };\n    },\n\n    getMinWidth: function() {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['minWidth'].concat(propertiesToInclude));\n    }\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   * @param {Boolean} [forceAsync] Force an async behaviour trying to create pattern first\n   * @return {fabric.Textbox} instance of fabric.Textbox\n   */\n  fabric.Textbox.fromObject = function(object, callback, forceAsync) {\n    return fabric.Object._fromObject('Textbox', object, callback, forceAsync, 'text');\n  };\n\n  /**\n   * Returns the default controls visibility required for Textboxes.\n   * @returns {Object}\n   */\n  fabric.Textbox.getTextboxControlVisibility = function() {\n    return {\n      tl: false,\n      tr: false,\n      br: false,\n      bl: false,\n      ml: true,\n      mt: false,\n      mr: true,\n      mb: false,\n      mtr: true\n    };\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /**\n   * Override _setObjectScale and add Textbox specific resizing behavior. Resizing\n   * a Textbox doesn't scale text, it only changes width and makes text wrap automatically.\n   */\n  var setObjectScaleOverridden = fabric.Canvas.prototype._setObjectScale;\n\n  fabric.Canvas.prototype._setObjectScale = function(localMouse, transform,\n                                                     lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {\n\n    var t = transform.target;\n    if (t instanceof fabric.Textbox) {\n      var w = t.width * ((localMouse.x / transform.scaleX) / (t.width + t.strokeWidth));\n      if (w >= t.getMinWidth()) {\n        t.set('width', w);\n        return true;\n      }\n    }\n    else {\n      return setObjectScaleOverridden.call(fabric.Canvas.prototype, localMouse, transform,\n        lockScalingX, lockScalingY, by, lockScalingFlip, _dim);\n    }\n  };\n\n  /**\n   * Sets controls of this group to the Textbox's special configuration if\n   * one is present in the group. Deletes _controlsVisibility otherwise, so that\n   * it gets initialized to default value at runtime.\n   */\n  fabric.Group.prototype._refreshControlsVisibility = function() {\n    if (typeof fabric.Textbox === 'undefined') {\n      return;\n    }\n    for (var i = this._objects.length; i--;) {\n      if (this._objects[i] instanceof fabric.Textbox) {\n        this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());\n        return;\n      }\n    }\n  };\n\n  fabric.util.object.extend(fabric.Textbox.prototype, /** @lends fabric.IText.prototype */ {\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this._styleMap) {\n        if (!this._textLines[prop]) {\n          delete this.styles[this._styleMap[prop].line];\n        }\n      }\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Object} [style] Style object to insert, if given\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, style) {\n      // adjust lineIndex and charIndex\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      fabric.IText.prototype.insertCharStyleObject.apply(this, [lineIndex, charIndex, style]);\n    },\n\n    /**\n     * Inserts new style object\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Boolean} isEndOfLine True if it's end of line\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, isEndOfLine) {\n      // adjust lineIndex and charIndex\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      fabric.IText.prototype.insertNewlineStyleObject.apply(this, [lineIndex, charIndex, isEndOfLine]);\n    },\n\n    /**\n     * Shifts line styles up or down. This function is slightly different than the one in\n     * itext_behaviour as it takes into account the styleMap.\n     *\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can be -1 or +1\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by 1 upward\n      var map = this._styleMap[lineIndex];\n      // adjust line index\n      lineIndex = map.line;\n      fabric.IText.prototype.shiftLineStyles.call(this, lineIndex, offset);\n    },\n\n    /**\n     * Figure out programatically the text on previous actual line (actual = separated by \\n);\n     *\n     * @param {Number} lIndex\n     * @returns {String}\n     * @private\n     */\n    _getTextOnPreviousLine: function(lIndex) {\n      var textOnPreviousLine = this._textLines[lIndex - 1];\n\n      while (this._styleMap[lIndex - 2] && this._styleMap[lIndex - 2].line === this._styleMap[lIndex - 1].line) {\n        textOnPreviousLine = this._textLines[lIndex - 2] + textOnPreviousLine;\n\n        lIndex--;\n      }\n\n      return textOnPreviousLine;\n    },\n\n    /**\n     * Removes style object\n     * @param {Boolean} isBeginningOfLine True if cursor is at the beginning of line\n     * @param {Number} [index] Optional index. When not given, current selectionStart is used.\n     */\n    removeStyleObject: function(isBeginningOfLine, index) {\n\n      var cursorLocation = this.get2DCursorLocation(index),\n          map            = this._styleMap[cursorLocation.lineIndex],\n          lineIndex      = map.line,\n          charIndex      = map.offset + cursorLocation.charIndex;\n      this._removeStyleObject(isBeginningOfLine, cursorLocation, lineIndex, charIndex);\n    }\n  });\n})();\n\n\n(function() {\n  var override = fabric.IText.prototype._getNewSelectionStartFromOffset;\n  /**\n   * Overrides the IText implementation and adjusts character index as there is not always a linebreak\n   *\n   * @param {Number} mouseOffset\n   * @param {Number} prevWidth\n   * @param {Number} width\n   * @param {Number} index\n   * @param {Number} jlen\n   * @returns {Number}\n   */\n  fabric.IText.prototype._getNewSelectionStartFromOffset = function(mouseOffset, prevWidth, width, index, jlen) {\n    index = override.call(this, mouseOffset, prevWidth, width, index, jlen);\n\n    // the index passed into the function is padded by the amount of lines from _textLines (to account for \\n)\n    // we need to remove this padding, and pad it by actual lines, and / or spaces that are meant to be there\n    var tmp     = 0,\n        removed = 0;\n\n    // account for removed characters\n    for (var i = 0; i < this._textLines.length; i++) {\n      tmp += this._textLines[i].length;\n\n      if (tmp + removed >= index) {\n        break;\n      }\n\n      if (this.text[tmp + removed] === '\\n' || this.text[tmp + removed] === ' ') {\n        removed++;\n      }\n    }\n\n    return index - i + removed;\n  };\n})();\n\n\n(function() {\n\n  if (typeof document !== 'undefined' && typeof window !== 'undefined') {\n    return;\n  }\n\n  var DOMParser = require('xmldom').DOMParser,\n      URL = require('url'),\n      HTTP = require('http'),\n      HTTPS = require('https'),\n\n      Canvas = require('canvas'),\n      Image = require('canvas').Image;\n\n  /** @private */\n  function request(url, encoding, callback) {\n    var oURL = URL.parse(url);\n\n    // detect if http or https is used\n    if ( !oURL.port ) {\n      oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;\n    }\n\n    // assign request handler based on protocol\n    var reqHandler = (oURL.protocol.indexOf('https:') === 0 ) ? HTTPS : HTTP,\n        req = reqHandler.request({\n          hostname: oURL.hostname,\n          port: oURL.port,\n          path: oURL.path,\n          method: 'GET'\n        }, function(response) {\n          var body = '';\n          if (encoding) {\n            response.setEncoding(encoding);\n          }\n          response.on('end', function () {\n            callback(body);\n          });\n          response.on('data', function (chunk) {\n            if (response.statusCode === 200) {\n              body += chunk;\n            }\n          });\n        });\n\n    req.on('error', function(err) {\n      if (err.errno === process.ECONNREFUSED) {\n        fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);\n      }\n      else {\n        fabric.log(err.message);\n      }\n      callback(null);\n    });\n\n    req.end();\n  }\n\n  /** @private */\n  function requestFs(path, callback) {\n    var fs = require('fs');\n    fs.readFile(path, function (err, data) {\n      if (err) {\n        fabric.log(err);\n        throw err;\n      }\n      else {\n        callback(data);\n      }\n    });\n  }\n\n  fabric.util.loadImage = function(url, callback, context) {\n    function createImageAndCallBack(data) {\n      if (data) {\n        img.src = new Buffer(data, 'binary');\n        // preserving original url, which seems to be lost in node-canvas\n        img._src = url;\n        callback && callback.call(context, img);\n      }\n      else {\n        img = null;\n        callback && callback.call(context, null, true);\n      }\n    }\n    var img = new Image();\n    if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {\n      img.src = img._src = url;\n      callback && callback.call(context, img);\n    }\n    else if (url && url.indexOf('http') !== 0) {\n      requestFs(url, createImageAndCallBack);\n    }\n    else if (url) {\n      request(url, 'binary', createImageAndCallBack);\n    }\n    else {\n      callback && callback.call(context, url);\n    }\n  };\n\n  fabric.loadSVGFromURL = function(url, callback, reviver) {\n    url = url.replace(/^\\n\\s*/, '').replace(/\\?.*$/, '').trim();\n    if (url.indexOf('http') !== 0) {\n      requestFs(url, function(body) {\n        fabric.loadSVGFromString(body.toString(), callback, reviver);\n      });\n    }\n    else {\n      request(url, '', function(body) {\n        fabric.loadSVGFromString(body, callback, reviver);\n      });\n    }\n  };\n\n  fabric.loadSVGFromString = function(string, callback, reviver) {\n    var doc = new DOMParser().parseFromString(string);\n    fabric.parseSVGDocument(doc.documentElement, function(results, options) {\n      callback && callback(results, options);\n    }, reviver);\n  };\n\n  fabric.util.getScript = function(url, callback) {\n    request(url, '', function(body) {\n      // eslint-disable-next-line no-eval\n      eval(body);\n      callback && callback();\n    });\n  };\n\n  // fabric.util.createCanvasElement = function(_, width, height) {\n  //   return new Canvas(width, height);\n  // }\n\n  /**\n   * Only available when running fabric on node.js\n   * @param {Number} width Canvas width\n   * @param {Number} height Canvas height\n   * @param {Object} [options] Options to pass to FabricCanvas.\n   * @param {Object} [nodeCanvasOptions] Options to pass to NodeCanvas.\n   * @return {Object} wrapped canvas instance\n   */\n  fabric.createCanvasForNode = function(width, height, options, nodeCanvasOptions) {\n    nodeCanvasOptions = nodeCanvasOptions || options;\n\n    var canvasEl = fabric.document.createElement('canvas'),\n        nodeCanvas = new Canvas(width || 600, height || 600, nodeCanvasOptions),\n        nodeCacheCanvas = new Canvas(width || 600, height || 600, nodeCanvasOptions);\n\n    // jsdom doesn't create style on canvas element, so here be temp. workaround\n    canvasEl.style = { };\n\n    canvasEl.width = nodeCanvas.width;\n    canvasEl.height = nodeCanvas.height;\n    options = options || { };\n    options.nodeCanvas = nodeCanvas;\n    options.nodeCacheCanvas = nodeCacheCanvas;\n    var FabricCanvas = fabric.Canvas || fabric.StaticCanvas,\n        fabricCanvas = new FabricCanvas(canvasEl, options);\n    fabricCanvas.nodeCanvas = nodeCanvas;\n    fabricCanvas.nodeCacheCanvas = nodeCacheCanvas;\n    fabricCanvas.contextContainer = nodeCanvas.getContext('2d');\n    fabricCanvas.contextCache = nodeCacheCanvas.getContext('2d');\n    fabricCanvas.Font = Canvas.Font;\n    return fabricCanvas;\n  };\n\n  var originaInitStatic = fabric.StaticCanvas.prototype._initStatic;\n  fabric.StaticCanvas.prototype._initStatic = function(el, options) {\n    el = el || fabric.document.createElement('canvas');\n    this.nodeCanvas = new Canvas(el.width, el.height);\n    this.nodeCacheCanvas = new Canvas(el.width, el.height);\n    originaInitStatic.call(this, el, options);\n    this.contextContainer = this.nodeCanvas.getContext('2d');\n    this.contextCache = this.nodeCacheCanvas.getContext('2d');\n    this.Font = Canvas.Font;\n  };\n\n  /** @ignore */\n  fabric.StaticCanvas.prototype.createPNGStream = function() {\n    return this.nodeCanvas.createPNGStream();\n  };\n\n  fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\n    return this.nodeCanvas.createJPEGStream(opts);\n  };\n\n  fabric.StaticCanvas.prototype._initRetinaScaling = function() {\n    if (!this._isRetinaScaling()) {\n      return;\n    }\n\n    this.lowerCanvasEl.setAttribute('width', this.width * fabric.devicePixelRatio);\n    this.lowerCanvasEl.setAttribute('height', this.height * fabric.devicePixelRatio);\n    this.nodeCanvas.width = this.width * fabric.devicePixelRatio;\n    this.nodeCanvas.height = this.height * fabric.devicePixelRatio;\n    this.contextContainer.scale(fabric.devicePixelRatio, fabric.devicePixelRatio);\n    return this;\n  };\n  if (fabric.Canvas) {\n    fabric.Canvas.prototype._initRetinaScaling = fabric.StaticCanvas.prototype._initRetinaScaling;\n  }\n\n  var origSetBackstoreDimension = fabric.StaticCanvas.prototype._setBackstoreDimension;\n  fabric.StaticCanvas.prototype._setBackstoreDimension = function(prop, value) {\n    origSetBackstoreDimension.call(this, prop, value);\n    this.nodeCanvas[prop] = value;\n    return this;\n  };\n  if (fabric.Canvas) {\n    fabric.Canvas.prototype._setBackstoreDimension = fabric.StaticCanvas.prototype._setBackstoreDimension;\n  }\n\n})();\n\n"]}