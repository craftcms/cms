{% extends '_layouts/cp' %}
{% set selectedTab = 'entryTypes' %}

{% do view.registerAssetBundle('craft\\web\\assets\\admintable\\AdminTableAsset') -%}

{% do view.registerTranslations('app', [
    'Are you sure you want to delete “{name}” and all entries of that type?',
    'Handle',
    'Name',
    'No entry types exist yet.',
    'Used by',
]) %}

{% set title = 'Entry Types'|t('app') %}

{% set crumbs = [
    {
        label: 'Settings'|t('app'),
        url: url('settings'),
    },
] %}

{% block actionButton %}
    <a href="{{ url('settings/entry-types/new') }}" class="btn submit add icon">{{ "New entry type"|t('app') }}</a>
{% endblock %}

{% block content %}
    <div id="entrytypes-vue-admin-table"></div>
{% endblock %}

{% set tableData = entryTypes|map(entryType => {
    id: entryType.id,
    title: entryType.name|t('site'),
    url: entryType.getCpEditUrl(),
    name: entryType.name|t('site')|e,
    handle: entryType.handle,
    usages: tag('ul', {
        html: (entryTypeUsages[entryType.id] ?? [])|map(usage => tag('li', {
            html: tag('a', {
                text: usage[1],
                href: usage[2],
                class: 'iconlink',
                data: {
                    icon: usage[0],
                }
            }),
        }))|join(''),
    }),
}) %}

{% js %}
var columns = [
    { name: '__slot:title', title: Craft.t('app', 'Name') },
    { name: '__slot:handle', title: Craft.t('app', 'Handle') },
    { name: 'usages', title: Craft.t('app', 'Used by') },
];

new Craft.VueAdminTable({
    columns: columns,
    container: '#entrytypes-vue-admin-table',
    deleteAction: 'entry-types/delete',
    deleteConfirmationMessage: Craft.t('app', 'Are you sure you want to delete “{name}” and all entries of that type?'),
    emptyMessage: Craft.t('app', 'No entry types exist yet.'),
    tableData: {{ tableData|json_encode|raw }},
});
{% endjs %}
