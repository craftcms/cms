{%- set static = (static is defined ? static : false) %}
{%- set staticRows = static ? true : (staticRows is defined ? staticRows : false) %}
{%- set cols = (cols is defined ? cols : []) %}
{%- set rows = (rows is defined ? rows : []) -%}

<table id="{{ id }}" class="shadow-box editable"
        {%- if block('attr') is defined %} {{ block('attr') }}{% endif %}>
    <thead>
        <tr>
            {% for col in cols %}
                <th scope="col" class="header {{ col.class ?? null }}">
                    {%- if col.heading is defined and col.heading %}{{ col.heading }}{% else %}&nbsp;{% endif %}
                    {%- if col.info is defined -%}
                        <span class="info">{{ col.info|md|raw }}</span>
                    {%- endif -%}
                </th>
            {% endfor %}
            {% if not staticRows %}
                <th class="header" colspan="2"></th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for rowId, row in rows %}
            <tr data-id="{{ rowId }}">
                {% for colId, col in cols %}
                    {% set cell = row[colId] ?? null %}
                    {% set value = cell.value is defined ? cell.value : cell %}
                    {% if col.type == 'heading' %}
                        <th scope="row" class="{{ cell.class ?? col.class ?? '' }}">{{ value|raw }}</th>
                    {% else %}
                        {% set hasErrors = cell.hasErrors ?? false %}
                        {% set cellName = name~'['~rowId~']['~colId~']' %}
                        {% set textual = (col.type in ['singleline','multiline','number']) %}
                        <td class="{% if textual %}textual{% endif %} {% if col.class is defined %}{{ col.class }}{% endif %} {% if col.code is defined %}code{% endif %} {% if hasErrors %}error{% endif %}"{% if col.width is defined %} width="{{ col.width }}"{% endif %}>
                            {%- switch col.type -%}
                                {% case 'select' -%}
                                    {% include "_includes/forms/select" with {
                                        class:    'small',
                                        name:     cellName,
                                        options:  cell.options ?? col.options,
                                        value:    value,
                                        disabled: static
                                    } only %}
                                {%- case 'checkbox' -%}
                                    {% include "_includes/forms/checkbox" with {
                                        name: cellName,
                                        value:  col.value ?? 1,
                                        checked: value is not empty,
                                        disabled: static
                                    } only %}
                                {%- case 'lightswitch' -%}
                                    {% include "_includes/forms/lightswitch" with {
                                        name: cellName,
                                        on: value,
                                        value: col.value ?? 1,
                                        small: true,
                                        disabled: static
                                    } only %}
                                {%- default -%}
                                    <textarea name="{{ cellName }}" rows="1"{% if static %} disabled{% endif %}{% if col.placeholder is defined %} placeholder="{{ col.placeholder }}"{% endif %}>{{ value }}</textarea>
                            {%- endswitch -%}
                        </td>
                    {% endif %}
                {% endfor %}
                {% if not staticRows %}
                    <td class="thin action"><a class="move icon" title="{{ 'Reorder'|t('app') }}"></a></td>
                    <td class="thin action"><a class="delete icon" title="{{ 'Delete'|t('app') }}"></a></td>
                {% endif %}
            </tr>
        {% endfor %}
    </tbody>
</table>
{% if not staticRows %}
    <div class="btn add icon">{{ addRowLabel is defined ? addRowLabel : "Add a row"|t('app') }}</div>
{% endif %}

{% if not static and (initJs is not defined or initJs) %}
    {% js %}
        new Craft.EditableTable(
            "{{ id   | namespaceInputId   | e('js') }}",
            "{{ name | namespaceInputName | e('js') }}",
            {{ cols|json_encode|raw }});
    {% endjs %}
{% endif %}
