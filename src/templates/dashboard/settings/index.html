{% extends "_layouts/cp" %}
{% set title = "Dashboard Settings"|t('app') %}

{% set crumbs = [
	{ label: "Dashboard"|t('app'), url: url('dashboard') }
] %}


{% set widgets = craft.dashboard.getAllWidgets() %}
{% set sortable  = (widgets|length > 1) %}


{% set content %}
	<h2>{{ "My Widgets"|t('app') }}</h2>

	<p id="nowidgets"{% if widgets|length %} class="hidden"{% endif %}>
		{{ "You donâ€™t have any widgets yet."|t('app') }}
	</p>

	{% if widgets|length %}
		<table id="widgets" class="data fullwidth collapsible">
			<tbody>
				{% for widget in widgets %}
					{% if widget.getType() != 'craft\\app\\widgets\\GetHelp' or currentUser.admin %}
						{% set widgetTitle = widget.getTitle() %}
						{% set widgetTypeInfo = craft.dashboard.getWidgetTypeInfo(widget) %}

						<tr data-id="{{ widget.id }}" data-name="{{ widgetTitle }}">
							<th scope="row" data-title="{{ 'Name'|t('app') }}">
								<a href="{{ url('dashboard/settings/' ~ widget.id) }}">{{ widgetTitle }}</a>
								{% if not widgetTypeInfo.getIsInvalid() %}
									{% if widgetTypeInfo.getDisplayName() != widgetTitle %}<span class="light">({{ widgetTypeInfo.getDisplayName() }})</span>{% endif %}
								{% else %}
									<span class="light error">({{ widget.type }})</span>
								{% endif %}
							</th>
							{% if sortable %}<td class="thin"><a class="move icon" title="{{ 'Reorder'|t('app') }}" role="button"></a></td>{% endif %}
							<td class="thin"><a class="delete icon" title="{{ 'Delete'|t('app') }}" role="button"></a></td>
						</tr>
					{% endif %}
				{% endfor %}
			</tbody>
		</table>
	{% endif %}

	<div class="buttons">
		<a href="{{ url('dashboard/settings/new') }}" class="btn submit add icon">{{ "New Widget"|t('app') }}</a>
	</div>
{% endset %}


{% registerjs %}
	new Craft.AdminTable({
		tableSelector: '#widgets',
		noItemsSelector: '#nowidgets',
		sortable: true,
		reorderAction: 'dashboard/reorder-widgets',
		deleteAction: 'dashboard/delete-widget'
	});
{% endregisterjs %}
