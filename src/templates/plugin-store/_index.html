{% extends "_layouts/cp" %}

{% set title = 'Plugin Store'|t('app') %}

{% do view.registerTranslations('app', [
	"Active installs",
	"Active Trials",
	"Add to cart",
	"Ascending",
	"Buy later",
	"Buy {price}",
	"Cart",
	"Categories",
	"Changelog",
	"Compatibility",
	"Contact",
	"Description",
	"Descending",
	"Documentation",
	"Install",
	"Installed",
	"Items in your cart",
	"Last update",
	"Last Update",
	"License",
	"Loading Plugin Storeâ€¦",
	"Name",
	"Page not found.",
	"Plugin Name",
	"Plugin Store",
	"Popularity",
	"Price",
	"Pro Rate Discount",
	"Process My Order",
	"Screenshots",
	"Search plugins",
	"See all",
	"Staff Picks",
	"Subtotal",
	"The Plugin Store is not available, please try again later.",
	"Total",
	"Try",
	"Version",
	"Website",
]) %}

{% block actionButton %}

	{% if enableCraftId %}
		<div id="pluginstore-actions-spinner" class="spinner hidden"></div>

		<div id="pluginstore-actions" class="hidden">

			<a id="cart-button" role="button" tabindex="0">{{ svg('@app/icons/shopping-cart.svg') }} <span class="badge">0</span></a>

			<a id="craftid-account" class="menubtn hidden"><span class="photo">{{ svg('@app/icons/craftid.svg') }}</span><span class="label">Account</span></a>

			<div class="menu">
				<ul>
					<li><a href="{{ craft.cp.craftIdAccountUrl() }}" target="_blank">{{ "Manage your Craft ID"|t('app') }}</a></li>
					<li>
						<form method="post" id="disconnect">
							{{ csrfInput() }}
							<input type="hidden" name="action" value="plugin-store/disconnect">
							<a onclick="document.getElementById('disconnect').submit();">{{ "Sign out from Craft ID"|t('app') }}</a>
						</form>
					</li>
				</ul>
			</div>

			<form id="craftid-connect-form" method="post">
				{{ csrfInput() }}
				<input type="hidden" name="action" value="plugin-store/connect">
				<div class="ssl-status light" title="{{ craft.app.request.isSecureConnection ? "Your connection is secure"|t('app') : "Your connection is insecure"|t('app') }}">
					<i class="{{ craft.app.request.isSecureConnection ? "secure" : "insecure" }} icon"></i>
				</div>
				<a onclick="document.getElementById('craftid-connect-form').submit();">{{ 'Sign into Craft ID'|t('app') }}</a>
			</form>

			{#
			<a id="payment-button">Payment</a>
			#}
		</div>
	{% endif %}

{% endblock %}

{% set content %}

	<template v-if="pluginStoreDataLoaded && !pluginStoreDataError">
		<router-view></router-view>
	</template>

	<template v-else>
		<div id="graphic" class="spinner big" :class="{ error: pluginStoreDataError }"></div>
		<div id="status">{{ '{{ statusMessage }}' }}</div>
	</template>

	<global-modal :show.sync="showModal" :plugin-id="pluginId"></global-modal>

{% endset %}
