{% import "_includes/forms" as forms %}

{% macro numberField(config, decimals) %}
    {% from '_includes/forms' import textField %}
    {# Only format the value if it isnâ€™t going to be misrepresented #}
    {% if not craft.app.formatter.willBeMisrepresented(config.value) %}
        {{ hiddenInput("#{config.name}[locale]", craft.app.formattingLocale.id) }}
        {% set config = config|merge({
            name: "#{config.name}[value]",
            value: config.value|number(decimals),
        }) %}
    {% endif %}
    {{ textField(config) }}
{% endmacro %}

{% set currencyInput %}
    {{ forms.select({
        id: 'currency',
        name: 'currency',
        options: currencies|map(currency => {label: currency.getCode(), value: currency.getCode()}),
        value: field.currency,
        class: 'selectize',
    }) }}
{% endset %}

{{ forms.field({
    label: 'Currency'|t('app'),
    errors: field.getErrors('currency'),
    required: true,
}, currencyInput) }}

{{ _self.numberField({
    label: 'Default Value'|t('app'),
    id: 'defaultValue',
    name: 'defaultValue',
    value: field.defaultValue,
    size: 5,
    errors: field.getErrors('defaultValue')
}, subUnits) }}

{{ _self.numberField({
    label: 'Min Value'|t('app'),
    id: 'min',
    name: 'min',
    value: field.min,
    size: 5,
    errors: field.getErrors('min')
}, subUnits) }}

{{ _self.numberField({
    label: 'Max Value'|t('app'),
    id: 'max',
    name: 'max',
    value: field.max,
    size: 5,
    errors: field.getErrors('max')
}, subUnits) }}

{{ forms.textField({
    label: 'Size'|t('app'),
    id: 'size',
    name: 'size',
    value: field.size,
    size: 2,
    errors: field.getErrors('size')
}) }}

{% js %}
(() => {
    const $defaultCurrency = $('#{{ 'currency'|namespaceInputId|e('js') }}').selectize({
        dropdownParent: 'body',
    });
})();
{% endjs %}