{% set entryType = entry.getType() %}
{% set entryTypeName = entryType.name|t('site') %}
{% set baseInputName = "#{name}[entries][uid:#{entry.uid}]" %}
{% set static = static ?? false %}
{% set staticEntries = staticEntries ?? false %}
{% set entryAttributes = {
  class: [
    'matrixblock',
    not entry.enabled ? 'disabled-entry',
    static ? 'static',
  ]|filter,
  data: {
    uid: entry.uid,
    type: entryType.handle,
    'type-name': entryTypeName,
    collapsed: entry.collapsed,
    'type-id': entry.typeId,
    'field-layout-id': entry.getFieldLayout().id
  },
  role: 'listitem',
} %}

{% set actionBtnLabel = "#{entryTypeName} #{'Actions'|t('app')}" %}
{% set actionMenuId = "matrixblock-action-menu--#{entry.uid}" %}

{% set actionBtnAttributes = {
  class: ['btn', 'settings', 'icon', 'menubtn'],
  type: 'button',
  role: 'button',
  title: 'Actions'|t('app'),
  aria: {
    controls: actionMenuId,
    label: actionBtnLabel,
  },
  data: {
    'disclosure-trigger': true,
  }
} %}

{% set form = entry.getFieldLayout().createForm(entry, static) %}
{% set tabs = form.getTabMenu() %}

<div {{ attr(entryAttributes) }}>
  {% if not static %}
    {{ hiddenInput("#{name}[sortOrder][]", entry.uid) }}
    {# only register a delta name for this entry if itâ€™s not new #}
    {% if entry.id %}
      {% do view.registerDeltaName(baseInputName) %}
    {% endif %}
    {{ hiddenInput("#{baseInputName}[type]", entryType.handle) }}
    {{ hiddenInput("#{baseInputName}[enabled]", entry.enabled ? '1' : '') }}
  {% endif %}

  <div class="titlebar">
    <div class="blocktype{% if not static and entry.hasErrors() %} error{% endif %}">
      {{ entryTypeName }}
      {% if not static and entry.hasErrors() %}<span data-icon="alert" aria-label="{{ 'Error'|t('app') }}"></span>{% endif %}
    </div>
    <div class="preview"></div>
    <div class="matrixblock-tabs">
      {% namespace baseInputName %}
        {% if tabs|length > 1 %}
          {% include '_includes/tabs.twig' with {'tabs': tabs, 'containerAttributes': {'id': 'tabs'}} %}
        {% endif %}
      {% endnamespace %}
    </div>
  </div>

  {% if not static %}
    <div class="checkbox" title="{{ 'Select'|t('app') }}" aria-label="{{ 'Select'|t('app') }}"></div>
    <div class="actions">
      <div class="status off" title="{{ 'Disabled'|t('app') }}">
        {{ tag('span', {
          class: 'visually-hidden',
          html: 'Disabled'|t('app'),
        }) }}
      </div>

      <div>
        <button {{ attr(actionBtnAttributes) }}></button>
        <div id="{{ actionMenuId }}" class="menu menu--disclosure">
          <ul>
            <li><a data-icon="collapse" data-action="collapse" href="#" type="button" role="button" aria-label="{{ 'Collapse'|t('app') }}">{{ "Collapse"|t('app') }}</a></li>
            <li class="hidden"><a data-icon="expand" data-action="expand" href="#" type="button" role="button" aria-label="{{ 'Expand'|t('app') }}">{{ "Expand"|t('app') }}</a></li>
            <li{% if not entry.enabled %} class="hidden"{% endif %}><a data-icon="disabled" data-action="disable" href="#" type="button" role="button" aria-label="{{ 'Disable'|t('app') }}">{{ "Disable"|t('app') }}</a></li>
            <li{% if entry.enabled %} class="hidden"{% endif %}><a data-icon="enabled" data-action="enable" href="#" type="button" role="button" aria-label="{{ 'Enable'|t('app') }}">{{ "Enable"|t('app') }}</a></li>
            <li><a data-icon="uarr" data-action="moveUp" href="#" type="button" role="button" aria-label="{{ 'Move up'|t('app') }}">{{ 'Move up'|t('app') }}</a></li>
            <li><a data-icon="darr" data-action="moveDown" href="#" type="button" role="button" aria-label="{{ 'Move down'|t('app') }}">{{ 'Move down'|t('app') }}</a></li>
          </ul>
          {% if not staticEntries %}
            <hr class="padded">
            <ul>
              <li><a class="error" data-icon="remove" data-action="delete" href="#" type="button" role="button" aria-label="{{ 'Delete'|t('app') }}">{{ "Delete"|t('app') }}</a></li>
            </ul>
            <hr class="padded">
            <ul>
              {% for entryType in entryTypes %}
                <li><a data-icon="plus" data-action="add" data-type="{{ entryType.handle }}" href="#" type="button" role="button" aria-label="{{ 'Add {type} above'|t('app', { type: entryType.name|t('site') }) }}">{{ "Add {type} above"|t('app', { type: entryType.name|t('site') }) }}</a></li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      </div>
      <a class="move icon" title="{{ 'Reorder'|t('app') }}" aria-label="{{ 'Reorder'|t('app') }}" role="button"></a>
    </div>
  {% endif %}
  <div class="fields">
    {% namespace baseInputName %}
      {{ form.render()|raw }}
    {% endnamespace %}
  </div>
</div>
