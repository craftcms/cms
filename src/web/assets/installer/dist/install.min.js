!function(t){Craft.Installer=Garnish.Base.extend({$bg:null,$screens:null,$dots:null,$currentScreen:null,$currentDot:null,$dbDriverInput:null,$dbPortInput:null,modal:null,currentScreen:null,loading:!1,init:function(){this.$bg=t("#bg"),this.$screens=t("#screens").children(),this.$dbDriverInput=t("#db-driver"),this.$dbPortInput=t("#db-port"),this.updateDbPortInput(),this.addListener(this.$screens.find("form"),"submit","handleScreenSubmit"),this.addListener(this.$screens.find(".btn.submit"),"activate","handleScreenSubmit"),this.addListener(t("#beginbtn"),"activate","showModal"),this.addListener(this.$dbDriverInput,"change","updateDbPortInput")},showModal:function(){this.modal?this.modal.show():(this.modal=new Garnish.Modal(t("#install-modal").removeClass("hidden"),{shadeClass:""}),this.gotoScreen(1))},updateDbPortInput:function(){var t=this.$dbDriverInput.val(),e=this.$dbPortInput.val(),n=Craft.Installer.defaultDbPorts[t];this.$dbPortInput.attr("placeholder",n),e==n&&this.$dbPortInput.val("")},handleScreenSubmit:function(t){t.preventDefault();var e=this.getScreenInputNames(this.$currentScreen);e?this.validate(this.$currentScreen.attr("id"),e):this.gotoNextScreen()},getScreenInputNames:function(t){var e=t.attr("data-inputs");return e?e.split(","):null},getInputData:function(e,n,s){for(var r={},i=0;i<n.length;i++){var a=n[i],o=t("#"+e+"-"+a);r[(s?e+"-":"")+a]=Garnish.getInputPostVal(o)}return r},showInstallScreen:function(){for(var e,n,s={},r=1;r<this.$screens.length-1;r++)e=this.$screens.eq(r),n=this.getScreenInputNames(e),t.extend(s,this.getInputData(e.attr("id"),n,!0));Craft.postActionRequest("install/install",s,t.proxy(this,"allDone"),{complete:t.noop})},allDone:function(e,n){t("#spinner").remove();var s=this.$currentScreen.find("h1:first");"success"===n&&e.success?(s.text(Craft.t("app","Craft is installed! ðŸŽ‰")),setTimeout(function(){window.location.href=Craft.getUrl("dashboard")},1e3)):(s.text("Install failed ðŸ˜ž"),t("<p/>",{text:"Please check your logs for more info."}).insertAfter(s))},gotoNextScreen:function(){this.gotoScreen(this.currentScreen+1)},gotoScreen:function(e){if(1===e)this.$dots&&this.$dots.hide();else if(this.$dots)this.$dots.show();else{this.$dots=t();for(var n=0;n<this.$screens.length;n++)this.$dots=this.$dots.add(t("<div/>").appendTo(t("#dots")))}this.$currentScreen&&(this.$currentScreen.addClass("hidden"),this.$currentDot&&this.$currentDot.removeClass("sel")),this.currentScreen=e,this.$currentScreen=this.$screens.eq(e-1).removeClass("hidden"),this.$dots&&(this.$currentDot=this.$dots.eq(e-1).addClass("sel")),e===this.$screens.length?this.showInstallScreen():1!==e&&this.$currentScreen.find("input[type=text]:first").focus()},validate:function(e,n){if(!this.loading){this.loading=!0,this.$currentScreen.find(".input").removeClass("errors"),this.$currentScreen.find("ul.errors").remove();var s=this.$currentScreen.find(".btn.submit");s.addClass("sel loading");var r="install/validate-"+e,i=this.getInputData(e,n,!1);Craft.postActionRequest(r,i,t.proxy(function(n,r){if(this.loading=!1,s.removeClass("sel loading"),"success"===r)if(n.validates)this.gotoNextScreen();else{var i=t("<ul/>",{class:"errors"}).insertBefore(t("#"+e).find(".buttons"));for(var a in n.errors)if(n.errors.hasOwnProperty(a)){for(var o=0;o<n.errors[a].length;o++)t("<li>"+n.errors[a][o]+"</li>").appendTo(i);var l=t("#"+e+"-"+a+"-field").children(".input");l.addClass("errors"),t.proxy(function(t){var e=t.find("select,input");this.addListener(e,"focus,blur,textchange,change",function(){t.removeClass("errors"),this.removeListener(e,"focus,blur,textchange,change")})},this)(l)}Garnish.shake(this.$currentScreen)}},this))}}},{defaultDbPorts:{mysql:3306,pgsql:5432}}),Garnish.$win.on("load",function(){Craft.installer=new Craft.Installer})}(jQuery);
//# sourceMappingURL=install.min.js.map