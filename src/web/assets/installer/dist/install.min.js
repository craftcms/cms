!function(t){Craft.Installer=Garnish.Base.extend({$bg:null,$screens:null,$currentScreen:null,$accountSubmitBtn:null,$siteSubmitBtn:null,loading:!1,init:function(){this.$bg=t("#bg"),this.$screens=Garnish.$bod.children(".modal"),this.addListener(t("#beginbtn"),"activate","showAccountScreen")},showAccountScreen:function(e){this.showScreen(1,t.proxy(function(){t("#beginbtn").remove(),this.$accountSubmitBtn=t("#accountsubmit"),this.addListener(this.$accountSubmitBtn,"activate","validateAccount"),this.addListener(t("#accountform"),"submit","validateAccount")},this))},validateAccount:function(e){e.preventDefault();var i=["username","email","password"];this.validate("account",i,t.proxy(this,"showSiteScreen"))},showSiteScreen:function(){this.showScreen(2,t.proxy(function(){this.$siteSubmitBtn=t("#sitesubmit"),this.addListener(this.$siteSubmitBtn,"activate","validateSite"),this.addListener(t("#siteform"),"submit","validateSite")},this))},validateSite:function(e){e.preventDefault();var i=["systemName","siteUrl","siteLanguage"];this.validate("site",i,t.proxy(this,"showInstallScreen"))},showInstallScreen:function(){this.showScreen(3,t.proxy(function(){for(var e=["username","email","password","systemName","siteUrl","siteLanguage"],i={},n=0;n<e.length;n++){var s=e[n],r=t("#"+s);i[s]=Garnish.getInputPostVal(r)}Craft.postActionRequest("install/install",i,t.proxy(this,"allDone"),{complete:t.noop})},this))},allDone:function(e,i){if("success"===i&&e.success){this.$currentScreen.find("h1:first").text(Craft.t("app","All done!"));var n=t('<div class="buttons"/>'),s=t('<div class="btn big submit">'+Craft.t("app","Go to Craft CMS")+"</div>").appendTo(n);t("#spinner").replaceWith(n),this.addListener(s,"click",function(){this.showScreen(30,null,1e3),setTimeout(function(){window.location.href=Craft.getUrl("dashboard")},Craft.Installer.duration)})}else this.$currentScreen.find("h1:first").text("Oops.")},showScreen:function(e,i,n){n||(n=Craft.Installer.duration),this.$bg.velocity({left:"-"+5*e+"%"},n);var s=Garnish.$win.width(),r=Math.floor(s/2);this.$currentScreen&&this.$currentScreen.css("left",r).velocity({left:-400},Craft.Installer.duration),this.$currentScreen=t(this.$screens[e-1]).css({display:"block",left:s+400}).velocity({left:r},Craft.Installer.duration,t.proxy(function(){this.$currentScreen.css("left","50%"),this.focusFirstInput(),i()},this))},validate:function(e,i,n){if(!this.loading){this.loading=!0,t("#"+e+"form").find(".errors").remove();var s=this["$"+e+"SubmitBtn"];s.addClass("sel loading");for(var r="install/validate-"+e,a={},o=0;o<i.length;o++){var c=i[o],l=t("#"+c);a[c]=Garnish.getInputPostVal(l)}Craft.postActionRequest(r,a,t.proxy(function(e,i){if(this.loading=!1,s.removeClass("sel loading"),"success"===i)if(e.validates)n();else{for(var r in e.errors)if(e.errors.hasOwnProperty(r)){for(var a=e.errors[r],o=t("#"+r),c=o.closest(".field"),l=t('<ul class="errors"/>').appendTo(c),u=0;u<a.length;u++){var h=a[u];t("<li>"+h+"</li>").appendTo(l)}o.is(":focus")||(o.addClass("error"),t.proxy(function(t){this.addListener(t,"focus",function(){t.removeClass("error"),this.removeListener(t,"focus")})},this)(o))}Garnish.shake(this.$currentScreen)}},this))}},focusFirstInput:function(){setTimeout(t.proxy(function(){this.$currentScreen.find("input:first").focus()},this),Craft.Installer.duration)}},{duration:300}),Garnish.$win.on("load",function(){Craft.installer=new Craft.Installer})}(jQuery);
//# sourceMappingURL=install.min.js.map