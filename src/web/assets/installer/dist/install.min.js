!function(l){Craft.Installer=Garnish.Base.extend({$bg:null,$screens:null,$dots:null,$currentScreen:null,$currentDot:null,$dbDriverInput:null,$dbPortInput:null,modal:null,currentScreen:null,loading:!1,init:function(){this.$bg=l("#bg"),this.$screens=l("#screens").children(),this.$dbDriverInput=l("#db-driver"),this.$dbPortInput=l("#db-port"),this.updateDbPortInput(),this.addListener(this.$screens.find("form"),"submit","handleScreenSubmit"),this.addListener(this.$screens.find(".btn.submit"),"activate","handleScreenSubmit"),this.addListener(l("#beginbtn"),"activate","showModal"),this.addListener(this.$dbDriverInput,"change","updateDbPortInput")},showModal:function(){this.modal?this.modal.show():(this.modal=new Garnish.Modal(l("#install-modal").removeClass("hidden"),{shadeClass:""}),this.gotoScreen(1))},updateDbPortInput:function(){var t=this.$dbDriverInput.val(),e=this.$dbPortInput.val(),r=Craft.Installer.defaultDbPorts[t];this.$dbPortInput.attr("placeholder",r),e==r&&this.$dbPortInput.val("")},handleScreenSubmit:function(t){t.preventDefault();var e=this.getScreenInputNames(this.$currentScreen);e?this.validate(this.$currentScreen.attr("id"),e):this.gotoNextScreen()},getScreenInputNames:function(t){var e=t.attr("data-inputs");return e?e.split(","):null},getInputData:function(t,e,r){for(var n={},s=0;s<e.length;s++){var i=e[s],a=l("#"+t+"-"+i);n[(r?t+"-":"")+i]=Garnish.getInputPostVal(a)}return n},showInstallScreen:function(){for(var t,e,r={},n=1;n<this.$screens.length-1;n++)t=this.$screens.eq(n),e=this.getScreenInputNames(t),l.extend(r,this.getInputData(t.attr("id"),e,!0));Craft.postActionRequest("install/install",r,l.proxy(this,"allDone"),{complete:l.noop})},allDone:function(t,e){l("#spinner").remove();var r=this.$currentScreen.find("h1:first");"success"===e&&t.success?(r.text(Craft.t("app","Craft is installed! ðŸŽ‰")),setTimeout(function(){window.location.href=Craft.getUrl("dashboard")},1e3)):(r.text("Install failed ðŸ˜ž"),l("<p/>",{text:"Please check your logs for more info."}).insertAfter(r))},gotoNextScreen:function(){this.gotoScreen(this.currentScreen+1)},gotoScreen:function(t){if(1===t)this.$dots&&this.$dots.hide();else if(this.$dots)this.$dots.show();else{this.$dots=l();for(var e=0;e<this.$screens.length;e++)this.$dots=this.$dots.add(l("<div/>").appendTo(l("#dots")))}this.$currentScreen&&(this.$currentScreen.addClass("hidden"),this.$currentDot&&this.$currentDot.removeClass("sel")),this.currentScreen=t,this.$currentScreen=this.$screens.eq(t-1).removeClass("hidden"),this.$dots&&(this.$currentDot=this.$dots.eq(t-1).addClass("sel")),t===this.$screens.length?this.showInstallScreen():1!==t&&this.$currentScreen.find("input[type=text]:first").trigger("focus")},validate:function(a,t){if(!this.loading){this.loading=!0,this.$currentScreen.find(".input").removeClass("errors"),this.$currentScreen.find("ul.errors").remove();var o=this.$currentScreen.find(".btn.submit");o.addClass("sel loading");var e="install/validate-"+a,r=this.getInputData(a,t,!1);Craft.postActionRequest(e,r,l.proxy(function(t,e){if(this.loading=!1,o.removeClass("sel loading"),"success"===e)if(t.validates)this.gotoNextScreen();else{var r=l("<ul/>",{class:"errors"}).insertBefore(l("#"+a).find(".buttons"));for(var n in t.errors)if(t.errors.hasOwnProperty(n)){for(var s=0;s<t.errors[n].length;s++)l("<li>"+t.errors[n][s]+"</li>").appendTo(r);var i=l("#"+a+"-"+n+"-field").children(".input");i.addClass("errors"),l.proxy(function(t){var e=t.find("select,input");this.addListener(e,"focus,blur,textchange,change",function(){t.removeClass("errors"),this.removeListener(e,"focus,blur,textchange,change")})},this)(i)}Garnish.shake(this.$currentScreen)}},this))}}},{defaultDbPorts:{mysql:3306,pgsql:5432}}),Garnish.$win.on("load",function(){Craft.installer=new Craft.Installer})}(jQuery);
//# sourceMappingURL=install.min.js.map