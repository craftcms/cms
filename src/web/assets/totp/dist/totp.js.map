{"version":3,"file":"totp.js","mappings":"AAgDGA,OA7CDC,MAAMC,SAAWC,QAAQC,KAAKC,OAC5B,CACEC,KAAM,SAAUC,EAAMC,EAAWC,GAC/B,IAAMC,EAAYH,EAAKI,cAAc,wBAC/BC,EAAYL,EAAKI,cAAc,iBAErCE,KAAKC,YAAYJ,EAAW,SAAS,SAACK,GACL,IAA3BL,EAAUM,MAAMC,QAClBV,EAAKW,eAET,IAEAL,KAAKC,YAAYP,EAAM,UAAU,SAACQ,GAChCA,EAAGI,iBAECP,EAAUQ,UAAUC,SAAS,aAIjCT,EAAUQ,UAAUE,IAAI,WACxBrB,MAAMsB,GAAGC,SAASvB,MAAMwB,EAAE,MAAO,YAEjCxB,MAAMyB,kBAAkB,OAAQ,mBAAoB,CAClDC,KAAM,CACJC,KAAMlB,EAAUM,SAGjBa,MAAK,WACJrB,GACF,IACCsB,OAAM,SAACC,GAAM,IAAAC,EACZvB,EAAUsB,SAAW,QAAVC,EAADD,EAAGE,gBAAQ,IAAAD,GAAM,QAANA,EAAXA,EAAaL,YAAI,IAAAK,OAAA,EAAjBA,EAAmBE,QAC/B,IACCC,SAAQ,WACPvB,EAAUQ,UAAUgB,OAAO,UAC7B,IACJ,GACF,GAEF,CACEC,OAAQ,+BAIZpC,MAAMqC,wBAAwBrC,MAAMC,SAASmC,OAAQpC,MAAMC","sources":["webpack:///./TotpForm.js"],"sourcesContent":["(function ($) {\n  /** global: Craft */\n  /** global: Garnish */\n  Craft.TotpForm = Garnish.Base.extend(\n    {\n      init: function (form, onSuccess, showError) {\n        const codeInput = form.querySelector('input.auth-totp-code');\n        const submitBtn = form.querySelector('button.submit');\n\n        this.addListener(codeInput, 'input', (ev) => {\n          if (codeInput.value.length === 6) {\n            form.requestSubmit();\n          }\n        });\n\n        this.addListener(form, 'submit', (ev) => {\n          ev.preventDefault();\n\n          if (submitBtn.classList.contains('loading')) {\n            return;\n          }\n\n          submitBtn.classList.add('loading');\n          Craft.cp.announce(Craft.t('app', 'Loading'));\n\n          Craft.sendActionRequest('POST', 'auth/verify-totp', {\n            data: {\n              code: codeInput.value,\n            },\n          })\n            .then(() => {\n              onSuccess();\n            })\n            .catch((e) => {\n              showError(e?.response?.data?.message);\n            })\n            .finally(() => {\n              submitBtn.classList.remove('loading');\n            });\n        });\n      },\n    },\n    {\n      METHOD: 'craft\\\\auth\\\\methods\\\\TOTP',\n    }\n  );\n\n  Craft.registerAuthFormHandler(Craft.TotpForm.METHOD, Craft.TotpForm);\n})(jQuery);\n"],"names":["jQuery","Craft","TotpForm","Garnish","Base","extend","init","form","onSuccess","showError","codeInput","querySelector","submitBtn","this","addListener","ev","value","length","requestSubmit","preventDefault","classList","contains","add","cp","announce","t","sendActionRequest","data","code","then","catch","e","_e$response","response","message","finally","remove","METHOD","registerAuthFormHandler"],"sourceRoot":""}