!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(1);!function($){Craft.PluginManager=Garnish.Base.extend({init:function(){this.getPluginLicenseInfo().then(function(response){for(var handle in response)response.hasOwnProperty(handle)&&(response[handle].isComposerInstalled?new Plugin(this,$("#plugin-"+handle)).update(response[handle]):this.addUninstalledPluginRow(handle,response[handle]))}.bind(this))},getPluginLicenseInfo:function(){return new Promise((function(resolve,reject){Craft.sendApiRequest("GET","cms-licenses",{params:{include:"plugins"}}).then((function(response){Craft.postActionRequest("app/get-plugin-license-info",{pluginLicenses:response.license.pluginLicenses||[]},(function(response,textStatus){"success"===textStatus?resolve(response):reject()}),{contentType:"json"})})).catch(reject)}))},addUninstalledPluginRow:function(handle,info){var $table=$("#plugins");$table.length||($table=$("<table/>",{id:"plugins",class:"data fullwidth collapsible",html:"<tbody></tbody>"}),$("#no-plugins").replaceWith($table));var $row=$("<tr/>",{data:{handle:handle}}).appendTo($table.children("tbody")).append($("<th/>").append($("<div/>",{class:"plugin-infos"}).append($("<div/>",{class:"icon"}).append($("<img/>",{src:info.iconUrl}))).append($("<div/>",{class:"details"}).append($("<h2/>",{text:info.name})).append(info.description?$("<p/>",{text:info.description}):$()).append(info.documentationUrl?$("<p/>",{class:"links"}).append($("<a/>",{href:info.documentationUrl,target:"_blank",text:Craft.t("app","Documentation")})):$()).append($("<div/>",{class:"flex license-key"}).append($("<div />",{class:"pane"}).append($("<input/>",{class:"text code",size:29,maxlength:29,value:Craft.PluginManager.normalizeUserKey(info.licenseKey),readonly:!0,disabled:!0}))))))).append($("<td/>",{class:"nowrap","data-title":Craft.t("app","Status")}).append($("<span/>",{class:"status"})).append($("<span/>",{class:"light",text:Craft.t("app","Missing")}))).append(info.latestVersion?$("<td/>",{class:"nowrap thin","data-title":Craft.t("app","Action")}).append($("<form/>",{method:"post","accept-charset":"UTF-8"}).append($("<input/>",{type:"hidden",name:"action",value:"pluginstore/install"})).append($("<input/>",{type:"hidden",name:"packageName",value:info.packageName})).append($("<input/>",{type:"hidden",name:"handle",value:handle})).append($("<input/>",{type:"hidden",name:"edition",value:info.licensedEdition})).append($("<input/>",{type:"hidden",name:"version",value:info.latestVersion})).append($("<input/>",{type:"hidden",name:"licenseKey",value:info.licenseKey})).append($("<input/>",{type:"hidden",name:"return",value:"settings/plugins"})).append(Craft.getCsrfInput()).append($("<div/>",{class:"btngroup"}).append($("<button/>",{type:"button",class:"btn menubtn","data-icon":"settings"})).append($("<div/>",{class:"menu","data-align":"right"}).append($("<ul/>").append($("<li/>").append($("<a/>",{class:"formsubmit",text:Craft.t("app","Install")}))))))):$());Craft.initUiElements($row)}},{normalizeUserKey:function(key){return"string"!=typeof key||""===key?"":"$"===key[0]?key:key.replace(/.{4}/g,"$&-").substr(0,29).toUpperCase()}});var Plugin=Garnish.Base.extend({manager:null,$row:null,$details:null,$keyContainer:null,$keyInput:null,$spinner:null,$buyBtn:null,handle:null,updateTimeout:null,init:function(manager,$row){this.manager=manager,this.$row=$row,this.$details=this.$row.find(".details"),this.$keyContainer=$row.find(".license-key"),this.$keyInput=this.$keyContainer.find("input.text").removeAttr("readonly"),this.$buyBtn=this.$keyContainer.find(".btn"),this.$spinner=$row.find(".spinner"),this.handle=this.$row.data("handle"),this.addListener(this.$keyInput,"focus","onKeyFocus"),this.addListener(this.$keyInput,"input","onKeyChange")},getKey:function(){return this.$keyInput.val().replace(/\-/g,"").toUpperCase()},onKeyFocus:function(){this.$keyInput.select()},onKeyChange:function(){this.updateTimeout&&clearTimeout(this.updateTimeout);var key=this.getKey();if(0===key.length||24===key.length||key.length>1&&"$"===key[0]){var userKey=Craft.PluginManager.normalizeUserKey(key);this.$keyInput.val(userKey),this.updateTimeout=setTimeout($.proxy(this,"updateLicenseStatus"),100)}},updateLicenseStatus:function(){this.$spinner.removeClass("hidden"),Craft.postActionRequest("app/update-plugin-license",{handle:this.handle,key:this.getKey()},function(response,textStatus){"success"===textStatus&&this.manager.getPluginLicenseInfo().then(function(response){this.$spinner.addClass("hidden"),this.update(response[this.handle])}.bind(this))}.bind(this))},update:function(info){var $oldIcon=this.$row.find(".license-key-status");if("valid"==info.licenseKeyStatus||info.licenseIssues.length){var $newIcon=$("<span/>",{class:"license-key-status "+(0===info.licenseIssues.length?"valid":"")});$oldIcon.length?$oldIcon.replaceWith($newIcon):$newIcon.appendTo(this.$row.find(".icon"))}else $oldIcon.length&&$oldIcon.remove();var $oldEdition=this.$row.find(".edition");if(info.hasMultipleEditions||info.isTrial){var $newEdition=info.upgradeAvailable?$("<a/>",{href:Craft.getUrl("plugin-store/"+this.handle),class:"edition"}):$("<div/>",{class:"edition"});info.hasMultipleEditions&&$("<div/>",{class:"edition-name",text:info.edition}).appendTo($newEdition),info.isTrial&&$("<div/>",{class:"edition-trial",text:Craft.t("app","Trial")}).appendTo($newEdition),$oldEdition.length?$oldEdition.replaceWith($newEdition):$newEdition.insertBefore(this.$row.find(".version"))}else $oldEdition.length&&$oldEdition.remove();var showLicenseKey=info.licenseKey||"unknown"!==info.licenseKeyStatus;if(showLicenseKey?(this.$keyContainer.removeClass("hidden"),info.licenseKey&&!this.$keyInput.val().match(/^\$/)&&this.$keyInput.val(Craft.PluginManager.normalizeUserKey(info.licenseKey))):this.$keyContainer.addClass("hidden"),showLicenseKey&&info.licenseIssues.length?this.$keyInput.addClass("error"):this.$keyInput.removeClass("error"),this.$row.find("p.error").remove(),info.licenseIssues.length){for(var $p,$form,message,$issues=$(),i=0;i<info.licenseIssues.length;i++){switch(info.licenseIssues[i]){case"no_trials":message=Craft.t("app","Plugin trials are not allowed on this domain.");break;case"wrong_edition":message=Craft.t("app","This license is for the {name} edition.",{name:info.licensedEdition.charAt(0).toUpperCase()+info.licensedEdition.substring(1)})+' <button type="button" class="btn submit small formsubmit">'+Craft.t("app","Switch")+"</button>";break;case"mismatched":message=Craft.t("app",'This license is tied to another Craft install. Visit {accountLink} to detach it, or <a href="{buyUrl}">buy a new license</a>',{accountLink:'<a href="https://id.craftcms.com" rel="noopener" target="_blank">id.craftcms.com</a>',buyUrl:Craft.getCpUrl("plugin-store/buy/".concat(this.handle,"/").concat(info.edition))});break;case"astray":message=Craft.t("app","This license isnâ€™t allowed to run version {version}.",{version:info.version});break;case"required":message=Craft.t("app","A license key is required.");break;default:message=Craft.t("app","Your license key is invalid.")}$p=$("<p/>",{class:"error",html:message}),"wrong_edition"===info.licenseIssues[i]?($form=$("<form/>",{method:"post","accept-charset":"UTF-8"}).append(Craft.getCsrfInput()).append($("<input/>",{type:"hidden",name:"action",value:"plugins/switch-edition"})).append($("<input/>",{type:"hidden",name:"pluginHandle",value:this.handle})).append($("<input/>",{type:"hidden",name:"edition",value:info.licensedEdition})).append($p),Craft.initUiElements($form),$issues=$issues.add($form)):$issues=$issues.add($p)}$issues.appendTo(this.$details),Craft.initUiElements()}var $oldExpired=this.$row.find(".expired");if(info.expired){var $newExpired=$("<p/>",{class:"warning with-icon expired",html:Craft.t("app","This license has expired.")+" "+Craft.t("app","<a>Renew now</a> for another year of updates.").replace("<a>",'<a href="'+info.renewalUrl+'" target="_blank">')});$oldExpired.length?$oldExpired.replaceWith($newExpired):$newExpired.appendTo(this.$details)}"trial"===info.licenseKeyStatus?(this.$buyBtn.removeClass("hidden"),info.licenseIssues.length?this.$buyBtn.addClass("submit"):this.$buyBtn.removeClass("submit")):this.$buyBtn.addClass("hidden")}})}(jQuery)},function(module,exports,__webpack_require__){var content=__webpack_require__(2);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[module.i,content,""]]),content.locals&&(module.exports=content.locals);(0,__webpack_require__(3).default)("6c02db64",content,!0,{})},function(module,exports,__webpack_require__){},function(module,__webpack_exports__,__webpack_require__){"use strict";function listToStyles(parentId,list){for(var styles=[],newStyles={},i=0;i<list.length;i++){var item=list[i],id=item[0],part={id:parentId+":"+i,css:item[1],media:item[2],sourceMap:item[3]};newStyles[id]?newStyles[id].parts.push(part):styles.push(newStyles[id]={id:id,parts:[part]})}return styles}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return addStylesClient}));var hasDocument="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!hasDocument)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var stylesInDom={},head=hasDocument&&(document.head||document.getElementsByTagName("head")[0]),singletonElement=null,singletonCounter=0,isProduction=!1,noop=function(){},options=null,isOldIE="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function addStylesClient(parentId,list,_isProduction,_options){isProduction=_isProduction,options=_options||{};var styles=listToStyles(parentId,list);return addStylesToDom(styles),function(newList){for(var mayRemove=[],i=0;i<styles.length;i++){var item=styles[i];(domStyle=stylesInDom[item.id]).refs--,mayRemove.push(domStyle)}newList?addStylesToDom(styles=listToStyles(parentId,newList)):styles=[];for(i=0;i<mayRemove.length;i++){var domStyle;if(0===(domStyle=mayRemove[i]).refs){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}}}function addStylesToDom(styles){for(var i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j]));domStyle.parts.length>item.parts.length&&(domStyle.parts.length=item.parts.length)}else{var parts=[];for(j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j]));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function createStyleElement(){var styleElement=document.createElement("style");return styleElement.type="text/css",head.appendChild(styleElement),styleElement}function addStyle(obj){var update,remove,styleElement=document.querySelector('style[data-vue-ssr-id~="'+obj.id+'"]');if(styleElement){if(isProduction)return noop;styleElement.parentNode.removeChild(styleElement)}if(isOldIE){var styleIndex=singletonCounter++;styleElement=singletonElement||(singletonElement=createStyleElement()),update=applyToSingletonTag.bind(null,styleElement,styleIndex,!1),remove=applyToSingletonTag.bind(null,styleElement,styleIndex,!0)}else styleElement=createStyleElement(),update=applyToTag.bind(null,styleElement),remove=function(){styleElement.parentNode.removeChild(styleElement)};return update(obj),function(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}var textStore,replaceText=(textStore=[],function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join("\n")});function applyToSingletonTag(styleElement,index,remove,obj){var css=remove?"":obj.css;if(styleElement.styleSheet)styleElement.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=styleElement.childNodes;childNodes[index]&&styleElement.removeChild(childNodes[index]),childNodes.length?styleElement.insertBefore(cssNode,childNodes[index]):styleElement.appendChild(cssNode)}}function applyToTag(styleElement,obj){var css=obj.css,media=obj.media,sourceMap=obj.sourceMap;if(media&&styleElement.setAttribute("media",media),options.ssrId&&styleElement.setAttribute("data-vue-ssr-id",obj.id),sourceMap&&(css+="\n/*# sourceURL="+sourceMap.sources[0]+" */",css+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */"),styleElement.styleSheet)styleElement.styleSheet.cssText=css;else{for(;styleElement.firstChild;)styleElement.removeChild(styleElement.firstChild);styleElement.appendChild(document.createTextNode(css))}}}]);
//# sourceMappingURL=PluginManager.min.js.map