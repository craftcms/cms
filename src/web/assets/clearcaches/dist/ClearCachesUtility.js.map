{"version":3,"file":"ClearCachesUtility.js","mappings":"YAAA,IAAWA,IAiGRC,OAhGDC,MAAMC,mBAAqBC,QAAQC,KAAKC,OAAO,CAC7CC,KAAM,SAAUC,GAEd,IAFsB,WAClBC,EAAST,EAAE,gBAAgB,WACtBU,GACP,IAAIC,EAAQF,EAAOG,GAAGF,GAClBG,EAAcF,EAAMG,KAAK,wBACzBC,EAAOJ,EAAMG,KAAK,QAClBE,EAAc,WACZH,EAAYI,OAAO,YAAYC,OACjCH,EAAKI,YAAY,YAEjBJ,EAAKK,SAAS,WAElB,EACAP,EAAYQ,GAAG,SAAUL,GACzBA,IACA,EAAKM,YAAYX,EAAO,UAAU,SAACY,GACjCA,EAAGC,iBACET,EAAKU,SAAS,aACjB,EAAKC,SAASH,EAElB,GAAG,EAlBIb,EAAI,EAAGA,EAAID,EAAOS,OAAQR,IAAK,EAA/BA,EAoBX,EAEAgB,SAAU,SAAUH,GAClB,IAQII,EAAaC,EARbjB,EAAQX,EAAEuB,EAAGM,eACbC,EAAWnB,EAAMG,KAAK,iBACtBiB,EAAUpB,EAAMG,KAAK,mBAErBgB,EAASL,SAAS,cAKjBd,EAAMqB,KAAK,iBAIdL,EAAchB,EAAMqB,KAAK,gBACbC,mBACZL,EAAWjB,EAAMqB,KAAK,aALtBL,EAAc,IAAIzB,MAAMgC,YAAYH,GACpCpB,EAAMqB,KAAK,cAAeL,IAO5BA,EAAYQ,aAAahB,YAAY,UAErCQ,EAAYQ,aAAaC,SAAS,QAAQA,SACxC,CACEC,QAAS,GAEX,CACEC,SAAU,WACR,IAAIC,EAAWnC,QAAQoC,YAAY7B,GAC/BqB,EAAO9B,MAAMuC,gBAAgBF,GAEjCrC,MAAMwC,kBAAkB,OAAQV,EAAKW,OAAQ,CAACX,KAAAA,IAC3CY,MAAK,SAACC,GACLlB,EAAYmB,sBAAsB,KAElCC,YAAW,WACJnB,KACHA,EAAW5B,EACT,4CACAgD,SAASjB,IACFkB,IAAI,UAAW,GACxBtC,EAAMqB,KAAK,UAAWJ,IAGxBD,EAAYQ,aAAaC,SACvB,CAACC,QAAS,GACV,CACEa,SAAU,OACVZ,SAAU,WACRV,EAASQ,SAAS,CAACC,QAAS,GAAI,CAACa,SAAU,SAC3CpB,EAASX,YAAY,YACrBW,EAASqB,QAAQ,QACnB,GAGN,GAAG,IACL,IAAE,OACK,YAAgB,IAAdN,EAAQ,EAARA,SACP3C,MAAMkD,GAAGC,aAAaR,EAASb,KAAKsB,QACtC,GACJ,IAIA1B,GACFA,EAASqB,IAAI,UAAW,GAG1BnB,EAASV,SAAS,YAClBU,EAASqB,QAAQ,QACnB,G","sources":["webpack:///./ClearCachesUtility.js"],"sourcesContent":["(function ($) {\n  Craft.ClearCachesUtility = Garnish.Base.extend({\n    init: function (formId) {\n      let $forms = $('form.utility');\n      for (let i = 0; i < $forms.length; i++) {\n        let $form = $forms.eq(i);\n        let $checkboxes = $form.find('input[type=checkbox]');\n        let $btn = $form.find('.btn');\n        let checkInputs = function () {\n          if ($checkboxes.filter(':checked').length) {\n            $btn.removeClass('disabled');\n          } else {\n            $btn.addClass('disabled');\n          }\n        };\n        $checkboxes.on('change', checkInputs);\n        checkInputs();\n        this.addListener($form, 'submit', (ev) => {\n          ev.preventDefault();\n          if (!$btn.hasClass('disabled')) {\n            this.onSubmit(ev);\n          }\n        });\n      }\n    },\n\n    onSubmit: function (ev) {\n      let $form = $(ev.currentTarget);\n      let $trigger = $form.find('button.submit');\n      let $status = $form.find('.utility-status');\n\n      if ($trigger.hasClass('disabled')) {\n        return;\n      }\n\n      let progressBar, $allDone;\n      if (!$form.data('progressBar')) {\n        progressBar = new Craft.ProgressBar($status);\n        $form.data('progressBar', progressBar);\n      } else {\n        progressBar = $form.data('progressBar');\n        progressBar.resetProgressBar();\n        $allDone = $form.data('allDone');\n      }\n\n      progressBar.$progressBar.removeClass('hidden');\n\n      progressBar.$progressBar.velocity('stop').velocity(\n        {\n          opacity: 1,\n        },\n        {\n          complete: () => {\n            let postData = Garnish.getPostData($form);\n            let data = Craft.expandPostArray(postData);\n\n            Craft.sendActionRequest('POST', data.action, {data})\n              .then((response) => {\n                progressBar.setProgressPercentage(100);\n\n                setTimeout(() => {\n                  if (!$allDone) {\n                    $allDone = $(\n                      '<div class=\"alldone\" data-icon=\"done\" />'\n                    ).appendTo($status);\n                    $allDone.css('opacity', 0);\n                    $form.data('allDone', $allDone);\n                  }\n\n                  progressBar.$progressBar.velocity(\n                    {opacity: 0},\n                    {\n                      duration: 'fast',\n                      complete: () => {\n                        $allDone.velocity({opacity: 1}, {duration: 'fast'});\n                        $trigger.removeClass('disabled');\n                        $trigger.trigger('focus');\n                      },\n                    }\n                  );\n                }, 300);\n              })\n              .catch(({response}) => {\n                Craft.cp.displayError(response.data.message);\n              });\n          },\n        }\n      );\n\n      if ($allDone) {\n        $allDone.css('opacity', 0);\n      }\n\n      $trigger.addClass('disabled');\n      $trigger.trigger('blur');\n    },\n  });\n})(jQuery);\n"],"names":["$","jQuery","Craft","ClearCachesUtility","Garnish","Base","extend","init","formId","$forms","i","$form","eq","$checkboxes","find","$btn","checkInputs","filter","length","removeClass","addClass","on","addListener","ev","preventDefault","hasClass","onSubmit","progressBar","$allDone","currentTarget","$trigger","$status","data","resetProgressBar","ProgressBar","$progressBar","velocity","opacity","complete","postData","getPostData","expandPostArray","sendActionRequest","action","then","response","setProgressPercentage","setTimeout","appendTo","css","duration","trigger","cp","displayError","message"],"sourceRoot":""}