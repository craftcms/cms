!function(){var t={917:function(){},821:function(t,e,i){var s=i(917);s.__esModule&&(s=s.default),"string"==typeof s&&(s=[[t.id,s,""]]),s.locals&&(t.exports=s.locals),(0,i(673).Z)("ec3d9c2c",s,!0,{})},673:function(t,e,i){"use strict";function s(t,e){for(var i=[],s={},o=0;o<e.length;o++){var n=e[o],a=n[0],r={id:t+":"+o,css:n[1],media:n[2],sourceMap:n[3]};s[a]?s[a].parts.push(r):i.push(s[a]={id:a,parts:[r]})}return i}i.d(e,{Z:function(){return p}});var o="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var n={},a=o&&(document.head||document.getElementsByTagName("head")[0]),r=null,h=0,d=!1,l=function(){},u=null,c="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function p(t,e,i,o){d=i,u=o||{};var a=s(t,e);return v(a),function(e){for(var i=[],o=0;o<a.length;o++){var r=a[o];(h=n[r.id]).refs--,i.push(h)}for(e?v(a=s(t,e)):a=[],o=0;o<i.length;o++){var h;if(0===(h=i[o]).refs){for(var d=0;d<h.parts.length;d++)h.parts[d]();delete n[h.id]}}}}function v(t){for(var e=0;e<t.length;e++){var i=t[e],s=n[i.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](i.parts[o]);for(;o<i.parts.length;o++)s.parts.push(b(i.parts[o]));s.parts.length>i.parts.length&&(s.parts.length=i.parts.length)}else{var a=[];for(o=0;o<i.parts.length;o++)a.push(b(i.parts[o]));n[i.id]={id:i.id,refs:1,parts:a}}}}function g(){var t=document.createElement("style");return t.type="text/css",a.appendChild(t),t}function b(t){var e,i,s=document.querySelector("style["+c+'~="'+t.id+'"]');if(s){if(d)return l;s.parentNode.removeChild(s)}if(f){var o=h++;s=r||(r=g()),e=y.bind(null,s,o,!1),i=y.bind(null,s,o,!0)}else s=g(),e=S.bind(null,s),i=function(){s.parentNode.removeChild(s)};return e(t),function(s){if(s){if(s.css===t.css&&s.media===t.media&&s.sourceMap===t.sourceMap)return;e(t=s)}else i()}}var m,$=(m=[],function(t,e){return m[t]=e,m.filter(Boolean).join("\n")});function y(t,e,i,s){var o=i?"":s.css;if(t.styleSheet)t.styleSheet.cssText=$(e,o);else{var n=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(n,a[e]):t.appendChild(n)}}function S(t,e){var i=e.css,s=e.media,o=e.sourceMap;if(s&&t.setAttribute("media",s),u.ssrId&&t.setAttribute(c,e.id),o&&(i+="\n/*# sourceURL="+o.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}}},e={};function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={id:s,exports:{}};return t[s](n,n.exports,i),n.exports}i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};!function(){"use strict";i.r(s),i.d(s,{FocalPoint:function(){return t}}),i(821);class t{constructor(t,e,i){this.visible=!1,this.dragging=!1,this.saving=!1,this.shouldSave=!1,this.lastX=0,this.lastY=0,this.debounceTimeout=1500,this.focalId="focal-point-"+Math.floor(99999*Math.random()),this.$target=t,this.$focal=$('<div class="preview-focal-point" id="'+this.focalId+'"><div class="inner"></div></div>').hide().appendTo(this.$target);const s=this.$target.find("img").data("focal");this.focalPos=s.split(";"),this.assetUid=this.$target.find("img").data("uid"),this.isCentered()?this.visible=!1:this.visible=!0,this.movable=i,this.$button=e,this.movable?(this.$button.on("click",(()=>{this.toggleFocal()})),this.addFocalMoveListeners()):this.$focal.css({cursor:"auto"}),this.renderFocal()}addFocalMoveListeners(){this.$focal.on("mousedown touchstart",this.handleDragStart.bind(this)),$(window).on("mouseup touchend",this.handleDragEnd.bind(this)),$(window).on("mousemove touchmove",this.handleMove.bind(this))}destruct(){this.debounceTimer&&this.storeFocalPosition(),this.$focal.off("mousedown touchstart",this.handleDragStart.bind(this)),$(window).off("mouseup touchend",this.handleDragEnd.bind(this)),$(window).off("mousemove touchmove",this.handleMove.bind(this))}handleDragStart(t){this.dragging=this.movable,this.lastX=t.pageX,this.lastY=t.pageY}isCentered(){return.5==this.focalPos[0]&&.5==this.focalPos[1]}handleDragEnd(){this.dragging=!1}handleMove(t){if(t.preventDefault(),!this.dragging||this.saving)return;const e=t.pageX-this.lastX,i=t.pageY-this.lastY;0===i&&0===e||(this.shouldSave=!0),this.lastX=t.pageX,this.lastY=t.pageY;const s=this.$focal.position(),o=s.left+e+this.$focal.outerWidth()/2,n=s.top+i+this.$focal.outerHeight()/2,a=this.$target.width(),r=this.$target.height(),h=Math.min(Math.max(0,o),a),d=Math.min(Math.max(0,n),r);this.focalPos=[1/(a/h),1/(r/d)],this.debouncedSave(),this.positionFocal()}debouncedSave(){this.saving||(clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout((()=>this.storeFocalPosition()),this.debounceTimeout))}storeFocalPosition(){this.saving=!0,this.renderButton();let t={assetUid:this.assetUid,focal:(this.visible?this.focalPos:[.5,.5]).join(";"),focalEnabled:this.visible};this.$button.parents(".buttons").css({opacity:1}),Craft.sendActionRequest("POST","assets/update-focal-position",{data:t}).then((t=>{this.saving=!1,this.shouldSave=!1,this.$button.parents(".buttons").css({opacity:""}),this.renderButton(),Craft.Preview.refresh()}))}toggleFocal(){this.saving||(this.visible=!this.visible,this.isCentered()||(this.shouldSave=!0),this.renderButton(),this.debouncedSave(),this.renderFocal())}renderButton(){this.saving?this.$button.text(Craft.t("app","Savingâ€¦")):this.visible?this.$button.text(Craft.t("app","Disable focal point")):this.$button.text(Craft.t("app","Enable focal point"))}renderFocal(){this.visible?(this.$focal.show(),this.positionFocal()):this.$focal.hide(),this.renderButton()}positionFocal(){this.$focal.css({left:this.$target.width()*this.focalPos[0]-this.$focal.outerWidth()/2,top:this.$target.height()*this.focalPos[1]-this.$focal.outerHeight()/2})}}}();var o=Craft="undefined"==typeof Craft?{}:Craft;for(var n in s)o[n]=s[n];s.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})}();
//# sourceMappingURL=FocalPoint.js.map