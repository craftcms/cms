!function(d){Craft.TableFieldSettings=Garnish.Base.extend({columnsTableName:null,defaultsTableName:null,columnsTableId:null,defaultsTableId:null,columnsTableInputPath:null,defaultsTableInputPath:null,defaults:null,columnSettings:null,columnsTable:null,defaultsTable:null,init:function(t,e,a,l,s){this.columnsTableName=t,this.defaultsTableName=e,this.columnsTableId=Craft.formatInputId(this.columnsTableName),this.defaultsTableId=Craft.formatInputId(this.defaultsTableName),this.columnsTableInputPath=Craft.filterArray(this.columnsTableName.split(/[\[\]]+/)),this.defaultsTableInputPath=Craft.filterArray(this.defaultsTableName.split(/[\[\]]+/)),this.defaults=l,this.columnSettings=s,this.initColumnsTable(),this.initDefaultsTable(a)},initColumnsTable:function(){this.columnsTable=new Craft.EditableTable(this.columnsTableId,this.columnsTableName,this.columnSettings,{rowIdPrefix:"col",defaultValues:{type:"singleline"},onAddRow:d.proxy(this,"onAddColumn"),onDeleteRow:d.proxy(this,"reconstructDefaultsTable")}),this.initColumnSettingInputs(this.columnsTable.$tbody),this.columnsTable.sorter.settings.onSortChange=d.proxy(this,"reconstructDefaultsTable")},initDefaultsTable:function(t){this.defaultsTable=new Craft.EditableTable(this.defaultsTableId,this.defaultsTableName,t,{rowIdPrefix:"row"})},onAddColumn:function(t){this.reconstructDefaultsTable(),this.initColumnSettingInputs(t)},initColumnSettingInputs:function(t){var e=t.find("td:first-child textarea, td:nth-child(3) textarea"),a=t.find("td:nth-child(4) select");this.addListener(e,"textchange","reconstructDefaultsTable"),this.addListener(a,"change","reconstructDefaultsTable")},reconstructDefaultsTable:function(){var t,e,a=Craft.expandPostArray(Garnish.getPostData(this.columnsTable.$tbody)),l=Craft.expandPostArray(Garnish.getPostData(this.defaultsTable.$tbody));for(t=0;t<this.columnsTableInputPath.length;t++)a=a[e=this.columnsTableInputPath[t]];for(t=0;t<this.defaultsTableInputPath.length;t++){if(void 0===l[e=this.defaultsTableInputPath[t]]){l={};break}l=l[e]}var s="<thead><tr>";for(var n in a)a.hasOwnProperty(n)&&(s+='<th scope="col">'+(a[n].heading?a[n].heading:"&nbsp;")+"</th>");s+='<th colspan="2"></th></tr></thead>';var i=d("<table/>",{id:this.defaultsTableId,class:"editable shadow-box"}).append(s),u=d("<tbody/>").appendTo(i);for(var o in l)l.hasOwnProperty(o)&&Craft.EditableTable.createRow(o,a,this.defaultsTableName,l[o]).appendTo(u);this.defaultsTable.$table.replaceWith(i),this.defaultsTable.destroy(),delete this.defaultsTable,this.initDefaultsTable(a)}})}(jQuery);
//# sourceMappingURL=TableFieldSettings.min.js.map