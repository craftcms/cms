!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(module,exports){!function($){Craft.TableFieldSettings=Garnish.Base.extend({columnsTableName:null,defaultsTableName:null,columnsData:null,columnsTableId:null,defaultsTableId:null,columnsTableInputPath:null,defaultsTableInputPath:null,defaults:null,columnSettings:null,dropdownSettingsHtml:null,dropdownSettingsCols:null,columnsTable:null,defaultsTable:null,init:function(columnsTableName,defaultsTableName,columnsData,defaults,columnSettings,dropdownSettingsHtml,dropdownSettingsCols){this.columnsTableName=columnsTableName,this.defaultsTableName=defaultsTableName,this.columnsData=columnsData,this.columnsTableId=Craft.formatInputId(this.columnsTableName),this.defaultsTableId=Craft.formatInputId(this.defaultsTableName),this.columnsTableInputPath=Craft.filterArray(this.columnsTableName.split(/[\[\]]+/)),this.defaultsTableInputPath=Craft.filterArray(this.defaultsTableName.split(/[\[\]]+/)),this.defaults=defaults,this.columnSettings=columnSettings,this.dropdownSettingsHtml=dropdownSettingsHtml,this.dropdownSettingsCols=dropdownSettingsCols,this.initColumnsTable(),this.initDefaultsTable()},initColumnsTable:function(){this.columnsTable=new ColumnTable(this,this.columnsTableId,this.columnsTableName,this.columnSettings,{rowIdPrefix:"col",defaultValues:{type:"singleline"},onAddRow:$.proxy(this,"onAddColumn"),onDeleteRow:$.proxy(this,"reconstructDefaultsTable")})},initDefaultsTable:function(){this.defaultsTable=new Craft.EditableTable(this.defaultsTableId,this.defaultsTableName,this.columnsData,{rowIdPrefix:"row"})},onAddColumn:function($tr){this.reconstructDefaultsTable(),this.initColumnSettingInputs($tr)},initColumnSettingInputs:function($container){var $textareas=$container.find("td:first-child textarea, td:nth-child(3) textarea");this.addListener($textareas,"input","reconstructDefaultsTable")},reconstructDefaultsTable:function(){this.columnsData=Craft.expandPostArray(Garnish.getPostData(this.columnsTable.$tbody));var i,key,defaults=Craft.expandPostArray(Garnish.getPostData(this.defaultsTable.$tbody));for(i=0;i<this.columnsTableInputPath.length;i++)key=this.columnsTableInputPath[i],this.columnsData=this.columnsData[key];for(var colId in this.columnsData)if(this.columnsData.hasOwnProperty(colId)&&"select"===this.columnsData[colId].type){var rowObj=this.columnsTable.$tbody.find('tr[data-id="'+colId+'"]').data("editable-table-row");this.columnsData[colId].options=rowObj.options||[]}for(i=0;i<this.defaultsTableInputPath.length;i++){if(void 0===defaults[key=this.defaultsTableInputPath[i]]){defaults={};break}defaults=defaults[key]}var theadHtml="<thead><tr>";for(var _colId in this.columnsData)this.columnsData.hasOwnProperty(_colId)&&(theadHtml+='<th scope="col">'+(this.columnsData[_colId].heading?this.columnsData[_colId].heading:"&nbsp;")+"</th>");theadHtml+='<th colspan="2"></th></tr></thead>';var $table=$("<table/>",{id:this.defaultsTableId,class:"editable fullwidth"}).append(theadHtml),$tbody=$("<tbody/>").appendTo($table);for(var rowId in defaults)defaults.hasOwnProperty(rowId)&&Craft.EditableTable.createRow(rowId,this.columnsData,this.defaultsTableName,defaults[rowId]).appendTo($tbody);this.defaultsTable.$table.replaceWith($table),this.defaultsTable.destroy(),delete this.defaultsTable,this.initDefaultsTable()}});var ColumnTable=Craft.EditableTable.extend({fieldSettings:null,init:function(fieldSettings,id,baseName,columns,settings){this.fieldSettings=fieldSettings,this.base(id,baseName,columns,settings)},initialize:function(){return!!this.base()&&(this.fieldSettings.initColumnSettingInputs(this.$tbody),this.sorter.settings.onSortChange=$.proxy(this.fieldSettings.reconstructDefaultsTable,this.fieldSettings),!0)},createRowObj:function($tr){return new ColumnTable.Row(this,$tr)}});ColumnTable.Row=Craft.EditableTable.Row.extend({$typeSelect:null,$settingsBtn:null,options:null,settingsModal:null,optionsTable:null,init:function(table,tr){this.base(table,tr),this.table.fieldSettings.columnsData[this.id]&&(this.options=this.table.fieldSettings.columnsData[this.id].options||null);var $typeCell=this.$tr.find("td:nth-child(4)"),$typeSelectContainer=$typeCell.find(".select");this.$settingsBtn=$typeCell.find(".settings"),this.$settingsBtn.length||(this.$settingsBtn=$("<a/>",{class:"settings light invisible",role:"button","data-icon":"settings"}),$("<div/>",{class:"flex flex-no-wrap"}).appendTo($typeCell).append($typeSelectContainer).append(this.$settingsBtn)),this.$typeSelect=$typeSelectContainer.find("select"),this.addListener(this.$typeSelect,"change","handleTypeChange"),this.addListener(this.$settingsBtn,"click","showSettingsModal"),this.addListener(this.$tr.closest("form"),"submit","handleFormSubmit")},handleTypeChange:function(){"select"===this.$typeSelect.val()?this.$settingsBtn.removeClass("invisible"):this.$settingsBtn.addClass("invisible"),this.table.fieldSettings.reconstructDefaultsTable()},showSettingsModal:function(ev){if(this.settingsModal)this.settingsModal.show();else{var id="dropdownsettingsmodal"+Math.floor(1e6*Math.random()),$modal=$("<div/>",{class:"modal dropdownsettingsmodal"}).appendTo(Garnish.$bod),$body=$("<div/>",{class:"body"}).appendTo($modal).html(this.table.fieldSettings.dropdownSettingsHtml.replace(/__ID__/g,id));if(this.optionsTable=new Craft.EditableTable(id,"__NAME__",this.table.fieldSettings.dropdownSettingsCols,{onAddRow:$.proxy(this,"handleOptionsRowChange"),onDeleteRow:$.proxy(this,"handleOptionsRowChange")}),this.options&&this.options.length)for(var row,i=0;i<this.options.length;i++)(row=this.optionsTable.addRow(!1)).$tr.find(".option-label textarea").val(this.options[i].label),row.$tr.find(".option-value textarea").val(this.options[i].value),row.$tr.find('.option-default input[type="checkbox"]').prop("checked",!!this.options[i].default);else this.optionsTable.addRow(!1);var $closeButton=$("<button/>",{type:"button",class:"btn submit",text:Craft.t("app","Done")}).appendTo($body);this.settingsModal=new Garnish.Modal($modal,{onHide:$.proxy(this,"handleSettingsModalHide")}),this.addListener($closeButton,"click",(function(){this.settingsModal.hide()}))}setTimeout($.proxy((function(){this.optionsTable.$tbody.find("textarea").first().trigger("focus")}),this),100)},handleOptionsRowChange:function(){this.settingsModal&&this.settingsModal.updateSizeAndPosition()},handleSettingsModalHide:function(){this.options=[];for(var $rows=this.optionsTable.$table.find("tbody tr"),i=0;i<$rows.length;i++){var $row=$rows.eq(i);this.options.push({label:$row.find(".option-label textarea").val(),value:$row.find(".option-value textarea").val(),default:$row.find(".option-default input[type=checkbox]").prop("checked")})}this.table.fieldSettings.reconstructDefaultsTable()},handleFormSubmit:function(ev){"select"===this.$typeSelect.val()&&$("<input/>",{type:"hidden",name:this.table.fieldSettings.columnsTableName+"["+this.id+"][options]",value:JSON.stringify(this.options)}).appendTo(ev.currentTarget)}})}(jQuery)}]);
//# sourceMappingURL=TableFieldSettings.min.js.map