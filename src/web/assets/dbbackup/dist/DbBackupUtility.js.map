{"version":3,"file":"DbBackupUtility.js","mappings":"YAAA,IAAWA,IAgHRC,OA/GDC,MAAMC,gBAAkBC,QAAQC,KAAKC,OAAO,CAC1CC,SAAU,KACVC,MAAO,KAEPC,KAAM,SAAUC,GACdC,KAAKH,MAAQR,EAAE,IAAMU,GACrBC,KAAKJ,SAAWP,EAAE,eAAgBW,KAAKH,OACvCG,KAAKC,QAAUZ,EAAE,kBAAmBW,KAAKH,OAEzCG,KAAKE,YAAYF,KAAKH,MAAO,SAAU,WACzC,EAEAM,SAAU,SAAUC,GAAI,IAAAC,EAAA,KACtBD,EAAGE,iBAEEN,KAAKJ,SAASW,SAAS,cACrBP,KAAKQ,YAGRR,KAAKQ,YAAYC,mBAFjBT,KAAKQ,YAAc,IAAIjB,MAAMmB,YAAYV,KAAKC,SAKhDD,KAAKQ,YAAYG,aAAaC,YAAY,UAE1CZ,KAAKQ,YAAYG,aAAaE,SAAS,QAAQA,SAC7C,CACEC,QAAS,GAEX,CACEC,SAAU,WACJ1B,EAAE,oBAAoB2B,KAAK,WAC7BzB,MAAM0B,gBACJ,OACA1B,MAAM2B,aAAa,sCACnBb,EAAKR,MAAMsB,aAEVC,MAAK,WACJf,EAAKgB,oBACLC,WAAWjB,EAAKkB,WAAWC,KAAKnB,GAAO,IACzC,IACCoB,OAAM,WACLlC,MAAMmC,GAAGC,aACPpC,MAAMqC,EACJ,MACA,+EAGJvB,EAAKkB,YAAW,EAClB,IAEFhC,MAAMsC,kBACJ,OACA,sCAECT,MAAK,SAACU,GACLzB,EAAKgB,oBACLC,WAAWjB,EAAKkB,WAAWC,KAAKnB,GAAO,IACzC,IACCoB,OAAM,SAAAM,GAAUA,EAARD,SACPzB,EAAKgB,oBACL9B,MAAMmC,GAAGC,aACPpC,MAAMqC,EACJ,MACA,+EAGJvB,EAAKkB,YAAW,EAClB,GAEN,IAIAvB,KAAKgC,UACPhC,KAAKgC,SAASC,IAAI,UAAW,GAG/BjC,KAAKJ,SAASsC,SAAS,YACvBlC,KAAKJ,SAASuC,QAAQ,QAE1B,EAEAd,kBAAmB,WAEjBrB,KAAKQ,YAAY4B,sBADL,IAEd,EAEAb,WAAY,SAAUc,GAAa,IAAAC,EAAA,KAC5BtC,KAAKgC,WACRhC,KAAKgC,SAAW3C,EAAE,4CAA4CkD,SAC5DvC,KAAKC,SAEPD,KAAKgC,SAASC,IAAI,UAAW,IAG/BjC,KAAKQ,YAAYG,aAAaE,SAC5B,CAACC,QAAS,GACV,CACE0B,SAAU,OACVzB,SAAU,gBACmB,IAAhBsB,IAA+C,IAAhBA,GACxCC,EAAKN,SAASnB,SAAS,CAACC,QAAS,GAAI,CAAC0B,SAAU,SAGlDF,EAAK1C,SAASgB,YAAY,YAC1B0B,EAAK1C,SAAS6C,OAChB,GAGN,G","sources":["webpack:///./DbBackupUtility.js"],"sourcesContent":["(function ($) {\n  Craft.DbBackupUtility = Garnish.Base.extend({\n    $trigger: null,\n    $form: null,\n\n    init: function (formId) {\n      this.$form = $('#' + formId);\n      this.$trigger = $('input.submit', this.$form);\n      this.$status = $('.utility-status', this.$form);\n\n      this.addListener(this.$form, 'submit', 'onSubmit');\n    },\n\n    onSubmit: function (ev) {\n      ev.preventDefault();\n\n      if (!this.$trigger.hasClass('disabled')) {\n        if (!this.progressBar) {\n          this.progressBar = new Craft.ProgressBar(this.$status);\n        } else {\n          this.progressBar.resetProgressBar();\n        }\n\n        this.progressBar.$progressBar.removeClass('hidden');\n\n        this.progressBar.$progressBar.velocity('stop').velocity(\n          {\n            opacity: 1,\n          },\n          {\n            complete: () => {\n              if ($('#download-backup').prop('checked')) {\n                Craft.downloadFromUrl(\n                  'POST',\n                  Craft.getActionUrl('utilities/db-backup-perform-action'),\n                  this.$form.serialize()\n                )\n                  .then(() => {\n                    this.updateProgressBar();\n                    setTimeout(this.onComplete.bind(this), 300);\n                  })\n                  .catch(() => {\n                    Craft.cp.displayError(\n                      Craft.t(\n                        'app',\n                        'There was a problem backing up your database. Please check the Craft logs.'\n                      )\n                    );\n                    this.onComplete(false);\n                  });\n              } else {\n                Craft.sendActionRequest(\n                  'POST',\n                  'utilities/db-backup-perform-action'\n                )\n                  .then((response) => {\n                    this.updateProgressBar();\n                    setTimeout(this.onComplete.bind(this), 300);\n                  })\n                  .catch(({response}) => {\n                    this.updateProgressBar();\n                    Craft.cp.displayError(\n                      Craft.t(\n                        'app',\n                        'There was a problem backing up your database. Please check the Craft logs.'\n                      )\n                    );\n                    this.onComplete(false);\n                  });\n              }\n            },\n          }\n        );\n\n        if (this.$allDone) {\n          this.$allDone.css('opacity', 0);\n        }\n\n        this.$trigger.addClass('disabled');\n        this.$trigger.trigger('blur');\n      }\n    },\n\n    updateProgressBar: function () {\n      var width = 100;\n      this.progressBar.setProgressPercentage(width);\n    },\n\n    onComplete: function (showAllDone) {\n      if (!this.$allDone) {\n        this.$allDone = $('<div class=\"alldone\" data-icon=\"done\" />').appendTo(\n          this.$status\n        );\n        this.$allDone.css('opacity', 0);\n      }\n\n      this.progressBar.$progressBar.velocity(\n        {opacity: 0},\n        {\n          duration: 'fast',\n          complete: () => {\n            if (typeof showAllDone === 'undefined' || showAllDone === true) {\n              this.$allDone.velocity({opacity: 1}, {duration: 'fast'});\n            }\n\n            this.$trigger.removeClass('disabled');\n            this.$trigger.focus();\n          },\n        }\n      );\n    },\n  });\n})(jQuery);\n"],"names":["$","jQuery","Craft","DbBackupUtility","Garnish","Base","extend","$trigger","$form","init","formId","this","$status","addListener","onSubmit","ev","_this","preventDefault","hasClass","progressBar","resetProgressBar","ProgressBar","$progressBar","removeClass","velocity","opacity","complete","prop","downloadFromUrl","getActionUrl","serialize","then","updateProgressBar","setTimeout","onComplete","bind","catch","cp","displayError","t","sendActionRequest","response","_ref","$allDone","css","addClass","trigger","setProgressPercentage","showAllDone","_this2","appendTo","duration","focus"],"sourceRoot":""}