!function(n){var s=Garnish.Base.extend({$form:null,$loginNameInput:null,$loginFields:null,$passwordPaneItem:null,$passwordInput:null,$forgotPasswordLink:null,$rememberMeCheckbox:null,$sslIcon:null,$submitBtn:null,$spinner:null,$error:null,passwordInputInterval:null,forgotPassword:!1,loading:!1,init:function(){this.$form=n("#login-form"),this.$loginNameInput=n("#loginName"),this.$loginFields=n("#login-fields"),this.$passwordPaneItem=this.$loginFields.children(),this.$passwordInput=n("#password"),this.$forgotPasswordLink=n("#forgot-password"),this.$sslIcon=n("#ssl-icon"),this.$submitBtn=n("#submit"),this.$spinner=n("#spinner"),this.$rememberMeCheckbox=n("#rememberMe"),new Craft.PasswordInput(this.$passwordInput,{onToggleInput:n.proxy(function(s){this.removeListener(this.$passwordInput,"textchange"),this.$passwordInput=s,this.addListener(this.$passwordInput,"textchange","validate")},this)}),this.addListener(this.$loginNameInput,"textchange","validate"),this.addListener(this.$passwordInput,"textchange","validate"),this.addListener(this.$forgotPasswordLink,"click","onForgetPassword"),this.addListener(this.$form,"submit","onSubmit"),this.addListener(this.$sslIcon,"mouseover",function(){this.$sslIcon.hasClass("disabled")||this.$submitBtn.addClass("hover")}),this.addListener(this.$sslIcon,"mouseout",function(){this.$sslIcon.hasClass("disabled")||this.$submitBtn.removeClass("hover")}),this.addListener(this.$sslIcon,"mousedown",function(){this.$sslIcon.hasClass("disabled")||(this.$submitBtn.addClass("active"),this.addListener(Garnish.$doc,"mouseup",function(){this.$submitBtn.removeClass("active"),this.removeListener(Garnish.$doc,"mouseup")}))}),this.passwordInputInterval=setInterval(n.proxy(this,"validate"),250),this.addListener(this.$sslIcon,"click",function(){this.$submitBtn.trigger("click")})},validate:function(){return this.$loginNameInput.val()&&(this.forgotPassword||6<=this.$passwordInput.val().length)?(this.$sslIcon.enable(),this.$submitBtn.enable(),!0):(this.$sslIcon.disable(),this.$submitBtn.disable(),!1)},onSubmit:function(s){s.preventDefault(),this.validate()&&(this.$submitBtn.addClass("active"),this.$spinner.removeClass("hidden"),this.loading=!0,this.$error&&this.$error.remove(),this.forgotPassword?this.submitForgotPassword():this.submitLogin())},submitForgotPassword:function(){var s={loginName:this.$loginNameInput.val()};Craft.postActionRequest("users/send-password-reset-email",s,n.proxy(function(s,t){"success"===t&&(s.success?new i:this.showError(s.error)),this.onSubmitResponse()},this))},submitLogin:function(){var s={loginName:this.$loginNameInput.val(),password:this.$passwordInput.val(),rememberMe:this.$rememberMeCheckbox.prop("checked")?"y":""};return Craft.postActionRequest("users/login",s,n.proxy(function(s,t){"success"===t?s.success?window.location.href=s.returnUrl:(Garnish.shake(this.$form),this.onSubmitResponse(),this.showError(s.error)):this.onSubmitResponse()},this)),!1},onSubmitResponse:function(){this.$submitBtn.removeClass("active"),this.$spinner.addClass("hidden"),this.loading=!1},showError:function(s){s||(s=Craft.t("app","An unknown error occurred.")),this.$error=n('<p class="error" style="display:none">'+s+"</p>").insertAfter(n(".buttons",this.$form)),this.$error.velocity("fadeIn")},onForgetPassword:function(s){s.preventDefault(),Garnish.isMobileBrowser()||this.$loginNameInput.trigger("focus"),this.$error&&this.$error.remove();var t=parseInt(this.$form.css("margin-top")),i=this.$loginFields.height(),e=t+Math.round(i/2);this.$form.velocity({marginTop:e},"fast"),this.$loginFields.velocity({height:24},"fast",n.proxy(function(){this.$loginFields.hide()},this)),this.$form.addClass("reset-password"),this.$submitBtn.addClass("reset-password"),this.$submitBtn.attr("value",Craft.t("app","Reset Password")),this.$submitBtn.enable(),this.$sslIcon.remove(),this.forgotPassword=!0,this.validate()}}),i=Garnish.Modal.extend({init:function(){var s=n('<div class="modal fitted email-sent"><div class="body">'+Craft.t("app","Check your email for instructions to reset your password.")+"</div></div>").appendTo(Garnish.$bod);this.base(s)},hide:function(){}});new s}(jQuery);
//# sourceMappingURL=login.min.js.map