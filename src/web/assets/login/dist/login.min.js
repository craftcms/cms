!function(s){var t=Garnish.Base.extend({$form:null,$loginNameInput:null,$loginFields:null,$passwordPaneItem:null,$passwordInput:null,$forgotPasswordLink:null,$rememberMeCheckbox:null,$sslIcon:null,$submitBtn:null,$spinner:null,$error:null,passwordInputInterval:null,forgotPassword:!1,loading:!1,init:function(){this.$form=s("#login-form"),this.$loginNameInput=s("#loginName"),this.$loginFields=s("#login-fields"),this.$passwordPaneItem=this.$loginFields.children(),this.$passwordInput=s("#password"),this.$forgotPasswordLink=s("#forgot-password"),this.$sslIcon=s("#ssl-icon"),this.$submitBtn=s("#submit"),this.$spinner=s("#spinner"),this.$rememberMeCheckbox=s("#rememberMe"),new Craft.PasswordInput(this.$passwordInput,{onToggleInput:s.proxy(function(s){this.removeListener(this.$passwordInput,"textchange"),this.$passwordInput=s,this.addListener(this.$passwordInput,"textchange","validate")},this)}),this.addListener(this.$loginNameInput,"textchange","validate"),this.addListener(this.$passwordInput,"textchange","validate"),this.addListener(this.$forgotPasswordLink,"click","onForgetPassword"),this.addListener(this.$form,"submit","onSubmit"),this.addListener(this.$sslIcon,"mouseover",function(){this.$sslIcon.hasClass("disabled")||this.$submitBtn.addClass("hover")}),this.addListener(this.$sslIcon,"mouseout",function(){this.$sslIcon.hasClass("disabled")||this.$submitBtn.removeClass("hover")}),this.addListener(this.$sslIcon,"mousedown",function(){this.$sslIcon.hasClass("disabled")||(this.$submitBtn.addClass("active"),this.addListener(Garnish.$doc,"mouseup",function(){this.$submitBtn.removeClass("active"),this.removeListener(Garnish.$doc,"mouseup")}))}),this.passwordInputInterval=setInterval(s.proxy(this,"validate"),250),this.addListener(this.$sslIcon,"click",function(){this.$submitBtn.click()})},validate:function(){return this.$loginNameInput.val()&&(this.forgotPassword||this.$passwordInput.val().length>=6)?(this.$sslIcon.enable(),this.$submitBtn.enable(),!0):(this.$sslIcon.disable(),this.$submitBtn.disable(),!1)},onSubmit:function(s){s.preventDefault(),this.validate()&&(this.$submitBtn.addClass("active"),this.$spinner.removeClass("hidden"),this.loading=!0,this.$error&&this.$error.remove(),this.forgotPassword?this.submitForgotPassword():this.submitLogin())},submitForgotPassword:function(){var t={loginName:this.$loginNameInput.val()};Craft.postActionRequest("users/send-password-reset-email",t,s.proxy(function(s,t){"success"===t&&(s.success?new i:this.showError(s.error)),this.onSubmitResponse()},this))},submitLogin:function(){var t={loginName:this.$loginNameInput.val(),password:this.$passwordInput.val(),rememberMe:this.$rememberMeCheckbox.prop("checked")?"y":""};return Craft.postActionRequest("users/login",t,s.proxy(function(s,t){"success"===t?s.success?window.location.href=s.returnUrl:(Garnish.shake(this.$form),this.onSubmitResponse(),this.showError(s.error)):this.onSubmitResponse()},this)),!1},onSubmitResponse:function(){this.$submitBtn.removeClass("active"),this.$spinner.addClass("hidden"),this.loading=!1},showError:function(t){t||(t=Craft.t("app","An unknown error occurred.")),this.$error=s('<p class="error" style="display:none">'+t+"</p>").insertAfter(s(".buttons",this.$form)),this.$error.velocity("fadeIn")},onForgetPassword:function(t){t.preventDefault(),Garnish.isMobileBrowser()||this.$loginNameInput.focus(),this.$error&&this.$error.remove();var i=parseInt(this.$form.css("margin-top")),e=this.$loginFields.height(),n=i+Math.round(e/2);this.$form.velocity({marginTop:n},"fast"),this.$loginFields.velocity({height:24},"fast",s.proxy(function(){this.$loginFields.hide()},this)),this.$form.addClass("reset-password"),this.$submitBtn.addClass("reset-password"),this.$submitBtn.attr("value",Craft.t("app","Reset Password")),this.$submitBtn.enable(),this.$sslIcon.remove(),this.forgotPassword=!0,this.validate()}}),i=Garnish.Modal.extend({init:function(){var t=s('<div class="modal fitted email-sent"><div class="body">'+Craft.t("app","Check your email for instructions to reset your password.")+"</div></div>").appendTo(Garnish.$bod);this.base(t)},hide:function(){}});new t}(jQuery);
//# sourceMappingURL=login.min.js.map