!function(i){Craft.Updater=Garnish.Base.extend({$graphic:null,$status:null,error:null,data:null,actionPrefix:null,init:function(t){this.actionPrefix=t,this.$graphic=i("#graphic"),this.$status=i("#status")},parseStatus:function(t){return"<p>"+Craft.escapeHtml(t).replace(/\n{2,}/g,"</p><p>").replace(/\n/g,"<br>").replace(/`(.*?)`/g,"<code>$1</code>")+"</p>"},showStatus:function(t){this.$status.html(this.parseStatus(t))},showError:function(t){this.$graphic.addClass("error"),this.showStatus(t)},showErrorDetails:function(t){i("<div/>",{id:"error",class:"code",html:this.parseStatus(t)}).appendTo(this.$status)},postActionRequest:function(t){var s={data:this.data};Craft.postActionRequest(this.actionPrefix+"/"+t,s,i.proxy(function(t,s,a){"success"===s?this.setState(t):this.handleFatalError(a)},this),{complete:i.noop})},setState:function(t){this.$graphic.removeClass("error"),t.data&&(this.data=t.data),t.status?this.showStatus(t.status):t.error&&(this.showError(t.error),t.errorDetails&&this.showErrorDetails(t.errorDetails)),t.nextAction?this.postActionRequest(t.nextAction):t.options?this.showOptions(t):t.finished&&this.onFinish(t.returnUrl)},showOptions:function(t){for(var s=i("<div/>",{id:"options",class:"buttons"}).appendTo(this.$status),a=0;a<t.options.length;a++){var e=t.options[a],r=i("<a/>",{class:"btn big",text:e.label}).appendTo(s);e.submit&&r.addClass("submit"),e.email?r.attr("href",this.getEmailLink(t,e)):e.url?(r.attr("href",e.url),r.attr("target","_blank")):this.addListener(r,"click",e,"onOptionSelect")}},getEmailLink:function(t,s){var a="mailto:"+s.email+"?subject="+encodeURIComponent(s.subject||"Craft update failure"),e="Describe what happened here.";return t.errorDetails&&(e+="\n\n-----------------------------------------------------------\n\n"+t.errorDetails),a+="&body="+encodeURIComponent(e)},onOptionSelect:function(t){this.setState(t.data)},onFinish:function(t){this.$graphic.addClass("success"),setTimeout(function(){window.location=t?Craft.getUrl(t):Craft.getUrl("dashboard")},750)},handleFatalError:function(t){var s=Craft.t("app","Status:")+" "+t.statusText+"\n\n"+Craft.t("app","Response:")+" "+t.responseText+"\n\n";this.setState({error:Craft.t("app","A fatal error has occurred:"),errorDetails:s,options:[{label:Craft.t("app","Troubleshoot"),url:"https://craftcms.com/guides/failed-updates"},{label:Craft.t("app","Send for help"),email:"support@craftcms.com"}]}),Craft.postActionRequest(this.actionPrefix+"/finish",{data:this.data})}})}(jQuery);
//# sourceMappingURL=Updater.min.js.map