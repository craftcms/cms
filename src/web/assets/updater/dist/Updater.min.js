!function(t){Craft.Updater=Garnish.Base.extend({$graphic:null,$status:null,error:null,data:null,init:function(s){this.$graphic=t("#graphic"),this.$status=t("#status")},parseStatus:function(t){return"<p>"+Craft.escapeHtml(t).split("\n\n").join("</p><p>")+"</p>"},showStatus:function(t){this.$status.html(this.parseStatus(t))},showError:function(t){this.$graphic.addClass("error"),this.showStatus(t)},showErrorDetails:function(s){t("<div/>",{id:"error",class:"code",html:this.parseStatus(s)}).appendTo(this.$status)},postActionRequest:function(s){var a={data:this.data};Craft.postActionRequest("updater/"+s,a,t.proxy(function(t,s,a){"success"===s?this.setState(t):this.handleFatalError(a)},this),{complete:t.noop})},setState:function(t){this.$graphic.removeClass("error"),t.data&&(this.data=t.data),t.status?this.showStatus(t.status):t.error&&(this.showError(t.error),t.errorDetails&&this.showErrorDetails(t.errorDetails)),t.nextAction?this.postActionRequest(t.nextAction):t.options?this.showOptions(t):t.finished&&this.onFinish(t.returnUrl)},showOptions:function(s){for(var a=t("<div/>",{id:"options",class:"buttons"}).appendTo(this.$status),r=0;r<s.options.length;r++){var e=s.options[r],i=t("<a/>",{class:"btn big",text:e.label}).appendTo(a);e.submit&&i.addClass("submit"),e.email?i.attr("href",this.getEmailLink(s,e)):this.addListener(i,"click",e,"onOptionSelect")}},getEmailLink:function(t,s){var a="mailto:"+s.email+"?subject="+encodeURIComponent(s.subject||"Craft update failure"),r="Describe what happened here.";return t.errorDetails&&(r+="\n\n-----------------------------------------------------------\n\n"+t.errorDetails),a+="&body="+encodeURIComponent(r)},onOptionSelect:function(t){this.setState(t.data)},onFinish:function(t){this.$graphic.addClass("success"),setTimeout(function(){window.location=t?Craft.getUrl(t):Craft.getUrl("dashboard")},750)},handleFatalError:function(t){var s=Craft.t("app","Status:")+" "+t.statusText+"\n\n"+Craft.t("app","Response:")+" "+t.responseText+"\n\n";this.setState({error:Craft.t("app","A fatal error has occurred:"),errorDetails:s,options:[{label:Craft.t("app","Send for help"),submit:!0,email:"support@craftcms.com"}]}),Craft.postActionRequest("updater/finish",{data:this.data})}})}(jQuery);
//# sourceMappingURL=Updater.min.js.map