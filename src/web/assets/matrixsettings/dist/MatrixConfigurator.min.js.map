{"version":3,"sources":["matrixsettings/src/MatrixConfigurator.js"],"names":["$","Craft","MatrixConfigurator","Garnish","Base","extend","inputNamePrefix","fieldTypeSettingsNamespace","inputIdPrefix","placeholderKey","$blockTypesColumnContainer","$fieldSettingsColumnContainer","$blockTypeItemsOuterContainer","$blockTypeItemsContainer","$fieldSettingItemsContainer","$newBlockTypeBtn","$newFieldBtn","blockTypes","blockTypeSort","totalNewBlockTypes","_cancelToken","_ignoreFailedRequest","fieldTypeInfo","children","$fieldsColumnContainer","$fieldItemsOuterContainer","setContainerHeight","this","_fieldTypeSettingsHtml","$container","$blockTypeItems","$item","newMatch","i","length","addListener","id","match","height","parseInt","axis","blockTypeSettingsModal","onSubmit","handle","applySettings","Math","max","maxColHeight","addFieldToSelectedBlockType","type","selectedBlockType","addBlockType","getBlockTypeSettingsModal","show","Promise","proxy","name","t","appendTo","BlockType","CancelToken","sendActionRequest","select","cancelToken","addField","addItems","namespace","response","BlockTypeSettingsModal","getFieldTypeSettingsHtml","resolve","reject","cancel","$nameInstructions","requestAnimationFrame","$nameInputContainer","$handleLabel","axios","source","$handleInputContainer","$handleField","token","$handleErrorList","then","handleGenerator","HandleGenerator","$nameInput","$cancelBtn","data","catch","$form","$deleteBtn","cp","displayError","Modal","$bod","shake","setContainer","hide","$body","$nameField","$nameHeading","$nameLabel","onDeleteClick","confirm","onDelete","$nameErrorList","$handleHeading","errors","$handleInstructions","$handleInput","startListening","$buttons","stopListening","$submitBtn","removeClass","onFormSubmit","ev","displayErrors","isMobileBrowser","listening","updateTarget","$errorList","trim","val","remove","addClass","$fieldItemsContainer","configurator","setTimeout","$settingsBtn","attr","$input","$fieldSettingsContainer","totalNewFields","onSortChange","$nameHiddenInput","$handleHiddenInput","fields","selectedField","fieldSort","fieldSettings","init","deselect","trigger","$nameContainer","find","insertBefore","$fieldItems","text","Field","$fieldItem","DragSort","$items","initializedFieldTypeSettings","$translationSettingsContainer","$typeSettingsContainer","blockType","fieldTypeSettingsTemplates","showSettings","$requiredCheckbox","$widthInput","selectedFieldType","$typeSelect","width","widthSlider","updateNameLabel","html","updateHandleLabel","onTypeSelectChange","setFieldType","isNew","getFieldTypeSettings","getDefaultFieldSettings","footHtml","append","$settings","fresh","initUiElements","appendHeadHtml","headHtml","appendFootHtml","SlidePicker","settingsHtml","valueLabel","getParsedFieldTypeHtml","pct","insertAfter","noop","replace","RegExp","createTextField","ui","maxlength","createTextareaField","escapeHtml","$fieldset","updateRequiredIcon","prop","fieldTypeOptions","value","updateTranslationMethodSettings","createSelectField","detach","targetPrefix","$translationKeyFormatContainer","data-id","label","class","required","createCheckboxField","checked","push","options","isMultiSite","toggle","confirmDelete","selfDestruct","jQuery"],"mappings":"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","file":"MatrixConfigurator.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    /**\n     * Matrix configurator class\n     */\n    Craft.MatrixConfigurator = Garnish.Base.extend(\n        {\n            fieldTypeInfo: null,\n\n            inputNamePrefix: null,\n            fieldTypeSettingsNamespace: null,\n            inputIdPrefix: null,\n            placeholderKey: null,\n\n            $container: null,\n\n            $blockTypesColumnContainer: null,\n            $fieldsColumnContainer: null,\n            $fieldSettingsColumnContainer: null,\n\n            $blockTypeItemsOuterContainer: null,\n            $blockTypeItemsContainer: null,\n            $fieldItemsContainer: null,\n            $fieldSettingItemsContainer: null,\n\n            $newBlockTypeBtn: null,\n            $newFieldBtn: null,\n\n            blockTypes: null,\n            selectedBlockType: null,\n            blockTypeSort: null,\n            totalNewBlockTypes: 0,\n\n            _fieldTypeSettingsHtml: null,\n            _cancelToken: null,\n            _ignoreFailedRequest: false,\n\n            init: function(fieldTypeInfo, inputNamePrefix, fieldTypeSettingsNamespace, placeholderKey) {\n                this.fieldTypeInfo = fieldTypeInfo;\n                this.inputNamePrefix = inputNamePrefix;\n                this.fieldTypeSettingsNamespace = fieldTypeSettingsNamespace;\n                this.inputIdPrefix = Craft.formatInputId(this.inputNamePrefix);\n                this.placeholderKey = placeholderKey;\n\n                this.$container = $('#' + this.inputIdPrefix + '-matrix-configurator:first .input:first');\n\n                this.$blockTypesColumnContainer = this.$container.children('.block-types').children();\n                this.$fieldsColumnContainer = this.$container.children('.mc-fields').children();\n                this.$fieldSettingsColumnContainer = this.$container.children('.mc-field-settings').children();\n\n                this.$blockTypeItemsOuterContainer = this.$blockTypesColumnContainer.children('.mc-col-items');\n                this.$blockTypeItemsContainer = this.$blockTypeItemsOuterContainer.children('.mc-blocktypes');\n                this.$fieldItemsOuterContainer = this.$fieldsColumnContainer.children('.mc-col-items');\n                this.$fieldSettingItemsContainer = this.$fieldSettingsColumnContainer.children('.mc-col-items');\n\n                this.setContainerHeight();\n\n                this.$newBlockTypeBtn = this.$blockTypeItemsOuterContainer.children('.btn');\n                this.$newFieldBtn = this.$fieldItemsOuterContainer.children('.btn');\n\n                this._fieldTypeSettingsHtml = {};\n\n                // Find the existing block types\n                this.blockTypes = {};\n\n                var $blockTypeItems = this.$blockTypeItemsContainer.children();\n\n                for (var i = 0; i < $blockTypeItems.length; i++) {\n                    var $item = $($blockTypeItems[i]),\n                        id = $item.data('id');\n\n                    this.blockTypes[id] = new BlockType(this, $item);\n\n                    // Is this a new block type?\n                    var newMatch = (typeof id === 'string' && id.match(/new(\\d+)/));\n\n                    if (newMatch && newMatch[1] > this.totalNewBlockTypes) {\n                        this.totalNewBlockTypes = parseInt(newMatch[1]);\n                    }\n                }\n\n                this.blockTypeSort = new Garnish.DragSort($blockTypeItems, {\n                    handle: '.move',\n                    axis: 'y'\n                });\n\n                this.addListener(this.$newBlockTypeBtn, 'click', 'addBlockType');\n                this.addListener(this.$newFieldBtn, 'click', 'addFieldToSelectedBlockType');\n\n                this.addListener(this.$blockTypesColumnContainer, 'resize', 'setContainerHeight');\n                this.addListener(this.$fieldsColumnContainer, 'resize', 'setContainerHeight');\n                this.addListener(this.$fieldSettingsColumnContainer, 'resize', 'setContainerHeight');\n            },\n\n            setContainerHeight: function() {\n                setTimeout($.proxy(function() {\n                    var maxColHeight = Math.max(this.$blockTypesColumnContainer.height(), this.$fieldsColumnContainer.height(), this.$fieldSettingsColumnContainer.height(), 400);\n                    this.$container.height(maxColHeight);\n                }, this), 1);\n            },\n\n            getFieldTypeInfo: function(type) {\n                for (var i = 0; i < this.fieldTypeInfo.length; i++) {\n                    if (this.fieldTypeInfo[i].type === type) {\n                        return this.fieldTypeInfo[i];\n                    }\n                }\n            },\n\n            addBlockType: function() {\n                this.getBlockTypeSettingsModal();\n\n                this.blockTypeSettingsModal.show();\n\n                this.blockTypeSettingsModal.onSubmit = $.proxy(function(name, handle) {\n                    this.totalNewBlockTypes++;\n                    var id = 'new' + this.totalNewBlockTypes;\n\n                    var $item = $(\n                        '<div class=\"matrixconfigitem mci-blocktype\" data-id=\"' + id + '\">' +\n                        '<div class=\"mci-name\">' +\n                        '<h4></h4>' +\n                        '<div class=\"smalltext light code\"></div>' +\n                        '</div>' +\n                        '<a class=\"settings icon\" title=\"' + Craft.t('app', 'Settings') + '\"></a>' +\n                        '<a class=\"move icon\" title=\"' + Craft.t('app', 'Reorder') + '\"></a>' +\n                        '<input class=\"hidden\" name=\"' + this.inputNamePrefix + '[blockTypes][' + id + '][name]\">' +\n                        '<input class=\"hidden\" name=\"' + this.inputNamePrefix + '[blockTypes][' + id + '][handle]\">' +\n                        '</div>'\n                    ).appendTo(this.$blockTypeItemsContainer);\n\n                    this.blockTypes[id] = new BlockType(this, $item);\n                    this.blockTypes[id].applySettings(name, handle);\n                    this.blockTypes[id].select();\n                    this.blockTypes[id].addField();\n\n                    this.blockTypeSort.addItems($item);\n                }, this);\n            },\n\n            addFieldToSelectedBlockType: function() {\n                if (this.selectedBlockType) {\n                    this.selectedBlockType.addField();\n                }\n            },\n\n            getBlockTypeSettingsModal: function() {\n                if (!this.blockTypeSettingsModal) {\n                    this.blockTypeSettingsModal = new BlockTypeSettingsModal();\n                }\n\n                return this.blockTypeSettingsModal;\n            },\n\n            getFieldTypeSettingsHtml: function(type) {\n                return new Promise((resolve, reject) => {\n                    if (typeof this._fieldTypeSettingsHtml[type] !== 'undefined') {\n                        resolve(this._fieldTypeSettingsHtml[type]);\n                        return;\n                    }\n\n                    // Cancel the current request\n                    if (this._cancelToken) {\n                        this._ignoreFailedRequest = true;\n                        this._cancelToken.cancel();\n                        Garnish.requestAnimationFrame(() => {\n                            this._ignoreFailedRequest = false;\n                        });\n                    }\n\n                    // Create a cancel token\n                    this._cancelToken = axios.CancelToken.source();\n\n                    Craft.sendActionRequest('POST', 'fields/render-settings', {\n                        cancelToken: this._cancelToken.token,\n                        data: {\n                            type: type,\n                            namespace: this.fieldTypeSettingsNamespace,\n                        }\n                    }).then(response => {\n                        this._fieldTypeSettingsHtml[type] = response.data;\n                        resolve(response.data);\n                    }).catch(() => {\n                        if (!this._ignoreFailedRequest) {\n                            Craft.cp.displayError(Craft.t('app', 'A server error occurred.'));\n                        }\n                        reject();\n                    });\n                });\n            },\n        });\n\n\n    /**\n     * Block type settings modal class\n     */\n    var BlockTypeSettingsModal = Garnish.Modal.extend(\n        {\n            init: function() {\n                this.base();\n\n                this.$form = $('<form class=\"modal fitted\"/>').appendTo(Garnish.$bod);\n                this.setContainer(this.$form);\n\n                this.$body = $('<div class=\"body\"/>').appendTo(this.$form);\n                this.$nameField = $('<div class=\"field\"/>').appendTo(this.$body);\n                this.$nameHeading = $('<div class=\"heading\"/>').appendTo(this.$nameField);\n                this.$nameLabel = $('<label for=\"new-block-type-name\">' + Craft.t('app', 'Name') + '</label>').appendTo(this.$nameHeading);\n                this.$nameInstructions = $('<div class=\"instructions\"><p>' + Craft.t('app', 'What this block type will be called in the control panel.') + '</p></div>').appendTo(this.$nameHeading);\n                this.$nameInputContainer = $('<div class=\"input\"/>').appendTo(this.$nameField);\n                this.$nameInput = $('<input type=\"text\" class=\"text fullwidth\" id=\"new-block-type-name\"/>').appendTo(this.$nameInputContainer);\n                this.$nameErrorList = $('<ul class=\"errors\"/>').appendTo(this.$nameInputContainer).hide();\n                this.$handleField = $('<div class=\"field\"/>').appendTo(this.$body);\n                this.$handleHeading = $('<div class=\"heading\"/>').appendTo(this.$handleField);\n                this.$handleLabel = $('<label for=\"new-block-type-handle\">' + Craft.t('app', 'Handle') + '</label>').appendTo(this.$handleHeading);\n                this.$handleInstructions = $('<div class=\"instructions\"><p>' + Craft.t('app', 'How youâ€™ll refer to this block type in the templates.') + '</p></div>').appendTo(this.$handleHeading);\n                this.$handleInputContainer = $('<div class=\"input\"/>').appendTo(this.$handleField);\n                this.$handleInput = $('<input type=\"text\" class=\"text fullwidth code\" id=\"new-block-type-handle\"/>').appendTo(this.$handleInputContainer);\n                this.$handleErrorList = $('<ul class=\"errors\"/>').appendTo(this.$handleInputContainer).hide();\n                this.$deleteBtn = $('<a class=\"error left hidden\" style=\"line-height: 30px;\">' + Craft.t('app', 'Delete') + '</a>').appendTo(this.$body);\n                this.$buttons = $('<div class=\"buttons right\" style=\"margin-top: 0;\"/>').appendTo(this.$body);\n                this.$cancelBtn = $('<div class=\"btn\">' + Craft.t('app', 'Cancel') + '</div>').appendTo(this.$buttons);\n                this.$submitBtn = $('<input type=\"submit\" class=\"btn submit\"/>').appendTo(this.$buttons);\n\n                this.handleGenerator = new Craft.HandleGenerator(this.$nameInput, this.$handleInput);\n\n                this.addListener(this.$cancelBtn, 'click', 'hide');\n                this.addListener(this.$form, 'submit', 'onFormSubmit');\n                this.addListener(this.$deleteBtn, 'click', 'onDeleteClick');\n            },\n\n            onFormSubmit: function(ev) {\n                ev.preventDefault();\n\n                // Prevent multi form submits with the return key\n                if (!this.visible) {\n                    return;\n                }\n\n                if (this.handleGenerator.listening) {\n                    // Give the handle a chance to catch up with the input\n                    this.handleGenerator.updateTarget();\n                }\n\n                // Basic validation\n                var name = Craft.trim(this.$nameInput.val()),\n                    handle = Craft.trim(this.$handleInput.val());\n\n                if (!name || !handle) {\n                    Garnish.shake(this.$form);\n                }\n                else {\n                    this.hide();\n                    this.onSubmit(name, handle);\n                }\n            },\n\n            onDeleteClick: function() {\n                if (confirm(Craft.t('app', 'Are you sure you want to delete this block type?'))) {\n                    this.hide();\n                    this.onDelete();\n                }\n            },\n\n            show: function(name, handle, errors) {\n                this.$nameInput.val(typeof name === 'string' ? name : '');\n                this.$handleInput.val(typeof handle === 'string' ? handle : '');\n\n                if (!handle) {\n                    this.handleGenerator.startListening();\n                }\n                else {\n                    this.handleGenerator.stopListening();\n                }\n\n                if (typeof name === 'undefined') {\n                    this.$deleteBtn.addClass('hidden');\n                    this.$submitBtn.val(Craft.t('app', 'Create'));\n                }\n                else {\n                    this.$deleteBtn.removeClass('hidden');\n                    this.$submitBtn.val(Craft.t('app', 'Save'));\n                }\n\n                this.displayErrors('name', (errors ? errors.name : null));\n                this.displayErrors('handle', (errors ? errors.handle : null));\n\n                if (!Garnish.isMobileBrowser()) {\n                    setTimeout($.proxy(function() {\n                        this.$nameInput.trigger('focus');\n                    }, this), 100);\n                }\n\n                this.base();\n            },\n\n            displayErrors: function(attr, errors) {\n                var $input = this['$' + attr + 'Input'],\n                    $errorList = this['$' + attr + 'ErrorList'];\n\n                $errorList.children().remove();\n\n                if (errors) {\n                    $input.addClass('error');\n                    $errorList.show();\n\n                    for (var i = 0; i < errors.length; i++) {\n                        $('<li/>').text(errors[i]).appendTo($errorList);\n                    }\n                }\n                else {\n                    $input.removeClass('error');\n                    $errorList.hide();\n                }\n            }\n        });\n\n\n    /**\n     * Block type class\n     */\n    var BlockType = Garnish.Base.extend(\n        {\n            configurator: null,\n            id: null,\n            errors: null,\n\n            inputNamePrefix: null,\n            inputIdPrefix: null,\n\n            $item: null,\n            $nameLabel: null,\n            $handleLabel: null,\n            $nameHiddenInput: null,\n            $handleHiddenInput: null,\n            $settingsBtn: null,\n            $fieldItemsContainer: null,\n            $fieldSettingsContainer: null,\n\n            fields: null,\n            selectedField: null,\n            fieldSort: null,\n            totalNewFields: 0,\n            fieldSettings: null,\n\n            init: function(configurator, $item) {\n                this.configurator = configurator;\n                this.$item = $item;\n                this.id = this.$item.data('id');\n                this.errors = this.$item.data('errors');\n\n                this.inputNamePrefix = this.configurator.inputNamePrefix + '[blockTypes][' + this.id + ']';\n                this.inputIdPrefix = this.configurator.inputIdPrefix + '-blockTypes-' + this.id;\n\n                let $nameContainer = this.$item.children('.mci-name');\n                this.$nameLabel = $nameContainer.children('h4');\n                this.$handleLabel = $nameContainer.children('.smalltext');\n                this.$nameHiddenInput = this.$item.find('input[name$=\"[name]\"]:first');\n                this.$handleHiddenInput = this.$item.find('input[name$=\"[handle]\"]:first');\n                this.$settingsBtn = this.$item.find('.settings');\n\n                // Find the field items container if it exists, otherwise create it\n                this.$fieldItemsContainer = this.configurator.$fieldItemsOuterContainer.children('[data-id=\"' + this.id + '\"]:first');\n\n                if (!this.$fieldItemsContainer.length) {\n                    this.$fieldItemsContainer = $('<div data-id=\"' + this.id + '\"/>').insertBefore(this.configurator.$newFieldBtn);\n                }\n\n                // Find the field settings container if it exists, otherwise create it\n                this.$fieldSettingsContainer = this.configurator.$fieldSettingItemsContainer.children('[data-id=\"' + this.id + '\"]:first');\n\n                if (!this.$fieldSettingsContainer.length) {\n                    this.$fieldSettingsContainer = $('<div data-id=\"' + this.id + '\"/>').appendTo(this.configurator.$fieldSettingItemsContainer);\n                }\n\n                // Find the existing fields\n                this.fields = {};\n\n                var $fieldItems = this.$fieldItemsContainer.children();\n\n                for (var i = 0; i < $fieldItems.length; i++) {\n                    var $fieldItem = $($fieldItems[i]),\n                        id = $fieldItem.data('id');\n\n                    this.fields[id] = new Field(this.configurator, this, $fieldItem);\n\n                    // Is this a new field?\n                    var newMatch = (typeof id === 'string' && id.match(/new(\\d+)/));\n\n                    if (newMatch && newMatch[1] > this.totalNewFields) {\n                        this.totalNewFields = parseInt(newMatch[1]);\n                    }\n                }\n\n                this.addListener(this.$item, 'click', 'select');\n                this.addListener(this.$settingsBtn, 'click', 'showSettings');\n\n                this.fieldSort = new Garnish.DragSort($fieldItems, {\n                    handle: '.move',\n                    axis: 'y',\n                    onSortChange: $.proxy(function() {\n                        // Adjust the field setting containers to match the new sort order\n                        for (var i = 0; i < this.fieldSort.$items.length; i++) {\n                            var $item = $(this.fieldSort.$items[i]),\n                                id = $item.data('id'),\n                                field = this.fields[id];\n\n                            field.$fieldSettingsContainer.appendTo(this.$fieldSettingsContainer);\n                        }\n                    }, this)\n                });\n            },\n\n            select: function() {\n                if (this.configurator.selectedBlockType === this) {\n                    return;\n                }\n\n                if (this.configurator.selectedBlockType) {\n                    this.configurator.selectedBlockType.deselect();\n                }\n\n                this.configurator.$fieldsColumnContainer.removeClass('hidden').trigger('resize');\n                this.$fieldItemsContainer.removeClass('hidden');\n                this.$item.addClass('sel');\n                this.configurator.selectedBlockType = this;\n            },\n\n            deselect: function() {\n                this.$item.removeClass('sel');\n                this.configurator.$fieldsColumnContainer.addClass('hidden').trigger('resize');\n                this.$fieldItemsContainer.addClass('hidden');\n                this.$fieldSettingsContainer.addClass('hidden');\n                this.configurator.selectedBlockType = null;\n\n                if (this.selectedField) {\n                    this.selectedField.deselect();\n                }\n            },\n\n            showSettings: function() {\n                var blockTypeSettingsModal = this.configurator.getBlockTypeSettingsModal();\n                blockTypeSettingsModal.show(this.$nameHiddenInput.val(), this.$handleHiddenInput.val(), this.errors);\n                blockTypeSettingsModal.onSubmit = $.proxy(this, 'applySettings');\n                blockTypeSettingsModal.onDelete = $.proxy(this, 'selfDestruct');\n            },\n\n            applySettings: function(name, handle) {\n                if (this.errors) {\n                    this.errors = null;\n                    this.$settingsBtn.removeClass('error');\n                }\n\n                this.$nameLabel.text(name);\n                this.$handleLabel.text(handle);\n                this.$nameHiddenInput.val(name);\n                this.$handleHiddenInput.val(handle);\n            },\n\n            addField: function() {\n                this.totalNewFields++;\n                var id = 'new' + this.totalNewFields;\n\n                var $item = $(\n                    '<div class=\"matrixconfigitem mci-field\" data-id=\"' + id + '\">' +\n                    '<div class=\"mci-name\">' +\n                    '<h4><em class=\"light\">' + Craft.t('app', '(blank)') + '</em></h4>' +\n                    '<div class=\"smalltext light code\"></div>' +\n                    '</div>' +\n                    '<div class=\"actions\">' +\n                    '<a class=\"move icon\" title=\"' + Craft.t('app', 'Reorder') + '\"></a>' +\n                    '</div>' +\n                    '</div>'\n                ).appendTo(this.$fieldItemsContainer);\n\n                this.fields[id] = new Field(this.configurator, this, $item);\n                this.fields[id].select();\n\n                this.fieldSort.addItems($item);\n            },\n\n            selfDestruct: function() {\n                this.deselect();\n                this.$item.remove();\n                this.$fieldItemsContainer.remove();\n                this.$fieldSettingsContainer.remove();\n\n                this.configurator.blockTypes[this.id] = null;\n                delete this.configurator.blockTypes[this.id];\n            }\n        });\n\n\n    var Field = Garnish.Base.extend(\n        {\n            configurator: null,\n            blockType: null,\n            id: null,\n\n            inputNamePrefix: null,\n            inputIdPrefix: null,\n\n            selectedFieldType: null,\n            initializedFieldTypeSettings: null,\n\n            $item: null,\n            $nameLabel: null,\n            $handleLabel: null,\n\n            $fieldSettingsContainer: null,\n            $nameInput: null,\n            $handleInput: null,\n            $requiredCheckbox: null,\n            $typeSelect: null,\n            $translationSettingsContainer: null,\n            $typeSettingsContainer: null,\n            $widthInput: null,\n            $deleteBtn: null,\n\n            init: function(configurator, blockType, $item) {\n                this.configurator = configurator;\n                this.blockType = blockType;\n                this.$item = $item;\n                this.id = this.$item.data('id');\n\n                this.inputNamePrefix = this.blockType.inputNamePrefix + '[fields][' + this.id + ']';\n                this.inputIdPrefix = this.blockType.inputIdPrefix + '-fields-' + this.id;\n\n                this.initializedFieldTypeSettings = {};\n                this.fieldTypeSettingsTemplates = {};\n\n                let $nameContainer = this.$item.children('.mci-name');\n                this.$nameLabel = $nameContainer.children('h4');\n                this.$handleLabel = $nameContainer.children('.smalltext');\n\n                // Find the field settings container if it exists, otherwise create it\n                this.$fieldSettingsContainer = this.blockType.$fieldSettingsContainer.children('[data-id=\"' + this.id + '\"]:first');\n\n                var isNew = (!this.$fieldSettingsContainer.length);\n\n                if (isNew) {\n                    this.$fieldSettingsContainer = this.getDefaultFieldSettings().appendTo(this.blockType.$fieldSettingsContainer);\n                }\n\n                this.$nameInput = $('#' + this.inputIdPrefix + '-name');\n                this.$handleInput = $('#' + this.inputIdPrefix + '-handle');\n                this.$requiredCheckbox = $('#' + this.inputIdPrefix + '-required');\n                this.$typeSelect = $('#' + this.inputIdPrefix + '-type');\n                this.$translationSettingsContainer = $('#' + this.inputIdPrefix + '-translation-settings');\n                this.$typeSettingsContainer = this.$fieldSettingsContainer.children('.mc-fieldtype-settings:first');\n                this.$widthInput = $('#' + this.inputIdPrefix + '-width');\n                this.$deleteBtn = this.$fieldSettingsContainer.children('a.delete:first');\n\n                if (isNew) {\n                    this.setFieldType('craft\\\\fields\\\\PlainText');\n                }\n                else {\n                    this.selectedFieldType = this.$typeSelect.val();\n                    this.initializedFieldTypeSettings[this.selectedFieldType] = this.$typeSettingsContainer.children();\n                }\n\n                if (!this.$handleInput.val()) {\n                    new Craft.HandleGenerator(this.$nameInput, this.$handleInput);\n                }\n\n                this.addListener(this.$item, 'click', 'select');\n                this.addListener(this.$nameInput, 'input', 'updateNameLabel');\n                this.addListener(this.$handleInput, 'input', 'updateHandleLabel');\n                this.addListener(this.$requiredCheckbox, 'change', 'updateRequiredIcon');\n                this.addListener(this.$typeSelect, 'change', 'onTypeSelectChange');\n                this.addListener(this.$deleteBtn, 'click', 'confirmDelete');\n\n                let widthSlider = new Craft.SlidePicker(this.$widthInput.val() || 100, {\n                    min: 25,\n                    max: 100,\n                    step: 25,\n                    valueLabel: width => {\n                        return Craft.t('app', '{pct} width', {pct: `${width}%`});\n                    },\n                    onChange: width => {\n                        this.$widthInput.val(width);\n                    }\n                });\n                widthSlider.$container.insertAfter($nameContainer);\n            },\n\n            select: function() {\n                if (this.blockType.selectedField === this) {\n                    return;\n                }\n\n                if (this.blockType.selectedField) {\n                    this.blockType.selectedField.deselect();\n                }\n\n                this.configurator.$fieldSettingsColumnContainer.removeClass('hidden').trigger('resize');\n                this.blockType.$fieldSettingsContainer.removeClass('hidden');\n                this.$fieldSettingsContainer.removeClass('hidden');\n                this.$item.addClass('sel');\n                this.blockType.selectedField = this;\n\n                if (!Garnish.isMobileBrowser()) {\n                    setTimeout($.proxy(function() {\n                        this.$nameInput.trigger('focus');\n                    }, this), 100);\n                }\n            },\n\n            deselect: function() {\n                this.$item.removeClass('sel');\n                this.configurator.$fieldSettingsColumnContainer.addClass('hidden').trigger('resize');\n                this.blockType.$fieldSettingsContainer.addClass('hidden');\n                this.$fieldSettingsContainer.addClass('hidden');\n                this.blockType.selectedField = null;\n            },\n\n            updateNameLabel: function() {\n                var val = this.$nameInput.val();\n                this.$nameLabel.html((val ? Craft.escapeHtml(val) : '<em class=\"light\">' + Craft.t('app', '(blank)') + '</em>'));\n            },\n\n            updateHandleLabel: function() {\n                this.$handleLabel.html(Craft.escapeHtml(this.$handleInput.val()));\n            },\n\n            updateRequiredIcon: function() {\n                if (this.$requiredCheckbox.prop('checked')) {\n                    this.$nameLabel.addClass('mci-required');\n                }\n                else {\n                    this.$nameLabel.removeClass('mci-required');\n                }\n            },\n\n            onTypeSelectChange: function() {\n                this.setFieldType(this.$typeSelect.val());\n            },\n\n            setFieldType: function(type) {\n                // Update the Translation Method settings\n                Craft.updateTranslationMethodSettings(type, this.$translationSettingsContainer);\n\n                if (this.selectedFieldType) {\n                    this.initializedFieldTypeSettings[this.selectedFieldType].detach();\n                }\n\n                this.selectedFieldType = type;\n                this.$typeSelect.val(type);\n\n                // Show a spinner\n                this.$typeSettingsContainer.html('<div class=\"zilch\"><div class=\"spinner\"></div></div>');\n\n                this.getFieldTypeSettings(type).then(({fresh, $settings, headHtml, footHtml}) => {\n                    this.$typeSettingsContainer.html('').append($settings);\n                    if (fresh) {\n                        Craft.initUiElements($settings);\n                        Craft.appendHeadHtml(headHtml);\n                        Craft.appendFootHtml(footHtml);\n                    }\n\n                    // In case Firefox was sleeping on the job\n                    this.$typeSettingsContainer.trigger('resize');\n                }).catch(() => {\n                    this.$typeSettingsContainer.html('');\n                });\n            },\n\n            getFieldTypeSettings: function(type) {\n                return new Promise((resolve, reject) => {\n                    if (typeof this.initializedFieldTypeSettings[type] !== 'undefined') {\n                        resolve({\n                            fresh: false,\n                            $settings: this.initializedFieldTypeSettings[type],\n                        });\n                        return;\n                    }\n\n                    this.configurator.getFieldTypeSettingsHtml(type).then(({settingsHtml, headHtml, footHtml}) => {\n                        settingsHtml = this.getParsedFieldTypeHtml(settingsHtml);\n                        headHtml = this.getParsedFieldTypeHtml(headHtml);\n                        footHtml = this.getParsedFieldTypeHtml(footHtml);\n                        let $settings = $('<div/>').html(settingsHtml);\n                        this.initializedFieldTypeSettings[type] = $settings;\n                        resolve({\n                            fresh: true,\n                            $settings: $settings,\n                            headHtml: headHtml,\n                            footHtml: footHtml,\n                        });\n                    }).catch($.noop);\n                });\n            },\n\n            getParsedFieldTypeHtml: function(html) {\n                if (typeof html === 'string') {\n                    html = html.replace(new RegExp(`__BLOCK_TYPE_${this.configurator.placeholderKey}__`, 'g'), this.blockType.id);\n                    html = html.replace(new RegExp(`__FIELD_${this.configurator.placeholderKey}__`, 'g'), this.id);\n                }\n                else {\n                    html = '';\n                }\n\n                return html;\n            },\n\n            getDefaultFieldSettings: function() {\n                var $container = $('<div/>', {\n                    'data-id': this.id\n                });\n\n                Craft.ui.createTextField({\n                    label: Craft.t('app', 'Name'),\n                    id: this.inputIdPrefix + '-name',\n                    name: this.inputNamePrefix + '[name]'\n                }).appendTo($container);\n\n                Craft.ui.createTextField({\n                    label: Craft.t('app', 'Handle'),\n                    id: this.inputIdPrefix + '-handle',\n                    'class': 'code',\n                    name: this.inputNamePrefix + '[handle]',\n                    maxlength: 64,\n                    required: true\n                }).appendTo($container);\n\n                Craft.ui.createTextareaField({\n                    label: Craft.t('app', 'Instructions'),\n                    id: this.inputIdPrefix + '-instructions',\n                    'class': 'nicetext',\n                    name: this.inputNamePrefix + '[instructions]'\n                }).appendTo($container);\n\n                let $fieldset = $('<fieldset/>').appendTo($container);\n\n                Craft.ui.createCheckboxField({\n                    label: Craft.t('app', 'This field is required'),\n                    id: this.inputIdPrefix + '-required',\n                    name: this.inputNamePrefix + '[required]'\n                }).appendTo($fieldset);\n\n                Craft.ui.createCheckboxField({\n                    label: Craft.t('app', 'Use this fieldâ€™s values as search keywords'),\n                    id: this.inputIdPrefix + '-searchable',\n                    name: this.inputNamePrefix + '[searchable]',\n                    checked: false,\n                }).appendTo($fieldset);\n\n                var fieldTypeOptions = [];\n\n                for (var i = 0; i < this.configurator.fieldTypeInfo.length; i++) {\n                    fieldTypeOptions.push({\n                        value: this.configurator.fieldTypeInfo[i].type,\n                        label: this.configurator.fieldTypeInfo[i].name\n                    });\n                }\n\n                Craft.ui.createSelectField({\n                    label: Craft.t('app', 'Field Type'),\n                    id: this.inputIdPrefix + '-type',\n                    name: this.inputNamePrefix + '[type]',\n                    options: fieldTypeOptions,\n                    value: 'craft\\\\fields\\\\PlainText'\n                }).appendTo($container);\n\n                if (Craft.isMultiSite) {\n                    var $translationSettingsContainer = $('<div/>', {\n                        id: this.inputIdPrefix + '-translation-settings'\n                    }).appendTo($container);\n\n                    Craft.ui.createSelectField({\n                        label: Craft.t('app', 'Translation Method'),\n                        id: this.inputIdPrefix + '-translation-method',\n                        name: this.inputNamePrefix + '[translationMethod]',\n                        options: [],\n                        value: 'none',\n                        toggle: true,\n                        targetPrefix: this.inputIdPrefix + '-translation-method-'\n                    }).appendTo($translationSettingsContainer);\n\n                    var $translationKeyFormatContainer = $('<div/>', {\n                        id: this.inputIdPrefix + '-translation-method-custom',\n                        'class': 'hidden'\n                    }).appendTo($translationSettingsContainer);\n\n                    Craft.ui.createTextField({\n                        label: Craft.t('app', 'Translation Key Format'),\n                        id: this.inputIdPrefix + '-translation-key-format',\n                        name: this.inputNamePrefix + '[translationKeyFormat]'\n                    }).appendTo($translationKeyFormatContainer);\n                }\n\n                $('<hr/>').appendTo($container);\n\n                $('<div/>', {\n                    'class': 'mc-fieldtype-settings'\n                }).appendTo($container);\n\n                $('<input/>', {\n                    type: 'hidden',\n                    id: this.inputIdPrefix + '-width',\n                    name: this.inputNamePrefix + '[width]',\n                    value: '100',\n                }).appendTo($container);\n\n                $('<hr/>').appendTo($container);\n\n                $('<a/>', {\n                    'class': 'error delete',\n                    text: Craft.t('app', 'Delete')\n                }).appendTo($container);\n\n                return $container;\n            },\n\n            confirmDelete: function() {\n                if (confirm(Craft.t('app', 'Are you sure you want to delete this field?'))) {\n                    this.selfDestruct();\n                }\n            },\n\n            selfDestruct: function() {\n                this.deselect();\n                this.$item.remove();\n                this.$fieldSettingsContainer.remove();\n\n                this.blockType.fields[this.id] = null;\n                delete this.blockType.fields[this.id];\n            }\n        });\n})(jQuery);\n"]}