!function(t){Craft.EntryDraftEditor=Garnish.Base.extend({$revisionBtn:null,$editBtn:null,$nameInput:null,$saveBtn:null,$spinner:null,draftId:null,draftName:null,draftNotes:null,hud:null,loading:!1,init:function(s,e,n){this.draftId=s,this.draftName=e,this.draftNotes=n,this.$revisionBtn=t("#revision-btn"),this.$editBtn=t("#editdraft-btn"),this.addListener(this.$editBtn,"click","showHud")},showHud:function(){if(this.hud)this.hud.show();else{var s,e,n=t("<div/>");s=t('<div class="field"><div class="heading"><label for="draft-name">'+Craft.t("app","Draft Name")+"</label></div></div>").appendTo(n),e=t('<div class="input"/>').appendTo(s),this.$nameInput=t('<input type="text" class="text fullwidth" id="draft-name"/>').appendTo(e).val(this.draftName),s=t('<div class="field"><div class="heading"><label for="draft-notes">'+Craft.t("app","Notes")+"</label></div></div>").appendTo(n),e=t('<div class="input"/>').appendTo(s),this.$notesInput=t('<textarea class="text fullwidth" id="draft-notes" rows="2"/>').appendTo(e).val(this.draftNotes);var i=t('<div class="hud-footer"/>').appendTo(n),a=t('<div class="buttons right"/>').appendTo(i);this.$saveBtn=t('<input type="submit" class="btn submit disabled" value="'+Craft.t("app","Save")+'"/>').appendTo(a),this.$spinner=t('<div class="spinner hidden"/>').appendTo(a),this.hud=new Garnish.HUD(this.$editBtn,n,{onSubmit:t.proxy(this,"save")}),new Garnish.NiceText(this.$notesInput),this.addListener(this.$notesInput,"keydown","onNotesKeydown"),this.addListener(this.$nameInput,"textchange","checkValues"),this.addListener(this.$notesInput,"textchange","checkValues"),this.hud.on("show",t.proxy(this,"onHudShow")),this.hud.on("hide",t.proxy(this,"onHudHide")),this.hud.on("escape",t.proxy(this,"onHudEscape")),this.onHudShow()}Garnish.isMobileBrowser(!0)||this.$nameInput.focus()},onHudShow:function(){this.$editBtn.addClass("active")},onHudHide:function(){this.$editBtn.removeClass("active")},onHudEscape:function(){this.$nameInput.val(this.draftName)},onNotesKeydown:function(t){t.keyCode===Garnish.RETURN_KEY&&(t.preventDefault(),this.hud.submit())},hasAnythingChanged:function(){return this.$nameInput.val()!==this.draftName||this.$notesInput.val()!==this.draftNotes},checkValues:function(){return this.$nameInput.val()&&this.hasAnythingChanged()?(this.$saveBtn.removeClass("disabled"),!0):(this.$saveBtn.addClass("disabled"),!1)},save:function(){if(!this.loading)if(this.checkValues()){this.loading=!0,this.$saveBtn.addClass("active"),this.$spinner.removeClass("hidden");var s={draftId:this.draftId,name:this.$nameInput.val(),notes:this.$notesInput.val()};Craft.postActionRequest("entry-revisions/update-draft-meta",s,t.proxy(function(t,e){this.loading=!1,this.$saveBtn.removeClass("active"),this.$spinner.addClass("hidden"),"success"===e&&(t.success?(this.$revisionBtn.text(s.name),this.$revisionBtn.data("menubtn").menu.$options.filter(".sel").text(s.name),this.draftName=s.name,this.draftNotes=s.notes,this.checkValues(),this.hud.hide()):this.shakeHud())},this))}else this.shakeHud()},shakeHud:function(){Garnish.shake(this.hud.$hud)}})}(jQuery);
//# sourceMappingURL=EntryDraftEditor.min.js.map