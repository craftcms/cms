!function(e){Craft.UpdatesUtility=Garnish.Base.extend({$body:null,totalAvailableUpdates:0,criticalUpdateAvailable:!1,showUpdateAllBtn:!0,updates:null,init:function(){this.$body=e("#content");var t=e("#graphic"),a=e("#status");this.updates=[];var s={forceRefresh:!0,includeDetails:!0};Craft.postActionRequest("app/check-for-updates",s,e.proxy(function(s,n){if("success"!==n||s.error){var i=Craft.t("app","An unknown error occurred.");s.errors&&s.errors.length?i=s.errors[0]:s.error&&(i=s.error),t.addClass("error"),a.text(i)}else{if(s.updates.cms&&this.processUpdate(s.updates.cms,!1),s.updates.plugins&&s.updates.plugins.length)for(var l=0;l<s.updates.plugins.length;l++)this.processUpdate(s.updates.plugins[l],!0);if(this.totalAvailableUpdates){t.remove(),a.remove();var r;r=1===this.totalAvailableUpdates?Craft.t("app","1 Available Update"):Craft.t("app","{num} Available Updates",{num:this.totalAvailableUpdates}),e("#page-title").find("h1").text(r),this.showUpdateAllBtn&&this.updates.length>1&&this.createUpdateForm(Craft.t("app","Update all"),this.updates).insertAfter(e("#header").children("h1"))}else t.addClass("success"),a.text(Craft.t("app","Youâ€™re all up-to-date!"))}},this))},processUpdate:function(e,a){(e.releases.length||"expired"===e.status)&&(this.totalAvailableUpdates++,this.updates.push(new t(this,e,a)))},createUpdateForm:function(t,a){var s=e("<form/>",{method:"post"});s.append(Craft.getCsrfInput()),s.append(e("<input/>",{type:"hidden",name:"action",value:"updater"})),s.append(e("<input/>",{type:"hidden",name:"return",value:"utilities/updates"}));for(var n=0;n<a.length;n++)s.append(e("<input/>",{type:"hidden",name:"install["+a[n].updateInfo.handle+"]",value:a[n].updateInfo.latestAllowedVersion}));return s.append(e("<input/>",{type:"submit",value:t,class:"btn submit"})),s}});var t=Garnish.Base.extend({updateInfo:null,isPlugin:null,latestVersion:null,$container:null,$header:null,$contents:null,$releaseContainer:null,$showAllLink:null,licenseHud:null,$licenseSubmitBtn:null,licenseSubmitAction:null,init:function(t,a,s){this.updatesPage=t,this.updateInfo=a,this.isPlugin=s,this.createPane(),this.initReleases(),this.createHeading(),this.createCta(),"eligible"!==this.updateInfo.status&&(e('<blockquote class="note ineligible"><p>'+this.updateInfo.statusText+"</p>").insertBefore(this.$releaseContainer),"expired"!==this.updateInfo.status&&null!==this.updateInfo.latestAllowedVersion||(this.updatesPage.showUpdateAllBtn=!1))},canUpdateToLatest:function(){return this.updateInfo.releases.length&&this.updateInfo.latestAllowedVersion===this.updateInfo.releases[0].version},createPane:function(){this.$container=e('<div class="update"/>').appendTo(this.updatesPage.$body),this.$header=e('<div class="update-header"/>').appendTo(this.$container),this.$contents=e('<div class="readable"/>').appendTo(this.$container),this.$releaseContainer=e('<div class="releases"/>').appendTo(this.$contents)},createHeading:function(){e('<div class="readable left"/>').appendTo(this.$header).append(e("<h1/>",{text:this.updateInfo.name}))},createCta:function(){if(null!==this.latestAllowedVersion){var t=e('<div class="buttons right"/>').appendTo(this.$header);void 0!==this.updateInfo.ctaUrl?e("<a/>",{class:"btn submit",text:this.updateInfo.ctaText,href:this.updateInfo.ctaUrl}).appendTo(t):this.updatesPage.createUpdateForm(this.updateInfo.ctaText,[this]).appendTo(t)}},initReleases:function(){for(var e=0;e<this.updateInfo.releases.length;e++)null===this.latestAllowedVersion&&this.updateInfo.releases[e].allowed&&(this.latestAllowedVersion=this.updateInfo.releases[e].version),new a(this,this.updateInfo.releases[e])}}),a=Garnish.Base.extend({update:null,releaseInfo:null,notesId:null,$container:null,$headingContainer:null,init:function(e,t){this.update=e,this.releaseInfo=t,this.notesId="notes-"+Math.floor(1e6*Math.random()),this.createContainer(),this.createHeading(),this.releaseInfo.notes&&(this.createReleaseNotes(),new Craft.FieldToggle(this.$headingContainer))},createContainer:function(){this.$container=e('<div class="pane release"/>').appendTo(this.update.$releaseContainer),this.releaseInfo.critical&&this.$container.addClass("critical")},createHeading:function(){this.releaseInfo.notes?this.$headingContainer=e("<a/>",{class:"release-info fieldtoggle","data-target":this.notesId}):this.$headingContainer=e("<div/>",{class:"release-info"}),this.$headingContainer.appendTo(this.$container),e("<h2/>",{text:this.releaseInfo.version}).appendTo(this.$headingContainer),this.releaseInfo.critical&&e("<strong/>",{class:"critical",text:Craft.t("app","Critical")}).appendTo(this.$headingContainer),this.releaseInfo.date&&e("<span/>",{class:"date",text:Craft.formatDate(this.releaseInfo.date)}).appendTo(this.$headingContainer)},createReleaseNotes:function(){var t=e("<div/>",{id:this.notesId}).appendTo(this.$container).append(e("<div/>",{class:"release-notes"}).html(this.releaseInfo.notes));this.releaseInfo.critical||t.find("blockquote").length?this.$headingContainer.addClass("expanded"):t.addClass("hidden")}},{maxInitialUpdateHeight:500})}(jQuery);
//# sourceMappingURL=UpdatesUtility.min.js.map