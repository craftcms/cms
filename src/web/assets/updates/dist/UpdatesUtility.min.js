!function(e){Craft.UpdatesUtility=Garnish.Base.extend({$body:null,totalAvailableUpdates:0,criticalUpdateAvailable:!1,allowUpdates:null,installableUpdates:null,init:function(){this.$body=e("#content");var t=e("#graphic"),a=e("#status");this.installableUpdates=[];Craft.cp.checkForUpdates(!0,!0,function(n){if(this.allowUpdates=n.allowUpdates,n.updates.cms&&this.processUpdate(n.updates.cms,!1),n.updates.plugins&&n.updates.plugins.length)for(var s=0;s<n.updates.plugins.length;s++)this.processUpdate(n.updates.plugins[s],!0);if(this.totalAvailableUpdates){t.remove(),a.remove();var i=Craft.t("app","{num, number} {num, plural, =1{Available Update} other{Available Updates}}",{num:this.totalAvailableUpdates});e("#header h1").text(i),this.allowUpdates&&this.installableUpdates.length>1&&this.createUpdateForm(Craft.t("app","Update all"),this.installableUpdates).insertAfter(e("#header > .flex:last"))}else t.addClass("success"),a.text(Craft.t("app","Youâ€™re all up-to-date!"))}.bind(this))},processUpdate:function(e,a){if(e.releases.length){this.totalAvailableUpdates++;var n=new t(this,e,a);n.installable&&this.installableUpdates.push(n)}},createUpdateForm:function(t,a){var n=e("<form/>",{method:"post"});n.append(Craft.getCsrfInput()),n.append(e("<input/>",{type:"hidden",name:"action",value:"updater"})),n.append(e("<input/>",{type:"hidden",name:"return",value:"utilities/updates"}));for(var s=0;s<a.length;s++)n.append(e("<input/>",{type:"hidden",name:"install["+a[s].updateInfo.handle+"]",value:a[s].updateInfo.latestVersion})),n.append(e("<input/>",{type:"hidden",name:"packageNames["+a[s].updateInfo.handle+"]",value:a[s].updateInfo.packageName}));return n.append(e("<input/>",{type:"submit",value:t,class:"btn submit"})),n}});var t=Garnish.Base.extend({updateInfo:null,isPlugin:null,installable:!0,$container:null,$header:null,$contents:null,$releaseContainer:null,$showAllLink:null,licenseHud:null,$licenseSubmitBtn:null,licenseSubmitAction:null,init:function(t,a,n){this.updatesPage=t,this.updateInfo=a,this.isPlugin=n,this.createPane(),this.initReleases(),this.createHeading(),this.createCta(),"eligible"!==this.updateInfo.status&&(e('<blockquote class="note ineligible"><p>'+this.updateInfo.statusText+"</p></blockquote>").insertBefore(this.$releaseContainer),"expired"!==this.updateInfo.status&&null!==this.updateInfo.latestVersion||(this.installable=!1))},createPane:function(){this.$container=e('<div class="update"/>').appendTo(this.updatesPage.$body),this.$header=e('<div class="update-header"/>').appendTo(this.$container),this.$contents=e('<div class="readable"/>').appendTo(this.$container),this.$releaseContainer=e('<div class="releases"/>').appendTo(this.$contents)},createHeading:function(){e('<div class="readable left"/>').appendTo(this.$header).append(e("<h1/>",{text:this.updateInfo.name}))},createCta:function(){if(this.updatesPage.allowUpdates&&this.updateInfo.latestVersion){var t=e('<div class="buttons right"/>').appendTo(this.$header);void 0!==this.updateInfo.ctaUrl?e("<a/>",{class:"btn submit",text:this.updateInfo.ctaText,href:this.updateInfo.ctaUrl}).appendTo(t):this.updatesPage.createUpdateForm(this.updateInfo.ctaText,[this]).appendTo(t)}},initReleases:function(){for(var e=0;e<this.updateInfo.releases.length;e++)new a(this,this.updateInfo.releases[e])}}),a=Garnish.Base.extend({update:null,releaseInfo:null,notesId:null,$container:null,$headingContainer:null,init:function(e,t){this.update=e,this.releaseInfo=t,this.notesId="notes-"+Math.floor(1e6*Math.random()),this.createContainer(),this.createHeading(),this.releaseInfo.notes&&(this.createReleaseNotes(),new Craft.FieldToggle(this.$headingContainer))},createContainer:function(){this.$container=e('<div class="pane release"/>').appendTo(this.update.$releaseContainer),this.releaseInfo.critical&&this.$container.addClass("critical")},createHeading:function(){this.releaseInfo.notes?this.$headingContainer=e("<a/>",{class:"release-info fieldtoggle","data-target":this.notesId}):this.$headingContainer=e("<div/>",{class:"release-info"}),this.$headingContainer.appendTo(this.$container),e("<h2/>",{text:this.releaseInfo.version}).appendTo(this.$headingContainer),this.releaseInfo.critical&&e("<strong/>",{class:"critical",text:Craft.t("app","Critical")}).appendTo(this.$headingContainer),this.releaseInfo.date&&e("<span/>",{class:"date",text:Craft.formatDate(this.releaseInfo.date)}).appendTo(this.$headingContainer)},createReleaseNotes:function(){var t=e("<div/>",{id:this.notesId}).appendTo(this.$container).append(e("<div/>",{class:"release-notes"}).html(this.releaseInfo.notes));this.releaseInfo.critical||t.find("blockquote").length?this.$headingContainer.addClass("expanded"):t.addClass("hidden")}},{maxInitialUpdateHeight:500})}(jQuery);
//# sourceMappingURL=UpdatesUtility.min.js.map