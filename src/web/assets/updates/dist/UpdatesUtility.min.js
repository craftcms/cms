!function(r){Craft.UpdatesUtility=Garnish.Base.extend({$body:null,totalAvailableUpdates:0,criticalUpdateAvailable:!1,allowUpdates:null,showUpdateAllBtn:!0,updates:null,init:function(){this.$body=r("#content");var i=r("#graphic"),l=r("#status");this.updates=[];Craft.postActionRequest("app/check-for-updates",{forceRefresh:!0,includeDetails:!0},r.proxy(function(e,t){if("success"!==t||e.error){var a=Craft.t("app","An unknown error occurred.");e.errors&&e.errors.length?a=e.errors[0]:e.error&&(a=e.error),i.addClass("error"),l.text(a)}else{if(this.allowUpdates=e.allowUpdates,e.updates.cms&&this.processUpdate(e.updates.cms,!1),e.updates.plugins&&e.updates.plugins.length)for(var s=0;s<e.updates.plugins.length;s++)this.processUpdate(e.updates.plugins[s],!0);var n;if(this.totalAvailableUpdates)i.remove(),l.remove(),n=1===this.totalAvailableUpdates?Craft.t("app","1 Available Update"):Craft.t("app","{num} Available Updates",{num:this.totalAvailableUpdates}),r("#page-title").find("h1").text(n),this.allowUpdates&&this.showUpdateAllBtn&&1<this.updates.length&&this.createUpdateForm(Craft.t("app","Update all"),this.updates).insertAfter(r("#header").children("h1"));else i.addClass("success"),l.text(Craft.t("app","Youâ€™re all up-to-date!"))}},this))},processUpdate:function(e,t){(e.releases.length||"expired"===e.status)&&(this.totalAvailableUpdates++,this.updates.push(new a(this,e,t)))},createUpdateForm:function(e,t){var a=r("<form/>",{method:"post"});a.append(Craft.getCsrfInput()),a.append(r("<input/>",{type:"hidden",name:"action",value:"updater"})),a.append(r("<input/>",{type:"hidden",name:"return",value:"utilities/updates"}));for(var s=0;s<t.length;s++)a.append(r("<input/>",{type:"hidden",name:"install["+t[s].updateInfo.handle+"]",value:t[s].updateInfo.latestVersion}));return a.append(r("<input/>",{type:"submit",value:e,class:"btn submit"})),a}});var a=Garnish.Base.extend({updateInfo:null,isPlugin:null,$container:null,$header:null,$contents:null,$releaseContainer:null,$showAllLink:null,licenseHud:null,$licenseSubmitBtn:null,licenseSubmitAction:null,init:function(e,t,a){this.updatesPage=e,this.updateInfo=t,this.isPlugin=a,this.createPane(),this.initReleases(),this.createHeading(),this.createCta(),"eligible"!==this.updateInfo.status&&(r('<blockquote class="note ineligible"><p>'+this.updateInfo.statusText+"</p>").insertBefore(this.$releaseContainer),"expired"!==this.updateInfo.status&&null!==this.updateInfo.latestVersion||(this.updatesPage.showUpdateAllBtn=!1))},createPane:function(){this.$container=r('<div class="update"/>').appendTo(this.updatesPage.$body),this.$header=r('<div class="update-header"/>').appendTo(this.$container),this.$contents=r('<div class="readable"/>').appendTo(this.$container),this.$releaseContainer=r('<div class="releases"/>').appendTo(this.$contents)},createHeading:function(){r('<div class="readable left"/>').appendTo(this.$header).append(r("<h1/>",{text:this.updateInfo.name}))},createCta:function(){if(this.updatesPage.allowUpdates&&this.updateInfo.latestVersion){var e=r('<div class="buttons right"/>').appendTo(this.$header);void 0!==this.updateInfo.ctaUrl?r("<a/>",{class:"btn submit",text:this.updateInfo.ctaText,href:this.updateInfo.ctaUrl}).appendTo(e):this.updatesPage.createUpdateForm(this.updateInfo.ctaText,[this]).appendTo(e)}},initReleases:function(){for(var e=0;e<this.updateInfo.releases.length;e++)new t(this,this.updateInfo.releases[e])}}),t=Garnish.Base.extend({update:null,releaseInfo:null,notesId:null,$container:null,$headingContainer:null,init:function(e,t){this.update=e,this.releaseInfo=t,this.notesId="notes-"+Math.floor(1e6*Math.random()),this.createContainer(),this.createHeading(),this.releaseInfo.notes&&(this.createReleaseNotes(),new Craft.FieldToggle(this.$headingContainer))},createContainer:function(){this.$container=r('<div class="pane release"/>').appendTo(this.update.$releaseContainer),this.releaseInfo.critical&&this.$container.addClass("critical")},createHeading:function(){this.releaseInfo.notes?this.$headingContainer=r("<a/>",{class:"release-info fieldtoggle","data-target":this.notesId}):this.$headingContainer=r("<div/>",{class:"release-info"}),this.$headingContainer.appendTo(this.$container),r("<h2/>",{text:this.releaseInfo.version}).appendTo(this.$headingContainer),this.releaseInfo.critical&&r("<strong/>",{class:"critical",text:Craft.t("app","Critical")}).appendTo(this.$headingContainer),this.releaseInfo.date&&r("<span/>",{class:"date",text:Craft.formatDate(this.releaseInfo.date)}).appendTo(this.$headingContainer)},createReleaseNotes:function(){var e=r("<div/>",{id:this.notesId}).appendTo(this.$container).append(r("<div/>",{class:"release-notes"}).html(this.releaseInfo.notes));this.releaseInfo.critical||e.find("blockquote").length?this.$headingContainer.addClass("expanded"):e.addClass("hidden")}},{maxInitialUpdateHeight:500})}(jQuery);
//# sourceMappingURL=UpdatesUtility.min.js.map