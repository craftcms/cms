!function(i){Craft.UpdatesUtility=Garnish.Base.extend({$body:null,totalAvailableUpdates:0,criticalUpdateAvailable:!1,allowUpdates:null,installableUpdates:null,init:function(){this.$body=i("#content");var n=i("#graphic"),s=i("#status");this.installableUpdates=[];Craft.cp.checkForUpdates(!0,!0,function(e){if(this.allowUpdates=e.allowUpdates,e.updates.cms&&this.processUpdate(e.updates.cms,!1),e.updates.plugins&&e.updates.plugins.length)for(var t=0;t<e.updates.plugins.length;t++)this.processUpdate(e.updates.plugins[t],!0);var a;this.totalAvailableUpdates?(n.remove(),s.remove(),a=1===this.totalAvailableUpdates?Craft.t("app","1 Available Update"):Craft.t("app","{num} Available Updates",{num:this.totalAvailableUpdates}),i("#header h1").text(a),this.allowUpdates&&1<this.installableUpdates.length&&this.createUpdateForm(Craft.t("app","Update all"),this.installableUpdates).insertAfter(i("#header > .flex:last"))):(n.addClass("success"),s.text(Craft.t("app","Youâ€™re all up-to-date!")))}.bind(this))},processUpdate:function(e,t){if(e.releases.length){this.totalAvailableUpdates++;var a=new n(this,e,t);a.installable&&this.installableUpdates.push(a)}},createUpdateForm:function(e,t){var a=i("<form/>",{method:"post"});a.append(Craft.getCsrfInput()),a.append(i("<input/>",{type:"hidden",name:"action",value:"updater"})),a.append(i("<input/>",{type:"hidden",name:"return",value:"utilities/updates"}));for(var n=0;n<t.length;n++)a.append(i("<input/>",{type:"hidden",name:"install["+t[n].updateInfo.handle+"]",value:t[n].updateInfo.latestVersion})),a.append(i("<input/>",{type:"hidden",name:"packageNames["+t[n].updateInfo.handle+"]",value:t[n].updateInfo.packageName}));return a.append(i("<input/>",{type:"submit",value:e,class:"btn submit"})),a}});var n=Garnish.Base.extend({updateInfo:null,isPlugin:null,installable:!0,$container:null,$header:null,$contents:null,$releaseContainer:null,$showAllLink:null,licenseHud:null,$licenseSubmitBtn:null,licenseSubmitAction:null,init:function(e,t,a){this.updatesPage=e,this.updateInfo=t,this.isPlugin=a,this.createPane(),this.initReleases(),this.createHeading(),this.createCta(),"eligible"!==this.updateInfo.status&&(i('<blockquote class="note ineligible"><p>'+this.updateInfo.statusText+"</p></blockquote>").insertBefore(this.$releaseContainer),"expired"!==this.updateInfo.status&&null!==this.updateInfo.latestVersion||(this.installable=!1))},createPane:function(){this.$container=i('<div class="update"/>').appendTo(this.updatesPage.$body),this.$header=i('<div class="update-header"/>').appendTo(this.$container),this.$contents=i('<div class="readable"/>').appendTo(this.$container),this.$releaseContainer=i('<div class="releases"/>').appendTo(this.$contents)},createHeading:function(){i('<div class="readable left"/>').appendTo(this.$header).append(i("<h1/>",{text:this.updateInfo.name}))},createCta:function(){if(this.updatesPage.allowUpdates&&this.updateInfo.latestVersion){var e=i('<div class="buttons right"/>').appendTo(this.$header);void 0!==this.updateInfo.ctaUrl?i("<a/>",{class:"btn submit",text:this.updateInfo.ctaText,href:this.updateInfo.ctaUrl}).appendTo(e):this.updatesPage.createUpdateForm(this.updateInfo.ctaText,[this]).appendTo(e)}},initReleases:function(){for(var e=0;e<this.updateInfo.releases.length;e++)new t(this,this.updateInfo.releases[e])}}),t=Garnish.Base.extend({update:null,releaseInfo:null,notesId:null,$container:null,$headingContainer:null,init:function(e,t){this.update=e,this.releaseInfo=t,this.notesId="notes-"+Math.floor(1e6*Math.random()),this.createContainer(),this.createHeading(),this.releaseInfo.notes&&(this.createReleaseNotes(),new Craft.FieldToggle(this.$headingContainer))},createContainer:function(){this.$container=i('<div class="pane release"/>').appendTo(this.update.$releaseContainer),this.releaseInfo.critical&&this.$container.addClass("critical")},createHeading:function(){this.releaseInfo.notes?this.$headingContainer=i("<a/>",{class:"release-info fieldtoggle","data-target":this.notesId}):this.$headingContainer=i("<div/>",{class:"release-info"}),this.$headingContainer.appendTo(this.$container),i("<h2/>",{text:this.releaseInfo.version}).appendTo(this.$headingContainer),this.releaseInfo.critical&&i("<strong/>",{class:"critical",text:Craft.t("app","Critical")}).appendTo(this.$headingContainer),this.releaseInfo.date&&i("<span/>",{class:"date",text:Craft.formatDate(this.releaseInfo.date)}).appendTo(this.$headingContainer)},createReleaseNotes:function(){var e=i("<div/>",{id:this.notesId}).appendTo(this.$container).append(i("<div/>",{class:"release-notes"}).html(this.releaseInfo.notes));this.releaseInfo.critical||e.find("blockquote").length?this.$headingContainer.addClass("expanded"):e.addClass("hidden")}},{maxInitialUpdateHeight:500})}(jQuery);
//# sourceMappingURL=UpdatesUtility.min.js.map