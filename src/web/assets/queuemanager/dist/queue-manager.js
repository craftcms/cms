/*! For license information please see queue-manager.js.LICENSE.txt */
!function(){var e={363:function(){},688:function(e,t,r){var n=r(363);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals),(0,r(673).Z)("d039e3d0",n,!0,{})},673:function(e,t,r){"use strict";function n(e,t){for(var r=[],n={},a=0;a<t.length;a++){var o=t[a],i=o[0],s={id:e+":"+a,css:o[1],media:o[2],sourceMap:o[3]};n[i]?n[i].parts.push(s):r.push(n[i]={id:i,parts:[s]})}return r}r.d(t,{Z:function(){return b}});var a="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},i=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,u=0,c=!1,l=function(){},d=null,f="data-vue-ssr-id",p="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function b(e,t,r,a){c=r,d=a||{};var i=n(e,t);return v(i),function(t){for(var r=[],a=0;a<i.length;a++){var s=i[a];(u=o[s.id]).refs--,r.push(u)}for(t?v(i=n(e,t)):i=[],a=0;a<r.length;a++){var u;if(0===(u=r[a]).refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete o[u.id]}}}}function v(e){for(var t=0;t<e.length;t++){var r=e[t],n=o[r.id];if(n){n.refs++;for(var a=0;a<n.parts.length;a++)n.parts[a](r.parts[a]);for(;a<r.parts.length;a++)n.parts.push(m(r.parts[a]));n.parts.length>r.parts.length&&(n.parts.length=r.parts.length)}else{var i=[];for(a=0;a<r.parts.length;a++)i.push(m(r.parts[a]));o[r.id]={id:r.id,refs:1,parts:i}}}}function h(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function m(e){var t,r,n=document.querySelector("style["+f+'~="'+e.id+'"]');if(n){if(c)return l;n.parentNode.removeChild(n)}if(p){var a=u++;n=s||(s=h()),t=J.bind(null,n,a,!1),r=J.bind(null,n,a,!0)}else n=h(),t=y.bind(null,n),r=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else r()}}var g,C=(g=[],function(e,t){return g[e]=t,g.filter(Boolean).join("\n")});function J(e,t,r,n){var a=r?"":n.css;if(e.styleSheet)e.styleSheet.cssText=C(t,a);else{var o=document.createTextNode(a),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function y(e,t){var r=t.css,n=t.media,a=t.sourceMap;if(n&&e.setAttribute("media",n),d.ssrId&&e.setAttribute(f,t.id),a&&(r+="\n/*# sourceURL="+a.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={id:n,exports:{}};return e[n](o,o.exports,r),o.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";r(688),new Vue({el:"#main",delimiters:["[[","]]"],data:function(){return{loading:!1,indexTimeout:null,jobs:[],totalJobs:null,totalJobsFormatted:null,activeJobId:null,activeJob:null,limit:50}},mounted:function(){var e=this;document.getElementById("queue-manager-utility").removeAttribute("class"),Craft.cp.on("setJobInfo",(function(){e.jobs=Craft.cp.jobInfo.slice(0),e.totalJobs=Craft.cp.totalJobs,e.totalJobsFormatted=Craft.formatNumber(e.totalJobs),e.loading||e.refreshActiveJob()})),window.onpopstate=function(t){t.state&&t.state.jobId?e.setActiveJob(t.state.jobId,!1):e.clearActiveJob(!1)};var t=Craft.path.match(/utilities\/queue-manager\/([^\/]+)/);if(t){var r=t[1];history.replaceState({jobId:r},"",this.url(r)),this.setActiveJob(r,!1)}},methods:{updateJobProgress:function(){Craft.cp.trackJobProgress(!1,!0)},setActiveJob:function(e,t){var r=this;return new Promise((function(n,a){window.clearTimeout(r.indexTimeout),r.loading=!0,r.activeJobId=e,t&&history.pushState({jobId:e},"",r.url(e)),axios.get(Craft.getActionUrl("queue/get-job-details?id="+e,{})).then((function(e){e.data.id==r.activeJobId?(r.activeJob=e.data,r.loading=!1,n(!0)):n(!1)}),(function(e){var t;Craft.cp.displayError(null==e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message),a(e)}))}))},refreshActiveJob:function(){var e=this;return new Promise((function(t,r){if(e.activeJobId){var n=e.activeJob;e.setActiveJob(e.activeJobId,!1).then((function(r){r&&n&&3==e.activeJob.status&&($.extend(n,{progress:100,status:3}),delete n.error,delete n.progressLabel,e.activeJob=n),t(r)})).catch(r)}else t(!1)}))},retryAll:function(){var e=this;return new Promise((function(t,r){window.clearTimeout(e.indexTimeout),Craft.sendActionRequest("POST","queue/retry-all").then((function(r){Craft.cp.displayNotice(Craft.t("app","Retrying all failed jobs.")),e.updateJobProgress(),t()})).catch(r)}))},releaseAll:function(){var e=this;return new Promise((function(t,r){confirm(Craft.t("app","Are you sure you want to release all jobs in the queue?"))?Craft.sendActionRequest("POST","queue/release-all").then((function(r){Craft.cp.displayNotice(Craft.t("app","All jobs released.")),e.clearActiveJob(!0),e.updateJobProgress(),t(!0)})).catch(r):t(!1)}))},retryJob:function(e){var t=this;return new Promise((function(r,n){if(2==e.status){var a=Craft.t("app","Are you sure you want to restart the job “{description}”? Any progress could be lost.",{description:e.description});if(!confirm(a))return void r(!1)}window.clearTimeout(t.indexTimeout),Craft.sendActionRequest("POST","queue/retry",{data:{id:e.id}}).then((function(n){2==e.status?Craft.cp.displayNotice(Craft.t("app","Job restarted.")):Craft.cp.displayNotice(Craft.t("app","Job retried.")),t.updateJobProgress(),r(!0)})).catch(n)}))},retryActiveJob:function(){var e=this;return new Promise((function(t,r){e.retryJob(e.activeJob).then(t).catch(r)}))},releaseJob:function(e){var t=this;return new Promise((function(r,n){var a=Craft.t("app","Are you sure you want to release the job “{description}”?",{description:e.description});confirm(a)?Craft.sendActionRequest("POST","queue/release",{data:{id:e.id}}).then((function(e){Craft.cp.displayNotice(Craft.t("app","Job released.")),t.updateJobProgress(),r(!0)})).catch((function(e){return e.response,n})):r(!1)}))},releaseActiveJob:function(){var e=this;return new Promise((function(t,r){e.releaseJob(e.activeJob).then((function(r){r&&e.clearActiveJob(!0),t(r)})).catch(r)}))},clearActiveJob:function(e){this.activeJob&&(this.activeJob=null,this.activeJobId=null,e&&history.pushState({},"",this.url()))},url:function(e){return Craft.getUrl("utilities/queue-manager"+(e?"/"+e:""))},isRetryable:function(e){return 2==e.status||4==e.status},jobStatusClass:function(e){return 4==e?"error":""},jobStatusLabel:function(e,t){if(t)return Craft.t("app","Delayed");switch(e){case 1:return Craft.t("app","Pending");case 2:return Craft.t("app","Reserved");case 3:return Craft.t("app","Finished");case 4:return Craft.t("app","Failed");default:return""}},jobStatusIconClass:function(e){var t="status";switch(e){case 1:t+=" orange";break;case 2:t+=" green";break;case 4:t+=" red"}return t},jobAttributeName:function(e){switch(e){case"id":return Craft.t("app","ID");case"status":return Craft.t("app","Status");case"progress":return Craft.t("app","Progress");case"description":return Craft.t("app","Description");case"ttr":return Craft.t("app","Time to reserve");case"error":return Craft.t("app","Error");default:return e}},ttrValue:function(e){return Craft.t("app","{num, number} {num, plural, =1{second} other{seconds}}",{num:e})}}})}()}();
//# sourceMappingURL=queue-manager.js.map