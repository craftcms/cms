!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="/",__webpack_require__(__webpack_require__.s=0)}([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(1);!function($){Craft.CraftSupportWidget=Garnish.Base.extend({widgetId:0,envInfo:null,loading:!1,$widget:null,$pane:null,$screens:null,$currentScreen:null,$nextScreen:null,screens:null,currentScreen:null,$helpBody:null,$feedbackBody:null,init:function(widgetId,envInfo){this.widgetId=widgetId,this.envInfo=envInfo,Craft.CraftSupportWidget.widgets[this.widgetId]=this,this.$widget=$("#widget"+widgetId),this.$pane=this.$widget.find("> .front > .pane"),this.$screens=this.$pane.find("> .body > .cs-screen"),this.screens={},this.$currentScreen=this.initScreen(Craft.CraftSupportWidget.SCREEN_HOME).$screen},getScreen:function(screen){return this.$screens.filter(".cs-screen-"+screen+":first")},initScreen:function(screen){return void 0===this.screens[screen]?this.screens[screen]=this.loadScreen(screen):this.screens[screen].reinit(),this.screens[screen]},loadScreen:function(screen){var $screen=this.getScreen(screen);switch(screen){case Craft.CraftSupportWidget.SCREEN_HOME:return new HomeScreen(this,screen,$screen);case Craft.CraftSupportWidget.SCREEN_HELP:return new HelpScreen(this,screen,$screen);case Craft.CraftSupportWidget.SCREEN_FEEDBACK:return new FeedbackScreen(this,screen,$screen);default:throw"Invalid screen: "+screen}},gotoScreen:function(screen){this.$nextScreen&&(this.$currentScreen.velocity("stop").css({opacity:0,display:"none"}),this.$nextScreen.velocity("stop").css({opacity:1}),this.$pane.velocity("stop"),this.handleScreenAnimationComplete()),this.$nextScreen=this.getScreen(screen).css({display:"block",position:"absolute",left:"0px",top:"0px",width:this.$pane.width()+"px"}),this.$pane.height(this.$pane.height()),this.$currentScreen.velocity({opacity:0},{display:"none"}),this.$nextScreen.velocity({opacity:1}),this.$pane.velocity({height:this.$nextScreen.outerHeight()},{complete:$.proxy(this,"handleScreenAnimationComplete")}),this.currentScreen=this.initScreen(screen)},handleScreenAnimationComplete:function(){this.$pane.height("auto"),this.$nextScreen.css({position:"relative",width:"auto"}),this.$currentScreen=this.$nextScreen,this.$nextScreen=null}},{widgets:{},SCREEN_HOME:"home",SCREEN_HELP:"help",SCREEN_FEEDBACK:"feedback"});var BaseScreen=Garnish.Base.extend({widget:null,screen:null,$screen:null,init:function(widget,screen,$screen){this.widget=widget,this.screen=screen,this.$screen=$screen,this.afterInit()},afterInit:$.noop,reinit:$.noop}),HomeScreen=BaseScreen.extend({afterInit:function(){var $options=this.$screen.children(".cs-opt");this.addListener($options,"click","handleOptionClick")},handleOptionClick:function(ev){var screen=$.attr(ev.currentTarget,"data-screen");this.widget.gotoScreen(screen)}}),BaseSearchScreen=BaseScreen.extend({$body:null,$formContainer:null,mode:null,bodyStartHeight:null,$searchResultsContainer:null,$searchResults:null,$searchForm:null,$searchParams:null,$searchSubmit:null,searchTimeout:null,showingResults:!1,$supportForm:null,$supportMessage:null,$supportAttachment:null,$supportSubmit:null,$supportSpinner:null,$supportErrorList:null,$supportIframe:null,sendingSupportTicket:!1,afterInit:function(){this.$body=this.$screen.find(".cs-body-text:first").trigger("focus"),this.$formContainer=this.$screen.children(".cs-forms"),this.$searchResultsContainer=this.$screen.children(".cs-search-results-container:first"),this.$searchResults=this.$searchResultsContainer.find(".cs-search-results:first"),this.$searchForm=this.$formContainer.children(".cs-search-form:first"),this.$searchParams=this.$searchForm.children(".cs-search-params:first"),this.$searchSubmit=this.$searchForm.children(".submit:first"),this.addListener(this.$searchForm,"submit","handleSearchFormSubmit"),this.addListener(this.$searchForm.find("> p > a"),"click","handleSupportLinkClick"),this.$supportForm=this.$formContainer.children(".cs-support-form:first"),this.$supportMessage=this.$supportForm.children("input.cs-support-message");var $more=this.$supportForm.children(".cs-support-more");this.$supportAttachment=$more.find(".cs-support-attachment:first"),this.$supportSubmit=this.$supportForm.children(".submit:first"),this.$supportSpinner=this.$supportForm.children(".spinner:first"),this.$supportIframe=this.$screen.children("iframe"),this.addListener(this.$supportForm,"submit","handleSupportFormSubmit"),this.bodyStartHeight=this.$body.height(),this.addListener(this.$body,"input","handleBodyTextChange"),this.addListener(this.$body,"keydown","handleBodyKeydown"),this.prepForSearch(!1)},handleSearchFormSubmit:function(ev){this.$body.val()||ev.preventDefault()},handleBodyTextChange:function(){var text=this.$body.val();if(this.mode===BaseSearchScreen.MODE_SEARCH)if(this.clearSearchTimeout(),this.searchTimeout=setTimeout($.proxy(this,"search"),500),text){this.$searchParams.html("");var params=this.getFormParams(text);for(var name in params)params.hasOwnProperty(name)&&$("<input/>",{type:"hidden",name:name,value:params[name]}).appendTo(this.$searchParams);this.$searchSubmit.removeClass("disabled")}else this.$searchSubmit.addClass("disabled");else text?(this.$supportMessage.val(text),this.$supportSubmit.removeClass("disabled")):this.$supportSubmit.addClass("disabled")},handleBodyKeydown:function(ev){switch(ev.keyCode){case Garnish.ESC_KEY:this.mode===BaseSearchScreen.MODE_SEARCH?this.widget.gotoScreen(Craft.CraftSupportWidget.SCREEN_HOME):this.sendingSupportTicket||this.prepForSearch(!0);break;case Garnish.RETURN_KEY:Garnish.isCtrlKeyPressed(ev)&&(this.mode===BaseSearchScreen.MODE_SEARCH?this.$searchForm.trigger("submit"):this.$supportForm.trigger("submit"))}},handleSupportLinkClick:function(){this.prepForSupport(!0)},clearSearchTimeout:function(){this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null)},search:function(){if(this.clearSearchTimeout(),this.$body.val()){var url=this.getSearchUrl(this.$body.val());$.ajax({url:url,dataType:"json",success:$.proxy(this,"handleSearchSuccess"),error:$.proxy(this,"hideSearchResults")})}else this.hideSearchResults()},handleSearchSuccess:function(response){if(this.mode===BaseSearchScreen.MODE_SEARCH){var results=this.getSearchResults(response);if(results.length){var startResultsHeight;this.showingResults?startResultsHeight=this.$searchResultsContainer.height():(this.$searchResultsContainer.removeClass("hidden"),startResultsHeight=0,this.showingResults=!0,this.$screen.addClass("with-results")),this.$searchResults.html("");for(var max=Math.min(results.length,20),i=0;i<max;i++)this.$searchResults.append($("<li>").append($("<a>",{href:this.getSearchResultUrl(results[i]),target:"_blank",html:'<span class="status '+this.getSearchResultStatus(results[i])+'"></span>'+this.getSearchResultText(results[i])})));var endResultsHeight=this.$searchResultsContainer.height("auto").height();this.$searchResultsContainer.velocity("stop").height(startResultsHeight).velocity({height:endResultsHeight},{complete:$.proxy((function(){this.$searchResultsContainer.height("auto")}),this)})}else this.hideSearchResults()}},hideSearchResults:function(){this.mode===BaseSearchScreen.MODE_SEARCH&&this.showingResults&&(this.$searchResultsContainer.velocity("stop").height(this.$searchResultsContainer.height()).velocity({height:0},{complete:$.proxy((function(){this.$searchResultsContainer.addClass("hidden")}),this)}),this.showingResults=!1,this.$screen.removeClass("with-results"))},handleSupportFormSubmit:function(ev){this.$body.val()&&!this.sendingSupportTicket?(this.sendingSupportTicket=!0,this.$supportSubmit.addClass("active"),this.$supportSpinner.removeClass("hidden")):ev.preventDefault()},reinit:function(){this.$body.trigger("focus")},prepForSearch:function(animate){this.mode=BaseSearchScreen.MODE_SEARCH,this.$body.velocity("stop").trigger("focus"),this.$supportErrorList&&(this.$supportErrorList.remove(),this.$supportErrorList=null),animate?this.$body.velocity({height:this.bodyStartHeight}):this.$body.height(this.bodyStartHeight),this.swapForms(this.$supportForm,this.$searchForm,animate),this.handleBodyTextChange(),this.search()},prepForSupport:function(animate){this.clearSearchTimeout(),this.hideSearchResults(),this.mode=BaseSearchScreen.MODE_SUPPORT,this.$body.velocity("stop").trigger("focus"),animate?this.$body.velocity({height:2*this.bodyStartHeight}):this.$body.height(2*this.bodyStartHeight),this.swapForms(this.$searchForm,this.$supportForm,animate),this.handleBodyTextChange()},swapForms:function($out,$in,animate){if(animate){this.$formContainer.height(this.$formContainer.height());var width=this.$formContainer.width();$out.velocity("stop").css({position:"absolute",top:0,left:0,width:width}).velocity({opacity:0},{complete:function(){$out.addClass("hidden").css({position:"relative",width:"auto"})}}),$in.velocity("stop").removeClass("hidden").css({position:"absolute",top:0,left:0,width:width}).velocity({opacity:1},{complete:function(){$in.css({position:"relative",width:"auto"})}}),this.$formContainer.velocity("stop").velocity({height:$in.height()},{complete:$.proxy((function(){this.$formContainer.css({height:"auto"})}),this)})}else $out.addClass("hidden"),$in.removeClass("hidden")},parseSupportResponse:function(response){if(this.sendingSupportTicket=!1,this.$supportSubmit.removeClass("active"),this.$supportSpinner.addClass("hidden"),this.$supportErrorList&&this.$supportErrorList.children().remove(),response.errors)for(var attribute in this.$supportErrorList||(this.$supportErrorList=$('<ul class="errors"/>').insertAfter(this.$supportForm)),response.errors)if(response.errors.hasOwnProperty(attribute))for(var i=0;i<response.errors[attribute].length;i++){var error=response.errors[attribute][i];$("<li>"+error+"</li>").appendTo(this.$supportErrorList)}response.success&&(Craft.cp.displayNotice(Craft.t("app","Message sent successfully.")),this.$body.val(""),this.$supportMessage.val(""),this.$supportAttachment.val("")),this.$supportIframe.html("")},getFormParams:function(){throw"getFormParams() must be implemented"},getSearchUrl:function(){throw"getSearchUrl() must be implemented"},getSearchResults:function(){throw"getSearchResults() must be implemented"},getSearchResultUrl:function(){throw"getSearchResultUrl() must be implemented"},getSearchResultStatus:function(){throw"getSearchResultStatus() must be implemented"},getSearchResultText:function(){throw"getSearchResultUrl() must be implemented"}},{MODE_SEARCH:"search",MODE_SUPPORT:"support"}),HelpScreen=BaseSearchScreen.extend({getFormParams:function(query){return{title:query}},getSearchUrl:function(query){return"https://api.stackexchange.com/2.2/similar?site=craftcms&sort=relevance&order=desc&title="+encodeURIComponent(query)},getSearchResults:function(response){return response.items||[]},getSearchResultUrl:function(result){return result.link},getSearchResultStatus:function(result){return result.is_answered?"green":""},getSearchResultText:function(result){return result.title}}),FeedbackScreen=BaseSearchScreen.extend({getFormParams:function(query){var body="### Description\n\n\n\n### Steps to reproduce\n\n1.\n2.\n\n### Additional info\n";for(var name in this.widget.envInfo)this.widget.envInfo.hasOwnProperty(name)&&(body+="\n- "+name+": "+this.widget.envInfo[name]);return{title:query,body:body}},getSearchUrl:function(query){return"https://api.github.com/search/issues?q=type:issue+repo:craftcms/cms+"+encodeURIComponent(query)},getSearchResults:function(response){return response.items||[]},getSearchResultUrl:function(result){return result.html_url},getSearchResultStatus:function(result){return"open"===result.state?"green":"red"},getSearchResultText:function(result){return result.title}})}(jQuery)},function(module,exports,__webpack_require__){var content=__webpack_require__(2);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[module.i,content,""]]),content.locals&&(module.exports=content.locals);(0,__webpack_require__(3).default)("4126d794",content,!0,{})},function(module,exports,__webpack_require__){},function(module,__webpack_exports__,__webpack_require__){"use strict";function listToStyles(parentId,list){for(var styles=[],newStyles={},i=0;i<list.length;i++){var item=list[i],id=item[0],part={id:parentId+":"+i,css:item[1],media:item[2],sourceMap:item[3]};newStyles[id]?newStyles[id].parts.push(part):styles.push(newStyles[id]={id:id,parts:[part]})}return styles}__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",(function(){return addStylesClient}));var hasDocument="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!hasDocument)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var stylesInDom={},head=hasDocument&&(document.head||document.getElementsByTagName("head")[0]),singletonElement=null,singletonCounter=0,isProduction=!1,noop=function(){},options=null,isOldIE="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function addStylesClient(parentId,list,_isProduction,_options){isProduction=_isProduction,options=_options||{};var styles=listToStyles(parentId,list);return addStylesToDom(styles),function(newList){for(var mayRemove=[],i=0;i<styles.length;i++){var item=styles[i];(domStyle=stylesInDom[item.id]).refs--,mayRemove.push(domStyle)}newList?addStylesToDom(styles=listToStyles(parentId,newList)):styles=[];for(i=0;i<mayRemove.length;i++){var domStyle;if(0===(domStyle=mayRemove[i]).refs){for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j]();delete stylesInDom[domStyle.id]}}}}function addStylesToDom(styles){for(var i=0;i<styles.length;i++){var item=styles[i],domStyle=stylesInDom[item.id];if(domStyle){domStyle.refs++;for(var j=0;j<domStyle.parts.length;j++)domStyle.parts[j](item.parts[j]);for(;j<item.parts.length;j++)domStyle.parts.push(addStyle(item.parts[j]));domStyle.parts.length>item.parts.length&&(domStyle.parts.length=item.parts.length)}else{var parts=[];for(j=0;j<item.parts.length;j++)parts.push(addStyle(item.parts[j]));stylesInDom[item.id]={id:item.id,refs:1,parts:parts}}}}function createStyleElement(){var styleElement=document.createElement("style");return styleElement.type="text/css",head.appendChild(styleElement),styleElement}function addStyle(obj){var update,remove,styleElement=document.querySelector('style[data-vue-ssr-id~="'+obj.id+'"]');if(styleElement){if(isProduction)return noop;styleElement.parentNode.removeChild(styleElement)}if(isOldIE){var styleIndex=singletonCounter++;styleElement=singletonElement||(singletonElement=createStyleElement()),update=applyToSingletonTag.bind(null,styleElement,styleIndex,!1),remove=applyToSingletonTag.bind(null,styleElement,styleIndex,!0)}else styleElement=createStyleElement(),update=applyToTag.bind(null,styleElement),remove=function(){styleElement.parentNode.removeChild(styleElement)};return update(obj),function(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap)return;update(obj=newObj)}else remove()}}var textStore,replaceText=(textStore=[],function(index,replacement){return textStore[index]=replacement,textStore.filter(Boolean).join("\n")});function applyToSingletonTag(styleElement,index,remove,obj){var css=remove?"":obj.css;if(styleElement.styleSheet)styleElement.styleSheet.cssText=replaceText(index,css);else{var cssNode=document.createTextNode(css),childNodes=styleElement.childNodes;childNodes[index]&&styleElement.removeChild(childNodes[index]),childNodes.length?styleElement.insertBefore(cssNode,childNodes[index]):styleElement.appendChild(cssNode)}}function applyToTag(styleElement,obj){var css=obj.css,media=obj.media,sourceMap=obj.sourceMap;if(media&&styleElement.setAttribute("media",media),options.ssrId&&styleElement.setAttribute("data-vue-ssr-id",obj.id),sourceMap&&(css+="\n/*# sourceURL="+sourceMap.sources[0]+" */",css+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))+" */"),styleElement.styleSheet)styleElement.styleSheet.cssText=css;else{for(;styleElement.firstChild;)styleElement.removeChild(styleElement.firstChild);styleElement.appendChild(document.createTextNode(css))}}}]);
//# sourceMappingURL=CraftSupportWidget.min.js.map