!function(s){var t=Garnish.Base.extend({messages:null,init:function(){this.messages=[];for(var t=s("#messages").find(".message"),i=0;i<t.length;i++){var n=new e(t[i]);this.messages.push(n)}}}),e=Garnish.Base.extend({$container:null,key:null,$subject:null,$body:null,modal:null,init:function(t){this.$container=s(t),this.key=this.$container.attr("data-key"),this.$subject=this.$container.find(".subject:first"),this.$body=this.$container.find(".body:first"),this.addListener(this.$container,"click","edit")},edit:function(){this.modal?this.modal.show():this.modal=new i(this)},updateHtmlFromModal:function(){var s=this.modal.$subjectInput.val(),t=Craft.escapeHtml(this.modal.$bodyInput.val()).replace(/\n/g,"<br>");this.$subject.text(s),this.$body.html(t)}}),i=Garnish.Modal.extend({message:null,$languageSelect:null,$subjectInput:null,$bodyInput:null,$saveBtn:null,$cancelBtn:null,$spinner:null,loading:!1,init:function(s){this.message=s,this.base(null,{resizable:!0}),this.loadContainer()},loadContainer:function(t){var e={key:this.message.key,language:t};void 0!==Craft.csrfTokenName&&void 0!==Craft.csrfTokenValue&&(e[Craft.csrfTokenName]=Craft.csrfTokenValue),Craft.postActionRequest("system-messages/get-message-modal",e,s.proxy(function(t,e){if("success"===e){if(this.$container)this.$container.html(t.body);else{var i=s('<form class="modal fitted message-settings" accept-charset="UTF-8">'+t.body+"</form>").appendTo(Garnish.$bod);this.setContainer(i),this.show()}this.$languageSelect=this.$container.find(".language:first > select"),this.$subjectInput=this.$container.find(".message-subject:first"),this.$bodyInput=this.$container.find(".message-body:first"),this.$saveBtn=this.$container.find(".submit:first"),this.$cancelBtn=this.$container.find(".cancel:first"),this.$spinner=this.$container.find(".spinner:first"),this.addListener(this.$languageSelect,"change","switchLanguage"),this.addListener(this.$container,"submit","saveMessage"),this.addListener(this.$cancelBtn,"click","cancel"),setTimeout(s.proxy(function(){this.$subjectInput.trigger("focus")},this),100)}},this))},switchLanguage:function(){this.loadContainer(this.$languageSelect.val())},saveMessage:function(t){if(t.preventDefault(),!this.loading){var e={key:this.message.key,language:this.$languageSelect.length?this.$languageSelect.val():Craft.primarySiteLanguage,subject:this.$subjectInput.val(),body:this.$bodyInput.val()};if(this.$subjectInput.removeClass("error"),this.$bodyInput.removeClass("error"),!e.subject||!e.body)return e.subject||this.$subjectInput.addClass("error"),e.body||this.$bodyInput.addClass("error"),void Garnish.shake(this.$container);this.loading=!0,this.$saveBtn.addClass("active"),this.$spinner.show(),Craft.postActionRequest("system-messages/save-message",e,s.proxy(function(s,t){this.$saveBtn.removeClass("active"),this.$spinner.hide(),this.loading=!1,"success"===t&&(s.success?(e.language===Craft.primarySiteLanguage&&this.message.updateHtmlFromModal(),this.hide(),Craft.cp.displayNotice(Craft.t("app","Message saved."))):Craft.cp.displayError())},this))}},cancel:function(){this.hide(),this.message&&(this.message.modal=null)}});new t}(jQuery);
//# sourceMappingURL=system_messages.min.js.map